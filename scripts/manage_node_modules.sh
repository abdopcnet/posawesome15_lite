#!/bin/bash
# Script to backup and restore optimized node_modules

BACKUP_DIR="node_modules.backup"
NODE_MODULES="node_modules"

case "$1" in
  backup)
    echo "üì¶ Backing up node_modules..."
    if [ -d "$NODE_MODULES" ]; then
      rm -rf "$BACKUP_DIR"
      cp -r "$NODE_MODULES" "$BACKUP_DIR"
      echo "‚úÖ Backup created: $BACKUP_DIR"
      du -sh "$BACKUP_DIR"
    else
      echo "‚ùå node_modules not found"
    fi
    ;;
  restore)
    echo "üì¶ Restoring node_modules from backup..."
    if [ -d "$BACKUP_DIR" ]; then
      rm -rf "$NODE_MODULES"
      cp -r "$BACKUP_DIR" "$NODE_MODULES"
      echo "‚úÖ Restored from: $BACKUP_DIR"
      du -sh "$NODE_MODULES"
    else
      echo "‚ùå Backup not found: $BACKUP_DIR"
    fi
    ;;
  clean)
    echo "üßπ Cleaning node_modules (keeping only production deps)..."
    if [ -d "$NODE_MODULES" ]; then
      # Remove dev dependencies
      rm -rf "$NODE_MODULES/@vue" "$NODE_MODULES/@babel" "$NODE_MODULES/@jridgewell"
      rm -rf "$NODE_MODULES/csstype" "$NODE_MODULES/entities" "$NODE_MODULES/magic-string"
      rm -rf "$NODE_MODULES/postcss" "$NODE_MODULES/source-map-js" "$NODE_MODULES/nanoid"
      rm -rf "$NODE_MODULES/estree-walker" "$NODE_MODULES/picocolors"
      echo "‚úÖ Cleaned dev dependencies"
      du -sh "$NODE_MODULES"
    fi
    ;;
  *)
    echo "Usage: $0 {backup|restore|clean}"
    echo "  backup  - Create backup of current node_modules"
    echo "  restore - Restore node_modules from backup"
    echo "  clean   - Remove dev dependencies from node_modules"
    exit 1
    ;;
esac
