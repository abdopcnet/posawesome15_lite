(()=>{var Ra=Object.defineProperty,Ma=Object.defineProperties;var Va=Object.getOwnPropertyDescriptors;var Qn=Object.getOwnPropertySymbols;var La=Object.prototype.hasOwnProperty,Ua=Object.prototype.propertyIsEnumerable;var Jn=(e,t,o)=>t in e?Ra(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,ve=(e,t)=>{for(var o in t||(t={}))La.call(t,o)&&Jn(e,o,t[o]);if(Qn)for(var o of Qn(t))Ua.call(t,o)&&Jn(e,o,t[o]);return e},Ce=(e,t)=>Ma(e,Va(t));$(function(){frappe.realtime.on("toconsole",function(e){e.forEach(t=>{})})});function Jt(e,t){let o=Object.create(null),i=e.split(",");for(let s=0;s<i.length;s++)o[i[s]]=!0;return t?s=>!!o[s.toLowerCase()]:s=>!!o[s]}var he={},Rt=[],$e=()=>{},es=()=>!1,Fa=/^on[^a-z]/,Xt=e=>Fa.test(e),go=e=>e.startsWith("onUpdate:"),Te=Object.assign,Bo=(e,t)=>{let o=e.indexOf(t);o>-1&&e.splice(o,1)},za=Object.prototype.hasOwnProperty,re=(e,t)=>za.call(e,t),H=Array.isArray,gt=e=>Zt(e)==="[object Map]",mt=e=>Zt(e)==="[object Set]",Xn=e=>Zt(e)==="[object Date]",ts=e=>Zt(e)==="[object RegExp]",Z=e=>typeof e=="function",be=e=>typeof e=="string",At=e=>typeof e=="symbol",fe=e=>e!==null&&typeof e=="object",Wi=e=>(fe(e)||Z(e))&&Z(e.then)&&Z(e.catch),os=Object.prototype.toString,Zt=e=>os.call(e),Ki=e=>Zt(e).slice(8,-1),Yi=e=>Zt(e)==="[object Object]",Ho=e=>be(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,mo=Jt(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted");var Go=e=>{let t=Object.create(null);return o=>t[o]||(t[o]=e(o))},ja=/-(\w)/g,ze=Go(e=>e.replace(ja,(t,o)=>o?o.toUpperCase():"")),$a=/\B([A-Z])/g,st=Go(e=>e.replace($a,"-$1").toLowerCase()),Mt=Go(e=>e.charAt(0).toUpperCase()+e.slice(1)),yo=Go(e=>e?`on${Mt(e)}`:""),rt=(e,t)=>!Object.is(e,t),yt=(e,t)=>{for(let o=0;o<e.length;o++)e[o](t)},eo=(e,t,o)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:o})},to=e=>{let t=parseFloat(e);return isNaN(t)?e:t},Qi=e=>{let t=be(e)?Number(e):NaN;return isNaN(t)?e:t},Zn,qo=()=>Zn||(Zn=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});function k(e){if(H(e)){let t={};for(let o=0;o<e.length;o++){let i=e[o],s=be(i)?qa(i):k(i);if(s)for(let r in s)t[r]=s[r]}return t}else if(be(e)||fe(e))return e}var Ba=/;(?![^(]*\))/g,Ha=/:([^]+)/,Ga=/\/\*[^]*?\*\//g;function qa(e){let t={};return e.replace(Ga,"").split(Ba).forEach(o=>{if(o){let i=o.split(Ha);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function at(e){let t="";if(be(e))t=e;else if(H(e))for(let o=0;o<e.length;o++){let i=at(e[o]);i&&(t+=i+" ")}else if(fe(e))for(let o in e)e[o]&&(t+=o+" ");return t.trim()}var is="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ns=Jt(is),Xy=Jt(is+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,inert,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected");function Ji(e){return!!e||e===""}function Wa(e,t){if(e.length!==t.length)return!1;let o=!0;for(let i=0;o&&i<e.length;i++)o=oo(e[i],t[i]);return o}function oo(e,t){if(e===t)return!0;let o=Xn(e),i=Xn(t);if(o||i)return o&&i?e.getTime()===t.getTime():!1;if(o=At(e),i=At(t),o||i)return e===t;if(o=H(e),i=H(t),o||i)return o&&i?Wa(e,t):!1;if(o=fe(e),i=fe(t),o||i){if(!o||!i)return!1;let s=Object.keys(e).length,r=Object.keys(t).length;if(s!==r)return!1;for(let n in e){let c=e.hasOwnProperty(n),p=t.hasOwnProperty(n);if(c&&!p||!c&&p||!oo(e[n],t[n]))return!1}}return String(e)===String(t)}function Wo(e,t){return e.findIndex(o=>oo(o,t))}var x=e=>be(e)?e:e==null?"":H(e)||fe(e)&&(e.toString===os||!Z(e.toString))?JSON.stringify(e,ss,2):String(e),ss=(e,t)=>t&&t.__v_isRef?ss(e,t.value):gt(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((o,[i,s])=>(o[`${i} =>`]=s,o),{})}:mt(t)?{[`Set(${t.size})`]:[...t.values()]}:fe(t)&&!H(t)&&!Yi(t)?String(t):t;var Qe,vo=class{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Qe,!t&&Qe&&(this.index=(Qe.scopes||(Qe.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){let o=Qe;try{return Qe=this,t()}finally{Qe=o}}}on(){Qe=this}off(){Qe=this.parent}stop(t){if(this._active){let o,i;for(o=0,i=this.effects.length;o<i;o++)this.effects[o].stop();for(o=0,i=this.cleanups.length;o<i;o++)this.cleanups[o]();if(this.scopes)for(o=0,i=this.scopes.length;o<i;o++)this.scopes[o].stop(!0);if(!this.detached&&this.parent&&!t){let s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}};function Ka(e,t=Qe){t&&t.active&&t.effects.push(e)}function rn(){return Qe}var an=e=>{let t=new Set(e);return t.w=0,t.n=0,t},us=e=>(e.w&xt)>0,_s=e=>(e.n&xt)>0,Ya=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=xt},Qa=e=>{let{deps:t}=e;if(t.length){let o=0;for(let i=0;i<t.length;i++){let s=t[i];us(s)&&!_s(s)?s.delete(e):t[o++]=s,s.w&=~xt,s.n&=~xt}t.length=o}},Xi=new WeakMap,bo=0,xt=1,Zi=30,Je,Vt=Symbol(""),en=Symbol(""),Lt=class{constructor(t,o=null,i){this.fn=t,this.scheduler=o,this.active=!0,this.deps=[],this.parent=void 0,Ka(this,i)}run(){if(!this.active)return this.fn();let t=Je,o=vt;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=Je,Je=this,vt=!0,xt=1<<++bo,bo<=Zi?Ya(this):rs(this),this.fn()}finally{bo<=Zi&&Qa(this),xt=1<<--bo,Je=this.parent,vt=o,this.parent=void 0,this.deferStop&&this.stop()}}stop(){Je===this?this.deferStop=!0:this.active&&(rs(this),this.onStop&&this.onStop(),this.active=!1)}};function rs(e){let{deps:t}=e;if(t.length){for(let o=0;o<t.length;o++)t[o].delete(e);t.length=0}}var vt=!0,hs=[];function Et(){hs.push(vt),vt=!1}function Ot(){let e=hs.pop();vt=e===void 0?!0:e}function Le(e,t,o){if(vt&&Je){let i=Xi.get(e);i||Xi.set(e,i=new Map);let s=i.get(o);s||i.set(o,s=an()),gs(s,void 0)}}function gs(e,t){let o=!1;bo<=Zi?_s(e)||(e.n|=xt,o=!us(e)):o=!e.has(Je),o&&(e.add(Je),Je.deps.push(e))}function tt(e,t,o,i,s,r){let n=Xi.get(e);if(!n)return;let c=[];if(t==="clear")c=[...n.values()];else if(o==="length"&&H(e)){let f=Number(i);n.forEach((_,b)=>{(b==="length"||!At(b)&&b>=f)&&c.push(_)})}else switch(o!==void 0&&c.push(n.get(o)),t){case"add":H(e)?Ho(o)&&c.push(n.get("length")):(c.push(n.get(Vt)),gt(e)&&c.push(n.get(en)));break;case"delete":H(e)||(c.push(n.get(Vt)),gt(e)&&c.push(n.get(en)));break;case"set":gt(e)&&c.push(n.get(Vt));break}let p=void 0;if(c.length===1)c[0]&&tn(c[0]);else{let f=[];for(let _ of c)_&&f.push(..._);tn(an(f))}}function tn(e,t){let o=H(e)?e:[...e];for(let i of o)i.computed&&as(i,t);for(let i of o)i.computed||as(i,t)}function as(e,t){(e!==Je||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}var Ja=Jt("__proto__,__v_isRef,__isVue"),ms=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(At)),ls=Xa();function Xa(){let e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...o){let i=ie(this);for(let r=0,n=this.length;r<n;r++)Le(i,"get",r+"");let s=i[t](...o);return s===-1||s===!1?i[t](...o.map(ie)):s}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...o){Et();let i=ie(this)[t].apply(this,o);return Ot(),i}}),e}function Za(e){let t=ie(this);return Le(t,"has",e),t.hasOwnProperty(e)}var Zo=class{constructor(t=!1,o=!1){this._isReadonly=t,this._shallow=o}get(t,o,i){let s=this._isReadonly,r=this._shallow;if(o==="__v_isReactive")return!s;if(o==="__v_isReadonly")return s;if(o==="__v_isShallow")return r;if(o==="__v_raw"&&i===(s?r?pl:vs:r?bs:ys).get(t))return t;let n=H(t);if(!s){if(n&&re(ls,o))return Reflect.get(ls,o,i);if(o==="hasOwnProperty")return Za}let c=Reflect.get(t,o,i);return(At(o)?ms.has(o):Ja(o))||(s||Le(t,"get",o),r)?c:Ne(c)?n&&Ho(o)?c:c.value:fe(c)?s?pn(c):wo(c):c}},ei=class extends Zo{constructor(t=!1){super(!1,t)}set(t,o,i,s){let r=t[o];if(wt(r)&&Ne(r)&&!Ne(i))return!1;if(!this._shallow&&(!io(i)&&!wt(i)&&(r=ie(r),i=ie(i)),!H(t)&&Ne(r)&&!Ne(i)))return r.value=i,!0;let n=H(t)&&Ho(o)?Number(o)<t.length:re(t,o),c=Reflect.set(t,o,i,s);return t===ie(s)&&(n?rt(i,r)&&tt(t,"set",o,i,r):tt(t,"add",o,i)),c}deleteProperty(t,o){let i=re(t,o),s=t[o],r=Reflect.deleteProperty(t,o);return r&&i&&tt(t,"delete",o,void 0,s),r}has(t,o){let i=Reflect.has(t,o);return(!At(o)||!ms.has(o))&&Le(t,"has",o),i}ownKeys(t){return Le(t,"iterate",H(t)?"length":Vt),Reflect.ownKeys(t)}},on=class extends Zo{constructor(t=!1){super(!0,t)}set(t,o){return!0}deleteProperty(t,o){return!0}},el=new ei,tl=new on,ol=new ei(!0);var ln=e=>e,ti=e=>Reflect.getPrototypeOf(e);function Ko(e,t,o=!1,i=!1){e=e.__v_raw;let s=ie(e),r=ie(t);o||(rt(t,r)&&Le(s,"get",t),Le(s,"get",r));let{has:n}=ti(s),c=i?ln:o?un:xo;if(n.call(s,t))return c(e.get(t));if(n.call(s,r))return c(e.get(r));e!==s&&e.get(t)}function Yo(e,t=!1){let o=this.__v_raw,i=ie(o),s=ie(e);return t||(rt(e,s)&&Le(i,"has",e),Le(i,"has",s)),e===s?o.has(e):o.has(e)||o.has(s)}function Qo(e,t=!1){return e=e.__v_raw,!t&&Le(ie(e),"iterate",Vt),Reflect.get(e,"size",e)}function cs(e){e=ie(e);let t=ie(this);return ti(t).has.call(t,e)||(t.add(e),tt(t,"add",e,e)),this}function ds(e,t){t=ie(t);let o=ie(this),{has:i,get:s}=ti(o),r=i.call(o,e);r||(e=ie(e),r=i.call(o,e));let n=s.call(o,e);return o.set(e,t),r?rt(t,n)&&tt(o,"set",e,t,n):tt(o,"add",e,t),this}function ps(e){let t=ie(this),{has:o,get:i}=ti(t),s=o.call(t,e);s||(e=ie(e),s=o.call(t,e));let r=i?i.call(t,e):void 0,n=t.delete(e);return s&&tt(t,"delete",e,void 0,r),n}function fs(){let e=ie(this),t=e.size!==0,o=void 0,i=e.clear();return t&&tt(e,"clear",void 0,void 0,o),i}function Jo(e,t){return function(i,s){let r=this,n=r.__v_raw,c=ie(n),p=t?ln:e?un:xo;return!e&&Le(c,"iterate",Vt),n.forEach((f,_)=>i.call(s,p(f),p(_),r))}}function Xo(e,t,o){return function(...i){let s=this.__v_raw,r=ie(s),n=gt(r),c=e==="entries"||e===Symbol.iterator&&n,p=e==="keys"&&n,f=s[e](...i),_=o?ln:t?un:xo;return!t&&Le(r,"iterate",p?en:Vt),{next(){let{value:b,done:y}=f.next();return y?{value:b,done:y}:{value:c?[_(b[0]),_(b[1])]:_(b),done:y}},[Symbol.iterator](){return this}}}}function bt(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function il(){let e={get(r){return Ko(this,r)},get size(){return Qo(this)},has:Yo,add:cs,set:ds,delete:ps,clear:fs,forEach:Jo(!1,!1)},t={get(r){return Ko(this,r,!1,!0)},get size(){return Qo(this)},has:Yo,add:cs,set:ds,delete:ps,clear:fs,forEach:Jo(!1,!0)},o={get(r){return Ko(this,r,!0)},get size(){return Qo(this,!0)},has(r){return Yo.call(this,r,!0)},add:bt("add"),set:bt("set"),delete:bt("delete"),clear:bt("clear"),forEach:Jo(!0,!1)},i={get(r){return Ko(this,r,!0,!0)},get size(){return Qo(this,!0)},has(r){return Yo.call(this,r,!0)},add:bt("add"),set:bt("set"),delete:bt("delete"),clear:bt("clear"),forEach:Jo(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=Xo(r,!1,!1),o[r]=Xo(r,!0,!1),t[r]=Xo(r,!1,!0),i[r]=Xo(r,!0,!0)}),[e,o,t,i]}var[nl,sl,rl,al]=il();function cn(e,t){let o=t?e?al:rl:e?sl:nl;return(i,s,r)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?i:Reflect.get(re(o,s)&&s in i?o:i,s,r)}var ll={get:cn(!1,!1)},cl={get:cn(!1,!0)},dl={get:cn(!0,!1)};var ys=new WeakMap,bs=new WeakMap,vs=new WeakMap,pl=new WeakMap;function fl(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ul(e){return e.__v_skip||!Object.isExtensible(e)?0:fl(Ki(e))}function wo(e){return wt(e)?e:fn(e,!1,el,ll,ys)}function dn(e){return fn(e,!1,ol,cl,bs)}function pn(e){return fn(e,!0,tl,dl,vs)}function fn(e,t,o,i,s){if(!fe(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;let r=s.get(e);if(r)return r;let n=ul(e);if(n===0)return e;let c=new Proxy(e,n===2?i:o);return s.set(e,c),c}function Tt(e){return wt(e)?Tt(e.__v_raw):!!(e&&e.__v_isReactive)}function wt(e){return!!(e&&e.__v_isReadonly)}function io(e){return!!(e&&e.__v_isShallow)}function oi(e){return Tt(e)||wt(e)}function ie(e){let t=e&&e.__v_raw;return t?ie(t):e}function ii(e){return eo(e,"__v_skip",!0),e}var xo=e=>fe(e)?wo(e):e,un=e=>fe(e)?pn(e):e;function xs(e){vt&&Je&&(e=ie(e),gs(e.dep||(e.dep=an())))}function ws(e,t){e=ie(e);let o=e.dep;o&&tn(o)}function Ne(e){return!!(e&&e.__v_isRef===!0)}function ge(e){return _l(e,!1)}function _l(e,t){return Ne(e)?e:new nn(e,t)}var nn=class{constructor(t,o){this.__v_isShallow=o,this.dep=void 0,this.__v_isRef=!0,this._rawValue=o?t:ie(t),this._value=o?t:xo(t)}get value(){return xs(this),this._value}set value(t){let o=this.__v_isShallow||io(t)||wt(t);t=o?t:ie(t),rt(t,this._rawValue)&&(this._rawValue=t,this._value=o?t:xo(t),ws(this,t))}};function Es(e){return Ne(e)?e.value:e}var hl={get:(e,t,o)=>Es(Reflect.get(e,t,o)),set:(e,t,o,i)=>{let s=e[t];return Ne(s)&&!Ne(o)?(s.value=o,!0):Reflect.set(e,t,o,i)}};function ni(e){return Tt(e)?e:new Proxy(e,hl)}var sn=class{constructor(t,o,i,s){this._setter=o,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Lt(t,()=>{this._dirty||(this._dirty=!0,ws(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=i}get value(){let t=ie(this);return xs(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}};function Os(e,t,o=!1){let i,s,r=Z(e);return r?(i=e,s=$e):(i=e.get,s=e.set),new sn(i,s,r||!s,o)}var To=[];function $s(e,...t){}function gl(){let e=To[To.length-1];if(!e)return[];let t=[];for(;e;){let o=t[0];o&&o.vnode===e?o.recurseCount++:t.push({vnode:e,recurseCount:0});let i=e.component&&e.component.parent;e=i&&i.vnode}return t}function ml(e){let t=[];return e.forEach((o,i)=>{t.push(...i===0?[]:[`
`],...yl(o))}),t}function yl({vnode:e,recurseCount:t}){let o=t>0?`... (${t} recursive calls)`:"",i=e.component?e.component.parent==null:!1,s=` at <${vr(e.component,e.type,i)}`,r=">"+o;return e.props?[s,...bl(e.props),r]:[s+r]}function bl(e){let t=[],o=Object.keys(e);return o.slice(0,3).forEach(i=>{t.push(...Bs(i,e[i]))}),o.length>3&&t.push(" ..."),t}function Bs(e,t,o){return be(t)?(t=JSON.stringify(t),o?t:[`${e}=${t}`]):typeof t=="number"||typeof t=="boolean"||t==null?o?t:[`${e}=${t}`]:Ne(t)?(t=Bs(e,ie(t.value),!0),o?t:[`${e}=Ref<`,t,">"]):Z(t)?[`${e}=fn${t.name?`<${t.name}>`:""}`]:(t=ie(t),o?t:[`${e}=`,t])}function ct(e,t,o,i){let s;try{s=i?e(...i):e()}catch(r){hi(r,t,o)}return s}function He(e,t,o,i){if(Z(e)){let r=ct(e,t,o,i);return r&&Wi(r)&&r.catch(n=>{hi(n,t,o)}),r}let s=[];for(let r=0;r<e.length;r++)s.push(He(e[r],t,o,i));return s}function hi(e,t,o,i=!0){let s=t?t.vnode:null;if(t){let r=t.parent,n=t.proxy,c=o;for(;r;){let f=r.ec;if(f){for(let _=0;_<f.length;_++)if(f[_](e,n,c)===!1)return}r=r.parent}let p=t.appContext.config.errorHandler;if(p){ct(p,null,10,[e,n,c]);return}}vl(e,o,s,i)}function vl(e,t,o,i=!0){console.error(e)}var ko=!1,bn=!1,Ae=[],it=0,so=[],lt=null,zt=0,Hs=Promise.resolve(),Tn=null;function Gs(e){let t=Tn||Hs;return e?t.then(this?e.bind(this):e):t}function xl(e){let t=it+1,o=Ae.length;for(;t<o;){let i=t+o>>>1,s=Ae[i],r=Do(s);r<e||r===e&&s.pre?t=i+1:o=i}return t}function Sn(e){(!Ae.length||!Ae.includes(e,ko&&e.allowRecurse?it+1:it))&&(e.id==null?Ae.push(e):Ae.splice(xl(e.id),0,e),qs())}function qs(){!ko&&!bn&&(bn=!0,Tn=Hs.then(Ks))}function wl(e){let t=Ae.indexOf(e);t>it&&Ae.splice(t,1)}function El(e){H(e)?so.push(...e):(!lt||!lt.includes(e,e.allowRecurse?zt+1:zt))&&so.push(e),qs()}function Ts(e,t=ko?it+1:0){for(;t<Ae.length;t++){let o=Ae[t];o&&o.pre&&(Ae.splice(t,1),t--,o())}}function Ws(e){if(so.length){let t=[...new Set(so)];if(so.length=0,lt){lt.push(...t);return}for(lt=t,lt.sort((o,i)=>Do(o)-Do(i)),zt=0;zt<lt.length;zt++)lt[zt]();lt=null,zt=0}}var Do=e=>e.id==null?1/0:e.id,Ol=(e,t)=>{let o=Do(e)-Do(t);if(o===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return o};function Ks(e){bn=!1,ko=!0,Ae.sort(Ol);let t=$e;try{for(it=0;it<Ae.length;it++){let o=Ae[it];o&&o.active!==!1&&ct(o,null,14)}}finally{it=0,Ae.length=0,Ws(e),ko=!1,Tn=null,(Ae.length||so.length)&&Ks(e)}}function Tl(e,t,...o){if(e.isUnmounted)return;let i=e.vnode.props||he,s=o,r=t.startsWith("update:"),n=r&&t.slice(7);if(n&&n in i){let _=`${n==="modelValue"?"model":n}Modifiers`,{number:b,trim:y}=i[_]||he;y&&(s=o.map(A=>be(A)?A.trim():A)),b&&(s=o.map(to))}let c,p=i[c=yo(t)]||i[c=yo(ze(t))];!p&&r&&(p=i[c=yo(st(t))]),p&&He(p,e,6,s);let f=i[c+"Once"];if(f){if(!e.emitted)e.emitted={};else if(e.emitted[c])return;e.emitted[c]=!0,He(f,e,6,s)}}function Ys(e,t,o=!1){let i=t.emitsCache,s=i.get(e);if(s!==void 0)return s;let r=e.emits,n={},c=!1;if(!Z(e)){let p=f=>{let _=Ys(f,t,!0);_&&(c=!0,Te(n,_))};!o&&t.mixins.length&&t.mixins.forEach(p),e.extends&&p(e.extends),e.mixins&&e.mixins.forEach(p)}return!r&&!c?(fe(e)&&i.set(e,null),null):(H(r)?r.forEach(p=>n[p]=null):Te(n,r),fe(e)&&i.set(e,n),n)}function gi(e,t){return!e||!Xt(t)?!1:(t=t.slice(2).replace(/Once$/,""),re(e,t[0].toLowerCase()+t.slice(1))||re(e,st(t))||re(e,t))}var Be=null,Qs=null;function di(e){let t=Be;return Be=e,Qs=e&&e.type.__scopeId||null,t}function Sl(e,t=Be,o){if(!t||e._n)return e;let i=(...s)=>{i._d&&Ls(-1);let r=di(t),n;try{n=e(...s)}finally{di(r),i._d&&Ls(1)}return n};return i._n=!0,i._c=!0,i._d=!0,i}function _n(e){let{type:t,vnode:o,proxy:i,withProxy:s,props:r,propsOptions:[n],slots:c,attrs:p,emit:f,render:_,renderCache:b,data:y,setupState:A,ctx:G,inheritAttrs:C}=e,N,Q,E=di(e);try{if(o.shapeFlag&4){let M=s||i,le=M;N=ot(_.call(le,M,b,r,A,y,G)),Q=p}else{let M=t;N=ot(M.length>1?M(r,{attrs:p,slots:c,emit:f}):M(r,null)),Q=t.props?p:Cl(p)}}catch(M){No.length=0,hi(M,e,1),N=de(Ze)}let U=N,W;if(Q&&C!==!1){let M=Object.keys(Q),{shapeFlag:le}=U;M.length&&le&7&&(n&&M.some(go)&&(Q=Nl(Q,n)),U=dt(U,Q))}return o.dirs&&(U=dt(U),U.dirs=U.dirs?U.dirs.concat(o.dirs):o.dirs),o.transition&&(U.transition=o.transition),N=U,di(E),N}var Cl=e=>{let t;for(let o in e)(o==="class"||o==="style"||Xt(o))&&((t||(t={}))[o]=e[o]);return t},Nl=(e,t)=>{let o={};for(let i in e)(!go(i)||!(i.slice(9)in t))&&(o[i]=e[i]);return o};function kl(e,t,o){let{props:i,children:s,component:r}=e,{props:n,children:c,patchFlag:p}=t,f=r.emitsOptions;if(t.dirs||t.transition)return!0;if(o&&p>=0){if(p&1024)return!0;if(p&16)return i?Ss(i,n,f):!!n;if(p&8){let _=t.dynamicProps;for(let b=0;b<_.length;b++){let y=_[b];if(n[y]!==i[y]&&!gi(f,y))return!0}}}else return(s||c)&&(!c||!c.$stable)?!0:i===n?!1:i?n?Ss(i,n,f):!0:!!n;return!1}function Ss(e,t,o){let i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let s=0;s<i.length;s++){let r=i[s];if(t[r]!==e[r]&&!gi(o,r))return!0}return!1}function Dl({vnode:e,parent:t},o){for(;t&&t.subTree===e;)(e=t.vnode).el=o,t=t.parent}var Cn="components";function Ie(e,t){return Zs(Cn,e,!0,t)||e}var Js=Symbol.for("v-ndc");function Xs(e){return be(e)?Zs(Cn,e,!1)||e:e||Js}function Zs(e,t,o=!0,i=!1){let s=Be||ke;if(s){let r=s.type;if(e===Cn){let c=_i(r,!1);if(c&&(c===t||c===ze(t)||c===Mt(ze(t))))return r}let n=Cs(s[e]||r[e],t)||Cs(s.appContext[e],t);return!n&&i?r:n}}function Cs(e,t){return e&&(e[t]||e[ze(t)]||e[Mt(ze(t))])}var er=e=>e.__isSuspense;function Il(e,t){t&&t.pendingBranch?H(e)?t.effects.push(...e):t.effects.push(e):El(e)}var si={};function $t(e,t,o){return tr(e,t,o)}function tr(e,t,{immediate:o,deep:i,flush:s,onTrack:r,onTrigger:n}=he){var c;let p=M=>{$s("Invalid watch source: ",M,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},f=rn()===((c=ke)==null?void 0:c.scope)?ke:null,_,b=!1,y=!1;if(Ne(e)?(_=()=>e.value,b=io(e)):Tt(e)?(_=()=>e,i=!0):H(e)?(y=!0,b=e.some(M=>Tt(M)||io(M)),_=()=>e.map(M=>{if(Ne(M))return M.value;if(Tt(M))return jt(M);if(Z(M))return ct(M,f,2)})):Z(e)?t?_=()=>ct(e,f,2):_=()=>{if(!(f&&f.isUnmounted))return A&&A(),He(e,f,3,[G])}:_=$e,t&&i){let M=_;_=()=>jt(M())}let A,G=M=>{A=U.onStop=()=>{ct(M,f,4),A=U.onStop=void 0}},C;if(Po)if(G=$e,t?o&&He(t,f,3,[_(),y?[]:void 0,G]):_(),s==="sync"){let M=Oc();C=M.__watcherHandles||(M.__watcherHandles=[])}else return $e;let N=y?new Array(e.length).fill(si):si,Q=()=>{if(!!U.active)if(t){let M=U.run();(i||b||(y?M.some((le,ce)=>rt(le,N[ce])):rt(M,N)))&&(A&&A(),He(t,f,3,[M,N===si?void 0:y&&N[0]===si?[]:N,G]),N=M)}else U.run()};Q.allowRecurse=!!t;let E;s==="sync"?E=Q:s==="post"?E=()=>De(Q,f&&f.suspense):(Q.pre=!0,f&&(Q.id=f.uid),E=()=>Sn(Q));let U=new Lt(_,E);t?o?Q():N=U.run():s==="post"?De(U.run.bind(U),f&&f.suspense):U.run();let W=()=>{U.stop(),f&&f.scope&&Bo(f.scope.effects,U)};return C&&C.push(W),W}function Pl(e,t,o){let i=this.proxy,s=be(e)?e.includes(".")?or(i,e):()=>i[e]:e.bind(i,i),r;Z(t)?r=t:(r=t.handler,o=t);let n=ke;ao(this);let c=tr(s,r.bind(i),o);return n?ao(n):Bt(),c}function or(e,t){let o=t.split(".");return()=>{let i=e;for(let s=0;s<o.length&&i;s++)i=i[o[s]];return i}}function jt(e,t){if(!fe(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),Ne(e))jt(e.value,t);else if(H(e))for(let o=0;o<e.length;o++)jt(e[o],t);else if(mt(e)||gt(e))e.forEach(o=>{jt(o,t)});else if(Yi(e))for(let o in e)jt(e[o],t);return e}function ee(e,t){let o=Be;if(o===null)return e;let i=Oi(o)||o.proxy,s=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[n,c,p,f=he]=t[r];n&&(Z(n)&&(n={mounted:n,updated:n}),n.deep&&jt(c),s.push({dir:n,instance:i,value:c,oldValue:void 0,arg:p,modifiers:f}))}return e}function Ut(e,t,o,i){let s=e.dirs,r=t&&t.dirs;for(let n=0;n<s.length;n++){let c=s[n];r&&(c.oldValue=r[n].value);let p=c.dir[i];p&&(Et(),He(p,o,8,[e.el,c,e,t]),Ot())}}var St=Symbol("_leaveCb"),ri=Symbol("_enterCb");function Nn(){let e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return kt(()=>{e.isMounted=!0}),Ao(()=>{e.isUnmounting=!0}),e}var qe=[Function,Array],kn={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:qe,onEnter:qe,onAfterEnter:qe,onEnterCancelled:qe,onBeforeLeave:qe,onLeave:qe,onAfterLeave:qe,onLeaveCancelled:qe,onBeforeAppear:qe,onAppear:qe,onAfterAppear:qe,onAppearCancelled:qe},Al={name:"BaseTransition",props:kn,setup(e,{slots:t}){let o=Ei(),i=Nn(),s;return()=>{let r=t.default&&mi(t.default(),!0);if(!r||!r.length)return;let n=r[0];if(r.length>1){let C=!1;for(let N of r)if(N.type!==Ze){n=N,C=!0;break}}let c=ie(e),{mode:p}=c;if(i.isLeaving)return hn(n);let f=Ns(n);if(!f)return hn(n);let _=ro(f,c,i,o);Ht(f,_);let b=o.subTree,y=b&&Ns(b),A=!1,{getTransitionKey:G}=f.type;if(G){let C=G();s===void 0?s=C:C!==s&&(s=C,A=!0)}if(y&&y.type!==Ze&&(!Nt(f,y)||A)){let C=ro(y,c,i,o);if(Ht(y,C),p==="out-in")return i.isLeaving=!0,C.afterLeave=()=>{i.isLeaving=!1,o.update.active!==!1&&o.update()},hn(n);p==="in-out"&&f.type!==Ze&&(C.delayLeave=(N,Q,E)=>{let U=nr(i,y);U[String(y.key)]=y,N[St]=()=>{Q(),N[St]=void 0,delete _.delayedLeave},_.delayedLeave=E})}return n}}},ir=Al;function nr(e,t){let{leavingVNodes:o}=e,i=o.get(t.type);return i||(i=Object.create(null),o.set(t.type,i)),i}function ro(e,t,o,i){let{appear:s,mode:r,persisted:n=!1,onBeforeEnter:c,onEnter:p,onAfterEnter:f,onEnterCancelled:_,onBeforeLeave:b,onLeave:y,onAfterLeave:A,onLeaveCancelled:G,onBeforeAppear:C,onAppear:N,onAfterAppear:Q,onAppearCancelled:E}=t,U=String(e.key),W=nr(o,e),M=(q,j)=>{q&&He(q,i,9,j)},le=(q,j)=>{let z=j[1];M(q,j),H(q)?q.every(oe=>oe.length<=1)&&z():q.length<=1&&z()},ce={mode:r,persisted:n,beforeEnter(q){let j=c;if(!o.isMounted)if(s)j=C||c;else return;q[St]&&q[St](!0);let z=W[U];z&&Nt(e,z)&&z.el[St]&&z.el[St](),M(j,[q])},enter(q){let j=p,z=f,oe=_;if(!o.isMounted)if(s)j=N||p,z=Q||f,oe=E||_;else return;let F=!1,w=q[ri]=Ee=>{F||(F=!0,Ee?M(oe,[q]):M(z,[q]),ce.delayedLeave&&ce.delayedLeave(),q[ri]=void 0)};j?le(j,[q,w]):w()},leave(q,j){let z=String(e.key);if(q[ri]&&q[ri](!0),o.isUnmounting)return j();M(b,[q]);let oe=!1,F=q[St]=w=>{oe||(oe=!0,j(),w?M(G,[q]):M(A,[q]),q[St]=void 0,W[z]===e&&delete W[z])};W[z]=e,y?le(y,[q,F]):F()},clone(q){return ro(q,t,o,i)}};return ce}function hn(e){if(yi(e))return e=dt(e),e.children=null,e}function Ns(e){return yi(e)?e.children?e.children[0]:void 0:e}function Ht(e,t){e.shapeFlag&6&&e.component?Ht(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function mi(e,t=!1,o){let i=[],s=0;for(let r=0;r<e.length;r++){let n=e[r],c=o==null?n.key:String(o)+String(n.key!=null?n.key:r);n.type===V?(n.patchFlag&128&&s++,i=i.concat(mi(n.children,t,c))):(t||n.type!==Ze)&&i.push(c!=null?dt(n,{key:c}):n)}if(s>1)for(let r=0;r<i.length;r++)i[r].patchFlag=-2;return i}var So=e=>!!e.type.__asyncLoader;var yi=e=>e.type.__isKeepAlive,Rl={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){let o=Ei(),i=o.ctx;if(!i.renderer)return()=>{let E=t.default&&t.default();return E&&E.length===1?E[0]:E};let s=new Map,r=new Set,n=null,c=o.suspense,{renderer:{p,m:f,um:_,o:{createElement:b}}}=i,y=b("div");i.activate=(E,U,W,M,le)=>{let ce=E.component;f(E,U,W,0,c),p(ce.vnode,E,U,W,ce,c,M,E.slotScopeIds,le),De(()=>{ce.isDeactivated=!1,ce.a&&yt(ce.a);let q=E.props&&E.props.onVnodeMounted;q&&We(q,ce.parent,E)},c)},i.deactivate=E=>{let U=E.component;f(E,y,null,1,c),De(()=>{U.da&&yt(U.da);let W=E.props&&E.props.onVnodeUnmounted;W&&We(W,U.parent,E),U.isDeactivated=!0},c)};function A(E){gn(E),_(E,o,c,!0)}function G(E){s.forEach((U,W)=>{let M=_i(U.type);M&&(!E||!E(M))&&C(W)})}function C(E){let U=s.get(E);!n||!Nt(U,n)?A(U):n&&gn(n),s.delete(E),r.delete(E)}$t(()=>[e.include,e.exclude],([E,U])=>{E&&G(W=>Eo(E,W)),U&&G(W=>!Eo(U,W))},{flush:"post",deep:!0});let N=null,Q=()=>{N!=null&&s.set(N,mn(o.subTree))};return kt(Q),vi(Q),Ao(()=>{s.forEach(E=>{let{subTree:U,suspense:W}=o,M=mn(U);if(E.type===M.type&&E.key===M.key){gn(M);let le=M.component.da;le&&De(le,W);return}A(E)})}),()=>{if(N=null,!t.default)return null;let E=t.default(),U=E[0];if(E.length>1)return n=null,E;if(!ui(U)||!(U.shapeFlag&4)&&!(U.shapeFlag&128))return n=null,U;let W=mn(U),M=W.type,le=_i(So(W)?W.type.__asyncResolved||{}:M),{include:ce,exclude:q,max:j}=e;if(ce&&(!le||!Eo(ce,le))||q&&le&&Eo(q,le))return n=W,U;let z=W.key==null?M:W.key,oe=s.get(z);return W.el&&(W=dt(W),U.shapeFlag&128&&(U.ssContent=W)),N=z,oe?(W.el=oe.el,W.component=oe.component,W.transition&&Ht(W,W.transition),W.shapeFlag|=512,r.delete(z),r.add(z)):(r.add(z),j&&r.size>parseInt(j,10)&&C(r.values().next().value)),W.shapeFlag|=256,n=W,er(U.type)?U:W}}},sr=Rl;function Eo(e,t){return H(e)?e.some(o=>Eo(o,t)):be(e)?e.split(",").includes(t):ts(e)?e.test(t):!1}function Ml(e,t){rr(e,"a",t)}function Vl(e,t){rr(e,"da",t)}function rr(e,t,o=ke){let i=e.__wdc||(e.__wdc=()=>{let s=o;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(bi(t,i,o),o){let s=o.parent;for(;s&&s.parent;)yi(s.parent.vnode)&&Ll(i,t,o,s),s=s.parent}}function Ll(e,t,o,i){let s=bi(t,e,i,!0);Dn(()=>{Bo(i[t],s)},o)}function gn(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function mn(e){return e.shapeFlag&128?e.ssContent:e}function bi(e,t,o=ke,i=!1){if(o){let s=o[e]||(o[e]=[]),r=t.__weh||(t.__weh=(...n)=>{if(o.isUnmounted)return;Et(),ao(o);let c=He(t,o,e,n);return Bt(),Ot(),c});return i?s.unshift(r):s.push(r),r}}var pt=e=>(t,o=ke)=>(!Po||e==="sp")&&bi(e,(...i)=>t(...i),o),Ul=pt("bm"),kt=pt("m"),Fl=pt("bu"),vi=pt("u"),Ao=pt("bum"),Dn=pt("um"),zl=pt("sp"),jl=pt("rtg"),$l=pt("rtc");function Bl(e,t=ke){bi("ec",e,t)}function ae(e,t,o,i){let s,r=o&&o[i];if(H(e)||be(e)){s=new Array(e.length);for(let n=0,c=e.length;n<c;n++)s[n]=t(e[n],n,void 0,r&&r[n])}else if(typeof e=="number"){s=new Array(e);for(let n=0;n<e;n++)s[n]=t(n+1,n,void 0,r&&r[n])}else if(fe(e))if(e[Symbol.iterator])s=Array.from(e,(n,c)=>t(n,c,void 0,r&&r[c]));else{let n=Object.keys(e);s=new Array(n.length);for(let c=0,p=n.length;c<p;c++){let f=n[c];s[c]=t(e[f],f,c,r&&r[c])}}else s=[];return o&&(o[i]=s),s}var vn=e=>e?yr(e)?Oi(e)||e.proxy:vn(e.parent):null,Co=Te(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>vn(e.parent),$root:e=>vn(e.root),$emit:e=>e.emit,$options:e=>In(e),$forceUpdate:e=>e.f||(e.f=()=>Sn(e.update)),$nextTick:e=>e.n||(e.n=Gs.bind(e.proxy)),$watch:e=>Pl.bind(e)});var yn=(e,t)=>e!==he&&!e.__isScriptSetup&&re(e,t),Hl={get({_:e},t){let{ctx:o,setupState:i,data:s,props:r,accessCache:n,type:c,appContext:p}=e,f;if(t[0]!=="$"){let A=n[t];if(A!==void 0)switch(A){case 1:return i[t];case 2:return s[t];case 4:return o[t];case 3:return r[t]}else{if(yn(i,t))return n[t]=1,i[t];if(s!==he&&re(s,t))return n[t]=2,s[t];if((f=e.propsOptions[0])&&re(f,t))return n[t]=3,r[t];if(o!==he&&re(o,t))return n[t]=4,o[t];xn&&(n[t]=0)}}let _=Co[t],b,y;if(_)return t==="$attrs"&&Le(e,"get",t),_(e);if((b=c.__cssModules)&&(b=b[t]))return b;if(o!==he&&re(o,t))return n[t]=4,o[t];if(y=p.config.globalProperties,re(y,t))return y[t]},set({_:e},t,o){let{data:i,setupState:s,ctx:r}=e;return yn(s,t)?(s[t]=o,!0):i!==he&&re(i,t)?(i[t]=o,!0):re(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=o,!0)},has({_:{data:e,setupState:t,accessCache:o,ctx:i,appContext:s,propsOptions:r}},n){let c;return!!o[n]||e!==he&&re(e,n)||yn(t,n)||(c=r[0])&&re(c,n)||re(i,n)||re(Co,n)||re(s.config.globalProperties,n)},defineProperty(e,t,o){return o.get!=null?e._.accessCache[t]=0:re(o,"value")&&this.set(e,t,o.value,null),Reflect.defineProperty(e,t,o)}};function ks(e){return H(e)?e.reduce((t,o)=>(t[o]=null,t),{}):e}var xn=!0;function Gl(e){let t=In(e),o=e.proxy,i=e.ctx;xn=!1,t.beforeCreate&&Ds(t.beforeCreate,e,"bc");let{data:s,computed:r,methods:n,watch:c,provide:p,inject:f,created:_,beforeMount:b,mounted:y,beforeUpdate:A,updated:G,activated:C,deactivated:N,beforeDestroy:Q,beforeUnmount:E,destroyed:U,unmounted:W,render:M,renderTracked:le,renderTriggered:ce,errorCaptured:q,serverPrefetch:j,expose:z,inheritAttrs:oe,components:F,directives:w,filters:Ee}=t;if(f&&ql(f,i,null),n)for(let me in n){let pe=n[me];Z(pe)&&(i[me]=pe.bind(o))}if(s){let me=s.call(o,o);fe(me)&&(e.data=wo(me))}if(xn=!0,r)for(let me in r){let pe=r[me],Ge=Z(pe)?pe.bind(o,o):Z(pe.get)?pe.get.bind(o,o):$e,Wt=!Z(pe)&&Z(pe.set)?pe.set.bind(o):$e,K=Mn({get:Ge,set:Wt});Object.defineProperty(i,me,{enumerable:!0,configurable:!0,get:()=>K.value,set:Kt=>K.value=Kt})}if(c)for(let me in c)ar(c[me],i,o,me);if(p){let me=Z(p)?p.call(o):p;Reflect.ownKeys(me).forEach(pe=>{Xl(pe,me[pe])})}_&&Ds(_,e,"c");function Oe(me,pe){H(pe)?pe.forEach(Ge=>me(Ge.bind(o))):pe&&me(pe.bind(o))}if(Oe(Ul,b),Oe(kt,y),Oe(Fl,A),Oe(vi,G),Oe(Ml,C),Oe(Vl,N),Oe(Bl,q),Oe($l,le),Oe(jl,ce),Oe(Ao,E),Oe(Dn,W),Oe(zl,j),H(z))if(z.length){let me=e.exposed||(e.exposed={});z.forEach(pe=>{Object.defineProperty(me,pe,{get:()=>o[pe],set:Ge=>o[pe]=Ge})})}else e.exposed||(e.exposed={});M&&e.render===$e&&(e.render=M),oe!=null&&(e.inheritAttrs=oe),F&&(e.components=F),w&&(e.directives=w)}function ql(e,t,o=$e){H(e)&&(e=wn(e));for(let i in e){let s=e[i],r;fe(s)?"default"in s?r=ai(s.from||i,s.default,!0):r=ai(s.from||i):r=ai(s),Ne(r)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:n=>r.value=n}):t[i]=r}}function Ds(e,t,o){He(H(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,o)}function ar(e,t,o,i){let s=i.includes(".")?or(o,i):()=>o[i];if(be(e)){let r=t[e];Z(r)&&$t(s,r)}else if(Z(e))$t(s,e.bind(o));else if(fe(e))if(H(e))e.forEach(r=>ar(r,t,o,i));else{let r=Z(e.handler)?e.handler.bind(o):t[e.handler];Z(r)&&$t(s,r,e)}}function In(e){let t=e.type,{mixins:o,extends:i}=t,{mixins:s,optionsCache:r,config:{optionMergeStrategies:n}}=e.appContext,c=r.get(t),p;return c?p=c:!s.length&&!o&&!i?p=t:(p={},s.length&&s.forEach(f=>pi(p,f,n,!0)),pi(p,t,n)),fe(t)&&r.set(t,p),p}function pi(e,t,o,i=!1){let{mixins:s,extends:r}=t;r&&pi(e,r,o,!0),s&&s.forEach(n=>pi(e,n,o,!0));for(let n in t)if(!(i&&n==="expose")){let c=Wl[n]||o&&o[n];e[n]=c?c(e[n],t[n]):t[n]}return e}var Wl={data:Is,props:Ps,emits:Ps,methods:Oo,computed:Oo,beforeCreate:Ue,created:Ue,beforeMount:Ue,mounted:Ue,beforeUpdate:Ue,updated:Ue,beforeDestroy:Ue,beforeUnmount:Ue,destroyed:Ue,unmounted:Ue,activated:Ue,deactivated:Ue,errorCaptured:Ue,serverPrefetch:Ue,components:Oo,directives:Oo,watch:Yl,provide:Is,inject:Kl};function Is(e,t){return t?e?function(){return Te(Z(e)?e.call(this,this):e,Z(t)?t.call(this,this):t)}:t:e}function Kl(e,t){return Oo(wn(e),wn(t))}function wn(e){if(H(e)){let t={};for(let o=0;o<e.length;o++)t[e[o]]=e[o];return t}return e}function Ue(e,t){return e?[...new Set([].concat(e,t))]:t}function Oo(e,t){return e?Te(Object.create(null),e,t):t}function Ps(e,t){return e?H(e)&&H(t)?[...new Set([...e,...t])]:Te(Object.create(null),ks(e),ks(t!=null?t:{})):t}function Yl(e,t){if(!e)return t;if(!t)return e;let o=Te(Object.create(null),e);for(let i in t)o[i]=Ue(e[i],t[i]);return o}function lr(){return{app:null,config:{isNativeTag:es,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}var Ql=0;function Jl(e,t){return function(i,s=null){Z(i)||(i=Te({},i)),s!=null&&!fe(s)&&(s=null);let r=lr(),n=new WeakSet,c=!1,p=r.app={_uid:Ql++,_component:i,_props:s,_container:null,_context:r,_instance:null,version:Tc,get config(){return r.config},set config(f){},use(f,..._){return n.has(f)||(f&&Z(f.install)?(n.add(f),f.install(p,..._)):Z(f)&&(n.add(f),f(p,..._))),p},mixin(f){return r.mixins.includes(f)||r.mixins.push(f),p},component(f,_){return _?(r.components[f]=_,p):r.components[f]},directive(f,_){return _?(r.directives[f]=_,p):r.directives[f]},mount(f,_,b){if(!c){let y=de(i,s);return y.appContext=r,_&&t?t(y,f):e(y,f,b),c=!0,p._container=f,f.__vue_app__=p,Oi(y.component)||y.component.proxy}},unmount(){c&&(e(null,p._container),delete p._container.__vue_app__)},provide(f,_){return r.provides[f]=_,p},runWithContext(f){fi=p;try{return f()}finally{fi=null}}};return p}}var fi=null;function Xl(e,t){if(ke){let o=ke.provides,i=ke.parent&&ke.parent.provides;i===o&&(o=ke.provides=Object.create(i)),o[e]=t}}function ai(e,t,o=!1){let i=ke||Be;if(i||fi){let s=i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:fi._context.provides;if(s&&e in s)return s[e];if(arguments.length>1)return o&&Z(t)?t.call(i&&i.proxy):t}}function Zl(e,t,o,i=!1){let s={},r={};eo(r,wi,1),e.propsDefaults=Object.create(null),cr(e,t,s,r);for(let n in e.propsOptions[0])n in s||(s[n]=void 0);o?e.props=i?s:dn(s):e.type.props?e.props=s:e.props=r,e.attrs=r}function ec(e,t,o,i){let{props:s,attrs:r,vnode:{patchFlag:n}}=e,c=ie(s),[p]=e.propsOptions,f=!1;if((i||n>0)&&!(n&16)){if(n&8){let _=e.vnode.dynamicProps;for(let b=0;b<_.length;b++){let y=_[b];if(gi(e.emitsOptions,y))continue;let A=t[y];if(p)if(re(r,y))A!==r[y]&&(r[y]=A,f=!0);else{let G=ze(y);s[G]=En(p,c,G,A,e,!1)}else A!==r[y]&&(r[y]=A,f=!0)}}}else{cr(e,t,s,r)&&(f=!0);let _;for(let b in c)(!t||!re(t,b)&&((_=st(b))===b||!re(t,_)))&&(p?o&&(o[b]!==void 0||o[_]!==void 0)&&(s[b]=En(p,c,b,void 0,e,!0)):delete s[b]);if(r!==c)for(let b in r)(!t||!re(t,b)&&!0)&&(delete r[b],f=!0)}f&&tt(e,"set","$attrs")}function cr(e,t,o,i){let[s,r]=e.propsOptions,n=!1,c;if(t)for(let p in t){if(mo(p))continue;let f=t[p],_;s&&re(s,_=ze(p))?!r||!r.includes(_)?o[_]=f:(c||(c={}))[_]=f:gi(e.emitsOptions,p)||(!(p in i)||f!==i[p])&&(i[p]=f,n=!0)}if(r){let p=ie(o),f=c||he;for(let _=0;_<r.length;_++){let b=r[_];o[b]=En(s,p,b,f[b],e,!re(f,b))}}return n}function En(e,t,o,i,s,r){let n=e[o];if(n!=null){let c=re(n,"default");if(c&&i===void 0){let p=n.default;if(n.type!==Function&&!n.skipFactory&&Z(p)){let{propsDefaults:f}=s;o in f?i=f[o]:(ao(s),i=f[o]=p.call(null,t),Bt())}else i=p}n[0]&&(r&&!c?i=!1:n[1]&&(i===""||i===st(o))&&(i=!0))}return i}function dr(e,t,o=!1){let i=t.propsCache,s=i.get(e);if(s)return s;let r=e.props,n={},c=[],p=!1;if(!Z(e)){let _=b=>{p=!0;let[y,A]=dr(b,t,!0);Te(n,y),A&&c.push(...A)};!o&&t.mixins.length&&t.mixins.forEach(_),e.extends&&_(e.extends),e.mixins&&e.mixins.forEach(_)}if(!r&&!p)return fe(e)&&i.set(e,Rt),Rt;if(H(r))for(let _=0;_<r.length;_++){let b=ze(r[_]);As(b)&&(n[b]=he)}else if(r)for(let _ in r){let b=ze(_);if(As(b)){let y=r[_],A=n[b]=H(y)||Z(y)?{type:y}:Te({},y);if(A){let G=Vs(Boolean,A.type),C=Vs(String,A.type);A[0]=G>-1,A[1]=C<0||G<C,(G>-1||re(A,"default"))&&c.push(b)}}}let f=[n,c];return fe(e)&&i.set(e,f),f}function As(e){return e[0]!=="$"}function Rs(e){let t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function Ms(e,t){return Rs(e)===Rs(t)}function Vs(e,t){return H(t)?t.findIndex(o=>Ms(o,e)):Z(t)&&Ms(t,e)?0:-1}var pr=e=>e[0]==="_"||e==="$stable",Pn=e=>H(e)?e.map(ot):[ot(e)],tc=(e,t,o)=>{if(t._n)return t;let i=Sl((...s)=>Pn(t(...s)),o);return i._c=!1,i},fr=(e,t,o)=>{let i=e._ctx;for(let s in e){if(pr(s))continue;let r=e[s];if(Z(r))t[s]=tc(s,r,i);else if(r!=null){let n=Pn(r);t[s]=()=>n}}},ur=(e,t)=>{let o=Pn(t);e.slots.default=()=>o},oc=(e,t)=>{if(e.vnode.shapeFlag&32){let o=t._;o?(e.slots=ie(t),eo(t,"_",o)):fr(t,e.slots={})}else e.slots={},t&&ur(e,t);eo(e.slots,wi,1)},ic=(e,t,o)=>{let{vnode:i,slots:s}=e,r=!0,n=he;if(i.shapeFlag&32){let c=t._;c?o&&c===1?r=!1:(Te(s,t),!o&&c===1&&delete s._):(r=!t.$stable,fr(t,s)),n=t}else t&&(ur(e,t),n={default:1});if(r)for(let c in s)!pr(c)&&n[c]==null&&delete s[c]};function On(e,t,o,i,s=!1){if(H(e)){e.forEach((y,A)=>On(y,t&&(H(t)?t[A]:t),o,i,s));return}if(So(i)&&!s)return;let r=i.shapeFlag&4?Oi(i.component)||i.component.proxy:i.el,n=s?null:r,{i:c,r:p}=e,f=t&&t.r,_=c.refs===he?c.refs={}:c.refs,b=c.setupState;if(f!=null&&f!==p&&(be(f)?(_[f]=null,re(b,f)&&(b[f]=null)):Ne(f)&&(f.value=null)),Z(p))ct(p,c,12,[n,_]);else{let y=be(p),A=Ne(p);if(y||A){let G=()=>{if(e.f){let C=y?re(b,p)?b[p]:_[p]:p.value;s?H(C)&&Bo(C,r):H(C)?C.includes(r)||C.push(r):y?(_[p]=[r],re(b,p)&&(b[p]=_[p])):(p.value=[r],e.k&&(_[e.k]=p.value))}else y?(_[p]=n,re(b,p)&&(b[p]=n)):A&&(p.value=n,e.k&&(_[e.k]=n))};n?(G.id=-1,De(G,o)):G()}}}function nc(){let e=[]}var De=Il;function _r(e){return sc(e)}function sc(e,t){nc();let o=qo();o.__VUE__=!0;let{insert:i,remove:s,patchProp:r,createElement:n,createText:c,createComment:p,setText:f,setElementText:_,parentNode:b,nextSibling:y,setScopeId:A=$e,insertStaticContent:G}=e,C=(u,h,v,O=null,T=null,I=null,L=!1,D=null,R=!!h.dynamicChildren)=>{if(u===h)return;u&&!Nt(u,h)&&(O=$o(u),ht(u,T,I,!0),u=null),h.patchFlag===-2&&(R=!1,h.dynamicChildren=null);let{type:S,ref:Y,shapeFlag:B}=h;switch(S){case xi:N(u,h,v,O);break;case Ze:Q(u,h,v,O);break;case li:u==null&&E(h,v,O,L);break;case V:w(u,h,v,O,T,I,L,D,R);break;default:B&1?le(u,h,v,O,T,I,L,D,R):B&6?Ee(u,h,v,O,T,I,L,D,R):(B&64||B&128)&&S.process(u,h,v,O,T,I,L,D,R,Yt)}Y!=null&&T&&On(Y,u&&u.ref,I,h||u,!h)},N=(u,h,v,O)=>{if(u==null)i(h.el=c(h.children),v,O);else{let T=h.el=u.el;h.children!==u.children&&f(T,h.children)}},Q=(u,h,v,O)=>{u==null?i(h.el=p(h.children||""),v,O):h.el=u.el},E=(u,h,v,O)=>{[u.el,u.anchor]=G(u.children,h,v,O,u.el,u.anchor)},U=(u,h,v,O)=>{if(h.children!==u.children){let T=y(u.anchor);M(u),[h.el,h.anchor]=G(h.children,v,T,O)}else h.el=u.el,h.anchor=u.anchor},W=({el:u,anchor:h},v,O)=>{let T;for(;u&&u!==h;)T=y(u),i(u,v,O),u=T;i(h,v,O)},M=({el:u,anchor:h})=>{let v;for(;u&&u!==h;)v=y(u),s(u),u=v;s(h)},le=(u,h,v,O,T,I,L,D,R)=>{L=L||h.type==="svg",u==null?ce(h,v,O,T,I,L,D,R):z(u,h,T,I,L,D,R)},ce=(u,h,v,O,T,I,L,D)=>{let R,S,{type:Y,props:B,shapeFlag:J,transition:te,dirs:ne}=u;if(R=u.el=n(u.type,I,B&&B.is,B),J&8?_(R,u.children):J&16&&j(u.children,R,null,O,T,I&&Y!=="foreignObject",L,D),ne&&Ut(u,null,O,"created"),q(R,u,u.scopeId,L,O),B){for(let _e in B)_e!=="value"&&!mo(_e)&&r(R,_e,null,B[_e],I,u.children,O,T,nt);"value"in B&&r(R,"value",null,B.value),(S=B.onVnodeBeforeMount)&&We(S,O,u)}ne&&Ut(u,null,O,"beforeMount");let ye=rc(T,te);ye&&te.beforeEnter(R),i(R,h,v),((S=B&&B.onVnodeMounted)||ye||ne)&&De(()=>{S&&We(S,O,u),ye&&te.enter(R),ne&&Ut(u,null,O,"mounted")},T)},q=(u,h,v,O,T)=>{if(v&&A(u,v),O)for(let I=0;I<O.length;I++)A(u,O[I]);if(T){let I=T.subTree;if(h===I){let L=T.vnode;q(u,L,L.scopeId,L.slotScopeIds,T.parent)}}},j=(u,h,v,O,T,I,L,D,R=0)=>{for(let S=R;S<u.length;S++){let Y=u[S]=D?Ct(u[S]):ot(u[S]);C(null,Y,h,v,O,T,I,L,D)}},z=(u,h,v,O,T,I,L)=>{let D=h.el=u.el,{patchFlag:R,dynamicChildren:S,dirs:Y}=h;R|=u.patchFlag&16;let B=u.props||he,J=h.props||he,te;v&&Ft(v,!1),(te=J.onVnodeBeforeUpdate)&&We(te,v,h,u),Y&&Ut(h,u,v,"beforeUpdate"),v&&Ft(v,!0);let ne=T&&h.type!=="foreignObject";if(S?oe(u.dynamicChildren,S,D,v,O,ne,I):L||Ge(u,h,D,null,v,O,ne,I,!1),R>0){if(R&16)F(D,h,B,J,v,O,T);else if(R&2&&B.class!==J.class&&r(D,"class",null,J.class,T),R&4&&r(D,"style",B.style,J.style,T),R&8){let ye=h.dynamicProps;for(let _e=0;_e<ye.length;_e++){let Se=ye[_e],Ye=B[Se],Qt=J[Se];(Qt!==Ye||Se==="value")&&r(D,Se,Ye,Qt,T,u.children,v,O,nt)}}R&1&&u.children!==h.children&&_(D,h.children)}else!L&&S==null&&F(D,h,B,J,v,O,T);((te=J.onVnodeUpdated)||Y)&&De(()=>{te&&We(te,v,h,u),Y&&Ut(h,u,v,"updated")},O)},oe=(u,h,v,O,T,I,L)=>{for(let D=0;D<h.length;D++){let R=u[D],S=h[D],Y=R.el&&(R.type===V||!Nt(R,S)||R.shapeFlag&70)?b(R.el):v;C(R,S,Y,null,O,T,I,L,!0)}},F=(u,h,v,O,T,I,L)=>{if(v!==O){if(v!==he)for(let D in v)!mo(D)&&!(D in O)&&r(u,D,v[D],null,L,h.children,T,I,nt);for(let D in O){if(mo(D))continue;let R=O[D],S=v[D];R!==S&&D!=="value"&&r(u,D,S,R,L,h.children,T,I,nt)}"value"in O&&r(u,"value",v.value,O.value)}},w=(u,h,v,O,T,I,L,D,R)=>{let S=h.el=u?u.el:c(""),Y=h.anchor=u?u.anchor:c(""),{patchFlag:B,dynamicChildren:J,slotScopeIds:te}=h;te&&(D=D?D.concat(te):te),u==null?(i(S,v,O),i(Y,v,O),j(h.children,v,Y,T,I,L,D,R)):B>0&&B&64&&J&&u.dynamicChildren?(oe(u.dynamicChildren,J,v,T,I,L,D),(h.key!=null||T&&h===T.subTree)&&hr(u,h,!0)):Ge(u,h,v,Y,T,I,L,D,R)},Ee=(u,h,v,O,T,I,L,D,R)=>{h.slotScopeIds=D,u==null?h.shapeFlag&512?T.ctx.activate(h,v,O,L,R):Ve(h,v,O,T,I,L,R):Oe(u,h,R)},Ve=(u,h,v,O,T,I,L)=>{let D=u.component=hc(u,O,T);if(yi(u)&&(D.ctx.renderer=Yt),gc(D),D.asyncDep){if(T&&T.registerDep(D,me),!u.el){let R=D.subTree=de(Ze);Q(null,R,h,v)}return}me(D,u,h,v,T,I,L)},Oe=(u,h,v)=>{let O=h.component=u.component;if(kl(u,h,v))if(O.asyncDep&&!O.asyncResolved){pe(O,h,v);return}else O.next=h,wl(O.update),O.update();else h.el=u.el,O.vnode=h},me=(u,h,v,O,T,I,L)=>{let D=()=>{if(u.isMounted){let{next:Y,bu:B,u:J,parent:te,vnode:ne}=u,ye=Y,_e;Ft(u,!1),Y?(Y.el=ne.el,pe(u,Y,L)):Y=ne,B&&yt(B),(_e=Y.props&&Y.props.onVnodeBeforeUpdate)&&We(_e,te,Y,ne),Ft(u,!0);let Se=_n(u),Ye=u.subTree;u.subTree=Se,C(Ye,Se,b(Ye.el),$o(Ye),u,T,I),Y.el=Se.el,ye===null&&Dl(u,Se.el),J&&De(J,T),(_e=Y.props&&Y.props.onVnodeUpdated)&&De(()=>We(_e,te,Y,ne),T)}else{let Y,{el:B,props:J}=h,{bm:te,m:ne,parent:ye}=u,_e=So(h);if(Ft(u,!1),te&&yt(te),!_e&&(Y=J&&J.onVnodeBeforeMount)&&We(Y,ye,h),Ft(u,!0),B&&qi){let Se=()=>{u.subTree=_n(u),qi(B,u.subTree,u,T,null)};_e?h.type.__asyncLoader().then(()=>!u.isUnmounted&&Se()):Se()}else{let Se=u.subTree=_n(u);C(null,Se,v,O,u,T,I),h.el=Se.el}if(ne&&De(ne,T),!_e&&(Y=J&&J.onVnodeMounted)){let Se=h;De(()=>We(Y,ye,Se),T)}(h.shapeFlag&256||ye&&So(ye.vnode)&&ye.vnode.shapeFlag&256)&&u.a&&De(u.a,T),u.isMounted=!0,h=v=O=null}},R=u.effect=new Lt(D,()=>Sn(S),u.scope),S=u.update=()=>R.run();S.id=u.uid,Ft(u,!0),S()},pe=(u,h,v)=>{h.component=u;let O=u.vnode.props;u.vnode=h,u.next=null,ec(u,h.props,O,v),ic(u,h.children,v),Et(),Ts(),Ot()},Ge=(u,h,v,O,T,I,L,D,R=!1)=>{let S=u&&u.children,Y=u?u.shapeFlag:0,B=h.children,{patchFlag:J,shapeFlag:te}=h;if(J>0){if(J&128){K(S,B,v,O,T,I,L,D,R);return}else if(J&256){Wt(S,B,v,O,T,I,L,D,R);return}}te&8?(Y&16&&nt(S,T,I),B!==S&&_(v,B)):Y&16?te&16?K(S,B,v,O,T,I,L,D,R):nt(S,T,I,!0):(Y&8&&_(v,""),te&16&&j(B,v,O,T,I,L,D,R))},Wt=(u,h,v,O,T,I,L,D,R)=>{u=u||Rt,h=h||Rt;let S=u.length,Y=h.length,B=Math.min(S,Y),J;for(J=0;J<B;J++){let te=h[J]=R?Ct(h[J]):ot(h[J]);C(u[J],te,v,null,T,I,L,D,R)}S>Y?nt(u,T,I,!0,!1,B):j(h,v,O,T,I,L,D,R,B)},K=(u,h,v,O,T,I,L,D,R)=>{let S=0,Y=h.length,B=u.length-1,J=Y-1;for(;S<=B&&S<=J;){let te=u[S],ne=h[S]=R?Ct(h[S]):ot(h[S]);if(Nt(te,ne))C(te,ne,v,null,T,I,L,D,R);else break;S++}for(;S<=B&&S<=J;){let te=u[B],ne=h[J]=R?Ct(h[J]):ot(h[J]);if(Nt(te,ne))C(te,ne,v,null,T,I,L,D,R);else break;B--,J--}if(S>B){if(S<=J){let te=J+1,ne=te<Y?h[te].el:O;for(;S<=J;)C(null,h[S]=R?Ct(h[S]):ot(h[S]),v,ne,T,I,L,D,R),S++}}else if(S>J)for(;S<=B;)ht(u[S],T,I,!0),S++;else{let te=S,ne=S,ye=new Map;for(S=ne;S<=J;S++){let je=h[S]=R?Ct(h[S]):ot(h[S]);je.key!=null&&ye.set(je.key,S)}let _e,Se=0,Ye=J-ne+1,Qt=!1,Wn=0,ho=new Array(Ye);for(S=0;S<Ye;S++)ho[S]=0;for(S=te;S<=B;S++){let je=u[S];if(Se>=Ye){ht(je,T,I,!0);continue}let et;if(je.key!=null)et=ye.get(je.key);else for(_e=ne;_e<=J;_e++)if(ho[_e-ne]===0&&Nt(je,h[_e])){et=_e;break}et===void 0?ht(je,T,I,!0):(ho[et-ne]=S+1,et>=Wn?Wn=et:Qt=!0,C(je,h[et],v,null,T,I,L,D,R),Se++)}let Kn=Qt?ac(ho):Rt;for(_e=Kn.length-1,S=Ye-1;S>=0;S--){let je=ne+S,et=h[je],Yn=je+1<Y?h[je+1].el:O;ho[S]===0?C(null,et,v,Yn,T,I,L,D,R):Qt&&(_e<0||S!==Kn[_e]?Kt(et,v,Yn,2):_e--)}}},Kt=(u,h,v,O,T=null)=>{let{el:I,type:L,transition:D,children:R,shapeFlag:S}=u;if(S&6){Kt(u.component.subTree,h,v,O);return}if(S&128){u.suspense.move(h,v,O);return}if(S&64){L.move(u,h,v,Yt);return}if(L===V){i(I,h,v);for(let B=0;B<R.length;B++)Kt(R[B],h,v,O);i(u.anchor,h,v);return}if(L===li){W(u,h,v);return}if(O!==2&&S&1&&D)if(O===0)D.beforeEnter(I),i(I,h,v),De(()=>D.enter(I),T);else{let{leave:B,delayLeave:J,afterLeave:te}=D,ne=()=>i(I,h,v),ye=()=>{B(I,()=>{ne(),te&&te()})};J?J(I,ne,ye):ye()}else i(I,h,v)},ht=(u,h,v,O=!1,T=!1)=>{let{type:I,props:L,ref:D,children:R,dynamicChildren:S,shapeFlag:Y,patchFlag:B,dirs:J}=u;if(D!=null&&On(D,null,v,u,!0),Y&256){h.ctx.deactivate(u);return}let te=Y&1&&J,ne=!So(u),ye;if(ne&&(ye=L&&L.onVnodeBeforeUnmount)&&We(ye,h,u),Y&6)Aa(u.component,v,O);else{if(Y&128){u.suspense.unmount(v,O);return}te&&Ut(u,null,h,"beforeUnmount"),Y&64?u.type.remove(u,h,v,T,Yt,O):S&&(I!==V||B>0&&B&64)?nt(S,h,v,!1,!0):(I===V&&B&384||!T&&Y&16)&&nt(R,h,v),O&&Gn(u)}(ne&&(ye=L&&L.onVnodeUnmounted)||te)&&De(()=>{ye&&We(ye,h,u),te&&Ut(u,null,h,"unmounted")},v)},Gn=u=>{let{type:h,el:v,anchor:O,transition:T}=u;if(h===V){Pa(v,O);return}if(h===li){M(u);return}let I=()=>{s(v),T&&!T.persisted&&T.afterLeave&&T.afterLeave()};if(u.shapeFlag&1&&T&&!T.persisted){let{leave:L,delayLeave:D}=T,R=()=>L(v,I);D?D(u.el,I,R):R()}else I()},Pa=(u,h)=>{let v;for(;u!==h;)v=y(u),s(u),u=v;s(h)},Aa=(u,h,v)=>{let{bum:O,scope:T,update:I,subTree:L,um:D}=u;O&&yt(O),T.stop(),I&&(I.active=!1,ht(L,u,h,v)),D&&De(D,h),De(()=>{u.isUnmounted=!0},h),h&&h.pendingBranch&&!h.isUnmounted&&u.asyncDep&&!u.asyncResolved&&u.suspenseId===h.pendingId&&(h.deps--,h.deps===0&&h.resolve())},nt=(u,h,v,O=!1,T=!1,I=0)=>{for(let L=I;L<u.length;L++)ht(u[L],h,v,O,T)},$o=u=>u.shapeFlag&6?$o(u.component.subTree):u.shapeFlag&128?u.suspense.next():y(u.anchor||u.el),qn=(u,h,v)=>{u==null?h._vnode&&ht(h._vnode,null,null,!0):C(h._vnode||null,u,h,null,null,null,v),Ts(),Ws(),h._vnode=u},Yt={p:C,um:ht,m:Kt,r:Gn,mt:Ve,mc:j,pc:Ge,pbc:oe,n:$o,o:e},Gi,qi;return t&&([Gi,qi]=t(Yt)),{render:qn,hydrate:Gi,createApp:Jl(qn,Gi)}}function Ft({effect:e,update:t},o){e.allowRecurse=t.allowRecurse=o}function rc(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function hr(e,t,o=!1){let i=e.children,s=t.children;if(H(i)&&H(s))for(let r=0;r<i.length;r++){let n=i[r],c=s[r];c.shapeFlag&1&&!c.dynamicChildren&&((c.patchFlag<=0||c.patchFlag===32)&&(c=s[r]=Ct(s[r]),c.el=n.el),o||hr(n,c)),c.type===xi&&(c.el=n.el)}}function ac(e){let t=e.slice(),o=[0],i,s,r,n,c,p=e.length;for(i=0;i<p;i++){let f=e[i];if(f!==0){if(s=o[o.length-1],e[s]<f){t[i]=s,o.push(i);continue}for(r=0,n=o.length-1;r<n;)c=r+n>>1,e[o[c]]<f?r=c+1:n=c;f<e[o[r]]&&(r>0&&(t[i]=o[r-1]),o[r]=i)}}for(r=o.length,n=o[r-1];r-- >0;)o[r]=n,n=t[n];return o}var lc=e=>e.__isTeleport;var V=Symbol.for("v-fgt"),xi=Symbol.for("v-txt"),Ze=Symbol.for("v-cmt"),li=Symbol.for("v-stc"),No=[],Xe=null;function g(e=!1){No.push(Xe=e?null:[])}function cc(){No.pop(),Xe=No[No.length-1]||null}var Io=1;function Ls(e){Io+=e}function gr(e){return e.dynamicChildren=Io>0?Xe||Rt:null,cc(),Io>0&&Xe&&Xe.push(e),e}function m(e,t,o,i,s,r){return gr(a(e,t,o,i,s,r,!0))}function lo(e,t,o,i,s){return gr(de(e,t,o,i,s,!0))}function ui(e){return e?e.__v_isVNode===!0:!1}function Nt(e,t){return e.type===t.type&&e.key===t.key}var wi="__vInternal",mr=({key:e})=>e!=null?e:null,ci=({ref:e,ref_key:t,ref_for:o})=>(typeof e=="number"&&(e=""+e),e!=null?be(e)||Ne(e)||Z(e)?{i:Be,r:e,k:t,f:!!o}:e:null);function a(e,t=null,o=null,i=0,s=null,r=e===V?0:1,n=!1,c=!1){let p={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&mr(t),ref:t&&ci(t),scopeId:Qs,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Be};return c?(An(p,o),r&128&&e.normalize(p)):o&&(p.shapeFlag|=be(o)?8:16),Io>0&&!n&&Xe&&(p.patchFlag>0||r&6)&&p.patchFlag!==32&&Xe.push(p),p}var de=dc;function dc(e,t=null,o=null,i=0,s=null,r=!1){if((!e||e===Js)&&(e=Ze),ui(e)){let c=dt(e,t,!0);return o&&An(c,o),Io>0&&!r&&Xe&&(c.shapeFlag&6?Xe[Xe.indexOf(e)]=c:Xe.push(c)),c.patchFlag|=-2,c}if(wc(e)&&(e=e.__vccOpts),t){t=pc(t);let{class:c,style:p}=t;c&&!be(c)&&(t.class=at(c)),fe(p)&&(oi(p)&&!H(p)&&(p=Te({},p)),t.style=k(p))}let n=be(e)?1:er(e)?128:lc(e)?64:fe(e)?4:Z(e)?2:0;return a(e,t,o,i,s,n,r,!0)}function pc(e){return e?oi(e)||wi in e?Te({},e):e:null}function dt(e,t,o=!1){let{props:i,ref:s,patchFlag:r,children:n}=e,c=t?fc(i||{},t):i;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:c,key:c&&mr(c),ref:t&&t.ref?o&&s?H(s)?s.concat(ci(t)):[s,ci(t)]:ci(t):s,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:n,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==V?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&dt(e.ssContent),ssFallback:e.ssFallback&&dt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function P(e=" ",t=0){return de(xi,null,e,t)}function l(e="",t=!1){return t?(g(),lo(Ze,null,e)):de(Ze,null,e)}function ot(e){return e==null||typeof e=="boolean"?de(Ze):H(e)?de(V,null,e.slice()):typeof e=="object"?Ct(e):de(xi,null,String(e))}function Ct(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:dt(e)}function An(e,t){let o=0,{shapeFlag:i}=e;if(t==null)t=null;else if(H(t))o=16;else if(typeof t=="object")if(i&65){let s=t.default;s&&(s._c&&(s._d=!1),An(e,s()),s._c&&(s._d=!0));return}else{o=32;let s=t._;!s&&!(wi in t)?t._ctx=Be:s===3&&Be&&(Be.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Z(t)?(t={default:t,_ctx:Be},o=32):(t=String(t),i&64?(o=16,t=[P(t)]):o=8);e.children=t,e.shapeFlag|=o}function fc(...e){let t={};for(let o=0;o<e.length;o++){let i=e[o];for(let s in i)if(s==="class")t.class!==i.class&&(t.class=at([t.class,i.class]));else if(s==="style")t.style=k([t.style,i.style]);else if(Xt(s)){let r=t[s],n=i[s];n&&r!==n&&!(H(r)&&r.includes(n))&&(t[s]=r?[].concat(r,n):n)}else s!==""&&(t[s]=i[s])}return t}function We(e,t,o,i=null){He(e,t,7,[o,i])}var uc=lr(),_c=0;function hc(e,t,o){let i=e.type,s=(t?t.appContext:e.appContext)||uc,r={uid:_c++,vnode:e,type:i,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new vo(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:dr(i,s),emitsOptions:Ys(i,s),emit:null,emitted:null,propsDefaults:he,inheritAttrs:i.inheritAttrs,ctx:he,data:he,props:he,attrs:he,slots:he,refs:he,setupState:he,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=Tl.bind(null,r),e.ce&&e.ce(r),r}var ke=null,Ei=()=>ke||Be,Rn,no,Us="__VUE_INSTANCE_SETTERS__";(no=qo()[Us])||(no=qo()[Us]=[]),no.push(e=>ke=e),Rn=e=>{no.length>1?no.forEach(t=>t(e)):no[0](e)};var ao=e=>{Rn(e),e.scope.on()},Bt=()=>{ke&&ke.scope.off(),Rn(null)};function yr(e){return e.vnode.shapeFlag&4}var Po=!1;function gc(e,t=!1){Po=t;let{props:o,children:i}=e.vnode,s=yr(e);Zl(e,o,s,t),oc(e,i);let r=s?mc(e,t):void 0;return Po=!1,r}function mc(e,t){var o;let i=e.type;e.accessCache=Object.create(null),e.proxy=ii(new Proxy(e.ctx,Hl));let{setup:s}=i;if(s){let r=e.setupContext=s.length>1?bc(e):null;ao(e),Et();let n=ct(s,e,0,[e.props,r]);if(Ot(),Bt(),Wi(n)){if(n.then(Bt,Bt),t)return n.then(c=>{Fs(e,c,t)}).catch(c=>{hi(c,e,0)});e.asyncDep=n}else Fs(e,n,t)}else br(e,t)}function Fs(e,t,o){Z(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:fe(t)&&(e.setupState=ni(t)),br(e,o)}var zs,js;function br(e,t,o){let i=e.type;if(!e.render){if(!t&&zs&&!i.render){let s=i.template||In(e).template;if(s){let{isCustomElement:r,compilerOptions:n}=e.appContext.config,{delimiters:c,compilerOptions:p}=i,f=Te(Te({isCustomElement:r,delimiters:c},n),p);i.render=zs(s,f)}}e.render=i.render||$e,js&&js(e)}ao(e),Et();try{Gl(e)}finally{Ot(),Bt()}}function yc(e){return e.attrsProxy||(e.attrsProxy=new Proxy(e.attrs,{get(t,o){return Le(e,"get","$attrs"),t[o]}}))}function bc(e){let t=o=>{e.exposed=o||{}};return{get attrs(){return yc(e)},slots:e.slots,emit:e.emit,expose:t}}function Oi(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(ni(ii(e.exposed)),{get(t,o){if(o in t)return t[o];if(o in Co)return Co[o](e)},has(t,o){return o in t||o in Co}}))}var vc=/(?:^|[-_])(\w)/g,xc=e=>e.replace(vc,t=>t.toUpperCase()).replace(/[-_]/g,"");function _i(e,t=!0){return Z(e)?e.displayName||e.name:e.name||t&&e.__name}function vr(e,t,o=!1){let i=_i(t);if(!i&&t.__file){let s=t.__file.match(/([^/\\]+)\.\w+$/);s&&(i=s[1])}if(!i&&e&&e.parent){let s=r=>{for(let n in r)if(r[n]===t)return n};i=s(e.components||e.parent.type.components)||s(e.appContext.components)}return i?xc(i):o?"App":"Anonymous"}function wc(e){return Z(e)&&"__vccOpts"in e}var Mn=(e,t)=>Os(e,t,Po);function xr(e,t,o){let i=arguments.length;return i===2?fe(t)&&!H(t)?ui(t)?de(e,null,[t]):de(e,t):de(e,null,t):(i>3?o=Array.prototype.slice.call(arguments,2):i===3&&ui(o)&&(o=[o]),de(e,t,o))}var Ec=Symbol.for("v-scx"),Oc=()=>{{let e=ai(Ec);return e}};var Tc="3.3.9";var Sc="http://www.w3.org/2000/svg",qt=typeof document!="undefined"?document:null,wr=qt&&qt.createElement("template"),Cc={insert:(e,t,o)=>{t.insertBefore(e,o||null)},remove:e=>{let t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,o,i)=>{let s=t?qt.createElementNS(Sc,e):qt.createElement(e,o?{is:o}:void 0);return e==="select"&&i&&i.multiple!=null&&s.setAttribute("multiple",i.multiple),s},createText:e=>qt.createTextNode(e),createComment:e=>qt.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>qt.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,o,i,s,r){let n=o?o.previousSibling:t.lastChild;if(s&&(s===r||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),o),!(s===r||!(s=s.nextSibling)););else{wr.innerHTML=i?`<svg>${e}</svg>`:e;let c=wr.content;if(i){let p=c.firstChild;for(;p.firstChild;)c.appendChild(p.firstChild);c.removeChild(p)}t.insertBefore(c,o)}return[n?n.nextSibling:t.firstChild,o?o.previousSibling:t.lastChild]}},Dt="transition",Ro="animation",co=Symbol("_vtc"),Fr=(e,{slots:t})=>xr(ir,jr(e),t);Fr.displayName="Transition";var zr={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Nc=Fr.props=Te({},kn,zr),Gt=(e,t=[])=>{H(e)?e.forEach(o=>o(...t)):e&&e(...t)},Er=e=>e?H(e)?e.some(t=>t.length>1):e.length>1:!1;function jr(e){let t={};for(let F in e)F in zr||(t[F]=e[F]);if(e.css===!1)return t;let{name:o="v",type:i,duration:s,enterFromClass:r=`${o}-enter-from`,enterActiveClass:n=`${o}-enter-active`,enterToClass:c=`${o}-enter-to`,appearFromClass:p=r,appearActiveClass:f=n,appearToClass:_=c,leaveFromClass:b=`${o}-leave-from`,leaveActiveClass:y=`${o}-leave-active`,leaveToClass:A=`${o}-leave-to`}=e,G=kc(s),C=G&&G[0],N=G&&G[1],{onBeforeEnter:Q,onEnter:E,onEnterCancelled:U,onLeave:W,onLeaveCancelled:M,onBeforeAppear:le=Q,onAppear:ce=E,onAppearCancelled:q=U}=t,j=(F,w,Ee)=>{It(F,w?_:c),It(F,w?f:n),Ee&&Ee()},z=(F,w)=>{F._isLeaving=!1,It(F,b),It(F,A),It(F,y),w&&w()},oe=F=>(w,Ee)=>{let Ve=F?ce:E,Oe=()=>j(w,F,Ee);Gt(Ve,[w,Oe]),Or(()=>{It(w,F?p:r),ft(w,F?_:c),Er(Ve)||Tr(w,i,C,Oe)})};return Te(t,{onBeforeEnter(F){Gt(Q,[F]),ft(F,r),ft(F,n)},onBeforeAppear(F){Gt(le,[F]),ft(F,p),ft(F,f)},onEnter:oe(!1),onAppear:oe(!0),onLeave(F,w){F._isLeaving=!0;let Ee=()=>z(F,w);ft(F,b),Br(),ft(F,y),Or(()=>{!F._isLeaving||(It(F,b),ft(F,A),Er(W)||Tr(F,i,N,Ee))}),Gt(W,[F,Ee])},onEnterCancelled(F){j(F,!1),Gt(U,[F])},onAppearCancelled(F){j(F,!0),Gt(q,[F])},onLeaveCancelled(F){z(F),Gt(M,[F])}})}function kc(e){if(e==null)return null;if(fe(e))return[Vn(e.enter),Vn(e.leave)];{let t=Vn(e);return[t,t]}}function Vn(e){return Qi(e)}function ft(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.add(o)),(e[co]||(e[co]=new Set)).add(t)}function It(e,t){t.split(/\s+/).forEach(i=>i&&e.classList.remove(i));let o=e[co];o&&(o.delete(t),o.size||(e[co]=void 0))}function Or(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}var Dc=0;function Tr(e,t,o,i){let s=e._endId=++Dc,r=()=>{s===e._endId&&i()};if(o)return setTimeout(r,o);let{type:n,timeout:c,propCount:p}=$r(e,t);if(!n)return i();let f=n+"end",_=0,b=()=>{e.removeEventListener(f,y),r()},y=A=>{A.target===e&&++_>=p&&b()};setTimeout(()=>{_<p&&b()},c+1),e.addEventListener(f,y)}function $r(e,t){let o=window.getComputedStyle(e),i=G=>(o[G]||"").split(", "),s=i(`${Dt}Delay`),r=i(`${Dt}Duration`),n=Sr(s,r),c=i(`${Ro}Delay`),p=i(`${Ro}Duration`),f=Sr(c,p),_=null,b=0,y=0;t===Dt?n>0&&(_=Dt,b=n,y=r.length):t===Ro?f>0&&(_=Ro,b=f,y=p.length):(b=Math.max(n,f),_=b>0?n>f?Dt:Ro:null,y=_?_===Dt?r.length:p.length:0);let A=_===Dt&&/\b(transform|all)(,|$)/.test(i(`${Dt}Property`).toString());return{type:_,timeout:b,propCount:y,hasTransform:A}}function Sr(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((o,i)=>Cr(o)+Cr(e[i])))}function Cr(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function Br(){return document.body.offsetHeight}function Ic(e,t,o){let i=e[co];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):o?e.setAttribute("class",t):e.className=t}var zn=Symbol("_vod"),Lo={beforeMount(e,{value:t},{transition:o}){e[zn]=e.style.display==="none"?"":e.style.display,o&&t?o.beforeEnter(e):Mo(e,t)},mounted(e,{value:t},{transition:o}){o&&t&&o.enter(e)},updated(e,{value:t,oldValue:o},{transition:i}){!t!=!o&&(i?t?(i.beforeEnter(e),Mo(e,!0),i.enter(e)):i.leave(e,()=>{Mo(e,!1)}):Mo(e,t))},beforeUnmount(e,{value:t}){Mo(e,t)}};function Mo(e,t){e.style.display=t?e[zn]:"none"}function Pc(e,t,o){let i=e.style,s=be(o);if(o&&!s){if(t&&!be(t))for(let r in t)o[r]==null&&Fn(i,r,"");for(let r in o)Fn(i,r,o[r])}else{let r=i.display;s?t!==o&&(i.cssText=o):t&&e.removeAttribute("style"),zn in e&&(i.display=r)}}var Nr=/\s*!important$/;function Fn(e,t,o){if(H(o))o.forEach(i=>Fn(e,t,i));else if(o==null&&(o=""),t.startsWith("--"))e.setProperty(t,o);else{let i=Ac(e,t);Nr.test(o)?e.setProperty(st(i),o.replace(Nr,""),"important"):e[i]=o}}var kr=["Webkit","Moz","ms"],Ln={};function Ac(e,t){let o=Ln[t];if(o)return o;let i=ze(t);if(i!=="filter"&&i in e)return Ln[t]=i;i=Mt(i);for(let s=0;s<kr.length;s++){let r=kr[s]+i;if(r in e)return Ln[t]=r}return t}var Dr="http://www.w3.org/1999/xlink";function Rc(e,t,o,i,s){if(i&&t.startsWith("xlink:"))o==null?e.removeAttributeNS(Dr,t.slice(6,t.length)):e.setAttributeNS(Dr,t,o);else{let r=ns(t);o==null||r&&!Ji(o)?e.removeAttribute(t):e.setAttribute(t,r?"":o)}}function Mc(e,t,o,i,s,r,n){if(t==="innerHTML"||t==="textContent"){i&&n(i,s,r),e[t]=o==null?"":o;return}let c=e.tagName;if(t==="value"&&c!=="PROGRESS"&&!c.includes("-")){e._value=o;let f=c==="OPTION"?e.getAttribute("value"):e.value,_=o==null?"":o;f!==_&&(e.value=_),o==null&&e.removeAttribute(t);return}let p=!1;if(o===""||o==null){let f=typeof e[t];f==="boolean"?o=Ji(o):o==null&&f==="string"?(o="",p=!0):f==="number"&&(o=0,p=!0)}try{e[t]=o}catch(f){}p&&e.removeAttribute(t)}function Pt(e,t,o,i){e.addEventListener(t,o,i)}function Vc(e,t,o,i){e.removeEventListener(t,o,i)}var Ir=Symbol("_vei");function Lc(e,t,o,i,s=null){let r=e[Ir]||(e[Ir]={}),n=r[t];if(i&&n)n.value=i;else{let[c,p]=Uc(t);if(i){let f=r[t]=jc(i,s);Pt(e,c,f,p)}else n&&(Vc(e,c,n,p),r[t]=void 0)}}var Pr=/(?:Once|Passive|Capture)$/;function Uc(e){let t;if(Pr.test(e)){t={};let i;for(;i=e.match(Pr);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):st(e.slice(2)),t]}var Un=0,Fc=Promise.resolve(),zc=()=>Un||(Fc.then(()=>Un=0),Un=Date.now());function jc(e,t){let o=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=o.attached)return;He($c(i,o.value),t,5,[i])};return o.value=e,o.attached=zc(),o}function $c(e,t){if(H(t)){let o=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{o.call(e),e._stopped=!0},t.map(i=>s=>!s._stopped&&i&&i(s))}else return t}var Ar=/^on[a-z]/,Bc=(e,t,o,i,s=!1,r,n,c,p)=>{t==="class"?Ic(e,i,s):t==="style"?Pc(e,o,i):Xt(t)?go(t)||Lc(e,t,o,i,n):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Hc(e,t,i,s))?Mc(e,t,i,r,n,c,p):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),Rc(e,t,i,s))};function Hc(e,t,o,i){return i?!!(t==="innerHTML"||t==="textContent"||t in e&&Ar.test(t)&&Z(o)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||Ar.test(t)&&be(o)?!1:t in e}var Hr=new WeakMap,Gr=new WeakMap,Ti=Symbol("_moveCb"),Rr=Symbol("_enterCb"),Gc={name:"TransitionGroup",props:Te({},Nc,{tag:String,moveClass:String}),setup(e,{slots:t}){let o=Ei(),i=Nn(),s,r;return vi(()=>{if(!s.length)return;let n=e.moveClass||`${e.name||"v"}-move`;if(!Qc(s[0].el,o.vnode.el,n))return;s.forEach(Wc),s.forEach(Kc);let c=s.filter(Yc);Br(),c.forEach(p=>{let f=p.el,_=f.style;ft(f,n),_.transform=_.webkitTransform=_.transitionDuration="";let b=f[Ti]=y=>{y&&y.target!==f||(!y||/transform$/.test(y.propertyName))&&(f.removeEventListener("transitionend",b),f[Ti]=null,It(f,n))};f.addEventListener("transitionend",b)})}),()=>{let n=ie(e),c=jr(n),p=n.tag||V;s=r,r=t.default?mi(t.default()):[];for(let f=0;f<r.length;f++){let _=r[f];_.key!=null&&Ht(_,ro(_,c,i,o))}if(s)for(let f=0;f<s.length;f++){let _=s[f];Ht(_,ro(_,c,i,o)),Hr.set(_,_.el.getBoundingClientRect())}return de(p,null,r)}}},qc=e=>delete e.mode;Gc.props;function Wc(e){let t=e.el;t[Ti]&&t[Ti](),t[Rr]&&t[Rr]()}function Kc(e){Gr.set(e,e.el.getBoundingClientRect())}function Yc(e){let t=Hr.get(e),o=Gr.get(e),i=t.left-o.left,s=t.top-o.top;if(i||s){let r=e.el.style;return r.transform=r.webkitTransform=`translate(${i}px,${s}px)`,r.transitionDuration="0s",e}}function Qc(e,t,o){let i=e.cloneNode(),s=e[co];s&&s.forEach(c=>{c.split(/\s+/).forEach(p=>p&&i.classList.remove(p))}),o.split(/\s+/).forEach(c=>c&&i.classList.add(c)),i.style.display="none";let r=t.nodeType===1?t:t.parentNode;r.appendChild(i);let{hasTransform:n}=$r(i);return r.removeChild(i),n}var po=e=>{let t=e.props["onUpdate:modelValue"]||!1;return H(t)?o=>yt(t,o):t};function Jc(e){e.target.composing=!0}function Mr(e){let t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}var ut=Symbol("_assign"),ue={created(e,{modifiers:{lazy:t,trim:o,number:i}},s){e[ut]=po(s);let r=i||s.props&&s.props.type==="number";Pt(e,t?"change":"input",n=>{if(n.target.composing)return;let c=e.value;o&&(c=c.trim()),r&&(c=to(c)),e[ut](c)}),o&&Pt(e,"change",()=>{e.value=e.value.trim()}),t||(Pt(e,"compositionstart",Jc),Pt(e,"compositionend",Mr),Pt(e,"change",Mr))},mounted(e,{value:t}){e.value=t==null?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:o,trim:i,number:s}},r){if(e[ut]=po(r),e.composing)return;let n=s||e.type==="number"?to(e.value):e.value,c=t==null?"":t;n!==c&&(document.activeElement===e&&e.type!=="range"&&(o||i&&e.value.trim()===c)||(e.value=c))}},Uo={deep:!0,created(e,t,o){e[ut]=po(o),Pt(e,"change",()=>{let i=e._modelValue,s=Vo(e),r=e.checked,n=e[ut];if(H(i)){let c=Wo(i,s),p=c!==-1;if(r&&!p)n(i.concat(s));else if(!r&&p){let f=[...i];f.splice(c,1),n(f)}}else if(mt(i)){let c=new Set(i);r?c.add(s):c.delete(s),n(c)}else n(qr(e,r))})},mounted:Vr,beforeUpdate(e,t,o){e[ut]=po(o),Vr(e,t,o)}};function Vr(e,{value:t,oldValue:o},i){e._modelValue=t,H(t)?e.checked=Wo(t,i.props.value)>-1:mt(t)?e.checked=t.has(i.props.value):t!==o&&(e.checked=oo(t,qr(e,!0)))}var _t={deep:!0,created(e,{value:t,modifiers:{number:o}},i){let s=mt(t);Pt(e,"change",()=>{let r=Array.prototype.filter.call(e.options,n=>n.selected).map(n=>o?to(Vo(n)):Vo(n));e[ut](e.multiple?s?new Set(r):r:r[0])}),e[ut]=po(i)},mounted(e,{value:t}){Lr(e,t)},beforeUpdate(e,t,o){e[ut]=po(o)},updated(e,{value:t}){Lr(e,t)}};function Lr(e,t){let o=e.multiple;if(!(o&&!H(t)&&!mt(t))){for(let i=0,s=e.options.length;i<s;i++){let r=e.options[i],n=Vo(r);if(o)H(t)?r.selected=Wo(t,n)>-1:r.selected=t.has(n);else if(oo(Vo(r),t)){e.selectedIndex!==i&&(e.selectedIndex=i);return}}!o&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function Vo(e){return"_value"in e?e._value:e.value}function qr(e,t){let o=t?"_trueValue":"_falseValue";return o in e?e[o]:t}var Xc=["ctrl","shift","alt","meta"],Zc={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Xc.some(o=>e[`${o}Key`]&&!t.includes(o))},we=(e,t)=>(o,...i)=>{for(let s=0;s<t.length;s++){let r=Zc[t[s]];if(r&&r(o,t))return}return e(o,...i)},ed={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Fe=(e,t)=>o=>{if(!("key"in o))return;let i=st(o.key);if(t.some(s=>s===i||ed[s]===i))return e(o)},td=Te({patchProp:Bc},Cc),Ur;function od(){return Ur||(Ur=_r(td))}var Wr=(...e)=>{let t=od().createApp(...e),{mount:o}=t;return t.mount=i=>{let s=id(i);if(!s)return;let r=t._component;!Z(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";let n=o(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),n},t};function id(e){return be(e)?document.querySelector(e):e}function jn(e){return e=e||new Map,{all:e,on(t,o){let i=e.get(t);i&&i.push(o)||e.set(t,[o])},off(t,o){let i=e.get(t);i&&i.splice(i.indexOf(o)>>>0,1)},emit(t,o){Array.from(e.get(t)||[]).slice().map(i=>{i(o)}),Array.from(e.get("*")||[]).slice().map(i=>{i(t,o)})}}}var d=jn();var X={SALES_INVOICE:{CREATE:"posawesome.api.sales_invoice.create_invoice",UPDATE:"posawesome.api.sales_invoice.update_invoice",SUBMIT:"posawesome.api.sales_invoice.submit_invoice",DELETE:"posawesome.api.sales_invoice.delete_invoice",GET_INVOICES_FOR_RETURN:"posawesome.api.sales_invoice.get_invoices_for_return",SAVE_DRAFT:"posawesome.api.sales_invoice.save_draft_invoice",GET_DRAFTS:"posawesome.api.sales_invoice.get_draft_invoices",GET_PRINT_INVOICES:"posawesome.api.sales_invoice.get_print_invoices"},CUSTOMER:{GET_CUSTOMER:"posawesome.api.customer.get_customer",GET_MANY_CUSTOMERS:"posawesome.api.customer.get_many_customers",GET_CUSTOMERS_COUNT:"posawesome.api.customer.get_customers_count",POST_CUSTOMER:"posawesome.api.customer.create_customer",UPDATE_CUSTOMER:"posawesome.api.customer.update_customer",CREATE_CUSTOMER_ADDRESS:"posawesome.api.customer.create_customer_address",GET_CUSTOMER_CREDIT:"posawesome.api.customer.get_customer_credit",GET_ADDRESSES:"posawesome.api.customer.get_many_customer_addresses",GET_CUSTOMER_OUTSTANDING_BALANCE:"posawesome.api.customer.get_customer_outstanding_balance"},POS_PROFILE:{GET_DEFAULT_PAYMENT:"posawesome.api.pos_profile.get_default_payment_from_pos_profile"},ITEM:{GET_ITEMS:"posawesome.api.item.get_items",GET_ITEMS_GROUPS:"posawesome.api.item.get_items_groups",GET_BARCODE_ITEM:"posawesome.api.item.get_barcode_item",PROCESS_BATCH_SELECTION:"posawesome.api.item.process_batch_selection"},POS_OFFER:{GET_APPLICABLE_OFFERS:"posawesome.posawesome.doctype.pos_offer.pos_offer.get_applicable_offers",GET_OFFERS_FOR_PROFILE:"posawesome.posawesome.doctype.pos_offer.pos_offer.get_offers_for_profile",APPLY_OFFERS_TO_INVOICE:"posawesome.posawesome.doctype.pos_offer.pos_offer.get_offers"},POS_OPENING_SHIFT:{GET_OPENING_DATA:"posawesome.api.pos_profile.get_opening_dialog_data",CREATE_OPENING_VOUCHER:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.create_opening_voucher",GET_CURRENT_SHIFT_NAME:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.get_current_shift_name",GET_ALL_OPEN_SHIFTS:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.get_all_open_shifts",GET_USER_SHIFT_INVOICE_COUNT:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.get_user_shift_invoice_count",GET_PROFILE_USERS:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.get_profile_users",CHECK_OPENING_TIME_ALLOWED:"posawesome.posawesome.doctype.pos_opening_shift.pos_opening_shift.check_opening_time_allowed"},POS_CLOSING_SHIFT:{CHECK_CLOSING_TIME_ALLOWED:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.check_closing_time_allowed",GET_CASHIERS:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_cashiers",GET_POS_INVOICES:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_pos_invoices",GET_PAYMENTS_ENTRIES:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_payments_entries",MAKE_CLOSING_SHIFT:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.make_closing_shift_from_opening",SUBMIT_CLOSING_SHIFT:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.submit_closing_shift",GET_PAYMENT_TOTALS:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_payment_totals",GET_CURRENT_CASH_TOTAL:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_current_cash_total",GET_CURRENT_NON_CASH_TOTAL:"posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.get_current_non_cash_total"},POSAWESOME:{PING:"posawesome.api.ping.ping"},FRAPPE:{CLIENT_GET:"frappe.client.get",CLIENT_DELETE:"frappe.client.delete",PING:"frappe.ping"}};(function(){window.clearCacheAndReload||(window.clearCacheAndReload=function(){try{localStorage.clear()}catch(e){try{Object.keys(localStorage).forEach(t=>localStorage.removeItem(t))}catch(t){}}try{sessionStorage.clear()}catch(e){}try{location.reload(!0)}catch(e){location.reload()}})})();var Si={data(){return{drawer:!1,mini:!0,item:0,items:[{text:"POS",icon:"mdi-network-pos"}],page:"",fav:!0,message:!1,hints:!0,snack:!1,snackColor:"",snackText:"",company_name:"",pos_profile:"",freeze:!1,freezeTitle:"",freezeMsg:"",last_invoice:"",invoice_doc:null,pos_opening_shift:null,shift_invoice_count:0,pingTime:"000",pingInterval:null,totalCash:0,totalNonCash:0,quick_return_value:!1,wasConnectionLost:!1,shiftMonitoringInterval:null,printDialog:!1,printInvoicesList:[],selectedPrintInvoice:null,isLoadingInvoices:!1}},computed:{invoiceNumberText(){var e,t;return((e=this.invoice_doc)==null?void 0:e.is_return)&&((t=this.invoice_doc)==null?void 0:t.return_against)?"Return_Invoice":this.quick_return_value?"Quick_Return":"Sales_Mode"},invoiceNumberClass(){var e;return!this.invoice_doc||!this.invoice_doc.name?this.quick_return_value?"quick-return-mode":(e=this.invoice_doc)!=null&&e.is_return?"return-invoice-mode":"sales-invoice-mode":this.invoice_doc.is_return?"return-invoice":"regular-invoice"},invoiceIconColor(){var e;return!this.invoice_doc||!this.invoice_doc.name?this.quick_return_value?"#9c27b0":(e=this.invoice_doc)!=null&&e.is_return?"#607d8b":"#4caf50":this.quick_return_value?"#9c27b0":this.invoice_doc.is_return?"#607d8b":"#4caf50"},shiftNumberText(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"Shift not opened yet":this.pos_opening_shift.name},shiftNumberClass(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"no-shift":this.pos_opening_shift.status==="Open"?"open-shift":"closed-shift"},shiftIconColor(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"#757575":this.pos_opening_shift.status==="Open"?"#4caf50":"#ff9800"},currentUserName(){return frappe.session.user||"Unknown User"},shiftStartText(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"Not opened":this.pos_opening_shift.period_start_date?`${new Date(this.pos_opening_shift.period_start_date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})}`:"Unknown"},shiftStartClass(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"no-shift-start":this.pos_opening_shift.status==="Open"?"open-shift-start":"closed-shift-start"},shiftStartIconColor(){return!this.pos_opening_shift||!this.pos_opening_shift.name?"#757575":this.pos_opening_shift.status==="Open"?"#4caf50":"#ff9800"},totalInvoicesQty(){return!this.pos_opening_shift||!this.pos_opening_shift.name||!this.pos_profile?"000":this.shift_invoice_count||"000"},pingClass(){let e=parseInt(this.pingTime);return e<100?"ping-excellent":e<300?"ping-good":e<500?"ping-fair":"ping-poor"},pingIconColor(){let e=parseInt(this.pingTime);return e<100?"#4caf50":e<300?"#1976d2":e<500?"#ff9800":"#f44336"}},watch:{},methods:{formatCurrency(e){return(e==null||isNaN(e))&&(e=0),typeof e=="string"&&(e=parseFloat(e)||0),e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},fetchPaymentTotals(){if(!this.pos_profile||!this.pos_profile.name){this.totalCash=0,this.totalNonCash=0;return}frappe.call({method:X.POS_CLOSING_SHIFT.GET_PAYMENT_TOTALS,args:{pos_profile:this.pos_profile.name,user:frappe.session.user},callback:e=>{e.message?(this.totalCash=parseFloat(e.message.cash_total||0)||0,this.totalNonCash=parseFloat(e.message.non_cash_total||0)||0):(this.totalCash=0,this.totalNonCash=0)},error:e=>{this.totalCash=0,this.totalNonCash=0}})},setupCashUpdateInterval(){this.cashUpdateInterval&&clearInterval(this.cashUpdateInterval),this.fetchPaymentTotals(),this.cashUpdateInterval=setInterval(()=>{this.fetchPaymentTotals()},1e4)},changePage(e){this.$emit("changePage",e)},go_desk(){frappe.set_route("/"),location.reload()},close_shift_dialog(){d.emit("open_closing_dialog")},show_mesage(e){this.snack=!0,this.snackColor=e.color,this.snackText=e.text,setTimeout(()=>{this.snack=!1},4e3)},logOut(){var e=this;return e.logged_out=!0,frappe.call({method:"logout",callback:function(t){t.exc||(e.show_mesage({color:"info",text:"Logged out successfully. Click to reload."}),document.querySelector(".snackbar").addEventListener("click",function(){frappe.set_route("/login"),location.reload()}))}})},async openPrintDialog(){var e;if(!this.pos_profile||!this.pos_profile.name){this.show_mesage({color:"error",text:"\u0644\u0627 \u064A\u0648\u062C\u062F \u0628\u0631\u0648\u0641\u0627\u064A\u0644 POS \u0645\u062D\u062F\u062F"});return}this.printDialog=!0,this.selectedPrintInvoice=null,this.isLoadingInvoices=!0;try{let t=await frappe.call({method:X.SALES_INVOICE.GET_PRINT_INVOICES,args:{pos_profile:this.pos_profile.name,pos_opening_shift:((e=this.pos_opening_shift)==null?void 0:e.name)||null,user:frappe.session.user}});t.message&&Array.isArray(t.message)?this.printInvoicesList=t.message:this.printInvoicesList=[]}catch(t){this.show_mesage({color:"error",text:"\u062E\u0637\u0623 \u0641\u064A \u062C\u0644\u0628 \u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631: "+(t.message||"\u062E\u0637\u0623 \u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641")}),this.printInvoicesList=[]}finally{this.isLoadingInvoices=!1}},printSelectedInvoice(){if(!this.selectedPrintInvoice)return;let e=this.selectedPrintInvoice.name,t=this.pos_profile.print_format_for_online||this.pos_profile.posa_print_format,o=this.pos_profile.letter_head||0,i=frappe.urllib.get_base_url()+"/printview?doctype=Sales%20Invoice&name="+e+"&trigger_print=1&format="+t+"&no_letterhead="+o,s=window.open(i,"Print");s.addEventListener("load",function(){s.print()},!0),this.printDialog=!1,this.selectedPrintInvoice=null},fetch_company_info(){this.pos_profile&&this.pos_profile.company&&frappe.db.get_doc("Company",this.pos_profile.company).then(e=>{this.company_name=e.company_name}).catch(e=>{})},async clearCache(){try{this.show_mesage({color:"info",text:"Clearing cache..."}),window.clearCacheAndReload?(await window.clearCacheAndReload(),this.show_mesage({color:"success",text:"Cache cleared successfully. Reloading..."}),setTimeout(()=>{location.reload()},1e3)):(localStorage.clear(),sessionStorage.clear(),this.show_mesage({color:"success",text:"Basic cache cleared. Reloading..."}),setTimeout(()=>{location.reload()},1e3))}catch(e){this.show_mesage({color:"error",text:"Error clearing cache: "+e.message})}},async fetchShiftInvoiceCount(){if(!(!this.pos_profile||!this.pos_opening_shift))try{let e=await frappe.call({method:X.POS_OPENING_SHIFT.GET_USER_SHIFT_INVOICE_COUNT,args:{pos_profile:this.pos_profile.name,pos_opening_shift:this.pos_opening_shift.name}});e.message!==void 0&&(this.shift_invoice_count=e.message)}catch(e){this.shift_invoice_count=0}},measurePing(){if(!navigator.onLine){this.pingTime="999",this.wasConnectionLost||(this.wasConnectionLost=!0,this.show_mesage({color:"error",text:"\u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A \u0645\u0641\u0635\u0648\u0644"}));return}let e=performance.now(),t=null,o=!1;t=setTimeout(()=>{o||(o=!0,this.pingTime="999",this.wasConnectionLost||(this.wasConnectionLost=!0,this.show_mesage({color:"error",text:"\u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A \u0645\u0641\u0635\u0648\u0644"})))},1e3),frappe.call({method:X.POSAWESOME.PING,args:{},callback:i=>{if(t&&(clearTimeout(t),t=null),o)return;o=!0;let s=performance.now(),r=Math.round(s-e);this.pingTime=r.toString().padStart(3,"0"),r>1e3&&this.show_mesage({color:"warning",text:"\u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A \u0636\u0639\u064A\u0641 \u062C\u062F\u0627"}),this.wasConnectionLost&&(this.wasConnectionLost=!1,this.show_mesage({color:"success",text:"\u062A\u0645 \u0631\u062C\u0648\u0639 \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A"}))},error:i=>{t&&(clearTimeout(t),t=null),!o&&(o=!0,this.pingTime="999",this.wasConnectionLost||(this.wasConnectionLost=!0,this.show_mesage({color:"error",text:"\u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A \u0645\u0641\u0635\u0648\u0644"})))},freeze:!1,show_spinner:!1,async:!0})},startPingMonitoring(){this.pingInterval||(this._wasRunningBeforeHidden=!0,this.measurePing(),this.pingInterval=setInterval(()=>{this.measurePing()},2e3))},stopPingMonitoring(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=null,this._wasRunningBeforeHidden=!1)},checkShiftStatus(){if(!this.pos_opening_shift||!this.pos_opening_shift.name)return;let e=this.pos_opening_shift.name;console.log("[Navbar.js] Checking shift status:",e),frappe.call({method:"frappe.client.get",args:{doctype:"POS Opening Shift",name:e},callback:t=>{if(t.message){let o=t.message;console.log("[Navbar.js] Opening shift status:",o.status),console.log("[Navbar.js] Opening shift pos_closing_shift:",o.pos_closing_shift),o.status==="Closed"&&o.pos_closing_shift?(console.log("[Navbar.js] Shift closed successfully with closing shift linked!"),this.show_mesage({color:"error",text:"\u062A\u0645 \u0625\u063A\u0644\u0627\u0642 \u0627\u0644\u0648\u0631\u062F\u064A\u0629. \u0633\u064A\u062A\u0645 \u0625\u0639\u0627\u062F\u0629 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0635\u0641\u062D\u0629..."}),setTimeout(()=>{window.clearCacheAndReload?window.clearCacheAndReload():location.reload()},2e3)):o.status==="Closed"&&!o.pos_closing_shift?console.log("[Navbar.js] Shift closed but no closing shift linked yet - continuing to monitor..."):frappe.call({method:X.POS_OPENING_SHIFT.GET_CURRENT_SHIFT_NAME,args:{},callback:i=>{if(i.message&&i.message.success&&i.message.data){let s=i.message.data;s.name!==e&&(console.log("[Navbar.js] Shift was changed to:",s.name),this.show_mesage({color:"error",text:"\u062A\u0645 \u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0648\u0631\u062F\u064A\u0629. \u0633\u064A\u062A\u0645 \u0625\u0639\u0627\u062F\u0629 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0635\u0641\u062D\u0629..."}),setTimeout(()=>{window.clearCacheAndReload?window.clearCacheAndReload():location.reload()},2e3))}},error:i=>{i&&i.message&&console.error("[Navbar.js] checkShiftStatus error:",i.message)},freeze:!1,show_spinner:!1,async:!0})}},error:t=>{t&&t.message&&console.error("[Navbar.js] checkShiftStatus error:",t.message)},freeze:!1,show_spinner:!1,async:!0})},startShiftMonitoring(){this.shiftMonitoringInterval||!this.pos_opening_shift||!this.pos_opening_shift.name||(console.log("[Navbar.js] Starting shift monitoring for:",this.pos_opening_shift.name),this.checkShiftStatus(),this.shiftMonitoringInterval=setInterval(()=>{this.checkShiftStatus()},5e3))},stopShiftMonitoring(){console.log("[Navbar.js] stopShiftMonitoring called"),console.log("[Navbar.js] shiftMonitoringInterval before:",this.shiftMonitoringInterval),this.shiftMonitoringInterval?(clearInterval(this.shiftMonitoringInterval),this.shiftMonitoringInterval=null,console.log("[Navbar.js] Shift monitoring stopped")):console.log("[Navbar.js] No shift monitoring interval to stop"),console.log("[Navbar.js] shiftMonitoringInterval after:",this.shiftMonitoringInterval)},togglePingMonitoring(e){e?(sessionStorage.setItem("pos_enable_ping_monitoring","true"),this.startPingMonitoring()):(sessionStorage.setItem("pos_enable_ping_monitoring","false"),this.stopPingMonitoring())},handleStopShiftMonitoring(){if(!this.shiftMonitoringInterval){console.log("[Navbar.js] Shift monitoring already stopped - ignoring duplicate stop_shift_monitoring event");return}console.log("[Navbar.js] ===== handleStopShiftMonitoring START ====="),console.log("[Navbar.js] Received stop_shift_monitoring event - stopping shift monitoring"),console.log("[Navbar.js] Current shiftMonitoringInterval:",this.shiftMonitoringInterval),this.stopShiftMonitoring(),console.log("[Navbar.js] ===== handleStopShiftMonitoring END =====")}},created:function(){this.$nextTick(function(){try{sessionStorage.getItem("pos_enable_ping_monitoring")!=="false"&&this.startPingMonitoring(),this.handleVisibilityChange=()=>{document.hidden?this.stopPingMonitoring():this._wasRunningBeforeHidden&&this.startPingMonitoring()},this._wasRunningBeforeHidden=!0,document.addEventListener("visibilitychange",this.handleVisibilityChange),this.handleOnline=()=>{this.wasConnectionLost&&(this.wasConnectionLost=!1,this.show_mesage({color:"success",text:"\u062A\u0645 \u0631\u062C\u0648\u0639 \u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A"})),this.pingInterval?this.measurePing():this.startPingMonitoring()},this.handleOffline=()=>{this.pingTime="999",this.wasConnectionLost||(this.wasConnectionLost=!0,this.show_mesage({color:"error",text:"\u0627\u0644\u0627\u062A\u0635\u0627\u0644 \u0628\u0627\u0644\u0625\u0646\u062A\u0631\u0646\u062A \u0645\u0641\u0635\u0648\u0644"}))},window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline),d.on("show_mesage",t=>{this.show_mesage(t)}),d.on("set_company",t=>{this.company_name=t.name}),d.on("register_pos_profile",t=>{this.pos_profile=t.pos_profile,this.pos_opening_shift=t.pos_opening_shift,this.fetch_company_info(),this.fetchShiftInvoiceCount(),this.setupCashUpdateInterval()}),d.on("set_last_invoice",t=>{this.last_invoice=t}),d.on("toggle_quick_return",t=>{this.quick_return_value=t}),d.on("update_invoice_doc",t=>{this.invoice_doc=t}),d.on("set_pos_opening_shift",t=>{this.pos_opening_shift=t,this.fetchShiftInvoiceCount(),this.setupCashUpdateInterval(),this.startShiftMonitoring()}),d.on("register_pos_data",t=>{t.pos_profile&&(this.pos_profile=t.pos_profile),t.pos_opening_shift&&(this.pos_opening_shift=t.pos_opening_shift,console.log("[Navbar.js] Shift registered:",this.pos_opening_shift.name)),this.fetch_company_info(),this.fetchShiftInvoiceCount(),this.setupCashUpdateInterval(),this.startShiftMonitoring()}),d.on("invoice_submitted",()=>{this.fetchPaymentTotals(),setTimeout(()=>{this.fetchShiftInvoiceCount(),this.fetchPaymentTotals()},1e3)}),d.on("freeze",t=>{this.freeze=!0,this.freezeTitle=t.title,this.freezeMsg=t.msg}),d.on("unfreeze",()=>{this.freeze=!1,this.freezTitle="",this.freezeMsg=""}),d.on("stop_shift_monitoring",this.handleStopShiftMonitoring),d.on("toggle_ping_monitoring",t=>{this.togglePingMonitoring(t)}),d.on("stop_shift_monitoring",()=>{this.handleStopShiftMonitoring()})}catch(e){this.show_mesage({color:"error",text:"An error occurred while loading the menu."})}})},beforeUnmount(){this.stopPingMonitoring(),this.stopShiftMonitoring(),document.removeEventListener("click",this.handleClickOutside),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.handleOnline&&window.removeEventListener("online",this.handleOnline),this.handleOffline&&window.removeEventListener("offline",this.handleOffline),this.cashUpdateInterval&&(clearInterval(this.cashUpdateInterval),this.cashUpdateInterval=null),d.off("show_mesage"),d.off("set_company"),d.off("register_pos_profile"),d.off("set_last_invoice"),d.off("update_invoice_doc"),d.off("set_pos_opening_shift"),d.off("register_pos_data"),d.off("invoice_submitted"),d.off("freeze"),d.off("unfreeze"),d.off("toggle_ping_monitoring"),d.off("stop_shift_monitoring",this.handleStopShiftMonitoring)}};var nd={style:{display:"flex","align-items":"center",gap:"4px",padding:"2px 6px",background:"linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%)","border-bottom":"1px solid #e0e0e0","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.06)",height:"32px",position:"sticky",top:"0","z-index":"1100"}},sd=a("i",{class:"mdi mdi-point-of-sale",style:{"font-size":"16px",color:"var(--primary)"}},null,-1),rd=[sd],ad={style:{flex:"1",display:"flex","align-items":"center",gap:"3px","overflow-x":"auto","scrollbar-width":"none"}},ld={style:{color:"inherit","font-weight":"600","font-size":"10px"}},cd={style:{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid rgba(25, 118, 210, 0.5)",background:"linear-gradient(135deg, #eaf4ff 0%, #dbeeff 100%)",color:"#1976d2","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}},dd=a("i",{class:"mdi mdi-account",style:{"font-size":"12px",color:"var(--primary)"}},null,-1),pd={style:{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid rgba(25, 118, 210, 0.5)",background:"linear-gradient(135deg, #eaf4ff 0%, #dbeeff 100%)",color:"#1976d2","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}},fd=a("i",{class:"mdi mdi-counter",style:{"font-size":"12px",color:"var(--primary)"}},null,-1),ud={style:{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid rgba(76, 175, 80, 0.5)",background:"linear-gradient(135deg, #eefbe7 0%, #def2da 100%)",color:"#2e7d32","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}},_d=a("i",{class:"mdi mdi-cash-multiple",style:{"font-size":"12px",color:"var(--success)"}},null,-1),hd={style:{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid rgba(156, 39, 176, 0.3)",background:"linear-gradient(135deg, #f8eefb 0%, #f0e1f6 100%)",color:"#9033b7","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}},gd=a("i",{class:"mdi mdi-credit-card",style:{"font-size":"12px",color:"var(--primary)"}},null,-1),md={style:{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid rgba(25, 118, 210, 0.5)",background:"linear-gradient(135deg, #eaf4ff 0%, #dbeeff 100%)",color:"#1976d2","font-size":"10px","font-weight":"700","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}},yd=a("i",{class:"mdi mdi-briefcase",style:{"font-size":"12px",color:"var(--primary)"}},null,-1),bd={style:{display:"flex","align-items":"center",gap:"3px"}},vd=a("i",{class:"mdi mdi-printer",style:{"font-size":"19px",color:"#1565c0"}},null,-1),xd=[vd],wd=a("i",{class:"mdi mdi-cached",style:{"font-size":"19px",color:"#2264d4"}},null,-1),Ed=[wd],Od=a("i",{class:"mdi mdi-close-circle",style:{"font-size":"19px",color:"#d32f2f"}},null,-1),Td=[Od],Sd={key:1,style:{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"3000"}},Cd={style:{background:"white","border-radius":"8px","max-width":"500px",width:"90%","max-height":"80vh","overflow-y":"auto","box-shadow":"0 8px 32px rgba(0, 0, 0, 0.3)"}},Nd={style:{padding:"20px","border-bottom":"1px solid #e0e0e0"}},kd={style:{margin:"0",color:"#333","font-size":"18px","font-weight":"600"}},Dd={style:{padding:"20px",color:"#666","line-height":"1.5"}},Id={style:{display:"flex","justify-content":"center","align-items":"center"}},Pd={style:{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},Ad={style:{background:"linear-gradient(135deg, #1565c0 0%, #0d47a1 100%)",color:"white",padding:"12px 16px","border-bottom":"1px solid #e0e0e0",position:"relative"}},Rd=a("span",{style:{color:"white",display:"flex","align-items":"center",gap:"0","font-size":"1.25rem","font-weight":"700"}},[a("i",{class:"mdi mdi-printer",style:{"font-size":"18px"}}),P("\u062C\u062F\u0648\u0644 \u0637\u0628\u0627\u0639\u0647 \u0641\u0627\u062A\u0648\u0631\u0629 ")],-1),Md={style:{padding:"16px","max-height":"60vh","overflow-y":"auto"}},Vd={key:0,style:{"text-align":"center",padding:"40px"}},Ld=a("div",{style:{"font-size":"1rem",color:"#666"}},"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...",-1),Ud=[Ld],Fd=a("div",{style:{"text-align":"center",padding:"40px"}},[a("div",{style:{"font-size":"1rem",color:"#666"}}," \u0644\u0627 \u062A\u0648\u062C\u062F \u0641\u0648\u0627\u062A\u064A\u0631 \u0645\u0633\u062C\u0644\u0629 ")],-1),zd={style:{width:"100%","border-collapse":"collapse","font-size":"0.9rem"}},jd=a("thead",null,[a("tr",{style:{background:`linear-gradient(
												135deg,
												#1565c0 0%,
												#0d47a1 100%
											)`,"border-bottom":"2px solid #e0e0e0",color:"white"}},[a("th",{style:{padding:"12px","text-align":"right","font-weight":"600",color:"white"}}," \u0627\u0644\u0639\u0645\u064A\u0644 "),a("th",{style:{padding:"12px","text-align":"center","font-weight":"600",color:"white"}}," \u0627\u0644\u062A\u0627\u0631\u064A\u062E "),a("th",{style:{padding:"12px","text-align":"center","font-weight":"600",color:"white"}}," \u0627\u0644\u0648\u0642\u062A "),a("th",{style:{padding:"12px","text-align":"right","font-weight":"600",color:"white"}}," \u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 "),a("th",{style:{padding:"12px","text-align":"center","font-weight":"600",color:"white"}}," \u0627\u0644\u062D\u0627\u0644\u0629 "),a("th",{style:{padding:"12px","text-align":"left","font-weight":"600",color:"white"}}," \u0627\u0644\u0645\u0628\u0644\u063A ")])],-1),$d=["onClick","onMouseleave"],Bd={style:{padding:"12px","text-align":"right"}},Hd={style:{padding:"12px","text-align":"center"}},Gd={style:{padding:"12px","text-align":"center"}},qd={style:{padding:"12px","text-align":"right","font-weight":"600"}},Wd={style:{padding:"12px","text-align":"center"}},Kd={style:{padding:"12px","text-align":"left","font-weight":"600"}},Yd={style:{display:"flex","align-items":"center","justify-content":"flex-end",gap:"8px",padding:"16px","border-top":"1px solid #e0e0e0"}},Qd=a("div",{style:{flex:"1"}},null,-1),Jd=["disabled"],Xd=a("i",{class:"mdi mdi-printer",style:{"margin-left":"4px"}},null,-1);function Kr(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" NAVBAR COMPONENT "),l(" =========================================== "),a("nav",null,[a("div",nd,[l(" =========================================== "),l(" LOGO/TITLE "),l(" =========================================== "),a("div",{onClick:t[0]||(t[0]=(...n)=>e.go_desk&&e.go_desk(...n)),style:{display:"flex","align-items":"center","justify-content":"center",padding:"4px 8px",cursor:"pointer","border-radius":"4px"},title:"Go to Desk"},rd),l(" =========================================== "),l(" INFO BADGES "),l(" =========================================== "),a("div",ad,[a("div",{style:k([e.invoiceNumberClass==="regular-invoice"?"border-color: rgba(8, 86, 152, 0.85); background: linear-gradient(135deg, #d4e8ff 0%, #93b9ff 100%); color: #043a8b;":e.invoiceNumberClass==="return-invoice"||e.invoiceNumberClass==="return-invoice-mode"?`border-color: ${e.invoiceIconColor}; background: ${e.invoiceIconColor}; color: white;`:e.invoiceNumberClass==="quick-return-mode"?`border-color: ${e.invoiceIconColor}; background: ${e.invoiceIconColor}; color: white;`:e.invoiceNumberClass==="sales-invoice-mode"?`border-color: ${e.invoiceIconColor}; background: ${e.invoiceIconColor}; color: white;`:"border-color: rgba(63, 81, 181, 0.75); background: linear-gradient(135deg, #eef3ff 0%, #d9e4ff 100%); color: #22314f; font-style: normal;",{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}])},[a("span",ld,x(e.invoiceNumberText),1)],4),l(" Shift Badge "),a("div",{style:k([e.shiftNumberClass==="open-shift"?"border-color: rgba(76, 175, 80, 0.50); background: linear-gradient(135deg, #eefbe7 0%, #def2da 100%); color: #2e7d32;":e.shiftNumberClass==="closed-shift"?"border-color: rgba(255, 152, 0, 0.30); background: linear-gradient(135deg, #fffaf3 0%, #fff0d6 100%); color: #000000b0;":"border-color: rgba(189, 189, 189, 0.65); background: #f9f9f9; color: #757575; font-style: italic;",{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid",background:"#fff","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}])},[a("i",{class:"mdi mdi-clock-outline",style:k(`font-size: 12px; color: ${e.shiftIconColor}`)},null,4),a("span",null,x(e.shiftNumberText),1)],4),l(" User Badge "),a("div",cd,[dd,a("span",null,x(e.currentUserName),1)]),l(" Shift Start Badge "),a("div",{style:k([e.shiftStartClass==="shift-active"?"border-color: rgba(76, 175, 80, 0.50); background: linear-gradient(135deg, #eefbe7 0%, #def2da 100%); color: #2e7d32;":"border-color: rgba(189, 189, 189, 0.65); background: #f9f9f9; color: #757575;",{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid",background:"#fff","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}])},[a("i",{class:"mdi mdi-clock-start",style:k(`font-size: 12px; color: ${e.shiftStartIconColor}`)},null,4),a("span",null,x(e.shiftStartText),1)],4),l(" Totals Badge "),a("div",pd,[fd,a("span",null,"QTY: "+x(e.totalInvoicesQty),1)]),l(" Cash Badge "),a("div",ud,[_d,a("span",null,x(e.formatCurrency(e.totalCash)),1)]),l(" Card Badge "),a("div",hd,[gd,a("span",null,x(e.formatCurrency(e.totalNonCash)),1)]),l(" Ping Badge "),a("div",{style:k([e.pingClass==="ping-excellent"?"border-color: rgba(76, 175, 80, 0.50); background: linear-gradient(135deg, #eefbe7 0%, #def2da 100%); color: #2e7d32;":e.pingClass==="ping-good"?"border-color: rgba(33, 150, 243, 0.50); background: linear-gradient(135deg, #eaf4ff 0%, #dbeeff 100%); color: #1976d2;":e.pingClass==="ping-fair"?"border-color: rgba(255, 152, 0, 0.50); background: linear-gradient(135deg, #fff9ed 0%, #fff1d6 100%); color: #f57c00;":"border-color: rgba(244, 67, 54, 0.50); background: linear-gradient(135deg, #fff6f6 0%, #ffe6e6 100%); color: #d32f2f;",{display:"inline-flex","align-items":"center",gap:"3px",padding:"2px 6px","border-radius":"4px",border:"1px solid",background:"#fff","font-size":"10px","font-weight":"600","white-space":"nowrap","line-height":"1",height:"22px","box-sizing":"border-box"}])},[a("i",{class:"mdi mdi-wifi",style:k(`font-size: 12px; color: ${e.pingIconColor}`)},null,4),a("span",null,x(e.pingTime)+"ms",1)],4),l(" Profile Badge "),a("div",md,[yd,a("span",null,x(e.pos_profile.name),1)])]),l(" =========================================== "),l(" ACTION BUTTONS "),l(" =========================================== "),a("div",bd,[l(" Print Button: Print Invoice Dialog "),a("button",{onClick:t[1]||(t[1]=(...n)=>e.openPrintDialog&&e.openPrintDialog(...n)),title:"\u0637\u0628\u0627\u0639\u0629 \u0641\u0627\u062A\u0648\u0631\u0629",style:{display:"inline-flex","align-items":"center","justify-content":"center",gap:"6px",padding:"6px 8px","border-radius":"6px",border:"1px solid rgba(25, 118, 210, 0.12)",background:`linear-gradient(
							90deg,
							rgba(25, 118, 210, 0.12),
							rgba(30, 136, 229, 0.08)
						)`,"font-size":"11px","font-weight":"600",height:"24px","min-width":"24px","box-sizing":"border-box",cursor:"pointer"},onMouseenter:t[2]||(t[2]=n=>{n.currentTarget.style.background="rgba(25, 118, 210, 0.2)",n.currentTarget.style.borderColor="rgba(25, 118, 210, 0.3)",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[3]||(t[3]=n=>{n.currentTarget.style.background="linear-gradient(90deg, rgba(25, 118, 210, 0.12), rgba(30, 136, 229, 0.08))",n.currentTarget.style.borderColor="rgba(25, 118, 210, 0.12)",n.currentTarget.style.boxShadow=""}),"aria-label":"Print last receipt"},xd,32),l(" Cache Button: Clear Cache "),a("button",{onClick:t[4]||(t[4]=(...n)=>e.clearCache&&e.clearCache(...n)),title:"\u0645\u0633\u062D \u0627\u0644\u0630\u0627\u0643\u0631\u0629 \u0627\u0644\u0645\u0624\u0642\u062A\u0629",style:{display:"inline-flex","align-items":"center","justify-content":"center",gap:"6px",padding:"6px 8px","border-radius":"6px",border:"1px solid rgba(255, 160, 0, 0.1)",background:`linear-gradient(
							90deg,
							rgba(255, 193, 7, 0.18),
							rgba(255, 152, 0, 0.12)
						)`,cursor:"pointer","font-size":"11px","font-weight":"600",height:"24px","min-width":"24px","box-sizing":"border-box"},onMouseenter:t[5]||(t[5]=n=>{n.currentTarget.style.background="rgba(255, 193, 7, 0.25)",n.currentTarget.style.borderColor="rgba(255, 152, 0, 0.3)",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[6]||(t[6]=n=>{n.currentTarget.style.background="linear-gradient(90deg, rgba(255, 193, 7, 0.18), rgba(255, 152, 0, 0.12))",n.currentTarget.style.borderColor="rgba(255, 160, 0, 0.1)",n.currentTarget.style.boxShadow=""}),"aria-label":"Clear cache"},Ed,32),l(" Close Shift Button: Close POS "),e.pos_profile.posa_hide_closing_shift?l("v-if",!0):(g(),m("button",{key:0,onClick:t[7]||(t[7]=(...n)=>e.close_shift_dialog&&e.close_shift_dialog(...n)),title:"\u0625\u063A\u0644\u0627\u0642 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639",style:{display:"inline-flex","align-items":"center","justify-content":"center",gap:"6px",padding:"6px 8px","border-radius":"6px",border:"1px solid rgba(244, 67, 54, 0.2)",background:`linear-gradient(
							90deg,
							rgba(244, 67, 54, 0.15),
							rgba(211, 47, 47, 0.1)
						)`,cursor:"pointer","font-size":"11px","font-weight":"600",height:"24px","min-width":"24px","box-sizing":"border-box"},onMouseenter:t[8]||(t[8]=n=>{n.currentTarget.style.background="rgba(244, 67, 54, 0.25)",n.currentTarget.style.borderColor="rgba(244, 67, 54, 0.4)",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[9]||(t[9]=n=>{n.currentTarget.style.background="linear-gradient(90deg, rgba(244, 67, 54, 0.15), rgba(211, 47, 47, 0.1))",n.currentTarget.style.borderColor="rgba(244, 67, 54, 0.2)",n.currentTarget.style.boxShadow=""}),"aria-label":"Close POS"},Td,32))])]),l(" Snackbar "),e.snack?(g(),m("div",{key:0,style:k([e.snackColor==="success"?"background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); border: 1px solid #4caf50":e.snackColor==="error"?"background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); border: 1px solid #f44336":e.snackColor==="info"?"background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); border: 1px solid #2196f3":"background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); border: 1px solid #ff9800",{position:"fixed",top:"40px",left:"50%",transform:"translateX(-50%)","min-width":"300px","max-width":"500px",padding:"12px 20px","border-radius":"8px",color:"white","font-weight":"600","font-size":"14px","z-index":"2000",cursor:"pointer","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.15)","text-align":"center"}]),onClick:t[10]||(t[10]=n=>e.snack=!1)},x(e.snackText),5)):l("v-if",!0),l(" Modal Overlay "),e.freeze?(g(),m("div",Sd,[a("div",Cd,[a("div",Nd,[a("h3",kd,x(e.freezeTitle),1)]),a("div",Dd,x(e.freezeMsg),1)])])):l("v-if",!0),l(" =========================================== "),l(" PRINT INVOICE DIALOG "),l(" =========================================== "),a("div",Id,[l(" Modal Overlay "),e.printDialog?(g(),m("div",{key:0,onClick:t[20]||(t[20]=n=>e.printDialog=!1),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"}},[l(" Modal "),a("div",{onClick:t[19]||(t[19]=we(()=>{},["stop"])),style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"90vw","min-width":"600px",width:"auto","max-height":"90vh",overflow:"hidden"}},[l(" Card "),a("div",Pd,[l(" =========================================== "),l(" CARD HEADER "),l(" =========================================== "),a("div",Ad,[Rd,a("button",{onClick:t[11]||(t[11]=n=>e.printDialog=!1),style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none","font-size":"1.5rem",color:"white",cursor:"pointer",width:"32px",height:"32px",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}}," \xD7 ")]),l(" =========================================== "),l(" CARD BODY "),l(" =========================================== "),a("div",Md,[l(" Loading State "),e.isLoadingInvoices?(g(),m("div",Vd,Ud)):!e.printInvoicesList||e.printInvoicesList.length===0?(g(),m(V,{key:1},[l(" Empty State "),Fd],2112)):(g(),m(V,{key:2},[l(" Table "),a("table",zd,[jd,a("tbody",null,[(g(!0),m(V,null,ae(e.printInvoicesList,n=>(g(),m("tr",{key:n.name,onClick:c=>e.selectedPrintInvoice=n,style:k([e.selectedPrintInvoice&&e.selectedPrintInvoice.name===n.name?"background: #e3f2fd; cursor: pointer;":"cursor: pointer;",{"border-bottom":"1px solid #e0e0e0"}]),onMouseenter:t[12]||(t[12]=c=>c.currentTarget.style.background="#f5f5f5"),onMouseleave:c=>c.currentTarget.style.background=e.selectedPrintInvoice&&e.selectedPrintInvoice.name===n.name?"#e3f2fd":"transparent"},[a("td",Bd,x(n.customer_name||n.customer||"-"),1),a("td",Hd,x(n.posting_date||"-"),1),a("td",Gd,x(n.posting_time?n.posting_time.split(".")[0]:"-"),1),a("td",qd,x(n.name),1),a("td",Wd,[a("span",{style:k({display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",whiteSpace:"nowrap",backgroundColor:(n.invoice_status||n.status)==="Paid"?"#e8f5e9":(n.invoice_status||n.status)==="Unpaid"?"#ffebee":(n.invoice_status||n.status)==="Partly Paid"?"#fff3e0":(n.invoice_status||n.status)==="Return"?"#f3e5f5":(n.invoice_status||n.status)==="Credit Note Issued"?"#e1bee7":"#f5f5f5",color:(n.invoice_status||n.status)==="Paid"?"#2e7d32":(n.invoice_status||n.status)==="Unpaid"?"#c62828":(n.invoice_status||n.status)==="Partly Paid"?"#e65100":(n.invoice_status||n.status)==="Return"?"#6a1b9a":(n.invoice_status||n.status)==="Credit Note Issued"?"#7b1fa2":"#616161",border:(n.invoice_status||n.status)==="Paid"?"1px solid #4caf50":(n.invoice_status||n.status)==="Unpaid"?"1px solid #ef5350":(n.invoice_status||n.status)==="Partly Paid"?"1px solid #ff9800":(n.invoice_status||n.status)==="Return"?"1px solid #9c27b0":(n.invoice_status||n.status)==="Credit Note Issued"?"1px solid #ab47bc":"1px solid #9e9e9e"})},x(n.invoice_status||n.status||"-"),5)]),a("td",Kd,x(e.formatCurrency(n.grand_total||0)),1)],44,$d))),128))])])],2112))]),l(" =========================================== "),l(" CARD FOOTER "),l(" =========================================== "),a("div",Yd,[Qd,a("button",{onClick:t[13]||(t[13]=n=>e.printDialog=!1),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #d32f2f","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #f44336 0%, #e53935 100%)",color:"white"},onMouseenter:t[14]||(t[14]=n=>{n.currentTarget.style.background="#e53935",n.currentTarget.style.borderColor="#c62828",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[15]||(t[15]=n=>{n.currentTarget.style.background="linear-gradient(135deg, #f44336 0%, #e53935 100%)",n.currentTarget.style.borderColor="#d32f2f",n.currentTarget.style.boxShadow=""})}," \u0625\u063A\u0644\u0627\u0642 ",32),a("button",{onClick:t[16]||(t[16]=(...n)=>e.printSelectedInvoice&&e.printSelectedInvoice(...n)),disabled:!e.selectedPrintInvoice,style:k([{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #1565c0","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #1565c0 0%, #1976d2 100%)",color:"white"},e.selectedPrintInvoice?"":"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; border-color: #e0e0e0"]),onMouseenter:t[17]||(t[17]=n=>{e.selectedPrintInvoice&&(n.currentTarget.style.background="#1976d2",n.currentTarget.style.borderColor="#0d47a1",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")}),onMouseleave:t[18]||(t[18]=n=>{e.selectedPrintInvoice&&(n.currentTarget.style.background="linear-gradient(135deg, #1565c0 0%, #1976d2 100%)",n.currentTarget.style.borderColor="#1565c0",n.currentTarget.style.boxShadow="")})},[Xd,P(" \u0637\u0628\u0627\u0639\u0629 ")],44,Jd)])])])])):l("v-if",!0)])])],2112)}Si.render=Kr;Si.__file="../posawesome/posawesome/public/js/posapp/components/Navbar.vue";var Yr=Si;var Re={data(){return{float_precision:3,currency_precision:2}},methods:{flt(e,t,o,i){try{return!t&&t!=0&&(t=this.currency_precision||2),i="Banker's Rounding",flt(e,t,o,i)}catch(s){return parseFloat(e||0).toFixed(t||2)}},formatCurrency(e,t){try{return format_number(e,null,t||this.currency_precision||2)}catch(o){return parseFloat(e||0).toFixed(t||2)}},formatFloat(e,t){try{return format_number(e,null,t||this.float_precision||3)}catch(o){return parseFloat(e||0).toFixed(t||3)}},setFormatedCurrency(e,t,o,i=!1,s){let r=0;try{let n=parseFloat(s.target.value);isNaN(n)||(r=n),i&&r<0&&(r=r*-1),r=this.formatCurrency(s.target.value,o)}catch(n){r=parseFloat(s.target.value||0).toFixed(o||2)}return typeof e=="object"?e[t]=r:this[t]=r,r},setFormatedFloat(e,t,o,i=!1,s){let r=0;try{r=parseFloat(s.target.value),isNaN(r)?r=0:i&&r<0&&(r=r*-1),r=this.formatFloat(s.target.value,o)}catch(n){r=parseFloat(s.target.value||0).toFixed(o||3)}return typeof e=="object"?e[t]=r:this[t]=r,r},currencySymbol(e){return""},isNumber(e){try{return/^-?(\d+|\d{1,3}(\.\d{3})*)(,\d+)?$/.test(e)||"invalid number"}catch(t){return!1}}},mounted(){this.float_precision=3,this.currency_precision=2}};function Zd(e,t){let o;return function(...s){let r=this,n=()=>{clearTimeout(o),e.apply(r,s)};clearTimeout(o),o=setTimeout(n,t)}}var Qr={ADD_ITEM:"add_item",SET_ALL_ITEMS:"set_all_items",UPDATE_CUR_ITEMS_DETAILS:"update_cur_items_details",SHOW_OFFERS:"show_offers",SHOW_MESSAGE:"show_mesage",REGISTER_POS_PROFILE:"register_pos_profile",UPDATE_CUSTOMER:"update_customer",UPDATE_CUSTOMER_PRICE_LIST:"update_customer_price_list",UPDATE_OFFERS_COUNTERS:"update_offers_counters"},fo={SEARCH_MIN_LENGTH:3,MAX_DISPLAYED_ITEMS:50,MIN_PANEL_HEIGHT:180,BOTTOM_PADDING:16,DEBOUNCE_DELAY:200},ep={CARD:"card",LIST:"list"};var Ci={name:"ItemsSelector",mixins:[Re],data(){return{pos_profile:null,flags:{},items_view:ep.LIST,item_group:"item_group_menu",loading:!1,search_loading:!1,items_group:["item_group_menu"],items:[],search:"",first_search:"",barcode_search:"",itemsPerPage:1e3,offersCount:0,appliedOffersCount:0,customer_price_list:null,customer:null,qty:1,itemsScrollHeight:null,_suppressCustomerWatcher:!1,_processingBarcode:!1,is_return_invoice:!1,_detailsReady:!1,_itemsMap:new Map}},watch:{filtred_items(e,t){e.length!==t.length&&this.update_items_details(e),this.scheduleScrollHeightUpdate()},customer(e,t){if(this._suppressCustomerWatcher){this._suppressCustomerWatcher=!1;return}t!==void 0&&e!==t&&this.get_items()},items_view(){this.scheduleScrollHeightUpdate()}},computed:{filtred_items(){this.search=this.get_search(this.first_search);let e=this.item_group!=="item_group_menu",t=this.search&&this.search.length>=fo.SEARCH_MIN_LENGTH,o=[],i=[];if(e){let s=this.item_group.toLowerCase();i=this.items.filter(r=>r.item_group.toLowerCase().includes(s))}else i=this.items;if(!t)o=i.slice(0,fo.MAX_DISPLAYED_ITEMS);else{let s=this.search.toLowerCase();o=i.filter(r=>r.item_code.toLowerCase().includes(s)),o.length===0&&(o=i.filter(r=>r.item_name.toLowerCase().includes(s)))}return o.slice(0,fo.MAX_DISPLAYED_ITEMS)},itemsScrollStyle(){return this.itemsScrollHeight?{maxHeight:`${this.itemsScrollHeight-80}px`}:{}},debounce_search:{get(){return this.first_search},set:Zd(function(e){this.first_search=e,this.performLiveSearch(e)},fo.DEBOUNCE_DELAY)}},methods:{scheduleScrollHeightUpdate(){this.$nextTick(()=>{requestAnimationFrame(()=>{this.updateScrollableHeight()})})},updateScrollableHeight(){var i;let e=this.$refs.itemsScrollArea,t=e?e.$el||e:null;if(!t||typeof t.getBoundingClientRect!="function")return;let o=window.innerHeight||((i=document.documentElement)==null?void 0:i.clientHeight)||0;!o||requestAnimationFrame(()=>{let s=t.getBoundingClientRect(),r=o-s.top-fo.BOTTOM_PADDING;Number.isFinite(r)&&(this.itemsScrollHeight=Math.max(fo.MIN_PANEL_HEIGHT,Math.floor(r)))})},handle_barcode_input(){if(!this.barcode_search.trim())return;if(this._processingBarcode){this._processingBarcode=!1,this.barcode_search="";return}this.process_barcode(this.barcode_search.trim()),this.barcode_search="";let e=document.querySelector("#barcode-input");e&&(e.value="")},process_barcode(e){if(this.is_return_invoice){d.emit("show_mesage",{text:"Cannot scan items in return mode. Only items from the original invoice can be returned.",color:"error"});return}frappe.call({method:X.ITEM.GET_BARCODE_ITEM,args:{pos_profile:this.pos_profile,barcode_value:e},callback:t=>{var o;(o=t==null?void 0:t.message)!=null&&o.item_code?this.add_item_to_cart(t.message):d.emit("show_mesage",{text:"Item not found with this barcode",color:"error"})},error:t=>{d.emit("show_mesage",{text:"Error processing barcode",color:"error"})}})},add_item_to_cart(e){if(this.is_return_invoice){d.emit("show_mesage",{text:"\u0644\u0627 \u064A\u0645\u0643\u0646 \u0625\u0636\u0627\u0641\u0629 \u0623\u0635\u0646\u0627\u0641 \u062C\u062F\u064A\u062F\u0629 \u0625\u0644\u0649 \u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0625\u0631\u062C\u0627\u0639. \u064A\u0645\u0643\u0646 \u0625\u0631\u062C\u0627\u0639 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0645\u0646 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629 \u0641\u0642\u0637.",color:"error"});return}d.emit(Qr.ADD_ITEM,e)},show_offers(){d.emit(Qr.SHOW_OFFERS,"true")},onItemGroupChange(){this.debounce_search&&(this.debounce_search="",this.first_search=""),this.get_items()},get_items(){if(!this.pos_profile){d.emit("show_mesage",{text:"POS Profile not specified",color:"error"});return}let e=this;this.loading=!0;let t=this.get_search(this.first_search),o="",i="";t&&(i=t),e.item_group!="item_group_menu"&&(o=e.item_group.toLowerCase()),frappe.call({method:X.ITEM.GET_ITEMS,args:{pos_profile:e.pos_profile,price_list:e.customer_price_list,item_group:o,search_value:i,customer:e.customer},callback:function(s){s.message&&(e.items=(s.message||[]).map(r=>({item_code:r.item_code,item_name:r.item_name,item_group:r.item_group,brand:r.brand,rate:r.rate,price_list_rate:r.price_list_rate,base_rate:r.base_rate,currency:r.currency,actual_qty:r.actual_qty,stock_uom:r.stock_uom,image:r.image,item_barcode:[],serial_no_data:[],batch_no_data:[]})),e._buildItemsMap(),d.emit("set_all_items",e.items),e.loading=!1,e.search_loading=!1,e.scheduleScrollHeightUpdate())},error:function(s){console.log("[ItemsSelector.js] get_items error:",s)}})},_buildItemsMap(){this._itemsMap.clear(),this.items.forEach(e=>{this._itemsMap.set(e.item_code.toLowerCase(),e),this._itemsMap.set(e.item_name.toLowerCase(),e)})},get_items_groups(){if(!!this.pos_profile)if(this.pos_profile.item_groups&&this.pos_profile.item_groups.length>0)this.pos_profile.item_groups.forEach(e=>{let t=typeof e=="string"?e:e.item_group;t&&t!=="item_group_menu"&&this.items_group.push(t)});else{let e=this;frappe.call({method:X.ITEM.GET_ITEMS_GROUPS,args:{},callback:function(t){t.message&&t.message.forEach(o=>{e.items_group.push(o.name)})},error:function(t){console.log("[ItemsSelector.js] get_items_groups error:",t)}})}},getItemsHeaders(){return[{title:__("Item Name"),align:"start",sortable:!0,key:"item_name",width:"40%"},{title:__("Item Code"),align:"start",sortable:!0,key:"item_code",width:"35%"},{title:__("Price"),key:"rate",align:"start",width:"5%"},{title:__("Qty"),value:"actual_qty",key:"actual_qty",align:"center",width:"15%"},{title:__("UOM"),key:"stock_uom",align:"center",width:"5%"}]},add_item_table(e){if(this.is_return_invoice){d.emit("show_mesage",{text:"\u0644\u0627 \u064A\u0645\u0643\u0646 \u0625\u0636\u0627\u0641\u0629 \u0623\u0635\u0646\u0627\u0641 \u062C\u062F\u064A\u062F\u0629 \u0625\u0644\u0649 \u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0625\u0631\u062C\u0627\u0639. \u064A\u0645\u0643\u0646 \u0625\u0631\u062C\u0627\u0639 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0645\u0646 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629 \u0641\u0642\u0637.",color:"error"});return}d.emit("add_item",Ce(ve({},e),{qty:this.qty||1})),this.qty=1,this.$nextTick(()=>{var t;(t=this.$refs.barcode_search)==null||t.focus()})},add_item(e){if(this.is_return_invoice){d.emit("show_mesage",{text:"\u0644\u0627 \u064A\u0645\u0643\u0646 \u0625\u0636\u0627\u0641\u0629 \u0623\u0635\u0646\u0627\u0641 \u062C\u062F\u064A\u062F\u0629 \u0625\u0644\u0649 \u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0625\u0631\u062C\u0627\u0639. \u064A\u0645\u0643\u0646 \u0625\u0631\u062C\u0627\u0639 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0645\u0646 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629 \u0641\u0642\u0637.",color:"error"});return}d.emit("add_item",Ce(ve({},e),{qty:this.qty||1})),this.qty=1,this.$nextTick(()=>{var t;(t=this.$refs.barcode_search)==null||t.focus()})},get_search(e){return e||""},esc_event(){this.first_search="",this.debounce_search=""},performLiveSearch(e){let t=this;if(this.search_loading=!0,!e||e.trim()===""){this.get_items();return}let o=e.trim();if(/^\d+$/.test(o)&&o.length>=8){frappe.call({method:X.ITEM.GET_BARCODE_ITEM,args:{pos_profile:t.pos_profile,barcode_value:o},callback:function(s){var r;t.search_loading=!1,(r=s==null?void 0:s.message)!=null&&r.item_code?(t.add_item_to_cart(s.message),t.debounce_search="",t.first_search=""):t._performNormalSearch(o)},error:function(s){t.search_loading=!1,t._performNormalSearch(o)}});return}this._performNormalSearch(o)},_performNormalSearch(e){let t=this;frappe.call({method:X.ITEM.GET_ITEMS,args:{pos_profile:t.pos_profile,price_list:t.customer_price_list,item_group:t.item_group!=="item_group_menu"?t.item_group.toLowerCase():"",search_value:e,customer:t.customer},callback:function(o){t.search_loading=!1,o.message&&(t.items=(o.message||[]).map(i=>Ce(ve({},i),{item_group:i.item_group,price_list_rate:i.price_list_rate||i.rate,base_rate:i.base_rate||i.rate,image:i.image,item_barcode:Array.isArray(i.item_barcode)?i.item_barcode:[],serial_no_data:Array.isArray(i.serial_no_data)?i.serial_no_data:[],batch_no_data:Array.isArray(i.batch_no_data)?i.batch_no_data:[]})),t._buildItemsMap(),d.emit("set_all_items",t.items))},error:function(o){t.search_loading=!1,console.log("[ItemsSelector.js] _performNormalSearch error:",o)}})},update_items_details(e){d.emit("update_cur_items_details",e)},scan_barcode(){let e=this;try{document.scannerDetectionData&&document.scannerDetectionData.options&&onScan.detachFrom(document)}catch(t){console.log("[ItemsSelector.js] scan_barcode detachFrom error:",t)}onScan.attachTo(document,{suffixKeyCodes:[13],reactToKeydown:!0,reactToPaste:!1,keyCodeMapper:function(t){return t.stopImmediatePropagation(),onScan.decodeKeyEvent(t)},onScan:function(t){e._processingBarcode=!0,e.barcode_search="",e.trigger_onscan(t)}})},trigger_onscan(e){this.process_barcode(e)}},created:function(){this.$nextTick(function(){}),d.on("register_pos_profile",e=>{this.pos_profile=e.pos_profile,this._suppressCustomerWatcher=!0,this.customer=this.pos_profile&&this.pos_profile.customer?this.pos_profile.customer:this.customer,this.get_items(),this.get_items_groups(),this.items_view=this.pos_profile.posa_default_card_view?"card":"list"}),d.on("update_offers_counters",e=>{this.offersCount=e.offersCount,this.appliedOffersCount=e.appliedOffersCount}),d.on("update_customer_price_list",e=>{this.customer_price_list=e}),d.on("update_customer",e=>{this.customer=e}),d.on("clear_search_fields",()=>{this.barcode_search="",this.debounce_search="",this.first_search="",this.item_group!=="item_group_menu"&&(this.item_group="item_group_menu",this.get_items())}),d.on("load_return_invoice",e=>{this.is_return_invoice=!!(e.invoice_doc&&e.invoice_doc.return_against)}),d.on("new_invoice",e=>{!e||!e.is_return&&!e.return_against?this.is_return_invoice=!1:this.is_return_invoice=!!e.return_against}),d.on("invoice_submitted",()=>{this.is_return_invoice&&(this.is_return_invoice=!1)})},mounted(){this.$nextTick(()=>{setTimeout(()=>{this.scan_barcode()},300)}),this.scheduleScrollHeightUpdate(),window.addEventListener("resize",this.scheduleScrollHeightUpdate)},beforeUnmount(){this._searchDebounceTimer&&clearTimeout(this._searchDebounceTimer);try{document.scannerDetectionData&&document.scannerDetectionData.options&&onScan.detachFrom(document)}catch(e){}d.$off("register_pos_profile"),d.$off("update_cur_items_details"),d.$off("update_offers_counters"),d.$off("update_customer_price_list"),d.$off("update_customer"),d.$off("clear_search_fields"),d.$off("load_return_invoice"),d.$off("new_invoice"),d.$off("invoice_submitted"),window.removeEventListener("resize",this.scheduleScrollHeightUpdate)}};var tp={style:{display:"flex","flex-direction":"column",height:"100%",background:"white",overflow:"hidden"}},op={style:{display:"flex",gap:"4px",padding:"4px",background:"#c4763d85","border-bottom":"1px solid #e0e0e0"}},ip={style:{flex:"1","min-width":"0"}},np={style:{width:"100%",height:"26px",display:"flex","align-items":"center",gap:"4px",padding:"0 8px",background:"white",border:"1px solid #e0e0e0","border-radius":"4px",position:"relative"}},sp=a("i",{class:"mdi mdi-shape",style:{color:"#1976d2","flex-shrink":"0","font-size":"18px"}},null,-1),rp=["value"],ap=a("span",{style:{content:"'\u25BC'",position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)","font-size":"13px",color:"#1976d2","pointer-events":"none"}},"\u25BC",-1),lp={style:{flex:"1","min-width":"0"}},cp=a("i",{class:"mdi mdi-tag-multiple",style:{"font-size":"18px"}},null,-1),dp={style:{flex:"1",display:"flex","flex-direction":"column",overflow:"hidden",position:"relative"}},pp={key:0,style:{position:"absolute",top:"0",left:"0",right:"0",height:"4px",background:"#e0e0e0",overflow:"hidden","z-index":"10"}},fp=a("div",{style:{height:"100%",background:"#1976d2","transform-origin":"0% 50%"}},null,-1),up=[fp],_p={style:{display:"flex",gap:"3px",padding:"4px",background:"#c4763d85","border-bottom":"1px solid #e0e0e0"}},hp={style:{flex:"1","min-width":"0"}},gp={style:{position:"relative",display:"flex","align-items":"center",background:"white",border:"1px solid #e0e0e0","border-radius":"4px",height:"28px",overflow:"hidden"}},mp=a("div",{style:{display:"flex","align-items":"center",padding:"0 6px",height:"100%"}},[a("i",{class:"mdi mdi-barcode",style:{color:"#4caf50","font-size":"20px"}})],-1),yp=["placeholder","disabled"],bp={style:{flex:"1","min-width":"0"}},vp={style:{position:"relative",display:"flex","align-items":"center",background:"white",border:"1px solid #e0e0e0","border-radius":"4px",height:"28px",overflow:"hidden"}},xp={key:0,style:{position:"absolute",top:"0",left:"0",right:"0",height:"2px",background:"#e0e0e0",overflow:"hidden","z-index":"10"}},wp=a("div",{style:{height:"100%",background:"#1976d2","transform-origin":"0% 50%"}},null,-1),Ep=[wp],Op=a("div",{style:{display:"flex","align-items":"center",padding:"0 6px",height:"100%"}},[a("i",{class:"mdi mdi-magnify",style:{color:"#1976d2","font-size":"20px"}})],-1),Tp={style:{flex:"1",display:"flex","flex-direction":"column",overflow:"hidden","min-height":"0"}},Sp={key:0,style:{flex:"1",display:"flex","flex-direction":"column",overflow:"hidden","min-height":"0"}},Cp=["onClick","title"],Np={key:1,style:{flex:"1","min-height":"140px",display:"flex","align-items":"center","justify-content":"center",background:"#f5f5f5","border-bottom":"1px solid #e0e0e0",overflow:"hidden"}},kp=["src","alt"],Dp={key:2,style:{flex:"1","min-height":"140px",display:"flex","align-items":"center","justify-content":"center",background:"linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)","border-bottom":"1px solid #e0e0e0","font-size":"2.5rem","font-weight":"700",color:"#9e9e9e"}},Ip={style:{padding:"8px",background:"white",display:"flex","flex-direction":"column",gap:"2px"}},Pp={style:{"font-size":"0.75rem","font-weight":"600",color:"#333","margin-bottom":"4px",overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis"}},Ap={style:{"font-size":"0.85rem","font-weight":"700",color:"#1976d2"}},Rp={key:1,style:{flex:"1",display:"flex","flex-direction":"column",overflow:"hidden","min-height":"0"}},Mp={style:{width:"100%","max-width":"100%","border-collapse":"collapse","font-size":"0.75rem",background:"white","table-layout":"auto"}},Vp={style:{"border-bottom":"1px solid #e0e0e0"}},Lp=["onClick","title"],Up={key:0,style:{color:"#1976d2","font-weight":"600","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Fp={key:1,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},zp={key:2,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}};function Jr(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" ITEMS SELECTOR COMPONENT "),l(" =========================================== "),a("div",tp,[l(" =========================================== "),l(" COMPACT HEADER WITH FILTERS AND COUNTERS "),l(" =========================================== "),a("div",op,[a("div",ip,[a("div",np,[sp,ee(a("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>e.item_group=n),onChange:t[1]||(t[1]=(...n)=>e.onItemGroupChange&&e.onItemGroupChange(...n)),style:{flex:"1",height:"100%",border:"none",background:"transparent","font-size":"0.7rem","font-weight":"600",color:"#1976d2",cursor:"pointer",outline:"none","padding-right":"16px",appearance:"none","-webkit-appearance":"none","-moz-appearance":"none","text-align":"center"}},[(g(!0),m(V,null,ae(e.items_group,n=>(g(),m("option",{key:n,value:n},x(n==="item_group_menu"?"\u0645\u062C\u0645\u0648\u0639\u0627\u062A \u0627\u0644\u0623\u0635\u0646\u0627\u0641":n),9,rp))),128))],544),[[_t,e.item_group]]),l(" Dropdown arrow "),ap])]),a("div",lp,[a("button",{onClick:t[2]||(t[2]=(...n)=>e.show_offers&&e.show_offers(...n)),style:{width:"100%",height:"26px",display:"flex","align-items":"center","justify-content":"center",gap:"4px",border:"1px solid #e0e0e0","border-radius":"4px","font-size":"0.7rem","font-weight":"600",cursor:"pointer",background:"white",color:"#1976d2"}},[cp,a("span",null,x(e.offersCount)+" \u0627\u0644\u0639\u0631\u0648\u0636",1)])])]),a("div",dp,[l(" Loading Progress "),e.loading?(g(),m("div",pp,up)):l("v-if",!0),l(" =========================================== "),l(" SEARCH FIELDS "),l(" =========================================== "),a("div",_p,[l(" Barcode Search "),a("div",hp,[a("div",gp,[mp,l(" Barcode disabled in return mode or Scan Barcode "),ee(a("input",{type:"text",placeholder:e.is_return_invoice?"\u0627\u0644\u0628\u0627\u0631\u0643\u0648\u062F \u0645\u0639\u0637\u0644 \u0641\u064A \u0648\u0636\u0639 \u0627\u0644\u0645\u0631\u062A\u062C\u0639":"\u0645\u0633\u062D \u0627\u0644\u0628\u0627\u0631\u0643\u0648\u062F","onUpdate:modelValue":t[3]||(t[3]=n=>e.barcode_search=n),onKeyup:t[4]||(t[4]=Fe((...n)=>e.handle_barcode_input&&e.handle_barcode_input(...n),["enter"])),ref:"barcode_search",disabled:e.is_return_invoice,autofocus:"",style:k({flex:1,border:"none",outline:"none",background:"transparent",padding:"4px 6px",fontSize:"0.8rem",color:e.is_return_invoice?"#999":"#0f172a",fontWeight:"700",height:"100%",cursor:e.is_return_invoice?"not-allowed":"text",textAlign:"center"})},null,44,yp),[[ue,e.barcode_search]]),e.barcode_search?(g(),m("button",{key:0,onClick:t[5]||(t[5]=n=>e.barcode_search=""),type:"button",style:{display:"flex","align-items":"center","justify-content":"center",width:"20px",height:"20px",border:"none",background:"transparent",color:"#999","font-size":"18px",cursor:"pointer","margin-right":"2px","border-radius":"50%",padding:"0","line-height":"1"}}," \xD7 ")):l("v-if",!0)])]),l(" Name Search "),a("div",bp,[a("div",vp,[e.search_loading?(g(),m("div",xp,Ep)):l("v-if",!0),Op,l(" Search Item "),ee(a("input",{type:"text",placeholder:"\u0628\u062D\u062B \u0639\u0646 \u0635\u0646\u0641","onUpdate:modelValue":t[6]||(t[6]=n=>e.debounce_search=n),onKeydown:t[7]||(t[7]=Fe((...n)=>e.esc_event&&e.esc_event(...n),["esc"])),ref:"debounce_search",style:{flex:"1",border:"none",outline:"none",background:"transparent",padding:"4px 6px","font-size":"0.8rem",color:"#0f172a","font-weight":"700",height:"100%","text-align":"center"}},null,544),[[ue,e.debounce_search]]),e.debounce_search?(g(),m("button",{key:1,onClick:t[8]||(t[8]=n=>e.debounce_search=""),type:"button",style:{display:"flex","align-items":"center","justify-content":"center",width:"20px",height:"20px",border:"none",background:"transparent",color:"#999","font-size":"18px",cursor:"pointer","margin-right":"2px","border-radius":"50%",padding:"0","line-height":"1"}}," \xD7 ")):l("v-if",!0)])])]),l(" =========================================== "),l(" ITEMS DISPLAY AREA "),l(" =========================================== "),a("div",Tp,[l(" Card View "),e.items_view=="card"?(g(),m("div",Sp,[a("div",{ref:"itemsScrollArea",style:k([e.itemsScrollStyle,{display:"grid","grid-template-columns":"repeat(auto-fill, minmax(150px, 1fr))",gap:"8px",padding:"8px","overflow-y":"auto"}])},[(g(!0),m(V,null,ae(e.filtred_items,(n,c)=>(g(),m("div",{key:c,onClick:p=>e.add_item(n),title:e.is_return_invoice?"Cannot add items in return mode":n.item_name,style:k({position:"relative",borderRadius:"8px",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.12)",cursor:e.is_return_invoice?"not-allowed":"pointer",userSelect:"none",overflow:"hidden",background:"white",display:"flex",flexDirection:"column",height:"200px",minHeight:"200px",opacity:e.is_return_invoice?.5:1,filter:e.is_return_invoice?"grayscale(50%)":"none"})},[l(" Quantity Pill "),n.actual_qty!==void 0?(g(),m("div",{key:0,style:k([{position:"absolute",top:"8px",right:"8px","z-index":"2",display:"flex","align-items":"center",padding:"2px 8px","border-radius":"12px","font-size":"11px","font-weight":"600","backdrop-filter":"blur(4px)"},{background:n.actual_qty>10?"rgba(76, 175, 80, 0.9)":n.actual_qty<=0?"rgba(244, 67, 54, 0.9)":"rgba(255, 152, 0, 0.9)",color:"white"}])},x(e.formatFloat(n.actual_qty)),5)):l("v-if",!0),l(" Image or Abbreviation "),n.image?(g(),m("div",Np,[a("img",{src:n.image,alt:n.item_name,onError:t[9]||(t[9]=p=>p.target.style.display="none"),style:{width:"100%",height:"100%","object-fit":"cover"}},null,40,kp)])):(g(),m("div",Dp,x(n.item_name.substring(0,2).toUpperCase()),1)),l(" Item Details "),a("div",Ip,[a("div",Pp,x(n.item_name),1),a("div",Ap,x(e.formatCurrency(n.rate))+" / "+x(n.stock_uom),1)])],12,Cp))),128))],4)])):l("v-if",!0),l(" List View "),e.items_view=="list"?(g(),m("div",Rp,[a("div",{ref:"itemsScrollArea",style:k([e.itemsScrollStyle,{flex:"1","min-height":"0","overflow-y":"auto","overflow-x":"hidden",padding:"0",display:"block"}])},[a("table",Mp,[a("thead",null,[a("tr",Vp,[(g(!0),m(V,null,ae(e.getItemsHeaders(),n=>(g(),m("th",{key:n.value,style:k([{textAlign:n.align||"left"},{padding:"8px 12px","font-size":"0.75rem","font-weight":"600",color:"#424242",background:`linear-gradient(
                        180deg,
                        rgba(255, 174, 0, 1) 0%,
                        rgba(255, 174, 0, 0.33) 50%
                      )`,"border-bottom":"1px solid #e0e0e0",position:"sticky",top:"0","z-index":"1","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}])},x(n.title||n.text),5))),128))])]),a("tbody",null,[(g(!0),m(V,null,ae(e.filtred_items,n=>(g(),m("tr",{key:n.item_code,onClick:c=>e.add_item_table(n),title:e.is_return_invoice?"Cannot add items in return mode":n.item_name,style:k({borderBottom:"1px solid #f0f0f0",cursor:e.is_return_invoice?"not-allowed":"pointer",opacity:e.is_return_invoice?.5:1})},[(g(!0),m(V,null,ae(e.getItemsHeaders(),c=>(g(),m("td",{key:c.value,style:k([{textAlign:c.align||"left"},{padding:"13px 12px","font-size":"0.75rem",color:"#424242","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}])},[c.key==="rate"?(g(),m("span",Up,x(e.formatCurrency(n.rate)),1)):c.key==="actual_qty"?(g(),m("span",Fp,x(e.formatFloat(n.actual_qty)),1)):(g(),m("span",zp,x(n[c.key]),1))],4))),128))],12,Lp))),128))])])],4)])):l("v-if",!0)])])])],2112)}Ci.render=Jr;Ci.__file="../posawesome/posawesome/public/js/posapp/components/pos/ItemsSelector.vue";var Xr=Ci;var Ke={SHOW_MESSAGE:"show_mesage",ADD_CUSTOMER_TO_LIST:"add_customer_to_list",UPDATE_CUSTOMER_IN_LIST:"update_customer_in_list",SET_CUSTOMER:"set_customer",FETCH_CUSTOMER_DETAILS:"fetch_customer_details",SET_CUSTOMER_INFO_TO_EDIT:"set_customer_info_to_edit",OPEN_UPDATE_CUSTOMER:"open_update_customer",REGISTER_POS_PROFILE:"register_pos_profile",PAYMENTS_REGISTER_POS_PROFILE:"payments_register_pos_profile"},$n={CUSTOMER_NAME_REQUIRED:"Customer name is required.",CUSTOMER_GROUP_REQUIRED:"Customer group name is required.",TERRITORY_REQUIRED:"Territory name is required."},Zr={CUSTOMER_CREATED:"Customer created successfully.",CUSTOMER_UPDATED:"Customer data updated successfully."},Ni={FAILED_TO_CREATE:"Failed to create customer.",FAILED_TO_LOAD_GROUPS:"Error loading customer groups",FAILED_TO_LOAD_TERRITORIES:"Error loading territories",FAILED_TO_LOAD_GENDERS:"Error loading genders"},ea={INDIVIDUAL:"Individual"},Bn={CUSTOMER_GROUPS:1e3,TERRITORIES:5e3,GENDERS:10},ta={CUSTOMER_GROUP:"Individual",TERRITORY:"Rest Of The World"},ki={name:"UpdateCustomer",data(){return{customerDialog:!1,pos_profile:null,customer_id:"",customer_name:"",tax_id:"",mobile_no:"",email_id:"",posa_referral_code:"",posa_discount:0,customer_type:ea.INDIVIDUAL,gender:"",loyalty_points:null,loyalty_program:null,group:"",groups:[],territory:"",territorys:[],genders:[]}},methods:{close_dialog(){this.customerDialog=!1,this.clear_customer()},clear_customer(){this.customer_name="",this.tax_id="",this.mobile_no="",this.email_id="",this.posa_referral_code="",this.posa_discount=0,this.group=frappe.defaults.get_user_default("Customer Group"),this.territory=frappe.defaults.get_user_default("Territory"),this.customer_id="",this.customer_type=ea.INDIVIDUAL,this.gender="",this.loyalty_points=null,this.loyalty_program=null},getCustomerGroups(){this.groups.length>0||frappe.db.get_list("Customer Group",{fields:["name"],filters:{is_group:0},limit:Bn.CUSTOMER_GROUPS,order_by:"name"}).then(e=>{e.length>0&&(this.groups=e.map(t=>t.name))}).catch(e=>{console.log("[UpdateCustomer.js] getCustomerGroups error:",e),this.showMessage(Ni.FAILED_TO_LOAD_GROUPS,"error")})},getCustomerTerritorys(){this.territorys.length>0||frappe.db.get_list("Territory",{fields:["name"],filters:{is_group:0},limit:Bn.TERRITORIES,order_by:"name"}).then(e=>{e.length>0&&(this.territorys=e.map(t=>t.name))}).catch(e=>{console.log("[UpdateCustomer.js] getCustomerTerritorys error:",e),this.showMessage(Ni.FAILED_TO_LOAD_TERRITORIES,"error")})},getGenders(){frappe.db.get_list("Gender",{fields:["name"],page_length:Bn.GENDERS}).then(e=>{e.length>0&&(this.genders=e.map(t=>t.name))}).catch(e=>{console.log("[UpdateCustomer.js] getGenders error:",e),this.showMessage(Ni.FAILED_TO_LOAD_GENDERS,"error")})},validateForm(){return this.customer_name?this.group?this.territory?!0:(this.showMessage($n.TERRITORY_REQUIRED,"error"),!1):(this.showMessage($n.CUSTOMER_GROUP_REQUIRED,"error"),!1):(this.showMessage($n.CUSTOMER_NAME_REQUIRED,"error"),!1)},submit_dialog(){if(!this.validateForm())return;let e={customer_id:this.customer_id,customer_name:this.customer_name,company:this.pos_profile.company,tax_id:this.tax_id,mobile_no:this.mobile_no,email_id:this.email_id,posa_referral_code:this.posa_referral_code,posa_discount:this.posa_discount,customer_group:this.group,territory:this.territory,customer_type:this.customer_type,gender:this.gender,method:this.customer_id?"update":"create",pos_profile_doc:JSON.stringify(this.pos_profile)};frappe.call({method:this.customer_id?X.CUSTOMER.UPDATE_CUSTOMER:X.CUSTOMER.POST_CUSTOMER,args:e,callback:t=>{!t.exc&&t.message.name?this.handleCustomerSuccess(t.message.name,e):this.handleCustomerError()},error:t=>{console.log("[UpdateCustomer.js] submit_dialog error:",t),this.handleCustomerError()}}),this.customerDialog=!1},handleCustomerSuccess(e,t){let o=!!this.customer_id,i=o?Zr.CUSTOMER_UPDATED:Zr.CUSTOMER_CREATED;t.name=e,o?frappe.call({method:X.CUSTOMER.GET_CUSTOMER,args:{customer_id:e},callback:s=>{!s.exc&&s.message&&(d.emit(Ke.SET_CUSTOMER_INFO_TO_EDIT,s.message),d.emit(Ke.UPDATE_CUSTOMER_IN_LIST,s.message))},error:s=>{}}):(d.emit(Ke.ADD_CUSTOMER_TO_LIST,t),d.emit(Ke.SET_CUSTOMER,e),d.emit(Ke.FETCH_CUSTOMER_DETAILS)),this.close_dialog()},handleCustomerError(){this.showMessage(Ni.FAILED_TO_CREATE,"error")},showMessage(e,t){d.emit(Ke.SHOW_MESSAGE,{text:e,color:t})},populateCustomerData(e){!e||(this.customer_name=e.customer_name,this.customer_id=e.name,this.tax_id=e.tax_id||"",this.mobile_no=e.mobile_no||"",this.email_id=e.email_id||"",this.posa_referral_code=e.posa_referral_code||"",this.posa_discount=e.posa_discount||0,this.group=e.customer_group,this.territory=e.territory,this.customer_type=e.customer_type||"Individual",this.loyalty_points=e.loyalty_points,this.loyalty_program=e.loyalty_program,this.gender=e.gender||"")},registerEventListeners(){d.on(Ke.OPEN_UPDATE_CUSTOMER,this.handleOpenUpdateCustomer),d.on(Ke.REGISTER_POS_PROFILE,this.handleRegisterPosProfile),d.on(Ke.PAYMENTS_REGISTER_POS_PROFILE,this.handlePaymentsRegisterPosProfile)},handleOpenUpdateCustomer(e){this.customerDialog=!0,this.populateCustomerData(e),this.getCustomerGroups(),this.getCustomerTerritorys(),this.getGenders()},handleRegisterPosProfile(e){this.pos_profile=e.pos_profile},handlePaymentsRegisterPosProfile(e){this.pos_profile=e.pos_profile}},created(){this.registerEventListeners(),this.group=frappe.defaults.get_user_default("Customer Group")||ta.CUSTOMER_GROUP,this.territory=frappe.defaults.get_user_default("Territory")||ta.TERRITORY},beforeDestroy(){d.$off(Ke.OPEN_UPDATE_CUSTOMER,this.handleOpenUpdateCustomer),d.$off(Ke.REGISTER_POS_PROFILE,this.handleRegisterPosProfile),d.$off(Ke.PAYMENTS_REGISTER_POS_PROFILE,this.handlePaymentsRegisterPosProfile)}};var jp={style:{display:"flex","justify-content":"center","align-items":"center"}},$p={style:{background:"#fff","border-radius":"12px",overflow:"hidden","box-shadow":"0 6px 16px rgba(0, 0, 0, 0.08)"}},Bp={style:{display:"flex","align-items":"center",gap:"8px",padding:"6px 10px",background:"linear-gradient(135deg, #1976d2 0%, #42a5f5 100%)",color:"white"}},Hp=a("i",{class:"mdi mdi-account-circle",style:{color:"white","font-size":"20px",filter:"drop-shadow(0 6px 16px rgba(33, 150, 243, 0.1))"}},null,-1),Gp={style:{flex:"1","font-size":"13px","font-weight":"600","letter-spacing":"0.3px"}},qp=a("i",{class:"mdi mdi-close",style:{color:"white","font-size":"18px",filter:"drop-shadow(0 6px 14px rgba(244, 67, 54, 0.1))"}},null,-1),Wp=[qp],Kp={style:{padding:"8px 10px"}},Yp={style:{"margin-bottom":"6px"}},Qp=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0633\u0645 \u0627\u0644\u0639\u0645\u064A\u0644 * ",-1),Jp={style:{display:"flex",gap:"6px","margin-bottom":"6px"}},Xp={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},Zp=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u0631\u0642\u0645 \u0627\u0644\u0636\u0631\u064A\u0628\u064A ",-1),ef={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},tf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u062C\u0648\u0627\u0644 ",-1),of={style:{display:"flex",gap:"6px","margin-bottom":"6px"}},nf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},sf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0625\u0644\u0643\u062A\u0631\u0648\u0646\u064A ",-1),rf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},af=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u062C\u0646\u0633 ",-1),lf=a("option",{value:""},"\u0627\u062E\u062A\u0631",-1),cf=["value"],df={style:{display:"flex",gap:"6px","margin-bottom":"6px"}},pf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},ff=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0643\u0648\u062F \u0627\u0644\u0625\u062D\u0627\u0644\u0629 ",-1),uf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},_f=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0646\u0633\u0628\u0629 \u0627\u0644\u062E\u0635\u0645 \u0627\u0644\u0645\u0633\u0645\u0648\u062D\u0647 ",-1),hf={style:{display:"flex",gap:"6px","margin-bottom":"6px"}},gf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},mf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0645\u062C\u0645\u0648\u0639\u0629 \u0627\u0644\u0639\u0645\u0644\u0627\u0621 * ",-1),yf=a("option",{value:""},"\u0627\u062E\u062A\u0631",-1),bf=["value"],vf={style:{flex:"1","min-width":"0","margin-bottom":"6px"}},xf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u0645\u0646\u0637\u0642\u0629 * ",-1),wf=a("option",{value:""},"\u0627\u062E\u062A\u0631",-1),Ef=["value"],Of={key:0,style:{display:"flex",gap:"6px","margin-bottom":"6px"}},Tf={key:0,style:{flex:"1","min-width":"0","margin-bottom":"6px"}},Sf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0628\u0631\u0646\u0627\u0645\u062C \u0627\u0644\u0648\u0644\u0627\u0621 ",-1),Cf={key:1,style:{flex:"1","min-width":"0","margin-bottom":"6px"}},Nf=a("label",{style:{display:"block","font-size":"11px",color:"#555","margin-bottom":"2px","font-weight":"500"}}," \u0627\u0644\u0646\u0642\u0627\u0637 ",-1),kf={style:{display:"flex","justify-content":"flex-end",gap:"6px",padding:"6px 10px",background:"#f9fafb","border-top":"1px solid #e5e7eb"}},Df=a("i",{class:"mdi mdi-close",style:{"font-size":"13px"}},null,-1),If=a("i",{class:"mdi mdi-check",style:{"font-size":"13px"}},null,-1);function oa(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" UPDATE CUSTOMER DIALOG "),l(" =========================================== "),a("div",jp,[l(" Modal Overlay "),e.customerDialog?(g(),m("div",{key:0,onClick:t[15]||(t[15]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"}},[l(" Modal "),a("div",{onClick:t[14]||(t[14]=we(()=>{},["stop"])),style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"400px",width:"90%","max-height":"90vh",overflow:"hidden"}},[l(" Modal Content "),a("div",$p,[l(" =========================================== "),l(" MODAL HEADER "),l(" =========================================== "),a("div",Bp,[Hp,l(" Update Customer / New Customer "),a("span",Gp,x(e.customer_id?"\u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0639\u0645\u064A\u0644":"\u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F"),1),a("button",{onClick:t[0]||(t[0]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{background:"rgba(255, 255, 255, 0.15)",border:"none","border-radius":"3px",padding:"2px",cursor:"pointer",display:"flex","align-items":"center","justify-content":"center"}},Wp)]),l(" =========================================== "),l(" MODAL BODY "),l(" =========================================== "),a("div",Kp,[l(" Customer Name "),a("div",Yp,[l(" Customer Name "),Qp,ee(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.customer_name=n),placeholder:"\u0623\u062F\u062E\u0644 \u0627\u0644\u0627\u0633\u0645",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.customer_name]])]),l(" Tax ID & Mobile "),a("div",Jp,[a("div",Xp,[l(" Tax ID "),Zp,ee(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>e.tax_id=n),placeholder:"\u0627\u0644\u0631\u0642\u0645 \u0627\u0644\u0636\u0631\u064A\u0628\u064A",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.tax_id]])]),a("div",ef,[l(" Mobile "),tf,ee(a("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>e.mobile_no=n),placeholder:"\u0627\u0644\u062C\u0648\u0627\u0644",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.mobile_no]])])]),l(" Email & Gender "),a("div",of,[a("div",nf,[l(" Email "),sf,ee(a("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=n=>e.email_id=n),placeholder:"\u0627\u0644\u0628\u0631\u064A\u062F \u0627\u0644\u0625\u0644\u0643\u062A\u0631\u0648\u0646\u064A",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.email_id]])]),a("div",rf,[l(" Gender "),af,ee(a("select",{"onUpdate:modelValue":t[5]||(t[5]=n=>e.gender=n),style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px",cursor:"pointer",appearance:"none","background-image":"url('data:image/svg+xml,%3Csvg width=%2212%22 height=%2212%22 viewBox=%220 0 12 12%22%3E%3Cpath fill=%22%23666%22 d=%22M6 9L1 4h10z%22/%3E%3C/svg%3E')","background-repeat":"no-repeat","background-position":"right 6px center","padding-right":"24px"}},[l(" Select "),lf,(g(!0),m(V,null,ae(e.genders,n=>(g(),m("option",{key:n,value:n},x(n),9,cf))),128))],512),[[_t,e.gender]])])]),l(" Referral Code & Date of Birth "),a("div",df,[a("div",pf,[l(" Referral Code "),ff,ee(a("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=n=>e.posa_referral_code=n),placeholder:"\u0627\u0644\u0643\u0648\u062F",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.posa_referral_code]])]),a("div",uf,[l(" Discount "),_f,ee(a("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=n=>e.posa_discount=n),placeholder:"\u0646\u0633\u0628\u0629 \u0627\u0644\u062E\u0635\u0645 \u0627\u0644\u0645\u0633\u0645\u0648\u062D\u0647",min:"0",max:"100",step:"0.01",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px"}},null,512),[[ue,e.posa_discount]])])]),l(" Customer Group & Territory "),a("div",hf,[a("div",gf,[l(" Customer Group "),mf,ee(a("select",{"onUpdate:modelValue":t[8]||(t[8]=n=>e.group=n),required:"",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px",cursor:"pointer",appearance:"none","background-image":"url('data:image/svg+xml,%3Csvg width=%2712%22 height=%2212%22 viewBox=%220 0 12 12%22%3E%3Cpath fill=%22%23666%22 d=%22M6 9L1 4h10z%22/%3E%3C/svg%3E')","background-repeat":"no-repeat","background-position":"right 6px center","padding-right":"24px"}},[l(" Select "),yf,(g(!0),m(V,null,ae(e.groups,n=>(g(),m("option",{key:n,value:n},x(n),9,bf))),128))],512),[[_t,e.group]])]),a("div",vf,[l(" Territory "),xf,ee(a("select",{"onUpdate:modelValue":t[9]||(t[9]=n=>e.territory=n),required:"",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",color:"#1f2937",background:"#fff",outline:"none",height:"28px",cursor:"pointer",appearance:"none","background-image":"url('data:image/svg+xml,%3Csvg width=%2212%22 height=%2212%22 viewBox=%220 0 12 12%22%3E%3Cpath fill=%22%23666%22 d=%22M6 9L1 4h10z%22/%3E%3C/svg%3E')","background-repeat":"no-repeat","background-position":"right 6px center","padding-right":"24px"}},[l(" Select "),wf,(g(!0),m(V,null,ae(e.territorys,n=>(g(),m("option",{key:n,value:n},x(n),9,Ef))),128))],512),[[_t,e.territory]])])]),l(" Loyalty Program & Points (if available) "),e.loyalty_program||e.loyalty_points?(g(),m("div",Of,[e.loyalty_program?(g(),m("div",Tf,[l(" Loyalty Program "),Sf,ee(a("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=n=>e.loyalty_program=n),readonly:"",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",background:"#f9fafb",color:"#6b7280",outline:"none",height:"28px",cursor:"not-allowed"}},null,512),[[ue,e.loyalty_program]])])):l("v-if",!0),e.loyalty_points?(g(),m("div",Cf,[l(" Points "),Nf,ee(a("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=n=>e.loyalty_points=n),readonly:"",style:{width:"100%",padding:"5px 8px",border:"1px solid #d1d5db","border-radius":"4px","font-size":"12px",background:"#f9fafb",color:"#6b7280",outline:"none",height:"28px",cursor:"not-allowed"}},null,512),[[ue,e.loyalty_points]])])):l("v-if",!0)])):l("v-if",!0)])]),l(" =========================================== "),l(" MODAL FOOTER "),l(" =========================================== "),a("div",kf,[l(" Cancel Button "),a("button",{onClick:t[12]||(t[12]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{display:"inline-flex","align-items":"center",gap:"4px",padding:"4px 10px","border-radius":"4px",border:"1px solid #d1d5db","font-size":"12px","font-weight":"500",cursor:"pointer",transition:"all 0.2s",height:"26px",background:"white",color:"#374151"}},[l(" Cancel "),Df,P(" \u0625\u0644\u063A\u0627\u0621 ")]),l(" Submit Button "),a("button",{onClick:t[13]||(t[13]=(...n)=>e.submit_dialog&&e.submit_dialog(...n)),style:{display:"inline-flex","align-items":"center",gap:"4px",padding:"4px 10px","border-radius":"4px",border:"1px solid #1565c0","font-size":"12px","font-weight":"500",cursor:"pointer",transition:"all 0.2s",height:"26px",background:"linear-gradient(135deg, #1976d2 0%, #1e88e5 100%)",color:"white"}},[l(" Update / Register "),If,P(" "+x(e.customer_id?"\u062A\u062D\u062F\u064A\u062B":"\u062A\u0633\u062C\u064A\u0644"),1)])])])])):l("v-if",!0)])],2112)}ki.render=oa;ki.__file="../posawesome/posawesome/public/js/posapp/components/pos/UpdateCustomer.vue";var ia=ki;var Pe={UPDATE_CUSTOMER:"update_customer",SHOW_MESSAGE:"show_mesage",OPEN_UPDATE_CUSTOMER:"open_update_customer",TOGGLE_QUICK_RETURN:"toggle_quick_return",REGISTER_POS_PROFILE:"register_pos_profile",PAYMENTS_REGISTER_POS_PROFILE:"payments_register_pos_profile",SET_CUSTOMER:"set_customer",ADD_CUSTOMER_TO_LIST:"add_customer_to_list",UPDATE_CUSTOMER_IN_LIST:"update_customer_in_list",SET_CUSTOMER_READONLY:"set_customer_readonly",SET_CUSTOMER_INFO_TO_EDIT:"set_customer_info_to_edit",FETCH_CUSTOMER_DETAILS:"fetch_customer_details",CUSTOMER_DROPDOWN_OPENED:"customer_dropdown_opened"},uo={UNEXPECTED_ERROR:"\u062D\u062F\u062B \u062E\u0637\u0623 \u063A\u064A\u0631 \u0645\u062A\u0648\u0642\u0639 \u0623\u062B\u0646\u0627\u0621 \u062C\u0644\u0628 \u0627\u0644\u0639\u0645\u0644\u0627\u0621",POS_PROFILE_NOT_LOADED:"\u0645\u0644\u0641 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 \u063A\u064A\u0631 \u0645\u062D\u0645\u0651\u0644",DEFAULT_CUSTOMER_NOT_DEFINED:"\u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0627\u0641\u062A\u0631\u0627\u0636\u064A \u063A\u064A\u0631 \u0645\u062D\u062F\u062F \u0641\u064A \u0645\u0644\u0641 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639",FAILED_TO_FETCH:"\u0641\u0634\u0644 \u062C\u0644\u0628 \u0627\u0644\u0639\u0645\u0644\u0627\u0621",NEW_CUSTOMER_ERROR:"\u062E\u0637\u0623 \u0641\u064A \u0641\u062A\u062D \u0646\u0645\u0648\u0630\u062C \u0639\u0645\u064A\u0644 \u062C\u062F\u064A\u062F",EDIT_CUSTOMER_ERROR:"\u062E\u0637\u0623 \u0641\u064A \u0641\u062A\u062D \u0646\u0645\u0648\u0630\u062C \u062A\u0639\u062F\u064A\u0644 \u0627\u0644\u0639\u0645\u064A\u0644",INITIALIZATION_ERROR:"\u062D\u062F\u062B \u062E\u0637\u0623 \u0623\u062B\u0646\u0627\u0621 \u062A\u0647\u064A\u0626\u0629 \u0627\u0644\u0645\u0643\u0648\u0646"},Di={name:"Customer",components:{UpdateCustomer:ia},data(){return{pos_profile:null,customers:[],customer:"",readonly:!1,customer_info:{},quick_return:!1,searchTimeout:null,loading:!1,customer_search:"",showDropdown:!1,selectedIndex:-1,filteredCustomers:[],defaultLoaded:!1}},methods:{get_many_customers(){var e,t,o;try{if(this.customers.length>0)return;this.load_all_customers("");let i=((e=this.pos_profile)==null?void 0:e.customer)||((o=(t=this.pos_profile)==null?void 0:t.pos_profile)==null?void 0:o.customer);i&&(this.customer=i,d.emit(Pe.UPDATE_CUSTOMER,this.customer))}catch(i){console.log("[Customer.js] get_many_customers error:",i),this.showMessage(uo.UNEXPECTED_ERROR,"error")}},handleCustomerFocus(){this.load_all_customers(""),this.showDropdown=!0},load_all_customers(e=""){if(!this.pos_profile){this.showMessage(uo.POS_PROFILE_NOT_LOADED,"error");return}let o={pos_profile:this.pos_profile.pos_profile||this.pos_profile,limit:100};e.trim()&&(o.search_term=e.trim()),this.loading=!0,frappe.call({method:X.CUSTOMER.GET_MANY_CUSTOMERS,args:o,callback:i=>{if(i.message&&(this.customers=i.message,this.filteredCustomers=i.message,!this.defaultLoaded&&this.customer)){let s=this.customers.find(r=>r.name===this.customer);s?(this.customer_search=s.customer_name,this.customer_info=s,this.defaultLoaded=!0):(console.log("[Customer.js] Default customer not found in list:",this.customer),this.customer&&!this.customer_info.name&&this.fetch_customer_details_for_default(this.customer))}this.loading=!1},error:i=>{console.log("[Customer.js] load_all_customers error:",i),this.showMessage(uo.FAILED_TO_FETCH,"error"),this.loading=!1}})},performSearch(e){var o;let t=((o=e==null?void 0:e.target)==null?void 0:o.value)||"";this.customer_search=t,this.showDropdown=!0,this.selectedIndex=-1,this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.load_all_customers(t)},300)},selectCustomer(e){this.customer=e.name,this.customer_search=e.customer_name,this.customer_info=e,this.showDropdown=!1,this.selectedIndex=-1,d.emit(Pe.UPDATE_CUSTOMER,e.name)},handleEnter(){!this.showDropdown||(this.filteredCustomers.length>0&&this.selectedIndex>=0?this.selectCustomer(this.filteredCustomers[this.selectedIndex]):this.filteredCustomers.length>0&&this.selectCustomer(this.filteredCustomers[0]))},navigateDown(){this.selectedIndex<this.filteredCustomers.length-1&&this.selectedIndex++},navigateUp(){this.selectedIndex>0&&this.selectedIndex--},new_customer(){try{d.emit(Pe.OPEN_UPDATE_CUSTOMER,null)}catch(e){console.log("[Customer.js] new_customer error:",e),this.showMessage(uo.NEW_CUSTOMER_ERROR,"error")}},edit_customer(){try{d.emit(Pe.OPEN_UPDATE_CUSTOMER,this.customer_info)}catch(e){console.log("[Customer.js] edit_customer error:",e),this.showMessage(uo.EDIT_CUSTOMER_ERROR,"error")}},showMessage(e,t){d.emit(Pe.SHOW_MESSAGE,{message:e,color:t})},handleClickOutside(e){try{let t=typeof e.composedPath=="function"&&e.composedPath()||e.path||[],o=this.$el instanceof HTMLElement?this.$el:this.$el&&this.$el.$el instanceof HTMLElement?this.$el.$el:null,i=o?o.querySelector(".autocomplete"):document.querySelector(".autocomplete");if(!i)return;if(t&&t.length){for(let s=0;s<t.length;s++)if(t[s]===i||t[s]instanceof Node&&i.contains(t[s]))return;this.showDropdown=!1;return}i.contains(e.target)||(this.showDropdown=!1)}catch(t){console.log("[Customer.js] handleClickOutside error:",t),this.showDropdown=!1}},registerEventListeners(){try{d.on(Pe.TOGGLE_QUICK_RETURN,this.handleToggleQuickReturn),d.on(Pe.REGISTER_POS_PROFILE,this.handleRegisterPosProfile),d.on(Pe.PAYMENTS_REGISTER_POS_PROFILE,this.handlePaymentsRegisterPosProfile),d.on(Pe.SET_CUSTOMER,this.handleSetCustomer),d.on(Pe.ADD_CUSTOMER_TO_LIST,this.handleAddCustomerToList),d.on(Pe.UPDATE_CUSTOMER_IN_LIST,this.handleUpdateCustomerInList),d.on(Pe.SET_CUSTOMER_READONLY,this.handleSetCustomerReadonly),d.on(Pe.SET_CUSTOMER_INFO_TO_EDIT,this.handleSetCustomerInfoToEdit),d.on(Pe.FETCH_CUSTOMER_DETAILS,this.handleFetchCustomerDetails),d.on(Pe.CUSTOMER_DROPDOWN_OPENED,this.handleCustomerDropdownOpened)}catch(e){console.log("[Customer.js] registerEventListeners error:",e),this.showMessage(uo.INITIALIZATION_ERROR,"error")}},handleToggleQuickReturn(e){this.quick_return=e},handleRegisterPosProfile(e){var o;this.pos_profile=e;let t=(o=e==null?void 0:e.pos_profile)==null?void 0:o.customer;t&&(this.customer=t,this.fetch_customer_details_for_default(t),d.emit(Pe.UPDATE_CUSTOMER,this.customer)),this.get_many_customers()},handlePaymentsRegisterPosProfile(e){this.pos_profile=e,this.get_many_customers()},handleSetCustomer(e){this.customer=e},handleAddCustomerToList(e){this.customers.push(e)},handleUpdateCustomerInList(e){let t=this.customers.findIndex(o=>o.name===e.name);t!==-1&&(this.customers[t]=ve(ve({},this.customers[t]),e))},handleSetCustomerReadonly(e){this.readonly=e},handleSetCustomerInfoToEdit(e){this.customer_info=e},handleFetchCustomerDetails(){this.get_many_customers()},handleCustomerDropdownOpened(){this.load_all_customers("")},fetch_customer_details_for_default(e){!e||frappe.call({method:X.CUSTOMER.GET_CUSTOMER,args:{customer_id:e},callback:t=>{t.message&&(this.customer_info=t.message,this.customer_search=t.message.customer_name||e,this.defaultLoaded=!0,this.customers.find(o=>o.name===e)||(this.customers.unshift(t.message),this.filteredCustomers=this.customers))},error:t=>{console.log("[Customer.js] fetch_customer_details_for_default error:",t)}})}},mounted(){this._boundHandleClickOutside=e=>this.handleClickOutside(e),document.addEventListener("click",this._boundHandleClickOutside,!0)},beforeUnmount(){this._boundHandleClickOutside&&(document.removeEventListener("click",this._boundHandleClickOutside,!0),this._boundHandleClickOutside=null)},created(){this.$nextTick(()=>{this.registerEventListeners()})},watch:{customer(e){let t=this.customers.find(o=>o.name===e);t&&(this.customer_search=t.customer_name),d.emit(Pe.UPDATE_CUSTOMER,e)}}};Di.methods=Ce(ve({},Di.methods),{avatarColor(e){let t=(e||"").toString(),o=0;for(let s=0;s<t.length;s++)o=(o<<5)-o+t.charCodeAt(s),o|=0;return`hsl(${Math.abs(o)%360} 65% 78%)`},avatarHue(e){let t=(e||"").toString(),o=0;for(let i=0;i<t.length;i++)o=(o<<5)-o+t.charCodeAt(i),o|=0;return Math.abs(o)%360},avatarTextColor(){return"#0f172a"}});var Ii=Di;var Pf={style:{"font-family":"system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial"}},Af={style:{position:"relative",display:"flex","align-items":"center",padding:"6px 0"}},Rf=["placeholder","disabled"],Mf={"aria-hidden":"true",style:{position:"absolute",right:"8px",display:"flex",gap:"8px","align-items":"center",height:"100%"}},Vf=["disabled"],Lf=a("i",{class:"mdi mdi-account-edit"},null,-1),Uf=[Lf],Ff=["disabled"],zf=a("i",{class:"mdi mdi-plus"},null,-1),jf=[zf],$f={key:0,role:"listbox",style:{position:"absolute",top:"calc(100% + 9px)",left:"0",right:"0",background:"#fff",border:"1px solid rgba(60, 60, 67, 0.08)","border-radius":"12px","box-shadow":"0 16px 40px rgba(12, 24, 40, 0.08)","z-index":"1200","max-height":"300px","overflow-y":"auto",padding:"8px"}},Bf=["aria-selected","onClick","onMouseenter","data-index","data-selected","data-even"],Hf={"aria-hidden":"true"},Gf=["aria-label"],qf=["id"],Wf=["stop-color"],Kf=["stop-color"],Yf=["fill"],Qf=a("g",{fill:"rgba(255,255,255,0.92)",transform:"translate(0,0)"},[a("circle",{cx:"20",cy:"13",r:"6"}),a("ellipse",{cx:"20",cy:"28",rx:"11",ry:"5.2"})],-1),Jf={style:{display:"flex","flex-direction":"column","min-width":"0"}},Xf={style:{"font-weight":"bold",color:"#0f172a","font-size":"14px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Zf={key:0,style:{"font-size":"12px",color:"#6b7280","margin-top":"4px","line-height":"1"}},eu={key:1,style:{"font-size":"12px",color:"#9ca3af","margin-top":"4px","line-height":"1"}},tu={key:1,role:"status","aria-live":"polite",style:{position:"absolute",top:"calc(100% + 8px)",left:"0",right:"0",background:"#fff",border:"1px solid rgba(60, 60, 67, 0.08)","border-radius":"12px",padding:"12px","box-shadow":"0 12px 32px rgba(12, 24, 40, 0.06)","z-index":"1200"}},ou=a("div",{style:{width:"100%",height:"6px",background:"#eef2f7","border-radius":"6px",overflow:"hidden"}},[a("div",{style:{height:"100%",background:`linear-gradient(
								90deg,
								rgba(25, 118, 210, 1),
								rgba(33, 150, 243, 1)
							)`,"border-radius":"6px"}})],-1),iu=[ou];function na(e,t,o,i,s,r){let n=Ie("UpdateCustomer");return g(),m(V,null,[l(" =========================================== "),l(" CUSTOMER COMPONENT "),l(" =========================================== "),a("div",Pf,[l(" =========================================== "),l(" AUT G\xFCMplete Container "),l(" =========================================== "),a("div",{style:k([{backgroundColor:e.quick_return?"#fff1f0":"white"},{position:"relative",width:"100%","--input-height":"51px"}])},[l(" =========================================== "),l(" Input Wrapper "),l(" =========================================== "),a("div",Af,[l(" Customer Search Input "),ee(a("input",{type:"text",placeholder:"\u0627\u0628\u062D\u062B \u0639\u0646 \u0639\u0645\u064A\u0644...","onUpdate:modelValue":t[0]||(t[0]=c=>e.customer_search=c),disabled:e.readonly,onFocus:t[1]||(t[1]=(...c)=>e.handleCustomerFocus&&e.handleCustomerFocus(...c)),onInput:t[2]||(t[2]=(...c)=>e.performSearch&&e.performSearch(...c)),onKeydown:[t[3]||(t[3]=Fe((...c)=>e.handleEnter&&e.handleEnter(...c),["enter"])),t[4]||(t[4]=Fe((...c)=>e.navigateDown&&e.navigateDown(...c),["down"])),t[5]||(t[5]=Fe((...c)=>e.navigateUp&&e.navigateUp(...c),["up"])),t[6]||(t[6]=Fe(c=>e.showDropdown=!1,["esc"]))],"aria-autocomplete":"list","aria-expanded":"showDropdown",role:"combobox",style:k([{width:"100%",padding:"13px 46px 13px 12px",height:"var(--input-height)",border:"1px solid rgba(60, 60, 67, 0.1)","border-radius":"10px","font-size":"14px",background:"#fff","box-sizing":"border-box",outline:"none"},e.readonly?"background: #f6f7f8; color: #8e8e93; cursor: not-allowed":""])},null,44,Rf),[[ue,e.customer_search]]),l(" Action Buttons (Edit & New) "),a("div",Mf,[l(" Edit Customer Button "),a("button",{onClick:t[7]||(t[7]=(...c)=>e.edit_customer&&e.edit_customer(...c)),disabled:e.readonly,title:"Edit Customer",type:"button",onMouseenter:t[8]||(t[8]=c=>{e.readonly||(c.currentTarget.style.background="rgba(25, 118, 210, 0.1)",c.currentTarget.style.border="1px solid rgba(25, 118, 210, 0.3)",c.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")}),onMouseleave:t[9]||(t[9]=c=>{e.readonly||(c.currentTarget.style.background="transparent",c.currentTarget.style.border="none",c.currentTarget.style.boxShadow="")}),style:k([{background:"transparent",border:"none",padding:"6px",cursor:"pointer",color:"#6b7280","border-radius":"8px",display:"inline-flex","align-items":"center","justify-content":"center",height:"32px",width:"32px","font-size":"25px"},e.readonly?"color: #c1c1c6; cursor: not-allowed":""])},Uf,44,Vf),l(" New Customer Button "),a("button",{onClick:t[10]||(t[10]=(...c)=>e.new_customer&&e.new_customer(...c)),disabled:e.readonly,title:"New Customer",type:"button",onMouseenter:t[11]||(t[11]=c=>{e.readonly||(c.currentTarget.style.background="rgba(25, 118, 210, 0.1)",c.currentTarget.style.border="1px solid rgba(25, 118, 210, 0.3)",c.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")}),onMouseleave:t[12]||(t[12]=c=>{e.readonly||(c.currentTarget.style.background="transparent",c.currentTarget.style.border="none",c.currentTarget.style.boxShadow="")}),style:k([{background:"transparent",border:"none",padding:"6px",cursor:"pointer",color:"#6b7280","border-radius":"8px",display:"inline-flex","align-items":"center","justify-content":"center",height:"32px",width:"32px","font-size":"25px"},e.readonly?"color: #c1c1c6; cursor: not-allowed":""])},jf,44,Ff)])]),l(" =========================================== "),l(" Customer Dropdown "),l(" =========================================== "),e.showDropdown&&e.filteredCustomers.length>0?(g(),m("div",$f,[(g(!0),m(V,null,ae(e.filteredCustomers,(c,p)=>(g(),m("div",{key:c.name,role:"option","aria-selected":p===e.selectedIndex,onClick:f=>e.selectCustomer(c),onMouseenter:f=>e.selectedIndex=p,class:"customer-item","data-index":p,"data-selected":p===e.selectedIndex,style:{display:"flex",gap:"12px","align-items":"center",padding:"10px",cursor:"pointer","border-radius":"8px","background-color":"var(--row-bg, rgba(255, 255, 255, 1))"},"data-even":p%2===0},[l(" Avatar Placeholder "),a("div",Hf,[l(" lightweight SVG faceless avatar with subtle gradient background (fast) "),(g(),m("svg",{width:40,height:40,viewBox:"0 0 40 40",style:{"flex-shrink":"0",display:"block","border-radius":"8px",overflow:"visible"},role:"img","aria-label":(c.customer_name||"?").charAt(0).toUpperCase()+" avatar"},[a("defs",null,[a("linearGradient",{id:`g${e.avatarHue(c.customer_name)}`,x1:"0",x2:"1",y1:"0",y2:"1"},[a("stop",{offset:"0","stop-color":`hsl(${e.avatarHue(c.customer_name)} 72% 86%)`},null,8,Wf),a("stop",{offset:"1","stop-color":`hsl(${e.avatarHue(c.customer_name)} 66% 74%)`},null,8,Kf)],8,qf)]),l(" gradient background "),a("rect",{x:"0",y:"0",width:"40",height:"40",fill:`url(#g${e.avatarHue(c.customer_name)})`,rx:"8",ry:"8"},null,8,Yf),l(" simple faceless silhouette (circle head + ellipse shoulders) "),Qf],8,Gf))]),l(" Customer Info "),a("div",Jf,[l(" Customer Name "),a("div",Xf,x(c.customer_name),1),l(" Mobile Number "),c.mobile_no?(g(),m("div",Zf,x(c.mobile_no),1)):(g(),m("div",eu," No number "))])],40,Bf))),128))])):l("v-if",!0),l(" =========================================== "),l(" Loading Indicator "),l(" =========================================== "),e.showDropdown&&e.loading?(g(),m("div",tu,iu)):l("v-if",!0)],4),l(" =========================================== "),l(" UpdateCustomer Wrapper "),l(" =========================================== "),de(n)])],2112)}Ii.render=na;Ii.__file="../posawesome/posawesome/public/js/posapp/components/pos/Customer.vue";var sa=Ii;var ra={SEARCH_MIN_LENGTH:3,MAX_DISPLAYED_ITEMS:50,MIN_PANEL_HEIGHT:180,BOTTOM_PADDING:16,DEBOUNCE_DELAY:200},Pi={name:"Invoice",mixins:[Re],components:{Customer:sa},props:{is_payment:{type:Boolean,default:!1},offerApplied:{type:Object,default:null},offerRemoved:{type:[Boolean,Object],default:!1}},data(){return{itemsScrollHeight:null,pos_profile:null,pos_opening_shift:null,invoice_doc:null,return_doc:null,customer:"",customer_info:{},additional_discount_percentage:0,offer_discount_percentage:0,total_tax:0,items:[],posa_offers:[],discount_percentage_offer_name:null,float_precision:3,currency_precision:2,invoice_posting_date:!1,posting_date:frappe.datetime.nowdate(),quick_return_value:!1,posa_use_customer_credit_switch:!1,isUpdatingTotals:!1,isPrinting:!1,_itemOperationTimer:null,_updatingFromAPI:!1,_sessionOffers:[],_lastCustomer:null,apply_discount_on:null,discount_amount:0,base_discount_amount:0,active_discount_type:null,is_cash_or_non_trade_discount:0,additional_discount_account:"",items_headers:[{title:"\u0627\u0633\u0645 \u0627\u0644\u0635\u0646\u0641",align:"start",sortable:!0,key:"item_name",width:"35%"},{title:"\u0643\u0648\u062F \u0627\u0644\u0635\u0646\u0641",align:"center",sortable:!0,key:"item_code",width:"12%"},{title:"\u0627\u0644\u0643\u0645\u064A\u0629",key:"qty",align:"center",width:"15%"},{title:"\u0627\u0644\u0648\u062D\u062F\u0629",key:"uom",align:"center",width:"3%"},{title:"\u0633\u0639\u0631 \u0627\u0644\u0642\u0627\u0626\u0645\u0629",key:"price_list_rate",align:"center",width:"5%"},{title:"\u0627\u0644\u0633\u0639\u0631",key:"rate",align:"center",width:"6%"},{title:"\u0646\u0633\u0628\u0629 \u0627\u0644\u062E\u0635\u0645 %",key:"discount_percentage",align:"center",width:"8%"},{title:"\u0642\u064A\u0645\u0629 \u0627\u0644\u062E\u0635\u0645",key:"discount_amount",align:"center",width:"18%"},{title:"\u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A",key:"amount",align:"center",width:"5%"},{title:"",key:"actions",align:"end",sortable:!1,width:"5%"}]}},computed:{hasExcessNonCashPayment(){var i,s,r;if(!((i=this.invoice_doc)!=null&&i.payments)||!this.pos_profile)return!1;let e=this.flt(this.invoice_doc.grand_total||0),t=((s=this.pos_profile)==null?void 0:s.posa_cash_mode_of_payment)||"Cash";if(((r=this.invoice_doc)==null?void 0:r.is_return)||this.quick_return_value){let n=this.invoice_doc.payments.reduce((b,y)=>b+Math.abs(this.flt(y.amount||0)),0),c=Math.abs(this.flt(this.invoice_doc.loyalty_amount||0)),p=Math.abs(this.flt(this.redeemed_customer_credit||0)),f=n+c+p,_=Math.abs(e);if(f>_)return!0}else for(let n of this.invoice_doc.payments)if(n.mode_of_payment!==t&&this.flt(n.amount||0)>e)return!0;return!1},hasPartialPaymentNotAllowed(){var i,s,r,n,c;if(!((i=this.invoice_doc)!=null&&i.payments)||!this.pos_profile||((s=this.invoice_doc)==null?void 0:s.is_return)||this.quick_return_value||this.pos_profile.posa_allow_partial_payment===1)return!1;let t=this.flt(((r=this.invoice_doc)==null?void 0:r.loyalty_amount)||0,2);((n=this.invoice_doc)==null?void 0:n.payments)&&Array.isArray(this.invoice_doc.payments)&&this.invoice_doc.payments.forEach(p=>{t+=this.flt(p.amount||0,2)}),t+=this.flt(this.redeemed_customer_credit||0,2),t=this.flt(t,2);let o=this.flt(((c=this.invoice_doc)==null?void 0:c.grand_total)||0,2);return t<=.01?!this.pos_profile.posa_allow_credit_sale:t<o-.01},itemsScrollStyle(){return this.itemsScrollHeight?{maxHeight:`${this.itemsScrollHeight-80}px`}:{}},dynamicHeaders(){var t,o,i;let e=[...this.items_headers];return(t=this.pos_profile)!=null&&t.posa_display_discount_percentage||(e=e.filter(s=>s.key!=="discount_percentage")),(o=this.pos_profile)!=null&&o.posa_display_discount_amount||(e=e.filter(s=>s.key!=="discount_amount")),(i=this.pos_profile)!=null&&i.posa_allow_user_to_edit_item_discount||(e=e.filter(s=>s.key!=="rate")),e},readonly(){var e;return((e=this.invoice_doc)==null?void 0:e.is_return)||!1},defaultPaymentMode(){var s,r,n,c;let e=this.invoice_doc&&Array.isArray((s=this.invoice_doc)==null?void 0:s.payments)?(r=this.invoice_doc)==null?void 0:r.payments:[],t=this.pos_profile&&Array.isArray((n=this.pos_profile)==null?void 0:n.payments)?(c=this.pos_profile)==null?void 0:c.payments:[],o=e.length?e:t,i=o.find(p=>p.default==1);return!i&&o.length>0&&(i=o[0]),i?i.mode_of_payment:null},canPrintInvoice(){var t,o,i,s,r,n,c;return(t=this.items)!=null&&t.length?((o=this.invoice_doc)==null?void 0:o.is_return)&&this.posa_use_customer_credit_switch||((i=this.invoice_doc)==null?void 0:i.is_return)&&((s=this.invoice_doc)==null?void 0:s._original_invoice_payment_info)&&Math.abs(this.flt(this.invoice_doc._original_invoice_payment_info.paid_amount||0))<=.01?!0:this.readonly&&!((r=this.invoice_doc)!=null&&r.is_return)?!1:((n=this.invoice_doc)==null?void 0:n.is_credit_sale)===!0||((c=this.invoice_doc)==null?void 0:c.is_credit_sale)==1?!0:this.hasValidPayments():!1},hasItems(){return this.items&&this.items.length>0},hasChosenPayment(){return this.hasValidPayments()||!!this.defaultPaymentMode},computedTaxAmount(){var e;return flt(((e=this.invoice_doc)==null?void 0:e.total_taxes_and_charges)||0)},computedNetTotal(){var e;return flt(((e=this.invoice_doc)==null?void 0:e.net_total)||0)},computedGrandTotalWithTax(){var e;return flt(((e=this.invoice_doc)==null?void 0:e.grand_total)||0)},computedDiscountAmount(){var o;let e=flt(((o=this.invoice_doc)==null?void 0:o.total)||0),t=flt(this.additional_discount_percentage||0);return flt(e*t/100,this.currency_precision)}},methods:{scheduleScrollHeightUpdate(){this.$nextTick(()=>{requestAnimationFrame(()=>{this.updateScrollableHeight()})})},updateScrollableHeight(){var i;let e=this.$refs.itemsScrollArea,t=e?e.$el||e:null;if(!t||typeof t.getBoundingClientRect!="function")return;let o=window.innerHeight||((i=document.documentElement)==null?void 0:i.clientHeight)||0;!o||requestAnimationFrame(()=>{let s=t.getBoundingClientRect(),r=o-s.top-ra.BOTTOM_PADDING;Number.isFinite(r)&&(this.itemsScrollHeight=Math.max(ra.MIN_PANEL_HEIGHT,Math.floor(r)))})},handleQtyBlur(e,t){this.onQtyChange(e,t)},handleRateBlur(e,t){this.setItemRate(e,t)},handleDiscountBlur(e,t){this.setDiscountPercentage(e,t)},calculateTax(e,t,o){if(!o||o===0)return 0;let i=0;return t==="Inclusive"?i=e-e/(1+o/100):t==="Exclusive"&&(i=e*(o/100)),flt(i,this.currency_precision)},getPrecision(e,t=null){return typeof precision=="function"?precision(e,t):["qty","stock_qty","actual_qty","conversion_factor"].includes(e)?this.float_precision||3:this.currency_precision||2},onQtyChange(e,t){var s,r,n;let o=((s=t==null?void 0:t.target)==null?void 0:s.value)!==void 0?Number(t.target.value):Number(e.qty),i=Math.abs(o)||0;e.max_qty&&i>e.max_qty?(d.emit("show_mesage",{text:`\u0644\u0627 \u064A\u0645\u0643\u0646 \u0623\u0646 \u062A\u062A\u062C\u0627\u0648\u0632 \u0627\u0644\u0643\u0645\u064A\u0629 \u0643\u0645\u064A\u0629 \u0627\u0644\u0625\u0631\u062C\u0627\u0639 \u0627\u0644\u0623\u0635\u0644\u064A\u0629: ${e.max_qty}`,color:"warning"}),e.qty=(r=this.invoice_doc)!=null&&r.is_return?-e.max_qty:e.max_qty):e.qty=(n=this.invoice_doc)!=null&&n.is_return?-i:i,e.amount=this.calculateItemAmount(e),this.updateInvoiceDocLocally()},onQtyInput(e,t){this.onQtyChange(e,t)},increaseQuantity(e){var o;let t=Math.abs(Number(e.qty)||0);if(e.max_qty&&t>=e.max_qty){d.emit("show_mesage",{text:`\u0644\u0627 \u064A\u0645\u0643\u0646 \u0632\u064A\u0627\u062F\u0629 \u0627\u0644\u0643\u0645\u064A\u0629 \u0639\u0646 \u0643\u0645\u064A\u0629 \u0627\u0644\u0625\u0631\u062C\u0627\u0639 \u0627\u0644\u0623\u0635\u0644\u064A\u0629: ${e.max_qty}`,color:"warning"});return}(o=this.invoice_doc)!=null&&o.is_return?e.qty=-(t+1):e.qty=t+1,e.amount=this.calculateItemAmount(e),d.emit("item_updated",e),this.updateInvoiceDocLocally()},decreaseQuantity(e){var i;let t=Math.abs(Number(e.qty)||0),o=Math.max(0,t-1);o===0?this.remove_item(e):((i=this.invoice_doc)!=null&&i.is_return?e.qty=-o:e.qty=o,e.amount=this.calculateItemAmount(e),d.emit("item_updated",e),this.updateInvoiceDocLocally())},getDiscountAmount(e){if(!e)return 0;if(e.discount_amount)return flt(e.discount_amount)||0;let t=flt(e.price_list_rate)||flt(e.rate)||0,o=flt(e.discount_percentage)||0;return o>0&&t>0&&flt(t*o/100)||0},quick_return(){d.emit("set_customer_readonly",!0),this.invoiceType="Return",this.invoiceTypes=["Return"],d.emit("update_invoice_type",this.invoiceType),this.quick_return_value=!0,d.emit("toggle_quick_return",this.quick_return_value),this.invoice_doc?(this.invoice_doc.is_return=1,d.emit("update_invoice_doc",this.invoice_doc)):(this.invoice_doc={is_return:1,__islocal:1},d.emit("update_invoice_doc",this.invoice_doc))},remove_item(e){let t=this.items.findIndex(o=>o.posa_row_id==e.posa_row_id);t>=0&&(this.items.splice(t,1),this.updateInvoiceDocLocally(),this.items.length===0?this.reset_invoice_session():d.emit("item_removed",e))},async add_item(e){var i;if(!(e!=null&&e.item_code))return;let t=Object.assign({},e);t.uom=t.uom||t.stock_uom||"Nos";let o=this.items.find(s=>s.item_code===t.item_code&&s.uom===t.uom);o?(o.qty=flt(o.qty)+flt(t.qty),o.amount=this.calculateItemAmount(o)):(t.posa_row_id=this.generateRowId(),t.posa_offers="[]",t.posa_offer_applied=0,t.posa_is_offer=0,t.posa_is_replace=0,t.is_free_item=0,t.amount=this.calculateItemAmount(t),this.items.push(t)),this.updateInvoiceDocLocally(),this.items.length===1&&!((i=this.invoice_doc)!=null&&i.name)?(this.create_draft_invoice(),this.calculateAndApplyOffers()):d.emit("item_added",o||t)},updateInvoiceDocLocally(){this.invoice_doc||(this.invoice_doc={});let e=this.get_invoice_doc("auto");this.calculateTotalsLocally(e),this.invoice_doc.total=e.total,this.invoice_doc.total_qty=e.total_qty,this.invoice_doc.posa_item_discount_total=e.posa_item_discount_total,this.invoice_doc.discount_amount=e.discount_amount,this.invoice_doc.net_total=e.net_total,this.invoice_doc.total_taxes_and_charges=e.total_taxes_and_charges,this.invoice_doc.grand_total=e.grand_total,this.isUpdatingTotals=!1},generateRowId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)},calculateItemAmount(e){let t=flt(e.qty)||0,o=flt(e.price_list_rate)||0;if(o>0){let i=flt(e.discount_percentage)||0;i>0?(e.discount_amount=flt(o*i/100,this.getPrecision("discount_amount",e)),e.rate=flt(o-e.discount_amount,this.getPrecision("rate",e))):(e.discount_amount=0,e.rate=o)}else e.rate=o,e.discount_amount=0;return flt(e.rate*t,this.getPrecision("amount",e))},calculateDiscountedPrice(e,t){let o=flt(e.price_list_rate)||0;if(o<=0||t<=0)return o;let i=flt(o*t/100,this.getPrecision("discount_amount",e));return flt(o-i,this.getPrecision("rate",e))},resetInvoiceState(){this.invoiceType="Invoice",this.invoiceTypes=["Invoice"],this.posting_date=frappe.datetime.nowdate(),this.items=[],this.posa_offers=[],this.additional_discount_percentage=0,this.offer_discount_percentage=0,d.emit("update_invoice_type",this.invoiceType),d.emit("update_invoice_doc",null),d.emit("reset_manual_offers")},hasValidPayments(e=null){var i;let t=e||this.invoice_doc;return(t==null?void 0:t.is_credit_sale)===!0||(t==null?void 0:t.is_credit_sale)==1||(t==null?void 0:t.is_return)&&this.posa_use_customer_credit_switch===!0||(t==null?void 0:t.is_return)&&(t==null?void 0:t._original_invoice_payment_info)&&Math.abs(this.flt(t._original_invoice_payment_info.paid_amount||0))<=.01?!0:((i=t==null?void 0:t.payments)==null?void 0:i.some(s=>Math.abs(this.flt(s.amount))>0))||!1},async create_draft_invoice(){return this.isUpdatingTotals=!1,null},create_invoice(e){return Promise.resolve(null)},async auto_update_invoice(e=null,t="auto"){return null},queue_auto_save(e="auto"){var o,i;if((o=this.invoice_doc)!=null&&o.submitted_for_payment||this.items.length===0&&!((i=this.invoice_doc)!=null&&i.name))return Promise.resolve();let t=this.get_invoice_doc(e);return this.auto_update_invoice(t,e)},async reload_invoice(){var e,t;if(this.invoice_doc&&((e=this.invoice_doc)==null?void 0:e.name))try{let o=await frappe.call({method:"frappe.client.get",args:{doctype:"Sales Invoice",name:(t=this.invoice_doc)==null?void 0:t.name}});o.message&&(this.invoice_doc=o.message,o.message.items&&(this.items=o.message.items))}catch(o){console.log("[Invoice.js] loadInvoiceDoc error:",o)}},cancel_invoice(){d.emit("invoice_submitted"),this.reset_invoice_session(),d.emit("show_payment","false")},async handleDraftButton(){this.hasItems?await this.save_draft_invoice():await this.load_draft_invoice()},async save_draft_invoice(){if(!this.items||this.items.length===0){d.emit("show_mesage",{text:"\u0644\u0627 \u064A\u0648\u062C\u062F \u0623\u0635\u0646\u0627\u0641 \u0644\u0644\u062D\u0641\u0638",color:"warning"});return}try{let e=this.get_invoice_doc("draft");this.calculateTotalsLocally(e),e.__islocal=1,e.docstatus=0,frappe.call({method:X.SALES_INVOICE.SAVE_DRAFT,args:{invoice_doc:e},callback:t=>{t.message&&(console.log("[Invoice.js] Draft saved:",t.message.name),d.emit("show_mesage",{text:`\u062A\u0645 \u062D\u0641\u0638 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629: ${t.message.name}`,color:"success"}),this.reset_invoice_session())},error:t=>{console.log("[Invoice.js] save_draft_invoice error:",t),d.emit("show_mesage",{text:"\u0641\u0634\u0644 \u062D\u0641\u0638 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",color:"error"})}})}catch(e){console.log("[Invoice.js] save_draft_invoice error:",e),d.emit("show_mesage",{text:"\u0641\u0634\u0644 \u062D\u0641\u0638 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",color:"error"})}},async load_draft_invoice(){var e;try{let t=(e=this.pos_opening_shift)==null?void 0:e.name;console.log("[Invoice.js] Loading draft invoices, pos_opening_shift:",t),frappe.call({method:X.SALES_INVOICE.GET_DRAFTS,args:{pos_opening_shift:t},callback:o=>{var i;console.log("[Invoice.js] Draft invoices response:",((i=o.message)==null?void 0:i.length)||0,"invoices"),o.message&&o.message.length>0?d.emit("open_drafts_dialog",o.message):d.emit("show_mesage",{text:"\u0644\u0627 \u062A\u0648\u062C\u062F \u0641\u0648\u0627\u062A\u064A\u0631 \u0645\u0633\u0648\u062F\u0629",color:"info"})},error:o=>{console.log("[Invoice.js] load_draft_invoice error:",o),d.emit("show_mesage",{text:"\u0641\u0634\u0644 \u062C\u0644\u0628 \u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631 \u0627\u0644\u0645\u0633\u0648\u062F\u0629",color:"error"})}})}catch(t){console.log("[Invoice.js] load_draft_invoice error:",t),d.emit("show_mesage",{text:"\u0641\u0634\u0644 \u062C\u0644\u0628 \u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631 \u0627\u0644\u0645\u0633\u0648\u062F\u0629",color:"error"})}},reset_invoice_session(){var e;this.resetInvoiceState(),this.return_doc=null,this.invoice_doc="",this.quick_return_value=!1,this.invoiceType="Invoice",this.invoiceTypes=["Invoice"],d.emit("set_customer_readonly",!1),d.emit("update_invoice_type",this.invoiceType),d.emit("toggle_quick_return",!1),d.emit("update_invoice_doc",null),this.customer=((e=this.pos_profile)==null?void 0:e.customer)||this.customer,this._lastCustomer=null,this.posa_use_customer_credit_switch=!1,this.calculateAndApplyOffers()},new_invoice(e={}){var t;d.emit("new_invoice",e),d.emit("set_customer_readonly",!1),this.posa_offers=[],this.return_doc="",!e.name&&!e.is_return?(this.items=[],this.customer=(t=this.pos_profile)==null?void 0:t.customer,this.invoice_doc="",this.additional_discount_percentage=0,this.invoiceType="Invoice",this.invoiceTypes=["Invoice"],d.emit("update_invoice_type",this.invoiceType)):(e.is_return&&(d.emit("set_customer_readonly",!0),this.invoiceType="Return",this.invoiceTypes=["Return"],d.emit("update_invoice_type",this.invoiceType)),this.invoice_doc=e,this.items=e.items||[],d.emit("update_invoice_doc",e),this.items.forEach(o=>{o.posa_row_id||(o.posa_row_id=this.makeid(20)),e.is_return&&o.qty&&(o.original_return_qty=Math.abs(o.qty),o.max_qty=Math.abs(o.qty))}),this.posa_offers=(e.posa_offers||[]).map(o=>Ce(ve({},o),{offer_applied:!0})),this.items.forEach(o=>{o.base_rate=o.base_rate||o.price_list_rate,o.posa_row_id||(o.posa_row_id=this.makeid(20)),o.batch_no&&this.set_batch_qty(o,o.batch_no)}),this.setCustomer(e.customer),this.posting_date=e.posting_date||frappe.datetime.nowdate(),this.additional_discount_percentage=e.additional_discount_percentage,this.items.forEach(o=>{o.serial_no&&(o.serial_no_selected=[],o.serial_no.split(`
`).forEach(s=>{s.length&&o.serial_no_selected.push(s)}),o.serial_no_selected_count=o.serial_no_selected.length)}))},get_invoice_doc(e="auto"){var i,s,r,n,c,p,f,_,b,y,A,G,C;let t=e==="payment"||e==="print",o={};return this.invoice_doc&&((i=this.invoice_doc)==null?void 0:i.name)&&!((s=this.invoice_doc)!=null&&s.submitted_for_payment)&&(o.name=(r=this.invoice_doc)==null?void 0:r.name,((n=this.invoice_doc)==null?void 0:n.docstatus)!==void 0&&(o.docstatus=this.invoice_doc.docstatus)),o.doctype="Sales Invoice",o.is_pos=1,o.ignore_pricing_rule=1,o.company=(c=this.pos_profile)==null?void 0:c.company,o.pos_profile=(p=this.pos_profile)==null?void 0:p.name,o.currency=(f=this.pos_profile)==null?void 0:f.currency,o.naming_series=(_=this.pos_profile)==null?void 0:_.naming_series,o.customer=this.customer,o.posting_date=this.posting_date,o.posa_pos_opening_shift=this.pos_opening_shift?this.pos_opening_shift.name:null,o.items=this.get_invoice_items_minimal(),o.additional_discount_percentage=flt(this.additional_discount_percentage),o.apply_discount_on=((b=this.pos_profile)==null?void 0:b.apply_discount_on)||"Net Total",this.discount_amount&&(o.discount_amount=flt(this.discount_amount)),this.is_cash_or_non_trade_discount&&(o.is_cash_or_non_trade_discount=this.is_cash_or_non_trade_discount),this.additional_discount_account&&(o.additional_discount_account=this.additional_discount_account),o.posa_offers=this.posa_offers,t&&(o.payments=this.get_payments()),this.invoice_doc&&(o.is_return=(y=this.invoice_doc)==null?void 0:y.is_return,o.return_against=(A=this.invoice_doc)==null?void 0:A.return_against,((G=this.invoice_doc)==null?void 0:G.is_credit_sale)!==void 0&&(o.is_credit_sale=this.invoice_doc.is_credit_sale===!0||this.invoice_doc.is_credit_sale==1),o.is_credit_sale&&((C=this.invoice_doc)==null?void 0:C.due_date)&&(o.due_date=this.invoice_doc.due_date)),o},get_invoice_items_minimal(){return this.items.map(e=>{var i;let t=e.qty||1;(((i=this.invoice_doc)==null?void 0:i.is_return)||this.quick_return_value)&&(t=-Math.abs(t));let o={item_code:e.item_code,qty:t,rate:flt(e.rate,this.getPrecision("rate",e)),price_list_rate:flt(e.price_list_rate,this.getPrecision("price_list_rate",e)),discount_percentage:flt(e.discount_percentage||0,this.getPrecision("discount_percentage",e)),discount_amount:flt(e.discount_amount||0,this.getPrecision("discount_amount",e)),uom:e.uom||e.stock_uom,serial_no:e.serial_no,batch_no:e.batch_no};return e.sales_invoice_item&&(o.sales_invoice_item=e.sales_invoice_item,o.si_detail=e.si_detail||e.sales_invoice_item),o})},get_payments(){var s,r,n,c,p;let e=[];if(this.invoice_doc&&Array.isArray((s=this.invoice_doc)==null?void 0:s.payments)&&((r=this.invoice_doc)==null?void 0:r.payments.length))e=this.invoice_doc.payments.map(f=>({amount:this.flt(f.amount),mode_of_payment:f.mode_of_payment,default:f.default,account:f.account||"",idx:f.idx}));else if(this.pos_profile&&Array.isArray((n=this.pos_profile)==null?void 0:n.payments)){let f=!1;(c=this.pos_profile)==null||c.payments.forEach((_,b)=>{_.default&&(f=!0),e.push({amount:0,mode_of_payment:_.mode_of_payment,default:_.default,account:_.account||"",idx:b+1})}),!f&&e.length>0&&(e[0].default=1)}let t=(p=this.invoice_doc)==null?void 0:p.grand_total,i=e.reduce((f,_)=>f+_.amount,0)-t;return Math.abs(i)>=.01&&Math.abs(i)<=1&&e.length>0&&(e[0].amount=this.flt(e[0].amount-i)),e},update_invoice(e){let t=this;return new Promise((o,i)=>{if(!e.name){i(new Error("Invoice name required for updates"));return}frappe.call({method:X.SALES_INVOICE.UPDATE,args:{data:e},async:!0,callback:function(s){if(s.message!==void 0)if(s.message===null)t.invoice_doc=null,t.items=[],o(null);else{if(t.invoice_doc=s.message,s.message.posa_offers){t.posa_offers=s.message.posa_offers.map(p=>Ce(ve({},p),{offer_applied:!0}));let r=0,n=t.posa_offers.find(p=>p.offer_applied);n?(r=flt(n.discount_percentage),t.additional_discount_percentage=r,t.offer_discount_percentage=r):t.offer_discount_percentage>0&&(t.offer_discount_percentage=0),d.emit("update_invoice_doc",t.invoice_doc);let c=t.posa_offers.filter(p=>p.offer_applied);c.length>0&&d.emit("update_pos_offers",c)}o(t.invoice_doc)}else i(new Error("Failed to update invoice"))},error:function(s){s.message&&s.message.includes("Document has been modified")?t.reload_invoice().then(()=>o(t.invoice_doc)).catch(r=>{i(r)}):i(s)}})})},async process_invoice(){let e=this.get_invoice_doc("payment");return this.calculateTotalsLocally(e),this.invoice_doc||(this.invoice_doc={}),this.invoice_doc.total=e.total,this.invoice_doc.total_qty=e.total_qty,this.invoice_doc.posa_item_discount_total=e.posa_item_discount_total,this.invoice_doc.discount_amount=e.discount_amount,this.invoice_doc.net_total=e.net_total,this.invoice_doc.grand_total=e.grand_total,this.invoice_doc.items=e.items,e},async show_payment(){var e,t,o,i;d.emit("show_loading",{text:"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...",color:"info"});try{this.updateInvoiceDocLocally();let s=await this.process_invoice();if(!(s!=null&&s.payments)||(s==null?void 0:s.payments.length)===0)try{let r=await frappe.call({method:X.POS_PROFILE.GET_DEFAULT_PAYMENT,args:{pos_profile:(e=this.pos_profile)==null?void 0:e.name,company:((t=this.pos_profile)==null?void 0:t.company)||frappe.defaults.get_user_default("Company")}});r.message&&(s.payments=[{mode_of_payment:r.message.mode_of_payment,amount:flt(s==null?void 0:s.grand_total),account:r.message.account,default:1}])}catch(r){console.log("[Invoice.js] getDefaultPayment error:",r)}d.emit("send_invoice_doc_payment",s),d.emit("show_payment","true"),this.posa_offers=[],(o=this.pos_profile)!=null&&o.posa_clear_customer_after_payment&&this.setCustomer((i=this.pos_profile)==null?void 0:i.customer),d.emit("invoice_session_reset"),d.emit("hide_loading")}catch(s){console.log("[Invoice.js] prepareInvoice error:",s),d.emit("hide_loading"),d.emit("show_mesage",{text:"\u062E\u0637\u0623 \u0641\u064A \u0625\u0639\u062F\u0627\u062F \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629: "+s.message,color:"error"})}},open_returns(){var e;!((e=this.pos_profile)!=null&&e.posa_allow_return)||d.emit("open_returns",{pos_profile:this.pos_profile,pos_opening_shift:this.pos_opening_shift||null})},close_payments(){d.emit("show_payment","false")},setCustomer(e){this.customer=e,this.close_payments(),d.emit("set_customer",this.customer),this.invoice_doc&&(this.invoice_doc.contact_person="",this.invoice_doc.contact_email="",this.invoice_doc.contact_mobile=""),this.fetch_customer_details()},fetch_customer_details(){let e=this;this.customer&&frappe.call({method:X.CUSTOMER.GET_CUSTOMER,args:{customer_id:e.customer},async:!1,callback:t=>{let o=t.message;t.exc||(e.customer_info=ve({},o),d.emit("set_customer_info_to_edit",e.customer_info)),e.update_price_list(),e.calculateAndApplyOffers()}})},get_price_list(){var t,o;let e=(t=this.pos_profile)==null?void 0:t.selling_price_list;if(this.customer_info&&this.pos_profile){let{customer_price_list:i,customer_group_price_list:s}=this.customer_info,r=(o=this.pos_profile)==null?void 0:o.selling_price_list;i&&i!=r?e=i:s&&s!=r&&(e=s)}return e},setDiscountPercentage(e,t){var r,n;if(!((r=this.pos_profile)!=null&&r.posa_allow_user_to_edit_item_discount)){d.emit("show_mesage",{text:"\u062A\u0639\u062F\u064A\u0644 \u062E\u0635\u0645 \u0627\u0644\u0635\u0646\u0641 \u063A\u064A\u0631 \u0645\u0633\u0645\u0648\u062D \u0641\u064A \u0645\u0644\u0641 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 \u0647\u0630\u0627",color:"warning"});return}let o=parseFloat(t.target.value)||0,i=((n=this.pos_profile)==null?void 0:n.posa_item_max_discount_allowed)||100;o<0&&(o=0),o>i&&(o=i),e.discount_percentage=o;let s=flt(e.price_list_rate)||0;s>0&&(o>0?(e.discount_amount=flt(s*o/100,this.getPrecision("discount_amount",e)),e.rate=flt(s-e.discount_amount,this.getPrecision("rate",e))):(e.discount_amount=0,e.rate=s)),e.amount=this.calculateItemAmount(e),this.updateInvoiceDocLocally()},setItemRate(e,t){var n,c;if(!((n=this.pos_profile)!=null&&n.posa_allow_user_to_edit_item_discount)){d.emit("show_mesage",{text:"\u062A\u0639\u062F\u064A\u0644 \u0633\u0639\u0631 \u0627\u0644\u0635\u0646\u0641 \u063A\u064A\u0631 \u0645\u0633\u0645\u0648\u062D \u0641\u064A \u0645\u0644\u0641 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 \u0647\u0630\u0627",color:"warning"});return}let o=t.target.value.toString().replace(/,/g,""),i=parseFloat(o)||0,s=flt(e.price_list_rate)||0;i<0&&(i=0),i>s&&(i=s,d.emit("show_mesage",{text:"\u0627\u0644\u0633\u0639\u0631 \u064A\u062A\u062C\u0627\u0648\u0632 \u0633\u0639\u0631 \u0627\u0644\u0642\u0627\u0626\u0645\u0629",color:"error"})),s>0?(e.discount_amount=flt(s-i,this.getPrecision("discount_amount",e)),e.discount_percentage=flt(100*e.discount_amount/s,this.getPrecision("discount_percentage",e))):(e.discount_amount=0,e.discount_percentage=0);let r=((c=this.pos_profile)==null?void 0:c.posa_item_max_discount_allowed)||100;e.discount_percentage>r&&(e.discount_percentage=r,e.discount_amount=flt(s*r/100,this.getPrecision("discount_amount",e)),i=flt(s-e.discount_amount,this.getPrecision("rate",e))),e.rate=i,e.amount=this.calculateItemAmount(e),this.updateInvoiceDocLocally()},update_price_list(){var t;let e=this.get_price_list();e==((t=this.pos_profile)==null?void 0:t.selling_price_list)&&(e=null),d.emit("update_customer_price_list",e)},onDiscountInput(e){var o;if(!((o=this.pos_profile)!=null&&o.posa_allow_user_to_edit_additional_discount))return;let t=flt(e.target.value)||0;this.additional_discount_percentage=t,this.update_discount_umount()},onDiscountBlur(){this.update_discount_umount()},update_discount_umount(){var o,i,s;if(!((o=this.pos_profile)!=null&&o.posa_allow_user_to_edit_additional_discount)&&!(this.offer_discount_percentage>0&&this.additional_discount_percentage>0)){this.additional_discount_percentage=((i=this.invoice_doc)==null?void 0:i.additional_discount_percentage)||0;return}let e=flt(this.additional_discount_percentage)||0,t=((s=this.pos_profile)==null?void 0:s.posa_invoice_max_discount_allowed)||100;e<0?this.additional_discount_percentage=0:e>t&&(this.additional_discount_percentage=t),this.offer_discount_percentage>0&&this.additional_discount_percentage!==this.offer_discount_percentage&&(this.offer_discount_percentage=0),this.updateInvoiceDocLocally()},set_serial_no(e){!e.has_serial_no||(e.serial_no="",e.serial_no_selected.forEach(t=>{e.serial_no+=t+`
`}),e.serial_no_selected_count=e.serial_no_selected.length,e.serial_no_selected_count!=e.stock_qty&&(e.qty=e.serial_no_selected_count,this.$forceUpdate()))},set_batch_qty(e,t,o=!0){if(!e.batch_no_data||!Array.isArray(e.batch_no_data))return;let i=this;frappe.call({method:X.ITEM.PROCESS_BATCH_SELECTION,args:{item_code:e.item_code,current_item_row_id:e.posa_row_id,existing_items_data:this.items,batch_no_data:e.batch_no_data,preferred_batch_no:t||null},async:!1,callback:function(s){var r,n;if(s.message&&s.message.success){let c=s.message,p=c.selected_batch;e.batch_no=p.batch_no,e.actual_batch_qty=p.actual_batch_qty,e.batch_no_expiry_date=p.expiry_date,e.batch_no_data=c.batch_data,p.batch_price?(e.batch_price=p.batch_price,e.price_list_rate=p.batch_price,e.rate=p.batch_price):o&&(e.batch_price=null,i.update_item_detail(e)),i.$nextTick()}else e.batch_no=null,e.actual_batch_qty=null,e.batch_no_expiry_date=null,e.batch_price=null,e.batch_no_data=((r=s.message)==null?void 0:r.batch_data)||[],(n=s.message)!=null&&n.message&&d.emit("show_mesage",{text:s.message.message,color:"warning"}),i.$nextTick()},error:function(s){d.emit("show_mesage",{text:"\u062E\u0637\u0623 \u0641\u064A \u0627\u062E\u062A\u064A\u0627\u0631 \u0627\u0644\u0628\u0627\u062A\u0634: "+(s.message||"\u062E\u0637\u0623 \u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641"),color:"error"})}})},shortOpenPayment(e){e.key==="s"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.show_payment())},shortDeleteFirstItem(e){e.key==="d"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.remove_item(this.items[0]))},shortOpenFirstItem(e){e.key==="a"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.expanded=[],this.expanded.push(this.items[0]))},shortSelectDiscount(e){e.key==="z"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.$refs.discount.focus())},makeid(e){return crypto.randomUUID?crypto.randomUUID().substring(0,e):Math.random().toString(36).substring(2,2+e)},checkOfferIsAppley(e,t){let o=!1;if(!e.posa_offers)return!1;try{let i=JSON.parse(e.posa_offers);if(!Array.isArray(i))return!1;for(let s of i){let r=this.posa_offers.find(n=>s==n.row_id);if(r&&r.offer_name==t.name){o=!0;break}}}catch(i){return console.log("[Invoice.js] checkOfferApplied error:",i),!1}return o},mergeItemsFromAPI(e){if(e&&Array.isArray(e)&&e.length>0){let t=new Map;this.items.forEach(o=>{t.set(o.item_code,o)}),this.items=e.map(o=>{let i=t.get(o.item_code);return(i==null?void 0:i.price_list_rate)&&!o.price_list_rate&&(o.price_list_rate=i.price_list_rate),(i==null?void 0:i.base_rate)&&!o.base_rate&&(o.base_rate=i.base_rate),(i==null?void 0:i.posa_row_id)&&!o.posa_row_id&&(o.posa_row_id=i.posa_row_id),o})}},sendInvoiceUpdate(){this.isUpdatingTotals=!1},calculateTotalsLocally(e){var f,_,b;if(!e||!e.items)return;let t=0,o=0,i=0;e.items.forEach(y=>{y.qty=flt(y.qty,this.getPrecision("qty",y));let A=y.qty||0,G=flt(y.price_list_rate)||0,C=flt(y.discount_percentage)||0;C>0&&G>0?(y.discount_amount=flt(G*C/100,this.getPrecision("discount_amount",y)),y.rate=flt(G-y.discount_amount,this.getPrecision("rate",y))):(y.rate=G,y.discount_amount=0),y.amount=flt(y.rate*A,this.getPrecision("amount",y)),t+=y.amount,o+=A,i+=y.discount_amount*Math.abs(A)}),e.total=flt(t,this.getPrecision("total")),e.total_qty=o,e.posa_item_discount_total=flt(i,this.getPrecision("posa_item_discount_total")),e.net_total=flt(e.total,this.getPrecision("net_total"));let s=(f=this.pos_profile)==null?void 0:f.posa_apply_tax,r=(_=this.pos_profile)==null?void 0:_.posa_tax_type,n=flt((b=this.pos_profile)==null?void 0:b.posa_tax_percent)||0,c=r==null?void 0:r.replace(/^Tax\s*/i,"").trim();s&&console.log("[Invoice.js] Tax calculation:",flt(e.net_total)),s&&c&&n>0?(e.net_total=flt(e.net_total,this.getPrecision("net_total")),c==="Inclusive"?(e.grand_total=flt(e.net_total,this.getPrecision("grand_total")),e.net_total=flt(e.net_total/(1+n/100),this.getPrecision("net_total")),e.total_taxes_and_charges=flt(e.grand_total-e.net_total,this.getPrecision("total_taxes_and_charges"))):c==="Exclusive"&&(e.total_taxes_and_charges=flt(e.net_total*(n/100),this.getPrecision("total_taxes_and_charges")),e.total_taxes_and_charges=flt(e.total_taxes_and_charges,this.getPrecision("total_taxes_and_charges")),e.grand_total=flt(e.net_total+e.total_taxes_and_charges,this.getPrecision("grand_total")))):(e.total_taxes_and_charges=0,e.grand_total=flt(e.net_total,this.getPrecision("grand_total"))),this.setDiscountAmount(e),this.applyDiscountAmount(e);let p=e.apply_discount_on||"Net Total";s&&e.discount_amount>0&&p==="Net Total"&&(e.net_total=flt(e.net_total,this.getPrecision("net_total")),c==="Exclusive"?(e.total_taxes_and_charges=flt(e.net_total*(n/100),this.getPrecision("total_taxes_and_charges")),e.total_taxes_and_charges=flt(e.total_taxes_and_charges,this.getPrecision("total_taxes_and_charges")),e.grand_total=flt(e.net_total+e.total_taxes_and_charges,this.getPrecision("grand_total"))):c==="Inclusive"&&(e.grand_total=flt(e.net_total*(1+n/100),this.getPrecision("grand_total")),e.total_taxes_and_charges=flt(e.grand_total-e.net_total,this.getPrecision("total_taxes_and_charges")))),e.grand_total=flt(e.grand_total,this.getPrecision("grand_total")),e.net_total=flt(e.net_total,this.getPrecision("net_total"))},setDiscountAmount(e){if(!e.additional_discount_percentage||e.additional_discount_percentage<=0){e.discount_amount=0,e.base_discount_amount=0;return}let t=e.apply_discount_on||"Net Total",o=0;t==="Grand Total"?o=flt(e.grand_total)||0:t==="Net Total"?o=flt(e.net_total)||0:o=flt(e.total)||0,e.discount_amount=flt(o*e.additional_discount_percentage/100,this.getPrecision("discount_amount")),e.base_discount_amount=flt(e.discount_amount||0,this.getPrecision("base_discount_amount"))},applyDiscountAmount(e){if(!e.discount_amount||e.discount_amount<=0)return;let t=e.apply_discount_on||"Net Total";t==="Grand Total"?e.grand_total=flt(e.grand_total-e.discount_amount,this.getPrecision("grand_total")):t==="Net Total"&&(e.net_total=flt(e.net_total-e.discount_amount,this.getPrecision("net_total")),e.total_taxes_and_charges>0?e.grand_total=flt(e.net_total+e.total_taxes_and_charges,this.getPrecision("grand_total")):e.grand_total=flt(e.net_total,this.getPrecision("grand_total")))},validateDiscountCalculation(e){if(!e||!e.items)return!0;let t=!1,o=!1;if(e.items.forEach(i=>{if(flt(i.discount_percentage)>0){t=!0;let s=flt(i.price_list_rate),r=flt(s*i.discount_percentage/100,this.getPrecision("discount_amount",i)),n=flt(s-r,this.getPrecision("rate",i));Math.abs(i.discount_amount-r)>.01,Math.abs(i.rate-n)>.01}}),flt(e.additional_discount_percentage)>0){o=!0;let i=e.apply_discount_on||"Net Total",s=e[frappe.scrub(i)]||0,r=flt(s*e.additional_discount_percentage/100,this.getPrecision("discount_amount"));Math.abs(e.discount_amount-r)>.01}return!0},handleOffers(){var e;((e=this.invoice_doc)==null?void 0:e.name)&&this.items&&this.items.length>=1&&this._processOffers()},_processOffers(){var i,s,r,n,c,p,f,_;if(!((i=this.invoice_doc)!=null&&i.name)||this.posa_offers&&this.posa_offers.length>0||!(((s=this.pos_profile)==null?void 0:s.posa_auto_fetch_offers)!==0&&((r=this.pos_profile)==null?void 0:r.posa_auto_fetch_offers)!=="0"&&((n=this.pos_profile)==null?void 0:n.posa_auto_fetch_offers)!==!1&&((c=this.pos_profile)==null?void 0:c.posa_auto_fetch_offers)!==null&&((p=this.pos_profile)==null?void 0:p.posa_auto_fetch_offers)!==void 0)||!this.items||this.items.length<1)return;let t=`${(f=this.invoice_doc)==null?void 0:f.name}_${this.items.length}`,o=Date.now();if(this._offersCache&&this._offersCache.key===t&&o-this._offersCache.timestamp<3e4){this.updatePosOffers(this._offersCache.data);return}this._offersProcessing||(this._offersProcessing=!0,frappe.call({method:X.POS_OFFER.GET_APPLICABLE_OFFERS,args:{invoice_name:(_=this.invoice_doc)==null?void 0:_.name},callback:b=>{this._offersProcessing=!1,b.message&&(this._offersCache={key:t,data:b.message,timestamp:o},this.updatePosOffers(b.message))},error:b=>{this._offersProcessing=!1}}))},getItemFromRowID(e){return this.items.find(o=>o.posa_row_id==e)},getItemOffer(e){return null},updatePosOffers(e){d.emit("update_pos_offers",e)},updateInvoiceOffers(e){let t=Array.isArray(e)?e:e?[e]:[];if(t.length===0){(this.additional_discount_percentage>0||this.offer_discount_percentage>0)&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0),this.clearItemOfferDiscounts(),this.posa_offers=[],this.updateInvoiceDocLocally();return}let o=t.filter(i=>i&&(i.offer_name||i.name||i.title)).map(i=>{let s=(i.offer_name||i.name||"").toString().trim(),r=(i.title||"").toString().trim(),n=i.row_id;return s?{offer_name:s,row_id:n,offer_applied:!0}:{title:r,row_id:n,offer_applied:!0}});this.posa_offers=o,this.applyManuallyToggledOffers(o)},applyManuallyToggledOffers(e){if(!e||e.length===0)return;let t=e.filter(i=>["grand_total","customer","customer_group",""].includes(i.offer_type||"")&&i.discount_percentage),o=e.filter(i=>["item_code","item_group","brand"].includes(i.offer_type)&&i.discount_percentage);if(t.length>0){t.sort((s,r)=>flt(r.discount_percentage)-flt(s.discount_percentage));let i=t[0];this.additional_discount_percentage=flt(i.discount_percentage),this.offer_discount_percentage=flt(i.discount_percentage),this.items.forEach(s=>{s._offer_discount_applied&&(s.discount_percentage=0,s.discount_amount=0,s.rate=s.price_list_rate,delete s._offer_discount_applied,delete s._offer_name)})}else o.length>0&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0,o.forEach(i=>{let s=flt(i.discount_percentage),r=i.offer_name||i.name;this.items.forEach(n=>{let c=!1;if((i.offer_type==="item_code"&&n.item_code===i.item_code||i.offer_type==="item_group"&&n.item_group===i.item_group||i.offer_type==="brand"&&n.brand===i.brand)&&(c=!0),c){let p=flt(n.price_list_rate);n.discount_percentage=s,n.discount_amount=flt(p*s/100,this.getPrecision("discount_amount",n)),n.rate=flt(p-n.discount_amount,this.getPrecision("rate",n)),n._offer_discount_applied=!0,n._offer_name=r}})}));this.updateInvoiceDocLocally()},applyItemOffer(e){let t=flt(e.discount_percentage),o=e.offer_type;if(!t||!o)return;let i=e.name||e.offer_name,s=!1;this.items.forEach(r=>{let n=!1;(o==="item_code"&&r.item_code===e.item_code||o==="item_group"&&r.item_group===e.item_group||o==="brand"&&r.brand===e.brand)&&(n=!0),n&&(!r._offer_discount_applied||r._offer_name!==i)&&(r._original_discount_percentage||(r._original_discount_percentage=flt(r.discount_percentage||0)),r._offer_discount_applied=!0,r._offer_name=i,r.discount_percentage=t,r.rate=this.calculateDiscountedPrice(r,t),r.amount=this.calculateItemAmount(r),s||(this.posa_offers||(this.posa_offers=[]),this.posa_offers.some(f=>f.offer_name===i&&f.offer_type===o)||(this.posa_offers.push({offer_name:i,offer_type:o,discount_percentage:t,offer_applied:!0,row_id:r.posa_row_id||r.name||""}),s=!0)))}),this.updateInvoiceDocLocally()},removeApplyOffer(e){let t=this.posa_offers.findIndex(o=>o.row_id===e.row_id);t>-1&&this.posa_offers.splice(t,1)},applyNewOffer(e){let t={offer_name:e.name,row_id:e.row_id,apply_on:e.apply_on,offer:e.offer,items:JSON.stringify(e.items),give_item:e.give_item,give_item_row_id:e.give_item_row_id,offer_applied:e.offer_applied};this.posa_offers.push(t)},calculateAndApplyOffers(){var i;if(!((i=this.pos_profile)!=null&&i.posa_auto_fetch_offers)||!this._sessionOffers||this._sessionOffers.length===0)return;if(!this.items||this.items.length===0){this.clearOfferDiscounts();return}let e=this.items.reduce((s,r)=>s+flt(r.qty||0),0),t=this.items.reduce((s,r)=>s+flt(r.qty||0)*flt(r.rate||0),0),o=this._sessionOffers.filter(s=>{var n;let r=frappe.datetime.nowdate();return s.valid_from&&r<s.valid_from||s.valid_upto&&r>s.valid_upto||s.min_qty&&e<flt(s.min_qty)||s.max_qty&&e>flt(s.max_qty)||s.min_amt&&t<flt(s.min_amt)||s.max_amt&&t>flt(s.max_amt)||s.offer_type==="customer"&&s.customer!==this.customer||s.offer_type==="customer_group"&&(!((n=this.customer_info)!=null&&n.customer_group)||this.customer_info.customer_group!==s.customer_group)?!1:s.offer_type==="item_code"?this.items.some(c=>c.item_code===s.item_code):s.offer_type==="item_group"?this.items.some(c=>c.item_group===s.item_group):s.offer_type==="brand"?this.items.some(c=>c.brand===s.brand):!0});this.applyOffersToInvoice(o)},applyOffersToInvoice(e){if(!e||e.length===0){this.clearOfferDiscounts();return}let t=e.sort((s,r)=>s.auto&&!r.auto?-1:!s.auto&&r.auto?1:flt(r.discount_percentage)-flt(s.discount_percentage)),o=t.find(s=>s.auto&&s.discount_percentage&&["grand_total","customer","customer_group",""].includes(s.offer_type||""));o?(this.additional_discount_percentage=flt(o.discount_percentage),this.offer_discount_percentage=flt(o.discount_percentage),this.posa_offers=[{offer_name:o.name,offer_type:o.offer_type,discount_percentage:o.discount_percentage,offer_applied:!0,row_id:""}]):this.posa_offers=[];let i=new Set;t.forEach(s=>{if(!s.auto||!s.discount_percentage)return;let r=s.offer_name||s.name;this.items.forEach(n=>{let c=!1;if((s.offer_type==="item_code"&&n.item_code===s.item_code||s.offer_type==="item_group"&&n.item_group===s.item_group||s.offer_type==="brand"&&n.brand===s.brand)&&(c=!0),c&&(!n._offer_discount_applied||n._offer_name!==r)){let f=`${r}_${s.offer_type}`;i.has(f)||(i.add(f),this.posa_offers||(this.posa_offers=[]),this.posa_offers.push({offer_name:r,offer_type:s.offer_type,discount_percentage:s.discount_percentage,offer_applied:!0,row_id:n.name||n.idx||""})),n._original_discount_percentage||(n._original_discount_percentage=flt(n.discount_percentage||0)),n._offer_discount_applied=!0,n._offer_name=r,n.discount_percentage=flt(s.discount_percentage),n.rate=this.calculateDiscountedPrice(n,flt(s.discount_percentage)),n.amount=this.calculateItemAmount(n)}})}),this.updateInvoiceDocLocally()},clearOfferDiscounts(){(this.additional_discount_percentage>0||this.offer_discount_percentage>0)&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0),(!this.posa_offers||this.posa_offers.length===0)&&(this.posa_offers=[])},clearItemOfferDiscounts(e=null){let t=!1;return this.items.forEach(o=>{if(o._offer_discount_applied){if(e&&o._offer_name!==e)return;let i=flt(o._original_discount_percentage||0);o.discount_percentage=i;let s=flt(o.price_list_rate)||0;if(s>0){if(i>0){let r=s*i/100;o.rate=flt(s-r)}else o.rate=s;o.amount=this.calculateItemAmount(o)}delete o._offer_discount_applied,delete o._offer_name,delete o._original_discount_percentage,t=!0}}),t&&this.updateInvoiceDocLocally(),t},printInvoice(){if(!this.invoice_doc||this.isPrinting)return;let e=this.get_invoice_doc("print");this.calculateTotalsLocally(e);let t=e.is_credit_sale===!0||e.is_credit_sale==1,o=(e==null?void 0:e.is_return)&&(e==null?void 0:e._original_invoice_payment_info)&&Math.abs(this.flt(e._original_invoice_payment_info.paid_amount||0))<=.01,i=this.posa_use_customer_credit_switch===!0;if(!t&&!o&&!i&&!this.hasValidPayments(e)){d.emit("show_mesage",{text:"\u064A\u062C\u0628 \u0627\u062E\u062A\u064A\u0627\u0631 \u0637\u0631\u064A\u0642\u0629 \u062F\u0641\u0639 \u0623\u0648\u0644\u0627\u064B \u0639\u0646 \u0637\u0631\u064A\u0642 \u0627\u0644\u0636\u063A\u0637 \u0639\u0644\u0649 \u0632\u0631 '\u062F\u0641\u0639'",color:"warning"});return}this.isPrinting=!0,d.emit("show_loading",{text:"\u062C\u0627\u0631\u064A \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629...",color:"info"}),(!e.name||e.docstatus!==0)&&(e.__islocal=1);let s=e.is_return?e.return_against?"Return_Invoice":"Quick_Return":"Sales_Mode",r=e.name?`Updating draft: ${e.name}`:"Creating new invoice";console.log(`[Invoice.js] printInvoice: ${r}, type: ${s}`),frappe.call({method:"posawesome.api.sales_invoice.create_and_submit_invoice",args:{invoice_doc:e},callback:n=>{var c,p;if(d.emit("hide_loading"),this.isPrinting=!1,(c=n.message)!=null&&c.name){let f=(p=this.pos_profile)==null?void 0:p.posa_print_format,_=frappe.urllib.get_full_url(`/printview?doctype=Sales%20Invoice&name=${n.message.name}&format=${f}&trigger_print=1&no_letterhead=0`);window.open(_),d.emit("set_last_invoice",n.message.name),d.emit("invoice_submitted"),this.reset_invoice_session(),d.emit("show_payment","false"),d.emit("invoice_submitted"),d.emit("clear_search_fields")}else d.emit("show_mesage",{text:"\u0641\u0634\u0644 \u0627\u0644\u0625\u0631\u0633\u0627\u0644",color:"error"})},error:n=>{d.emit("hide_loading"),this.isPrinting=!1,d.emit("show_mesage",{text:(n==null?void 0:n.message)||"Failed to submit",color:"error"})}})},update_item_detail(e){if(!(!e||!e.item_code||!this.allItems))try{let t=this.allItems.find(o=>o.item_code===e.item_code);t&&(["price_list_rate","rate","base_rate","currency","actual_qty","item_name","stock_uom","item_group","serial_no_data","batch_no_data","item_uoms"].forEach(i=>{t.hasOwnProperty(i)&&(e[i]=t[i])}),e._detailSynced=!0)}catch(t){console.log("[Invoice.js] Item detail update failed:",t)}}},created(){d.on("payment_amount_changed",()=>{this.$forceUpdate()}),d.on("register_pos_profile",e=>{var t,o;this.pos_profile=e.pos_profile,this.setCustomer((t=e.pos_profile)==null?void 0:t.customer),this.pos_opening_shift=e.pos_opening_shift,this.float_precision=3,this.currency_precision=2,this.invoiceType="Invoice",d.emit("update_invoice_type",this.invoiceType),console.log("[Invoice.js] POS Profile registered:",(o=e.pos_profile)==null?void 0:o.name)}),d.on("add_item",e=>{this.add_item(e)}),d.on("update_customer",e=>{this.setCustomer(e),this._lastCustomer!==e&&(this._lastCustomer=e,this.calculateAndApplyOffers())}),d.on("fetch_customer_details",()=>{this.fetch_customer_details()}),d.on("new_invoice",()=>{this.reset_invoice_session(),d.emit("show_payment","false")}),d.on("load_invoice",e=>{var t;this.new_invoice(e),(t=this.invoice_doc)!=null&&t.is_return&&(this.additional_discount_percentage=-e.additional_discount_percentage,this.return_doc=e)}),d.on("set_offers",e=>{this.posOffers=e,this._sessionOffers=e||[],this.items&&this.items.length>0&&this.calculateAndApplyOffers()}),d.on("update_invoice_offers",e=>{this.updateInvoiceOffers(e)}),d.on("set_all_items",e=>{this.allItems=e,this.items.forEach(t=>{this.update_item_detail(t)})}),d.on("load_return_invoice",e=>{var t;e.original_invoice_payment_info&&(e.invoice_doc._original_invoice_payment_info=e.original_invoice_payment_info),this.new_invoice(e.invoice_doc),((t=e.invoice_doc)==null?void 0:t.is_return)&&e.return_doc&&(this.quick_return_value=!1,d.emit("toggle_quick_return",!1)),e.return_doc?(this.additional_discount_percentage=-e.return_doc.additional_discount_percentage||0,this.return_doc=e.return_doc):(this.additional_discount_percentage=0,this.return_doc=null),this.$nextTick(()=>{this.$forceUpdate()})}),d.on("load_draft_invoice",e=>{var t;if(e&&e.name){if(((t=this.invoice_doc)==null?void 0:t.name)===e.name){console.log("[Invoice.js] Draft invoice already loaded:",e.name);return}this.new_invoice(e),console.log("[Invoice.js] Draft invoice loaded:",e.name),d.emit("show_mesage",{text:`\u062A\u0645 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629: ${e.name}`,color:"success"})}}),d.on("item_added",e=>{this.calculateAndApplyOffers()}),d.on("item_removed",e=>{this.calculateAndApplyOffers()}),d.on("item_updated",e=>{this.calculateAndApplyOffers()}),this.$nextTick(()=>{}),d.on("send_invoice_doc_payment",e=>{this.invoice_doc=e}),d.on("payments_updated",e=>{this.invoice_doc&&(this.invoice_doc.payments=e||[],this.$forceUpdate())}),d.on("request_invoice_print",()=>{var o,i;let e=((o=this.invoice_doc)==null?void 0:o.is_credit_sale)===!0||((i=this.invoice_doc)==null?void 0:i.is_credit_sale)==1,t=this.posa_use_customer_credit_switch===!0;if(!e&&!t&&!this.canPrintInvoice()){d.emit("show_mesage",{text:"Please select a payment method before printing",color:"warning"});return}this.printInvoice()}),d.on("posa_use_customer_credit_switch_changed",e=>{this.invoice_doc?(this.invoice_doc.is_credit_sale=!!e,this.posa_use_customer_credit_switch=!!e,this.$nextTick(()=>{this.$forceUpdate()})):(this.posa_use_customer_credit_switch=!!e,this.$nextTick(()=>{this.$forceUpdate()}))})},mounted(){this._boundShortOpenPayment=this.shortOpenPayment.bind(this),this._boundShortDeleteFirstItem=this.shortDeleteFirstItem.bind(this),this._boundShortOpenFirstItem=this.shortOpenFirstItem.bind(this),this._boundShortSelectDiscount=this.shortSelectDiscount.bind(this),document.addEventListener("keydown",this._boundShortOpenPayment),document.addEventListener("keydown",this._boundShortDeleteFirstItem),document.addEventListener("keydown",this._boundShortOpenFirstItem),document.addEventListener("keydown",this._boundShortSelectDiscount),this.scheduleScrollHeightUpdate(),window.addEventListener("resize",this.scheduleScrollHeightUpdate)},beforeUnmount(){window.removeEventListener("resize",this.scheduleScrollHeightUpdate),document.removeEventListener("keydown",this._boundShortOpenPayment),document.removeEventListener("keydown",this._boundShortDeleteFirstItem),document.removeEventListener("keydown",this._boundShortOpenFirstItem),document.removeEventListener("keydown",this._boundShortSelectDiscount),d.off("register_pos_profile"),d.off("add_item"),d.off("update_customer"),d.off("fetch_customer_details"),d.off("new_invoice"),d.off("load_invoice"),d.off("set_offers"),d.off("update_invoice_offers"),d.off("set_all_items"),d.off("load_return_invoice"),d.off("load_draft_invoice"),d.off("item_added"),d.off("item_removed"),d.off("item_updated"),d.off("send_invoice_doc_payment"),d.off("payments_updated"),d.off("request_invoice_print"),d.off("payment_amount_changed"),d.off("posa_use_customer_credit_switch_changed"),this._itemOperationTimer&&(clearTimeout(this._itemOperationTimer),this._itemOperationTimer=null),this._autoUpdateTimer&&(clearTimeout(this._autoUpdateTimer),this._autoUpdateTimer=null),this._sessionOffers=[],this._lastCustomer=null},watch:{"invoice_doc.grand_total"(e,t){e!==t&&this.invoice_doc},discount_amount(){},offerApplied:{handler(e,t){if(!e)return;let o=e;if(o.discount_percentage&&["grand_total","customer","customer_group",""].includes(o.offer_type||"")){this.additional_discount_percentage=flt(o.discount_percentage),this.offer_discount_percentage=flt(o.discount_percentage),this.$nextTick(()=>{this.update_discount_umount()});return}if(o.offer_type&&["item_code","item_group","brand"].includes(o.offer_type)&&o.discount_percentage){this.applyItemOffer(o);return}},deep:!0,immediate:!1},offerRemoved:{handler(e){if(!e||e===!1)return;if(e===!0){(this.additional_discount_percentage>0||this.offer_discount_percentage>0)&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0),this.clearItemOfferDiscounts(),this.$nextTick(()=>{this.updateInvoiceDocLocally()});return}let t=e.offer_type||"",o=e.name||e.offer_name,i=["grand_total","customer","customer_group",""].includes(t),s=["item_code","item_group","brand"].includes(t);if(i&&(this.additional_discount_percentage>0||this.offer_discount_percentage>0)&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0),s&&this.clearItemOfferDiscounts(o),!i&&!s&&o&&!this.clearItemOfferDiscounts(o)&&e.discount_percentage){let n=flt(e.discount_percentage);(this.additional_discount_percentage===n||this.offer_discount_percentage===n)&&(this.additional_discount_percentage=0,this.offer_discount_percentage=0)}this.$nextTick(()=>{this.updateInvoiceDocLocally()})},immediate:!1}}};var nu={style:{position:"relative","min-height":"0",display:"flex","flex-direction":"column","flex-grow":"1",height:"100%"}},su={style:{width:"100%","border-collapse":"collapse",background:"white","font-size":"0.75rem","table-layout":"auto","white-space":"nowrap"}},ru={key:0,style:{padding:"12px 0px 12px 3px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},au=["title"],lu={key:1,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0","text-align":"center"}},cu=["title"],du={key:2,style:{padding:"12px 0px","vertical-align":"middle","max-width":"80px","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},pu={style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"0px",padding:"0px",background:`linear-gradient(
											135deg,
											#f8f9fa 0%,
											#ffffff 100%
										)`,"border-radius":"4px",width:"100%","min-width":"0","box-sizing":"border-box",overflow:"hidden"}},fu=["onClick","disabled"],uu=a("span",{style:{"font-size":"0.75rem","font-weight":"700","line-height":"1"}},"\u2212",-1),_u=[uu],hu=["value","onInput","onChange","onBlur"],gu=["onClick"],mu=a("span",{style:{"font-size":"0.75rem","font-weight":"700","line-height":"1"}},"+",-1),yu=[mu],bu={key:3,style:{padding:"12px 0px","vertical-align":"middle","text-align":"center","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},vu={key:4,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0","max-width":"80px"}},xu={key:5,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0","max-width":"75px","justify-items":"center"}},wu=["value","onChange","onKeyup","onBlur","disabled"],Eu={key:6,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0","max-width":"85px"}},Ou=["value","onChange","onKeyup","onBlur","disabled","max"],Tu=a("span",{style:{"font-size":"0.65rem","font-weight":"700",color:"#f57c00","white-space":"nowrap","flex-shrink":"0"}},"%",-1),Su={key:0,style:{position:"absolute",top:"-2px",right:"-2px",background:"#4caf50",color:"white","font-size":"0.5rem","font-weight":"600",padding:"1px 3px","border-radius":"2px","line-height":"1"}},Cu={key:7,style:{padding:"12px 1px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0","max-width":"80px","justify-items":"center"}},Nu={key:0,style:{position:"absolute",top:"-2px",right:"-2px",background:"#4caf50",color:"white","font-size":"0.5rem","font-weight":"600",padding:"1px 2px","border-radius":"2px","line-height":"1"}},ku={key:8,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},Du={style:{display:"flex","align-items":"center",gap:"3px",padding:"0px 6px",background:`linear-gradient(
											135deg,
											#e8f5e9 0%,
											#c8e6c9 100%
										)`,"border-radius":"4px","min-width":"0","justify-content":"center",overflow:"hidden"}},Iu={style:{"font-size":"0.75rem","font-weight":"700",color:"#1b5e20","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Pu={key:9,style:{padding:"12px 0px","vertical-align":"middle","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","min-width":"0"}},Au={style:{display:"flex","justify-content":"center","align-items":"center"}},Ru=["disabled","onClick"],Mu=a("i",{class:"mdi mdi-delete",style:{"font-size":"18px",color:"#b71c1c","line-height":"1",display:"block","pointer-events":"none"}},null,-1),Vu=[Mu],Lu={style:{position:"fixed",bottom:"0",left:"0",right:"0",background:"#c4763d85","border-radius":"8px 8px 0 0",padding:"8px",border:"1px solid #e0e0e0","border-bottom":"none","box-shadow":"0 -2px 8px rgba(0, 0, 0, 0.12)","z-index":"100"}},Uu={style:{display:"grid","grid-template-columns":"repeat(auto-fit, minmax(120px, 1fr))",gap:"6px","margin-bottom":"3px",padding:"0px",background:"linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%)","border-radius":"4px"}},Fu={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #e0e0e0"}},zu=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#666","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" Total_Qty "),P(" \u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0643\u0645\u064A\u0629")],-1),ju={style:{"font-size":"0.9rem","font-weight":"700",color:"#1976d2","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},$u=["value","max","disabled"],Bu={key:0,style:{position:"absolute",top:"-2px",right:"-2px",background:"#4caf50",color:"white","font-size":"0.5rem","font-weight":"600",padding:"1px 3px","border-radius":"2px","line-height":"1"}},Hu={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #ffcc02"}},Gu=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#666","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" items_discount "),P(" \u062E\u0635\u0645 \u0627\u0644\u0623\u0635\u0646\u0627\u0641")],-1),qu={style:{"font-size":"0.9rem","font-weight":"700",color:"#f57c00","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},Wu={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #e0e0e0"}},Ku=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#666","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" list_price_total "),P(" \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A \u0642\u0628\u0644 \u0627\u0644\u062E\u0635\u0645")],-1),Yu={style:{"font-size":"0.9rem","font-weight":"700",color:"#1976d2","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},Qu={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #e0e0e0"}},Ju=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#666","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" net_total "),P(" \u0627\u0644\u0635\u0627\u0641\u064A")],-1),Xu={style:{"font-size":"0.9rem","font-weight":"700",color:"#1976d2","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},Zu={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #03a9f4"}},e_=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#666","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" Tax "),P(" \u0627\u0644\u0636\u0631\u064A\u0628\u0629")],-1),t_={style:{"font-size":"0.9rem","font-weight":"700",color:"#0288d1","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},o_={style:{display:"flex","flex-direction":"column",padding:"4px 6px",background:"white","border-radius":"3px",border:"1px solid #2e7d32"}},i_=a("label",{style:{"font-size":"0.65rem","margin-bottom":"0","font-weight":"600",color:"#2e7d32","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","text-transform":"uppercase","letter-spacing":"0.3px"}},[l(" grand_total "),P(" \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0643\u0644\u064A")],-1),n_={style:{"font-size":"0.9rem","font-weight":"800",color:"#2e7d32","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},s_={style:{display:"flex",gap:"1px",background:"white",padding:"0px","border-radius":"6px",width:"100%","box-shadow":"inset 0 1px 3px rgba(0, 0, 0, 0.05)"}},r_=["disabled"],a_=a("i",{class:"mdi mdi-printer",style:{"font-size":"16px"}},null,-1),l_={style:{"font-size":"0.85rem"}},c_={key:1,style:{flex:"1",padding:"8px 4px","border-radius":"5px",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px","text-align":"center"}},d_=a("i",{class:"mdi mdi-alert",style:{"font-size":"16px"}},null,-1),p_=a("span",{style:{"font-size":"0.85rem"}},"\u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0632\u0627\u0626\u062F \u063A\u064A\u0631 \u0645\u0633\u0645\u0648\u062D",-1),f_=[d_,p_],u_={key:2,style:{flex:"1",padding:"8px 4px","border-radius":"5px",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px","text-align":"center"}},h_=a("i",{class:"mdi mdi-alert",style:{"font-size":"16px"}},null,-1),g_=a("span",{style:{"font-size":"0.85rem"}},"\u0627\u0644\u062F\u0641\u0639 \u0627\u0644\u062C\u0632\u0626\u064A \u063A\u064A\u0631 \u0645\u0633\u0645\u0648\u062D",-1),m_=[h_,g_],y_=["disabled"],b_=a("i",{class:"mdi mdi-cash-multiple",style:{"font-size":"16px"}},null,-1),v_=a("span",{style:{"font-size":"0.85rem"}},"\u062F\u0641\u0639",-1),x_=["disabled"],w_=a("i",{class:"mdi mdi-keyboard-return",style:{"font-size":"16px"}},null,-1),E_=a("span",{style:{"font-size":"0.85rem"}},"\u0625\u0631\u062C\u0627\u0639 \u0641\u0627\u062A\u0648\u0631\u0629",-1),O_=["disabled"],T_=a("i",{class:"mdi mdi-flash",style:{"font-size":"16px"}},null,-1),S_=a("span",{style:{"font-size":"0.85rem"}},"\u0645\u0631\u062A\u062C\u0639 \u0633\u0631\u064A\u0639",-1),C_={style:{"font-size":"0.85rem"}},N_=a("i",{class:"mdi mdi-close-circle",style:{"font-size":"16px"}},null,-1),k_=a("span",{style:{"font-size":"0.85rem"}},"\u0625\u0644\u063A\u0627\u0621",-1);function aa(e,t,o,i,s,r){var c,p,f,_,b,y,A,G,C,N,Q,E,U,W,M,le,ce,q,j,z,oe,F;let n=Ie("Customer");return g(),m("div",null,[l(" =========================================== "),l(" INVOICE CONTAINER "),l(" =========================================== "),a("div",nu,[l(" =========================================== "),l(" CUSTOMER SECTION "),l(" =========================================== "),a("div",{style:k(e.quick_return_value?{padding:"4px 6px",borderBottom:"1px solid #e0e0e0",marginBottom:"0",border:"3px solid #9c27b0",borderRadius:"8px",borderTopWidth:"2px",paddingTop:"2px",borderBottomWidth:"2px",paddingBottom:"3px"}:(c=e.invoice_doc)!=null&&c.is_return?{padding:"4px 6px",borderBottom:"1px solid #e0e0e0",marginBottom:"0",border:"3px solid #607d8b",borderRadius:"8px",borderTopWidth:"2px",paddingTop:"2px",borderBottomWidth:"2px",paddingBottom:"3px"}:{padding:"4px 6px",borderBottom:"1px solid #e0e0e0",marginBottom:"0",border:"3px solid #4caf50",borderRadius:"8px",borderTopWidth:"2px",paddingTop:"2px",borderBottomWidth:"2px",paddingBottom:"3px"})},[de(n)],4),l(" =========================================== "),l(" ITEMS TABLE SECTION "),l(" =========================================== "),a("div",{ref:"itemsScrollArea",style:k([e.itemsScrollStyle,{flex:"1","overflow-y":"auto","overflow-x":"hidden",padding:"0",display:"block"}])},[a("table",su,[l(" TABLE HEADERS "),a("thead",null,[a("tr",null,[(g(!0),m(V,null,ae(e.dynamicHeaders,w=>(g(),m("th",{key:w.key,style:{background:`linear-gradient(
										180deg,
										rgba(128, 166, 255, 1) 0%,
										rgba(128, 166, 255, 0.25) 50%
									)`,"border-bottom":"1px solid #e0e0e0",padding:"8px 2px","font-weight":"600","font-size":"0.75rem",color:"#424242",position:"sticky",top:"0","z-index":"1","text-align":"center","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},x(w.title),1))),128))])]),l(" TABLE ROWS - INVOICE ITEMS "),a("tbody",null,[(g(!0),m(V,null,ae(e.items,w=>{var Ee,Ve,Oe,me,pe,Ge,Wt;return g(),m("tr",{key:w.posa_row_id,style:k({borderBottom:"1px solid #f1f1f1",borderLeft:w.discount_percentage>0||w.posa_offer_applied?"3px solid #ff9800":"none"})},[l(" ITEM NAME COLUMN "),e.dynamicHeaders.find(K=>K.key==="item_name")?(g(),m("td",ru,[l(' <div style="width: 120px"> '),a("p",{style:{"margin-bottom":"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","font-size":"0.7rem !important"},title:w.item_name},x(w.item_name),9,au),l(" </div> ")])):l("v-if",!0),l(" ITEM CODE COLUMN "),e.dynamicHeaders.find(K=>K.key==="item_code")?(g(),m("td",lu,[a("p",{style:{"margin-bottom":"0","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","font-size":"0.7rem !important"},title:w.item_code},x(w.item_code),9,cu)])):l("v-if",!0),l(" QUANTITY COLUMN "),e.dynamicHeaders.find(K=>K.key==="qty")?(g(),m("td",du,[a("div",pu,[a("button",{style:{"flex-shrink":"0",width:"16px",height:"16px","min-width":"16px",padding:"0",border:"none","border-radius":"3px",cursor:"pointer",display:"flex","align-items":"center","justify-content":"center","font-size":"0",position:"relative",color:"white",background:`linear-gradient(
												135deg,
												#ff9800 0%,
												#f57c00 100%
											)`,"box-shadow":"0 1px 3px rgba(0, 0, 0, 0.2)"},onClick:K=>e.decreaseQuantity(w),disabled:!(w.qty&&Math.abs(w.qty)>0),type:"button"},_u,8,fu),a("input",{type:"text",value:Math.abs(w.qty||0),onInput:K=>e.onQtyInput(w,K),onChange:K=>e.onQtyChange(w,K),onBlur:K=>e.handleQtyBlur(w,K),style:{flex:"1",width:"100%","min-width":"10px !important",border:"1px solid #1976d2",background:"white","text-align":"center","font-size":"0.75rem",margin:"0px 1px",padding:"0px 0px","border-radius":"3px",outline:"none","box-sizing":"border-box","max-width":"100%"},placeholder:"0"},null,40,hu),a("button",{style:{"flex-shrink":"0",width:"16px",height:"16px","min-width":"16px",padding:"0",border:"none","border-radius":"3px",cursor:"pointer",display:"flex","align-items":"center","justify-content":"center","font-size":"0",position:"relative",color:"white",background:`linear-gradient(
												135deg,
												#4caf50 0%,
												#388e3c 100%
											)`,"box-shadow":"0 1px 3px rgba(0, 0, 0, 0.2)"},onClick:K=>e.increaseQuantity(w),type:"button"},yu,8,gu)])])):l("v-if",!0),l(" UOM COLUMN "),e.dynamicHeaders.find(K=>K.key==="uom")?(g(),m("td",bu,x(w.uom),1)):l("v-if",!0),l(" PRICE LIST RATE COLUMN (Original Price) "),e.dynamicHeaders.find(K=>K.key==="price_list_rate")?(g(),m("td",vu,[a("div",{style:k({display:"flex",alignItems:"center",gap:"3px",padding:"0px 3px",background:w._offer_discount_applied?"linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)":"linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)",borderRadius:"4px",minWidth:0,justifyContent:"center",placeSelf:"center",overflow:"hidden"})},[a("span",{style:k({fontSize:"0.7rem",fontWeight:"700",color:w._offer_discount_applied?"#e65100":"#2e7d32",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"})},x(e.formatCurrency(w.price_list_rate)),5)],4)])):l("v-if",!0),l(" RATE COLUMN (Discounted Price - Editable) "),e.dynamicHeaders.find(K=>K.key==="rate")?(g(),m("td",xu,[a("div",{style:k({display:"flex",alignItems:"center",gap:"3px",padding:"0px 3px",background:(e.flt(w.rate)!==e.flt(w.price_list_rate),"linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)"),borderRadius:"4px",minWidth:"0",maxWidth:"65px",justifyContent:"center",position:"relative",border:e.flt(w.rate)!==e.flt(w.price_list_rate)?"1px solid #ff9800":"none"})},[a("input",{type:"text",value:w.rate||"",onChange:K=>e.setItemRate(w,K),onKeyup:Fe(K=>e.setItemRate(w,K),["enter"]),onBlur:K=>e.handleRateBlur(w,K),disabled:Boolean(w.posa_is_offer||w.posa_is_replace||w.posa_offer_applied||((Ee=e.invoice_doc)==null?void 0:Ee.is_return)),style:k([Boolean(w.posa_is_offer||w.posa_is_replace||w.posa_offer_applied||((Ve=e.invoice_doc)==null?void 0:Ve.is_return))?"flex: 1; width: 100%; border: none;background: #f5f5f5; color: #9e9e9e; font-size: 0.7rem; padding: 2px 2px; border-radius: 3px; outline: none; cursor: not-allowed; max-width: 45px;":"flex: 1; width: 100%; border: none; background: transparent; font-size: 0.75rem; font-weight: 700; color: #f57c00; padding: 0; outline: none; text-align: right; max-width: 45px;",{"box-sizing":"border-box","min-width":"0","max-width":"100%"}]),placeholder:"0.00"},null,44,wu),l(" Discount indicator for rate "),l(` <span
                    v-if="
                      flt(item.rate) !== flt(item.price_list_rate) &&
                      flt(item.rate) < flt(item.price_list_rate)
                    "
                    style="
                      position: absolute;
                      top: -2px;
                      right: -2px;
                      background: #ff9800;
                      color: white;
                      font-size: 0.5rem;
                      font-weight: 600;
                      padding: 1px 3px;
                      border-radius: 2px;
                      line-height: 1;
                    "
                  >
                    DISCOUNT
                  </span> `)],4)])):l("v-if",!0),l(" DISCOUNT PERCENTAGE COLUMN (Editable) "),e.dynamicHeaders.find(K=>K.key==="discount_percentage")?(g(),m("td",Eu,[a("div",{style:k({display:"flex",alignItems:"center",gap:"3px",padding:"0px 6px",background:(w.discount_percentage>0,"linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)"),borderRadius:"4px",minWidth:"0",justifyContent:"center",position:"relative"})},[a("input",{type:"number",value:e.formatFloat(w.discount_percentage||0),onChange:K=>e.setDiscountPercentage(w,K),onKeyup:Fe(K=>e.setDiscountPercentage(w,K),["enter"]),onBlur:K=>e.handleDiscountBlur(w,K),disabled:Boolean(w.posa_is_offer||w.posa_is_replace||w.posa_offer_applied||!((Oe=e.pos_profile)!=null&&Oe.posa_allow_user_to_edit_item_discount)||((me=e.invoice_doc)==null?void 0:me.is_return)),style:k([Boolean(w.posa_is_offer||w.posa_is_replace||w.posa_offer_applied||!((pe=e.pos_profile)!=null&&pe.posa_allow_user_to_edit_item_discount)||((Ge=e.invoice_doc)==null?void 0:Ge.is_return))?"flex: 1; width: 100%; border: none; background: #f5f5f5; color: #9e9e9e; font-size: 0.75rem; padding: 2px 4px; border-radius: 3px; outline: none; cursor: not-allowed; text-align: right":"flex: 1; width: 100%; border: none; background: transparent; font-size: 0.75rem; font-weight: 700; color: #f57c00; padding: 0; outline: none; text-align: right",{"box-sizing":"border-box","min-width":"0","max-width":"100%"}]),placeholder:"0",min:"0",max:((Wt=e.pos_profile)==null?void 0:Wt.posa_item_max_discount_allowed)||100,step:"0.01"},null,44,Ou),Tu,l(" Offer badge for discount percentage "),w.posa_offer_applied&&w.discount_percentage>0?(g(),m("span",Su," OFFER ")):l("v-if",!0)],4)])):l("v-if",!0),l(" DISCOUNT AMOUNT COLUMN (Calculated) "),e.dynamicHeaders.find(K=>K.key==="discount_amount")?(g(),m("td",Cu,[a("div",{style:k({display:"flex",alignItems:"center",gap:"3px",padding:"0px 2px",background:e.getDiscountAmount(w)>0?"linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)":"linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%)",borderRadius:"4px",minWidth:"0",maxWidth:"85px",justifyContent:"center",position:"relative"})},[a("span",{style:k({fontSize:"0.75rem",fontWeight:"700",color:e.getDiscountAmount(w)>0?"#f57c00":"#9e9e9e"})},x(e.formatCurrency(e.getDiscountAmount(w))),5),l(" Offer badge for discount amount "),w.posa_offer_applied&&e.getDiscountAmount(w)>0?(g(),m("span",Nu," OFFER ")):l("v-if",!0)],4)])):l("v-if",!0),l(" TOTAL AMOUNT COLUMN (Calculated: Qty \xD7 Rate) "),e.dynamicHeaders.find(K=>K.key==="amount")?(g(),m("td",ku,[a("div",Du,[a("span",Iu,x(e.formatCurrency(e.flt(w.qty,e.float_precision)*e.flt(w.rate,e.currency_precision))),1)])])):l("v-if",!0),l(" ACTIONS COLUMN (Delete Button) "),e.dynamicHeaders.find(K=>K.key==="actions")?(g(),m("td",Pu,[a("div",Au,[a("button",{disabled:Boolean(w.posa_is_offer||w.posa_is_replace),style:k(w.posa_is_offer||w.posa_is_replace?"width:18px;height:18px;padding:0;border-radius:6px;border:none;background:#f3f3f3;color:#9e9e9e;display:flex;align-items:center;justify-content:center;cursor:not-allowed;opacity:0.6;":"width:18px;height:18px;padding:0;border-radius:6px;border:none;background:linear-gradient(180deg,#fff5f5,#ffffff);color:#c62828;display:flex;align-items:center;justify-content:center;cursor:pointer;"),onMouseenter:t[0]||(t[0]=K=>{K.currentTarget.disabled||(K.currentTarget.style.background="#ffcdd2",K.currentTarget.style.border="1px solid #ef5350",K.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")}),onMouseleave:t[1]||(t[1]=K=>{K.currentTarget.disabled||(K.currentTarget.style.background="linear-gradient(180deg,#fff5f5,#ffffff)",K.currentTarget.style.border="none",K.currentTarget.style.boxShadow="")}),onClick:we(K=>e.remove_item(w),["stop"]),title:"\u062D\u0630\u0641 \u0627\u0644\u0635\u0646\u0641"},Vu,44,Ru)])])):l("v-if",!0)],4)}),128))])])],4)]),l(" =========================================== "),l(" PAYMENT & FINANCIAL SUMMARY SECTION "),l(" =========================================== "),a("div",Lu,[l(" FINANCIAL SUMMARY (Totals Row) "),a("div",Uu,[l(" Total_Qty Field "),a("div",Fu,[zu,a("div",ju,x(e.formatFloat(((p=e.invoice_doc)==null?void 0:p.total_qty)||0)),1)]),l(" Invoice_discount Field (Editable) "),a("div",{style:k({display:"flex",flexDirection:"column",padding:"4px 6px",background:(f=e.pos_profile)!=null&&f.posa_allow_user_to_edit_additional_discount?"white":"#f5f5f5",borderRadius:"3px",border:(_=e.pos_profile)!=null&&_.posa_allow_user_to_edit_additional_discount?"1px solid #e0e0e0":"1px solid #d0d0d0",position:"relative"})},[a("label",{style:k({fontSize:"0.65rem",marginBottom:"0",fontWeight:"600",color:(b=e.pos_profile)!=null&&b.posa_allow_user_to_edit_additional_discount?"#666":"#9e9e9e",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textTransform:"uppercase",letterSpacing:"0.3px"})},[l(" Invoice_discount "),P(" \u062E\u0635\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629")],4),a("input",{type:"number",value:e.additional_discount_percentage,onInput:t[2]||(t[2]=(...w)=>e.onDiscountInput&&e.onDiscountInput(...w)),onBlur:t[3]||(t[3]=(...w)=>e.onDiscountBlur&&e.onDiscountBlur(...w)),ref:"percentage_discount",step:"0.01",min:"0",max:((y=e.pos_profile)==null?void 0:y.posa_invoice_max_discount_allowed)||100,style:k({width:"100%",border:"none",outline:"none",background:"transparent",fontSize:"0.9rem",fontWeight:"700",color:(A=e.pos_profile)!=null&&A.posa_allow_user_to_edit_additional_discount?"#1976d2":"#9e9e9e",padding:"0",textAlign:"left",cursor:(G=e.pos_profile)!=null&&G.posa_allow_user_to_edit_additional_discount?"text":"not-allowed"}),placeholder:"0.00",disabled:!((C=e.pos_profile)!=null&&C.posa_allow_user_to_edit_additional_discount)},null,44,$u),l(" Offer badge for Invoice_discount "),e.offer_discount_percentage>0&&e.additional_discount_percentage>0?(g(),m("span",Bu," OFFER ")):l("v-if",!0)],4),l(" Items Discount Field "),a("div",Hu,[Gu,a("div",qu,x(e.currencySymbol((N=e.pos_profile)==null?void 0:N.currency))+x(e.formatCurrency(((Q=e.invoice_doc)==null?void 0:Q.posa_item_discount_total)||0)),1)]),l(" Before Discount Field "),a("div",Wu,[Ku,a("div",Yu,x(e.currencySymbol((E=e.pos_profile)==null?void 0:E.currency))+x(e.formatCurrency(((U=e.invoice_doc)==null?void 0:U.total)||0)),1)]),l(" Net Total Field "),a("div",Qu,[Ju,a("div",Xu,x(e.currencySymbol((W=e.pos_profile)==null?void 0:W.currency))+x(e.formatCurrency(((M=e.invoice_doc)==null?void 0:M.net_total)||0)),1)]),l(" Tax Field "),a("div",Zu,[e_,a("div",t_,x(e.currencySymbol((le=e.pos_profile)==null?void 0:le.currency))+x(e.formatCurrency(e.computedTaxAmount)),1)]),l(" Grand Total Field "),a("div",o_,[i_,a("div",n_,x(e.currencySymbol((ce=e.pos_profile)==null?void 0:ce.currency))+x(e.formatCurrency(((q=e.invoice_doc)==null?void 0:q.grand_total)||0)),1)])]),l(" =========================================== "),l(" ACTION BUTTONS ROW "),l(" =========================================== "),a("div",s_,[l(" Print Button "),!e.hasExcessNonCashPayment&&!e.hasPartialPaymentNotAllowed?(g(),m("button",{key:0,disabled:!e.hasItems||e.isPrinting||!e.canPrintInvoice,onClick:t[4]||(t[4]=(...w)=>e.printInvoice&&e.printInvoice(...w)),title:"\u0637\u0628\u0627\u0639\u0629 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",style:k([{flex:"1",padding:"8px 4px",border:"none","border-radius":"5px",cursor:"pointer",background:"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px"},!e.hasItems||e.isPrinting||!e.canPrintInvoice?"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; opacity: 0.6":""]),type:"button"},[a_,l(" Printing / Print "),a("span",l_,x(e.isPrinting?"\u062C\u0627\u0631\u064A \u0627\u0644\u0637\u0628\u0627\u0639\u0629...":"\u0637\u0628\u0627\u0639\u0629"),1)],12,r_)):l("v-if",!0),l(" Warning Message for Excess Non-Cash Payment "),e.hasExcessNonCashPayment?(g(),m("div",c_,f_)):l("v-if",!0),l(" Warning Message for Partial Payment Not Allowed "),e.hasPartialPaymentNotAllowed?(g(),m("div",u_,m_)):l("v-if",!0),l(" Pay Button "),a("button",{disabled:!e.hasItems||e.is_payment||e.isUpdatingTotals,onClick:t[5]||(t[5]=(...w)=>e.show_payment&&e.show_payment(...w)),style:k([{flex:"1",padding:"8px 4px",border:"none","border-radius":"5px",cursor:"pointer",background:"linear-gradient(135deg, #4caf50 0%, #388e3c 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px"},!e.hasItems||e.is_payment||e.isUpdatingTotals?"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; opacity: 0.6":""]),type:"button"},[b_,l(" Pay "),v_],12,y_),l(" Return Button "),a("button",{disabled:!((j=e.pos_profile)!=null&&j.posa_allow_return),onClick:t[6]||(t[6]=(...w)=>e.open_returns&&e.open_returns(...w)),style:k([{flex:"1",padding:"8px 4px",border:"none","border-radius":"5px",cursor:"pointer",background:"#607d8b",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px"},(z=e.pos_profile)!=null&&z.posa_allow_return?"":"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; opacity: 0.6"]),type:"button"},[w_,l(" Return_invoice "),E_],12,x_),l(" Quick Return Button "),a("button",{disabled:!((oe=e.pos_profile)!=null&&oe.posa_allow_quick_return),onClick:t[7]||(t[7]=(...w)=>e.quick_return&&e.quick_return(...w)),style:k([{flex:"1",padding:"8px 4px",border:"none","border-radius":"5px",cursor:"pointer",background:"linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px"},(F=e.pos_profile)!=null&&F.posa_allow_quick_return?"":"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; opacity: 0.6"]),type:"button"},[T_,l(" Quick_Return "),S_],12,O_),l(" Smart Draft Button: \u062A\u0643\u0645\u0644\u0629 \u0641\u0627\u062A\u0648\u0631\u0629 / \u062D\u0641\u0638 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 "),a("button",{onClick:t[8]||(t[8]=(...w)=>e.handleDraftButton&&e.handleDraftButton(...w)),style:k(e.hasItems?{flex:1,padding:"8px 4px",border:"none",borderRadius:"5px",cursor:"pointer",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}:{flex:1,padding:"8px 4px",border:"none",borderRadius:"5px",cursor:"pointer",background:"linear-gradient(135deg, #2196f3 0%, #1976d2 100%)",color:"white",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"}),type:"button"},[a("i",{class:at(e.hasItems?"mdi mdi-content-save":"mdi mdi-file-document-edit"),style:{"font-size":"16px"}},null,2),a("span",C_,x(e.hasItems?"\u062D\u0641\u0638 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629":"\u062A\u0643\u0645\u0644\u0629 \u0641\u0627\u062A\u0648\u0631\u0629"),1)],4),l(" Cancel Button "),a("button",{onClick:t[9]||(t[9]=(...w)=>e.cancel_invoice&&e.cancel_invoice(...w)),style:{flex:"1",padding:"8px 4px",border:"none","border-radius":"5px",cursor:"pointer",background:"linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",color:"white","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"4px"},type:"button"},[N_,l(" Cancel "),k_])])])])}Pi.render=aa;Pi.__file="../posawesome/posawesome/public/js/posapp/components/pos/Invoice.vue";var la=Pi;var Ai={CLOSE_OPENING_DIALOG:"close_opening_dialog",REGISTER_POS_DATA:"register_pos_data",SET_COMPANY:"set_company",SHOW_MESSAGE:"show_mesage"},ca={Cash:{icon:"mdi-cash",color:"#4CAF50"},Card:{icon:"mdi-credit-card",color:"#2196F3"},"Credit Card":{icon:"mdi-credit-card",color:"#2196F3"},"Debit Card":{icon:"mdi-credit-card-outline",color:"#FF9800"},"Bank Transfer":{icon:"mdi-bank-transfer",color:"#9C27B0"},"Mobile Payment":{icon:"mdi-cellphone",color:"#E91E63"},"Digital Wallet":{icon:"mdi-wallet",color:"#00BCD4"},Check:{icon:"mdi-checkbook",color:"#795548"},Voucher:{icon:"mdi-ticket",color:"#FF5722"}},D_={icon:"mdi-currency-usd",color:"#607D8B"},I_=[{title:"Payment Method",align:"start",sortable:!1,key:"mode_of_payment"},{title:"Opening Amount",key:"amount",align:"center",sortable:!1}],P_={MAX_CHARS:e=>e.length<=12||"Text too long!"},A_={ITEMS_PER_PAGE:100},Ri={name:"OpeningDialog",mixins:[Re],props:{dialog:{type:Boolean,default:!1}},setup(e){let t=ge(e.dialog||!1),o=ge({}),i=ge(!1),s=ge([]),r=ge(""),n=ge([]),c=ge([]),p=ge(""),f=ge([]),_=ge([]),b=ge(I_),y=ge(A_.ITEMS_PER_PAGE),A=ge(!0),G=ge(""),C=ge(""),N=ge(""),Q=()=>{frappe.call({method:X.POS_OPENING_SHIFT.GET_OPENING_DATA,args:{},callback:function(j){j.message?(j.message.companies.forEach(z=>{s.value.push(z.name)}),r.value=s.value[0],n.value=j.message.pos_profiles_data,f.value=j.message.payments_method):q("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0641\u062A\u062D \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639","error")}})},E=()=>{d.emit(Ai.CLOSE_OPENING_DIALOG)},U=()=>!_.value.length||!r.value||!p.value?(q("\u064A\u0631\u062C\u0649 \u0645\u0644\u0621 \u062C\u0645\u064A\u0639 \u0627\u0644\u062D\u0642\u0648\u0644 \u0627\u0644\u0645\u0637\u0644\u0648\u0628\u0629","error"),!1):!0,W=()=>{!U()||(i.value=!0,frappe.call({method:X.POS_OPENING_SHIFT.CREATE_OPENING_VOUCHER,args:{pos_profile:p.value,company:r.value,balance_details:_.value}}).then(j=>{if(j.message){let oe=j.message.name||"\u063A\u064A\u0631 \u0645\u0639\u0631\u0648\u0641";console.log("[OpeningDialog.js] Opening shift created:",oe),frappe.call({method:X.POS_OPENING_SHIFT.GET_CURRENT_SHIFT_NAME,callback:F=>{if(F.message&&F.message.success&&F.message.data){let w=F.message.data,Ee=w.pos_profile_data;if(Ee){let Ve={name:w.name,company:w.company,period_start_date:w.period_start_date,pos_profile:w.pos_profile,user:w.user},Oe={pos_profile:Ee,pos_opening_shift:Ve,company:{name:Ee.company}};d.emit(Ai.REGISTER_POS_DATA,Oe),d.emit(Ai.SET_COMPANY,{name:Ee.company}),q(`\u062A\u0645 \u0625\u0646\u0634\u0627\u0621 \u0648\u0631\u062F\u064A\u0629 \u0641\u062A\u062D \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 ${oe}`,"success"),E()}else{let Ve=w.pos_profile_error?`\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A: ${w.pos_profile_error}`:`\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A: POS Profile "${w.pos_profile}" \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F \u0623\u0648 \u063A\u064A\u0631 \u0645\u062A\u0627\u062D`;console.error("[OpeningDialog.js] POS Profile load error:",w.pos_profile_error||"POS Profile not found"),q(Ve,"error")}}else q("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629","error");i.value=!1},error:F=>{console.log("[OpeningDialog.js] get_current_shift_name error:",F),q("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0648\u0631\u062F\u064A\u0629","error"),i.value=!1}})}else q("\u0641\u0634\u0644 \u0625\u0646\u0634\u0627\u0621 \u0645\u0633\u062A\u0646\u062F \u0627\u0644\u0627\u0641\u062A\u062A\u0627\u062D","error"),i.value=!1}).catch(j=>{console.log("[OpeningDialog.js] submit_dialog error:",j),q("\u0641\u0634\u0644 \u0625\u0646\u0634\u0627\u0621 \u0645\u0633\u062A\u0646\u062F \u0627\u0644\u0627\u0641\u062A\u062A\u0627\u062D","error"),i.value=!1}))},M=()=>{frappe.set_route("/"),location.reload()},le=j=>{let z=Object.keys(ca).find(oe=>j.toLowerCase().includes(oe.toLowerCase()));return z?ca[z]:D_},ce=()=>{if(!p.value){A.value=!0;return}frappe.call({method:X.POS_OPENING_SHIFT.CHECK_OPENING_TIME_ALLOWED,args:{pos_profile:p.value},callback:function(j){j.message?(A.value=j.message.allowed,j.message.allowed||(N.value=j.message.message)):A.value=!0}})},q=(j,z)=>{d.emit(Ai.SHOW_MESSAGE,{text:j,color:z})};return $t(r,j=>{c.value=[],n.value.forEach(z=>{z.company===j&&c.value.push(z.name)}),p.value=c.value.length?c.value[0]:""}),$t(p,j=>{_.value=[],f.value.forEach(z=>{z.parent===j&&_.value.push({mode_of_payment:z.mode_of_payment,amount:0,currency:z.currency})}),ce()}),kt(()=>{Q()}),{isOpen:t,dialog_data:o,is_loading:i,companies:s,company:r,pos_profiles_data:n,pos_profiles:c,pos_profile:p,payments_method_data:f,payments_methods:_,payments_methods_headers:b,itemsPerPage:y,isOpeningAllowed:A,openingTimeStart:G,openingTimeEnd:C,openingTimeMessage:N,max25chars:P_.MAX_CHARS,close_opening_dialog:E,submit_dialog:W,go_desk:M,checkOpeningTimeAllowed:ce,getPaymentIcon:le}}};var R_={style:{display:"flex","justify-content":"center","align-items":"center"}},M_={style:{background:"linear-gradient(135deg, #ff6f00 0%, #ff9800 100%)",padding:"12px 16px",display:"flex","align-items":"center","justify-content":"space-between","box-shadow":"0 2px 8px rgba(255, 152, 0, 0.3)",position:"relative",overflow:"hidden"}},V_=a("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[a("div",{style:{width:"28px",height:"28px",background:"rgba(255, 255, 255, 0.2)","border-radius":"6px",display:"flex","align-items":"center","justify-content":"center"}},[a("i",{class:"mdi mdi-cash-register",style:{color:"white","font-size":"18px"}})]),a("h3",{style:{margin:"0","font-size":"16px","font-weight":"700",color:"white","text-shadow":"0 1px 2px rgba(0, 0, 0, 0.1)",position:"relative","z-index":"2"}},[l(" POS Opening "),P(" \u0641\u062A\u062D \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 ")])],-1),L_=a("i",{class:"mdi mdi-close",style:{color:"white","font-size":"14px"}},null,-1),U_=[L_],F_={style:{padding:"12px",background:"#fafbfc"}},z_={style:{"margin-bottom":"12px"}},j_=a("label",{style:{display:"block","font-size":"11px","font-weight":"600",color:"#475569","margin-bottom":"4px","text-transform":"uppercase","letter-spacing":"0.5px"}},[l(" Company "),P(" \u0627\u0644\u0634\u0631\u0643\u0629 ")],-1),$_=["value"],B_={style:{"margin-bottom":"12px"}},H_=a("label",{style:{display:"block","font-size":"11px","font-weight":"600",color:"#475569","margin-bottom":"4px","text-transform":"uppercase","letter-spacing":"0.5px"}},[l(" POS Profile "),P(" \u0645\u0644\u0641 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 ")],-1),G_=["value"],q_={style:{"margin-bottom":"0"}},W_=a("label",{style:{display:"block","font-size":"11px","font-weight":"600",color:"#475569","margin-bottom":"4px","text-transform":"uppercase","letter-spacing":"0.5px"}},[l(" Payment Methods "),P(" \u0637\u0631\u0642 \u0627\u0644\u062F\u0641\u0639 ")],-1),K_={style:{background:"white","border-radius":"8px",overflow:"hidden",border:"1px solid #e8eaed","margin-top":"6px","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.1)"}},Y_=a("div",{style:{display:"grid","grid-template-columns":"2fr 1fr",background:"linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)","border-bottom":"1px solid #e2e8f0"}},[a("div",{style:{padding:"6px 8px","font-size":"10px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-start"}},[l(" Payment Method "),P(" \u0637\u0631\u064A\u0642\u0629 \u0627\u0644\u062F\u0641\u0639 ")]),a("div",{style:{padding:"6px 8px","font-size":"10px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-end"}},[l(" Opening Amount "),P(" \u0645\u0628\u0644\u063A \u0627\u0644\u0627\u0641\u062A\u062A\u0627\u062D ")])],-1),Q_={style:{padding:"8px",display:"flex","align-items":"center","font-size":"12px","min-height":"36px","justify-content":"flex-start"}},J_={style:{display:"flex","align-items":"center",gap:"6px"}},X_={style:{"font-weight":"500",color:"#334155","font-size":"11px"}},Z_={style:{padding:"8px",display:"flex","align-items":"center","font-size":"12px","min-height":"36px","justify-content":"flex-end"}},eh={style:{display:"flex","align-items":"center",gap:"4px",background:"white",border:"1px solid #d1d5db","border-radius":"4px",padding:"2px 6px"}},th={style:{"font-size":"10px",color:"#64748b","font-weight":"500"}},oh=["onUpdate:modelValue"],ih={style:{background:"#f8fafc",padding:"8px 12px","border-top":"1px solid #e2e8f0",display:"flex",gap:"8px","justify-content":"flex-end"}},nh=a("i",{class:"mdi mdi-close",style:{"font-size":"14px"}},null,-1),sh=["disabled"],rh={key:0,class:"mdi mdi-check",style:{"font-size":"14px"}},ah={key:1,class:"mdi mdi-loading",style:{"font-size":"14px"}},lh={key:1,style:{"font-size":"11px",color:"#dc2626",background:"#fef2f2",border:"1px solid #fecaca","border-radius":"6px",padding:"6px 10px",display:"flex","align-items":"center","font-weight":"500"}};function da(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" OPENING DIALOG COMPONENT "),l(" =========================================== "),a("div",R_,[e.isOpen?(g(),m("div",{key:0,style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.7)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"},onClick:t[12]||(t[12]=(...n)=>e.go_desk&&e.go_desk(...n))},[l(" Beautiful Dialog "),a("div",{style:{background:"white","border-radius":"16px",overflow:"hidden","box-shadow":"0 20px 40px rgba(0, 0, 0, 0.15)","max-width":"450px",width:"100%",border:"1px solid rgba(102, 126, 234, 0.1)"},onClick:t[11]||(t[11]=we(()=>{},["stop"]))},[l(" =========================================== "),l(" COMPACT HEADER "),l(" =========================================== "),a("div",M_,[V_,a("button",{style:{background:"rgba(255, 255, 255, 0.15)",border:"none","border-radius":"4px",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},onClick:t[0]||(t[0]=(...n)=>e.go_desk&&e.go_desk(...n))},U_)]),l(" =========================================== "),l(" COMPACT CONTENT "),l(" =========================================== "),a("div",F_,[l(" Company Selection "),a("div",z_,[j_,ee(a("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.company=n),required:"",style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db","border-radius":"6px","font-size":"13px",background:"white",color:"#374151",outline:"none"}},[(g(!0),m(V,null,ae(e.companies,n=>(g(),m("option",{key:n,value:n},x(n),9,$_))),128))],512),[[_t,e.company]])]),l(" POS Profile Selection "),a("div",B_,[H_,ee(a("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>e.pos_profile=n),required:"",style:{width:"100%",padding:"8px 12px",border:"1px solid #d1d5db","border-radius":"6px","font-size":"13px",background:"white",color:"#374151",outline:"none"}},[(g(!0),m(V,null,ae(e.pos_profiles,n=>(g(),m("option",{key:n,value:n},x(n),9,G_))),128))],512),[[_t,e.pos_profile]])]),l(" Payment Methods Table "),a("div",q_,[W_,a("div",K_,[l(" Table Header "),Y_,l(" Table Body "),a("div",null,[(g(!0),m(V,null,ae(e.payments_methods,(n,c)=>(g(),m("div",{key:n.mode_of_payment,style:k([{display:"grid","grid-template-columns":"2fr 1fr","border-bottom":"1px solid #f1f5f9"},c===e.payments_methods.length-1?"border-bottom: none":""])},[l(" Method Column "),a("div",Q_,[a("div",J_,[a("i",{class:at(["mdi",e.getPaymentIcon(n.mode_of_payment).icon]),style:k({color:e.getPaymentIcon(n.mode_of_payment).color,fontSize:"14px"})},null,6),a("span",X_,x(n.mode_of_payment),1)])]),l(" Amount Column "),a("div",Z_,[a("div",eh,[a("span",th,x(e.currencySymbol(n.currency)),1),ee(a("input",{"onUpdate:modelValue":p=>n.amount=p,type:"number",placeholder:"0.00",step:"0.01",min:"0",style:{border:"none",outline:"none","font-size":"11px","font-weight":"600","font-family":"monospace",width:"60px","text-align":"right",background:"transparent",color:"#1e293b"},onFocus:t[3]||(t[3]=p=>{p.target.parentElement.style.borderColor="#6366f1",p.target.parentElement.style.boxShadow="0 0 0 2px rgba(99, 102, 241, 0.1)"}),onBlur:t[4]||(t[4]=p=>{p.target.parentElement.style.borderColor="#d1d5db",p.target.parentElement.style.boxShadow="none"})},null,40,oh),[[ue,n.amount]])])])],4))),128))])])])]),l(" =========================================== "),l(" COMPACT FOOTER "),l(" =========================================== "),a("div",ih,[a("button",{style:{display:"flex","align-items":"center",gap:"4px",padding:"6px 12px","border-radius":"6px","font-size":"12px","font-weight":"500",cursor:"pointer",border:"1px solid #cbd5e1",background:"#f1f5f9",color:"#475569"},onClick:t[5]||(t[5]=(...n)=>e.go_desk&&e.go_desk(...n)),onMouseenter:t[6]||(t[6]=n=>{n.currentTarget.style.background="#e2e8f0",n.currentTarget.style.borderColor="#94a3b8",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[7]||(t[7]=n=>{n.currentTarget.style.background="#f1f5f9",n.currentTarget.style.borderColor="#cbd5e1",n.currentTarget.style.boxShadow=""})},[nh,l(" Cancel "),P(" \u0625\u0644\u063A\u0627\u0621 ")],32),e.isOpeningAllowed?(g(),m("button",{key:0,style:k([{display:"flex","align-items":"center",gap:"4px",padding:"6px 12px","border-radius":"6px","font-size":"12px","font-weight":"500",cursor:"pointer",border:"1px solid #10b981",background:"#10b981",color:"white"},{opacity:e.is_loading?.6:1}]),disabled:e.is_loading,onClick:t[8]||(t[8]=(...n)=>e.submit_dialog&&e.submit_dialog(...n)),onMouseenter:t[9]||(t[9]=n=>{e.is_loading||(n.currentTarget.style.background="#059669",n.currentTarget.style.borderColor="#047857",n.currentTarget.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)")}),onMouseleave:t[10]||(t[10]=n=>{e.is_loading||(n.currentTarget.style.background="#10b981",n.currentTarget.style.borderColor="#10b981",n.currentTarget.style.boxShadow="")})},[e.is_loading?(g(),m("i",ah)):(g(),m("i",rh)),l(" Creating... / Confirm "),P(" "+x(e.is_loading?"\u062C\u0627\u0631\u064A \u0627\u0644\u0625\u0646\u0634\u0627\u0621...":"\u062A\u0623\u0643\u064A\u062F"),1)],44,sh)):(g(),m("div",lh,x(e.openingTimeMessage),1))])])])):l("v-if",!0)])],2112)}Ri.render=da;Ri.__file="../posawesome/posawesome/public/js/posapp/components/pos/OpeningDialog.vue";var pa=Ri;var Mi={name:"OpenShiftsWarning",props:{isOpen:{type:Boolean,required:!0,default:!1},shifts:{type:Array,required:!0,default:()=>[]}},methods:{formatDateTime(e){if(!e)return"";try{return new Date(e).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return e}},getShiftUrl(e){return`/app/pos-opening-shift/${encodeURIComponent(e)}`},handleClose(){window.location.href="/app"},handleRefresh(){window.location.reload()}}};var ch={style:{display:"flex","justify-content":"center","align-items":"center"}},dh={style:{background:"linear-gradient(135deg, #ff6f00 0%, #ff9800 100%)",padding:"12px 16px",display:"flex","align-items":"center","justify-content":"space-between","box-shadow":"0 2px 8px rgba(255, 152, 0, 0.3)",position:"relative",overflow:"hidden"}},ph=a("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[a("div",{style:{width:"28px",height:"28px",background:"rgba(255, 255, 255, 0.2)","border-radius":"6px",display:"flex","align-items":"center","justify-content":"center"}},[a("i",{class:"mdi mdi-alert-circle",style:{color:"white","font-size":"18px"}})]),a("h3",{style:{margin:"0","font-size":"16px","font-weight":"700",color:"white","text-shadow":"0 1px 2px rgba(0, 0, 0, 0.1)",position:"relative","z-index":"2"}}," Multiple Open Shifts ")],-1),fh=a("i",{class:"mdi mdi-close",style:{color:"white","font-size":"14px"}},null,-1),uh=[fh],_h={style:{padding:"12px",background:"#fafbfc"}},hh={style:{background:"#fff3e0","border-left":"3px solid #ff9800",padding:"10px 12px","border-radius":"6px","margin-bottom":"12px"}},gh={style:{margin:"0",color:"#e65100","font-weight":"500","font-size":"13px","line-height":"1.5"}},mh=a("i",{class:"mdi mdi-information",style:{"margin-right":"6px"}},null,-1),yh={style:{background:"white","border-radius":"8px",overflow:"hidden",border:"1px solid #e5e7eb","margin-bottom":"12px"}},bh={style:{width:"100%","border-collapse":"collapse"}},vh=a("thead",null,[a("tr",{style:{background:`linear-gradient(
                      to bottom,
                      #f9fafb 0%,
                      #f3f4f6 100%
                    )`}},[a("th",{style:{padding:"10px 12px","text-align":"left","font-size":"11px","font-weight":"600",color:"#6b7280","text-transform":"uppercase","letter-spacing":"0.5px","border-bottom":"1px solid #e5e7eb"}}," Shift ID "),a("th",{style:{padding:"10px 12px","text-align":"left","font-size":"11px","font-weight":"600",color:"#6b7280","text-transform":"uppercase","letter-spacing":"0.5px","border-bottom":"1px solid #e5e7eb"}}," POS Profile "),a("th",{style:{padding:"10px 12px","text-align":"left","font-size":"11px","font-weight":"600",color:"#6b7280","text-transform":"uppercase","letter-spacing":"0.5px","border-bottom":"1px solid #e5e7eb"}}," Started ")])],-1),xh={style:{padding:"10px 12px"}},wh=["href"],Eh=a("i",{class:"mdi mdi-open-in-new",style:{"font-size":"10px","margin-left":"4px"}},null,-1),Oh={style:{padding:"10px 12px",color:"#374151","font-size":"13px","font-weight":"500"}},Th={style:{padding:"10px 12px",color:"#6b7280","font-size":"12px"}},Sh={style:{padding:"12px",background:"white","border-top":"1px solid #e5e7eb",display:"flex",gap:"8px","justify-content":"flex-end"}},Ch=a("i",{class:"mdi mdi-arrow-left",style:{"margin-right":"4px"}},null,-1),Nh=a("i",{class:"mdi mdi-refresh",style:{"margin-right":"4px"}},null,-1);function fa(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" OPEN SHIFTS WARNING DIALOG "),l(" =========================================== "),a("div",ch,[e.isOpen?(g(),m("div",{key:0,style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.7)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"},onClick:t[6]||(t[6]=(...n)=>e.handleClose&&e.handleClose(...n))},[l(" Dialog Container "),a("div",{style:{background:"white","border-radius":"16px",overflow:"hidden","box-shadow":"0 20px 40px rgba(0, 0, 0, 0.15)","max-width":"600px",width:"100%",border:"1px solid rgba(255, 152, 0, 0.1)"},onClick:t[5]||(t[5]=we(()=>{},["stop"]))},[l(" =========================================== "),l(" HEADER (\u0645\u0637\u0627\u0628\u0642 \u0644\u0646\u0627\u0641\u0630\u0629 \u0641\u062A\u062D \u0627\u0644\u0648\u0631\u062F\u064A\u0629) "),l(" =========================================== "),a("div",dh,[ph,a("button",{style:{background:"rgba(255, 255, 255, 0.15)",border:"none","border-radius":"4px",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"},onClick:t[0]||(t[0]=(...n)=>e.handleClose&&e.handleClose(...n))},uh)]),l(" =========================================== "),l(" CONTENT (\u0645\u0637\u0627\u0628\u0642 \u0644\u0646\u0627\u0641\u0630\u0629 \u0641\u062A\u062D \u0627\u0644\u0648\u0631\u062F\u064A\u0629) "),l(" =========================================== "),a("div",_h,[l(" Warning Message "),a("div",hh,[a("p",gh,[mh,l(" You have X open shift(s). Please close these shifts before opening a new one. "),P(" \u0644\u062F\u064A\u0643 "+x(e.shifts.length)+" \u0648\u0631\u062F\u064A\u0629 \u0645\u0641\u062A\u0648\u062D\u0629. \u064A\u0631\u062C\u0649 \u0625\u063A\u0644\u0627\u0642 \u0647\u0630\u0647 \u0627\u0644\u0648\u0631\u062F\u064A\u0627\u062A \u0642\u0628\u0644 \u0641\u062A\u062D \u0648\u0631\u062F\u064A\u0629 \u062C\u062F\u064A\u062F\u0629. ",1)])]),l(" Shifts Table "),a("div",yh,[a("table",bh,[vh,a("tbody",null,[(g(!0),m(V,null,ae(e.shifts,(n,c)=>(g(),m("tr",{key:n.name,style:k({background:c%2===0?"white":"#f9fafb",borderBottom:c<e.shifts.length-1?"1px solid #f3f4f6":"none"})},[a("td",xh,[a("a",{href:e.getShiftUrl(n.name),target:"_blank",style:{color:"#3b82f6","font-weight":"600","font-size":"12px","font-family":"'Courier New', monospace","text-decoration":"none"}},[P(x(n.name)+" ",1),Eh],8,wh)]),a("td",Oh,x(n.pos_profile),1),a("td",Th,x(e.formatDateTime(n.period_start_date)),1)],4))),128))])])])]),l(" =========================================== "),l(" FOOTER (\u0645\u0637\u0627\u0628\u0642 \u0644\u0646\u0627\u0641\u0630\u0629 \u0641\u062A\u062D \u0627\u0644\u0648\u0631\u062F\u064A\u0629) "),l(" =========================================== "),a("div",Sh,[a("button",{onClick:t[1]||(t[1]=(...n)=>e.handleClose&&e.handleClose(...n)),style:{background:"#f3f4f6",color:"#374151",border:"1px solid #d1d5db",padding:"8px 16px","border-radius":"6px","font-size":"13px","font-weight":"500",cursor:"pointer"}},[Ch,P(" Go to Desk ")]),a("button",{onClick:t[2]||(t[2]=(...n)=>e.handleRefresh&&e.handleRefresh(...n)),style:{background:"linear-gradient(135deg, #ff6f00 0%, #ff9800 100%)",color:"white",border:"none",padding:"8px 16px","border-radius":"6px","font-size":"13px","font-weight":"600",cursor:"pointer","box-shadow":"0 2px 4px rgba(255, 152, 0, 0.2)"},onMouseenter:t[3]||(t[3]=n=>{n.target.style.background="#ff9800",n.target.style.borderColor="#f57c00",n.target.style.boxShadow="0 2px 4px rgba(0, 0, 0, 0.1)"}),onMouseleave:t[4]||(t[4]=n=>{n.target.style.background="linear-gradient(135deg, #ff6f00 0%, #ff9800 100%)",n.target.style.borderColor="",n.target.style.boxShadow="0 2px 4px rgba(255, 152, 0, 0.2)"})},[Nh,P(" Refresh Page ")],32)])])])):l("v-if",!0)])],2112)}Mi.render=fa;Mi.__file="../posawesome/posawesome/public/js/posapp/components/pos/OpenShiftsWarning.vue";var ua=Mi;var se={SHOW_PAYMENT:"show_payment",SET_CUSTOMER_READONLY:"set_customer_readonly",SHOW_MESSAGE:"show_mesage",SET_LAST_INVOICE:"set_last_invoice",NEW_INVOICE:"new_invoice",INVOICE_SUBMITTED:"invoice_submitted",PAYMENTS_UPDATED:"payments_updated",FREEZE:"freeze",UNFREEZE:"unfreeze",OPEN_EDIT_CUSTOMER:"open_edit_customer",OPEN_NEW_ADDRESS:"open_new_address",TOGGLE_QUICK_RETURN:"toggle_quick_return",SEND_INVOICE_DOC_PAYMENT:"send_invoice_doc_payment",REGISTER_POS_PROFILE:"register_pos_profile",ADD_THE_NEW_ADDRESS:"add_the_new_address",UPDATE_CUSTOMER:"update_customer",SET_POS_SETTINGS:"set_pos_settings",SET_CUSTOMER_INFO_TO_EDIT:"set_customer_info_to_edit",UPDATE_DUE_DATE:"update_due_date",POSA_USE_CUSTOMER_CREDIT_SWITCH_CHANGED:"posa_use_customer_credit_switch_changed"},Vi={mixins:[Re],data(){return{loading:!1,phone_dialog:!1,pos_profile:"",pos_settings:"",invoice_doc:null,customer:"",customer_info:"",loyalty_amount:0,redeem_customer_credit:!1,is_credit_sale:!1,is_return:!1,quick_return:!1,posa_use_customer_credit_switch:!1,is_write_off_change:0,customer_credit_dict:[],is_cashback:!0,addresses:[],change_amount_rules:[],selected_return_payment_idx:null,set_full_amount_timeouts:{},saved_payments_before_credit_sale:null,is_original_invoice_unpaid:!1,customer_outstanding_balance:0,customer_outstanding_currency:null}},computed:{min_date(){return typeof frappe!="undefined"&&frappe.datetime?frappe.datetime.now_date():new Date().toISOString().split("T")[0]},paid_amount(){var t;if(!this.invoice_doc)return 0;let e=parseFloat(this.invoice_doc.loyalty_amount||0);return(t=this.invoice_doc)!=null&&t.payments&&this.invoice_doc.payments.forEach(o=>{e+=this.flt(o.amount||0,2)}),e+=this.flt(this.redeemed_customer_credit||0,2),flt(e,2)},outstanding_amount(){if(!this.invoice_doc)return 0;let e=flt(this.invoice_doc.grand_total,2),t=flt(this.invoice_doc.write_off_amount||0,2),o=flt(e-this.paid_amount-t,2);return o>0?o:0},change_amount(){var i,s,r,n,c,p;if(!this.invoice_doc)return 0;let e=parseFloat(this.invoice_doc.loyalty_amount||0);(i=this.invoice_doc)!=null&&i.payments&&this.invoice_doc.payments.forEach(f=>{e+=this.flt(f.amount||0,2)}),e+=this.flt(this.redeemed_customer_credit||0,2),e=flt(e,2);let t=flt(this.invoice_doc.grand_total,2),o=(s=this.pos_profile)==null?void 0:s.posa_cash_mode_of_payment;if(e>t)if(o){let f=(n=(r=this.invoice_doc)==null?void 0:r.payments)==null?void 0:n.find(y=>y.mode_of_payment===o),_=((p=(c=this.invoice_doc)==null?void 0:c.payments)==null?void 0:p.filter(y=>y.mode_of_payment!==o).reduce((y,A)=>y+this.flt(A.amount||0,2),0))||0,b=flt(flt(this.invoice_doc.loyalty_amount||0,2)+flt(this.redeemed_customer_credit||0,2)+_,2);return f&&this.flt(f.amount||0)>0&&b<=t?flt(e-t,2):0}else return flt(e-t,2);return 0},total_payments(){return this.paid_amount},diff_payment(){return this.change_amount>0?-this.change_amount:this.outstanding_amount},available_pioints_amount(){var e;return(e=this.customer_info)!=null&&e.loyalty_points?this.customer_info.loyalty_points:0},available_customer_credit(){return this.customer_credit_dict.reduce((e,t)=>e+t.total_credit,0)},redeemed_customer_credit(){return this.customer_credit_dict.reduce((e,t)=>{let o=flt(t.credit_to_redeem);return o||(t.credit_to_redeem=0),e+o},0)},vaildatPayment(){return!this.invoice_doc||!this.invoice_doc.payments},request_payment_field(){var e,t;return((t=(e=this.invoice_doc)==null?void 0:e.payments)==null?void 0:t.some(o=>o.type==="Phone"))||!1},customer_outstanding_display(){return flt(this.customer_outstanding_balance||0)}},methods:{showMessage(e,t){d.emit(se.SHOW_MESSAGE,{text:e,color:t})},emitPrintRequest(){this.$emit("request-print")},exposeSubmit(e=!0,t=!1){this.submit(void 0,t,e)},autoPayWithDefault(e){this.invoice_doc=e;let t=this.getDefaultPayment();if(t){let o=flt(e.grand_total,2);t.amount=o}this.exposeSubmit(!0,!0)},getDefaultPayment(){var t;let e=Array.isArray((t=this.invoice_doc)==null?void 0:t.payments)?this.invoice_doc.payments:[];return e.find(o=>o.default==1)||e[0]||null},back_to_invoice(){d.emit(se.SHOW_PAYMENT,"false"),d.emit(se.SET_CUSTOMER_READONLY,!1)},async submit(e,t=!1,o=!1){var i;e&&typeof e.preventDefault=="function"&&e.preventDefault();try{await this.refreshInvoiceDoc()}catch(s){console.log("[Payments.js] submit error:",(s==null?void 0:s.message)||s)}if(((i=this.invoice_doc)==null?void 0:i.docstatus)===1){o&&this.load_print_page(),d.emit(se.SET_LAST_INVOICE,this.invoice_doc.name),d.emit(se.NEW_INVOICE,"false"),this.back_to_invoice();return}if(t){let s=this.getDefaultPayment();if(!s){this.showMessage("No default payment method in POS profile","error");return}let r=flt(this.invoice_doc.grand_total,2);s.amount=r}this.submit_invoice(o,t)},submit_invoice(e,t,o=!1){var b,y,A,G;if(this.quick_return){this.invoice_doc.is_return=1;let C=0;this.invoice_doc.items.forEach(N=>{N.qty=-1*Math.abs(N.qty),N.stock_qty=-1*Math.abs(N.stock_qty||N.qty),N.amount=-1*Math.abs(N.amount),N.net_amount=-1*Math.abs(N.net_amount||N.amount),C+=N.amount}),this.invoice_doc.total=C,this.invoice_doc.net_total=C,this.invoice_doc.grand_total=C,this.invoice_doc.base_total=C,this.invoice_doc.base_net_total=C,this.invoice_doc.base_grand_total=C,typeof this.selected_return_payment_idx=="number"?this.invoice_doc.payments.forEach(N=>{N.amount=N.idx===this.selected_return_payment_idx?C:0}):((b=this.invoice_doc.payments)==null?void 0:b.length)>0&&(this.invoice_doc.payments[0].amount=C),this.quick_return=!1}let i=0;this.invoice_doc.payments.forEach(C=>{C.amount=flt(C.amount,2),i+=C.amount});let s=flt(this.invoice_doc.grand_total,2),r=flt(i+flt(this.invoice_doc.loyalty_amount||0,2)+flt(this.redeemed_customer_credit||0,2),2);this.invoice_doc.is_return&&i==0&&(this.invoice_doc.is_pos=0),this.customer_credit_dict.length&&this.customer_credit_dict.forEach(C=>{C.credit_to_redeem=flt(C.credit_to_redeem)});let n=0;(y=this.invoice_doc)!=null&&y.payments&&this.invoice_doc.payments.forEach(C=>{n+=flt(C.amount||0)}),n+=flt(this.invoice_doc.loyalty_amount||0),n+=flt(this.redeemed_customer_credit||0),this.invoice_doc.paid_amount=flt(n,2);let c=flt(this.invoice_doc.grand_total,2),p=((G=(A=this.invoice_doc)==null?void 0:A.payments)==null?void 0:G.some(C=>C.type==="Cash"))||!1,f=!this.invoice_doc.is_return&&n>c&&p?flt(n-c,2):0;this.invoice_doc.change_amount=f;let _={redeemed_customer_credit:this.redeemed_customer_credit,customer_credit_dict:this.customer_credit_dict};if(t){this.load_print_page(),d.emit(se.NEW_INVOICE,"false"),this.back_to_invoice();return}frappe.call({method:X.SALES_INVOICE.SUBMIT,args:{data:_,invoice:{name:this.invoice_doc.name,customer:this.invoice_doc.customer,is_return:this.invoice_doc.is_return,is_pos:this.invoice_doc.is_pos,payments:this.invoice_doc.payments,loyalty_amount:this.invoice_doc.loyalty_amount,redeem_loyalty_points:this.invoice_doc.redeem_loyalty_points,loyalty_points:this.invoice_doc.loyalty_points,write_off_amount:this.invoice_doc.write_off_amount,write_off_outstanding_amount_automatically:this.invoice_doc.write_off_outstanding_amount_automatically,contact_mobile:this.invoice_doc.contact_mobile,contact_person:this.invoice_doc.contact_person,contact_email:this.invoice_doc.contact_email,due_date:this.invoice_doc.due_date,is_credit_sale:this.is_credit_sale||0,delivery_date:this.invoice_doc.delivery_date,address_display:this.invoice_doc.address_display,shipping_address_name:this.invoice_doc.shipping_address_name,customer_address:this.invoice_doc.customer_address,shipping_address:this.invoice_doc.shipping_address}},async:!0,callback:C=>{C.message?(e&&this.load_print_page(),d.emit(se.SET_LAST_INVOICE,this.invoice_doc.name),this.addresses=[],d.emit(se.NEW_INVOICE,"false"),d.emit(se.INVOICE_SUBMITTED),this.back_to_invoice()):this.showMessage("Failed to submit invoice","error")},error:C=>{let N=(C==null?void 0:C.message)||"",Q=typeof N=="string"&&N.includes("Document has been modified");!o&&Q?this.refreshInvoiceDoc().then(()=>{this.submit_invoice(e,t,!0)}).catch(E=>{console.log("[Payments.js] refreshInvoiceDoc error:",(E==null?void 0:E.message)||E),this.showMessage("Invoice was modified elsewhere, please try again","error")}):this.showMessage((C==null?void 0:C.message)||"Failed to submit invoice","error")}})},refreshInvoiceDoc(){var o;if(!((o=this.invoice_doc)!=null&&o.name))return Promise.resolve();let e=this.invoice_doc.docstatus===0,t=e&&this.invoice_doc.payments?this.invoice_doc.payments.map(i=>ve({},i)):[];return new Promise((i,s)=>{frappe.call({method:X.FRAPPE.CLIENT_GET,args:{doctype:"Sales Invoice",name:this.invoice_doc.name},async:!0,callback:r=>{var n;if(r.message){let c=r.message;if(e&&c.docstatus===0){let p=(c.payments||[]).map(_=>{let b=t.find(y=>y.idx!==void 0&&_.idx!==void 0?_.idx===y.idx:_.mode_of_payment===y.mode_of_payment);return b?Ce(ve({},_),{amount:b.amount}):_}),f=new Set(p.map(_=>`${_.mode_of_payment||""}__${_.idx||""}`));t.forEach(_=>{let b=`${_.mode_of_payment||""}__${_.idx||""}`;!f.has(b)&&flt(_.amount)&&p.push(_)}),c.payments=p}if(this.invoice_doc=c,this.invoice_doc&&!this.invoice_doc.is_return&&this.invoice_doc.docstatus===0){let p=(n=this.invoice_doc.payments)==null?void 0:n.find(f=>f.default==1);if(p){let f=flt(this.invoice_doc.grand_total,2);p.amount=f,p.base_amount!==void 0&&(p.base_amount=f)}}i()}else s(new Error("Failed to refresh invoice"))},error:r=>s(r)})})},set_full_amount(e){try{this.set_full_amount_timeouts[e]&&(clearTimeout(this.set_full_amount_timeouts[e]),delete this.set_full_amount_timeouts[e]),this.set_full_amount_timeouts[e]=setTimeout(()=>{if(this.posa_use_customer_credit_switch){delete this.set_full_amount_timeouts[e];return}let t=!!this.quick_return,o=this.invoice_doc.payments.find(n=>n.idx==e);if(!o){delete this.set_full_amount_timeouts[e];return}this.invoice_doc.payments.forEach(n=>{n.idx!==e&&(n.amount=0,n.base_amount!==void 0&&(n.base_amount=0))});let s=flt(this.invoice_doc.grand_total,2),r=t?-Math.abs(s):s;o.amount=r,o.base_amount!==void 0&&(o.base_amount=o.amount),this.$nextTick(()=>{this.validate_payment_amount(o)}),d.emit(se.PAYMENTS_UPDATED,JSON.parse(JSON.stringify(this.invoice_doc.payments))),this.$nextTick(()=>{this.$forceUpdate()}),delete this.set_full_amount_timeouts[e]},150)}catch(t){console.log("[Payments.js] set_full_amount error:",(t==null?void 0:t.message)||t),this.set_full_amount_timeouts[e]&&delete this.set_full_amount_timeouts[e]}},set_rest_amount(e){var t,o;try{if(this.posa_use_customer_credit_switch)return;let i=!!this.quick_return,s=flt(this.invoice_doc.grand_total,2),r=this.invoice_doc.payments.find(b=>b.idx===e);if(!r)return;let n=((t=this.invoice_doc.payments)==null?void 0:t.filter(b=>b.idx!==e).reduce((b,y)=>b+flt(y.amount||0,2),0))||0,c=flt(flt(this.invoice_doc.loyalty_amount||0,2)+flt(this.redeemed_customer_credit||0,2)+n,2),p=flt(s-c,2),f=(o=this.pos_profile)==null?void 0:o.posa_cash_mode_of_payment,_=p;if(f&&r.mode_of_payment!==f)if(i){let b=Math.abs(p),y=Math.abs(s);_=b<=y?p:-Math.abs(s)}else _=p>0?p:0;else _=p;i&&_>0&&(_=-Math.abs(_)),r.amount=_,r.base_amount!==void 0&&(r.base_amount=r.amount),this.$nextTick(()=>{this.validate_payment_amount(r)}),d.emit(se.PAYMENTS_UPDATED,JSON.parse(JSON.stringify(this.invoice_doc.payments))),this.$nextTick(()=>{this.$forceUpdate()})}catch(i){console.log("[Payments.js] set_rest_amount error:",(i==null?void 0:i.message)||i)}},clear_all_amounts(){this.invoice_doc.payments.forEach(e=>{e.amount=0})},load_print_page(){let e=this.pos_profile.print_format_for_online||this.pos_profile.posa_print_format,t=this.pos_profile.letter_head||0,o=`${frappe.urllib.get_base_url()}/printview?doctype=Sales%20Invoice&name=${this.invoice_doc.name}&trigger_print=1&format=${e}&no_letterhead=${t}`,i=window.open(o,"Print");i.addEventListener("load",function(){i.print(),setTimeout(()=>i.close(),1e3)},!0)},validate_due_date(){let e=frappe.datetime.now_date(),t=Date.parse(e);Date.parse(this.invoice_doc.due_date)<t&&setTimeout(()=>{this.invoice_doc.due_date=e},0)},shortPay(e){e.key==="x"&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.submit())},set_change_amount(){this.change_amount_rules=[]},handlePaymentAmountChange(e,t){if(this.posa_use_customer_credit_switch)return;let o=0;try{let i=t.target.value.toString().replace(/,/g,""),s=parseFloat(i);isNaN(s)||(o=s),this.quick_return&&o>0&&(o=-Math.abs(o)),e.amount=o,e.base_amount!==void 0&&(e.base_amount=e.amount),d.emit(se.PAYMENTS_UPDATED,JSON.parse(JSON.stringify(this.invoice_doc.payments))),this.$nextTick(()=>{this.$forceUpdate()})}catch(i){console.log("[Payments.js] handlePaymentAmountChange error:",(i==null?void 0:i.message)||i),e.amount=0}},validate_payment_amount(e){return d.emit("payment_amount_changed"),this.$nextTick(()=>{this.$forceUpdate()}),!0},get_available_credit(e){if(this.clear_all_amounts(),!e){this.customer_credit_dict=[];return}frappe.call({method:X.CUSTOMER.GET_CUSTOMER_CREDIT,args:{customer_id:this.invoice_doc.customer,company:this.pos_profile.company},callback:t=>{let o=t.message;if(!(o!=null&&o.length)){this.customer_credit_dict=[];return}let s=this.invoice_doc.grand_total;o.forEach(r=>{s>0?(r.credit_to_redeem=s>=r.total_credit?r.total_credit:s,s-=r.credit_to_redeem):r.credit_to_redeem=0}),this.customer_credit_dict=o}})},get_addresses(){var t;let e=((t=this.invoice_doc)==null?void 0:t.customer)||this.customer;if(!e){this.addresses=[];return}frappe.call({method:X.CUSTOMER.GET_ADDRESSES,args:{customer_id:e},async:!0,callback:o=>{this.addresses=o.exc?[]:o.message}})},get_customer_outstanding_balance(){var o,i;let e=((o=this.invoice_doc)==null?void 0:o.customer)||this.customer,t=(i=this.pos_profile)==null?void 0:i.company;if(!e){this.customer_outstanding_balance=0,this.customer_outstanding_currency=null;return}frappe.call({method:X.CUSTOMER.GET_CUSTOMER_OUTSTANDING_BALANCE,args:{customer_id:e,company:t},async:!0,callback:s=>{if(s.exc){this.customer_outstanding_balance=0,this.customer_outstanding_currency=null;return}let r=s.message||{};this.customer_outstanding_balance=this.flt(r.total_outstanding||0,this.currency_precision),this.customer_outstanding_currency=r.currency||null}})},addressFilter(e,t){let o=t.toLowerCase();return[e.address_title,e.address_line1,e.address_line2,e.city,e.name].some(s=>s==null?void 0:s.toLowerCase().includes(o))},new_address(){d.emit(se.OPEN_NEW_ADDRESS,this.invoice_doc.customer)},request_payment(){if(this.phone_dialog=!1,!this.invoice_doc.contact_mobile){this.showMessage("Please enter customer phone number","error"),d.emit(se.OPEN_EDIT_CUSTOMER),this.back_to_invoice();return}d.emit(se.FREEZE,{title:"Please wait for payment..."}),this.invoice_doc.payments.forEach(e=>{e.amount=flt(e.amount,2)}),d.emit(se.UNFREEZE)}},mounted(){this.$nextTick(()=>{d.on(se.TOGGLE_QUICK_RETURN,e=>{this.quick_return=e}),d.on(se.SEND_INVOICE_DOC_PAYMENT,e=>{var o;this.invoice_doc=e,this.posa_use_customer_credit_switch=!1,Array.isArray(this.invoice_doc.payments)?this.invoice_doc.payments.forEach((i,s)=>{i.idx||(i.idx=s+1)}):(this.showMessage("No payments array in invoice document","error"),this.invoice_doc.payments=[]);let t=this.invoice_doc.payments.find(i=>i.default==1);if(this.is_credit_sale=e.is_credit_sale||!1,this.is_credit_sale&&!e.due_date)if(typeof frappe!="undefined"&&frappe.datetime)this.invoice_doc.due_date=frappe.datetime.now_date();else{let i=new Date;this.invoice_doc.due_date=i.toISOString().split("T")[0]}if(this.saved_payments_before_credit_sale=null,this.is_write_off_change=0,this.is_original_invoice_unpaid=!1,e!=null&&e.customer&&this.get_customer_outstanding_balance(),t&&!e.is_return){let i=flt(e.grand_total,2);t.amount=i,t.base_amount!==void 0&&(t.base_amount=i)}if(e.is_return){this.is_return=!0,this.quick_return=!0;let i=e.grand_total,s=Math.abs(i);e.payments.forEach(c=>{c.amount=0,c.base_amount!==void 0&&(c.base_amount=0)}),this.is_original_invoice_unpaid=!1;let r=0,n=((o=this.pos_profile)==null?void 0:o.posa_use_customer_credit)==1;if(e._original_invoice_payment_info){let c=e._original_invoice_payment_info,p=Math.abs(this.flt(c.paid_amount||0,2)),f=Math.abs(this.flt(c.grand_total||0,2));if(p<=.01)this.is_original_invoice_unpaid=!0,r=0;else if(f>0){let _=p/f;r=s*_,this.is_original_invoice_unpaid=!1}else this.is_original_invoice_unpaid=!0,r=0}else this.is_original_invoice_unpaid=!0,r=0;if(this.posa_use_customer_credit_switch=!1,t&&r>.01&&!this.posa_use_customer_credit_switch){let c=-flt(r,2);t.amount=c,t.base_amount!==void 0&&(t.base_amount=c)}}else this.quick_return=!1;this.loyalty_amount=0,this.get_addresses()}),d.on(se.REGISTER_POS_PROFILE,e=>{var t;this.pos_profile=e.pos_profile,(t=e.pos_profile)!=null&&t.customer&&(this.customer=e.pos_profile.customer,this.get_addresses())}),d.on(se.ADD_THE_NEW_ADDRESS,e=>{this.addresses.push(e),this.$forceUpdate()})}),d.on(se.UPDATE_CUSTOMER,e=>{this.customer!=e&&(this.customer_credit_dict=[],this.redeem_customer_credit=!1,this.is_cashback=!0),this.customer=e,e&&this.get_customer_outstanding_balance()}),d.on(se.SET_POS_SETTINGS,e=>{this.pos_settings=e}),d.on(se.SET_CUSTOMER_INFO_TO_EDIT,e=>{this.customer_info=e}),d.on(se.UPDATE_DUE_DATE,e=>{this.invoice_doc&&(this.invoice_doc.due_date=e)})},created(){document.addEventListener("keydown",this.shortPay.bind(this))},beforeUnmount(){Object.keys(this.set_full_amount_timeouts||{}).forEach(t=>{this.set_full_amount_timeouts[t]&&clearTimeout(this.set_full_amount_timeouts[t])}),this.set_full_amount_timeouts={},[se.TOGGLE_QUICK_RETURN,se.SEND_INVOICE_DOC_PAYMENT,se.REGISTER_POS_PROFILE,se.ADD_THE_NEW_ADDRESS,se.UPDATE_CUSTOMER,se.SET_POS_SETTINGS,se.SET_CUSTOMER_INFO_TO_EDIT,se.UPDATE_DUE_DATE,"update_delivery_date"].forEach(t=>d.$off(t))},destroyed(){document.removeEventListener("keydown",this.shortPay)},watch:{loyalty_amount(e){e>this.available_pioints_amount?(this.invoice_doc.loyalty_amount=0,this.invoice_doc.redeem_loyalty_points=0,this.invoice_doc.loyalty_points=0,this.showMessage(`Cannot enter points greater than available balance ${this.available_pioints_amount}`,"error")):(this.invoice_doc.loyalty_amount=this.flt(this.loyalty_amount),this.invoice_doc.redeem_loyalty_points=1,this.invoice_doc.loyalty_points=this.flt(this.loyalty_amount))},is_credit_sale(e){if(!!this.invoice_doc){if(this.invoice_doc.is_credit_sale=!!e,d.emit(se.POSA_USE_CUSTOMER_CREDIT_SWITCH_CHANGED,e),e){if(!this.invoice_doc.due_date)if(typeof frappe!="undefined"&&frappe.datetime)this.invoice_doc.due_date=frappe.datetime.now_date();else{let t=new Date;this.invoice_doc.due_date=t.toISOString().split("T")[0]}Array.isArray(this.invoice_doc.payments)&&(this.saved_payments_before_credit_sale=JSON.parse(JSON.stringify(this.invoice_doc.payments)),this.invoice_doc.payments.forEach(t=>{t.amount=0,t.base_amount!==void 0&&(t.base_amount=0)}))}else if(Array.isArray(this.invoice_doc.payments))if(this.saved_payments_before_credit_sale)this.invoice_doc.payments.forEach((t,o)=>{let i=this.saved_payments_before_credit_sale.find(s=>s.idx===t.idx||s.name===t.name);i&&(t.amount=i.amount||0,t.base_amount!==void 0&&i.base_amount!==void 0&&(t.base_amount=i.base_amount))}),this.saved_payments_before_credit_sale=null;else{let t=this.flt(this.invoice_doc.grand_total,2);this.invoice_doc.payments.forEach(o=>{o.mode_of_payment&&o.mode_of_payment.toLowerCase()==="cash"&&(o.amount=t,o.base_amount!==void 0&&(o.base_amount=o.amount))})}this.$nextTick(()=>{this.$forceUpdate()})}},is_write_off_change(e){e==1?(this.invoice_doc.write_off_amount=this.outstanding_amount,this.invoice_doc.write_off_outstanding_amount_automatically=1):(this.invoice_doc.write_off_amount=0,this.invoice_doc.write_off_outstanding_amount_automatically=0)},"invoice_doc.payments":{handler(){this.$nextTick(()=>{this.$forceUpdate()})},deep:!0},redeemed_customer_credit(e){e>this.available_customer_credit&&this.showMessage(`Customer credit can be redeemed up to ${this.available_customer_credit}`,"error")},posa_use_customer_credit_switch(e){if(!(!this.invoice_doc||!this.invoice_doc.is_return)){if(e===!0)this.invoice_doc.payments&&(this.invoice_doc.payments.forEach(t=>{t.amount=0,t.base_amount!==void 0&&(t.base_amount=0)}),d.emit(se.PAYMENTS_UPDATED,JSON.parse(JSON.stringify(this.invoice_doc.payments))));else if(this.invoice_doc.payments&&this.invoice_doc.payments.length>0){let t=Math.abs(this.flt(this.invoice_doc.grand_total||0,2)),o=this.invoice_doc.payments[0];if(o){o.amount=t,o.base_amount!==void 0&&(o.base_amount=t);for(let i=1;i<this.invoice_doc.payments.length;i++)this.invoice_doc.payments[i].amount=0,this.invoice_doc.payments[i].base_amount!==void 0&&(this.invoice_doc.payments[i].base_amount=0);d.emit(se.PAYMENTS_UPDATED,JSON.parse(JSON.stringify(this.invoice_doc.payments)))}}d.emit(se.POSA_USE_CUSTOMER_CREDIT_SWITCH_CHANGED,e),this.$nextTick(()=>{this.$forceUpdate()})}}}};var kh={style:{width:"100%",height:"100%",position:"relative"}},Dh=a("i",{class:"mdi mdi-arrow-left",style:{color:"white","font-size":"18px"}},null,-1),Ih=a("span",null,"\u0631\u062C\u0648\u0639",-1),Ph={style:{"max-height":"76vh",height:"76vh",background:"linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%)","border-radius":"6px","box-shadow":"0 2px 6px rgba(0, 0, 0, 0.08)",overflow:"hidden",position:"relative"}},Ah={key:0,style:{position:"absolute",top:"0",left:"0",right:"0",height:"4px",background:"#e0e0e0",overflow:"hidden","z-index":"10"}},Rh=a("div",{style:{height:"100%",background:"#1976d2","transform-origin":"0% 50%"}},null,-1),Mh=[Rh],Vh={style:{"max-height":"75vh","overflow-y":"auto","overflow-x":"hidden",padding:"6px"}},Lh={key:0,style:{display:"flex","flex-direction":"column",gap:"3px","margin-bottom":"2px"}},Uh={style:{display:"flex",gap:"3px","align-items":"flex-start"}},Fh={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},zh=a("label",{style:{"font-size":"0.75rem","font-weight":"700",color:"#555","text-transform":"uppercase","letter-spacing":"0.5px",margin:"0",padding:"2px 4px","line-height":"1.2","text-align":"center",display:"block"}}," \u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u062F\u0641\u0648\u0639\u0627\u062A ",-1),jh={style:{display:"flex","align-items":"center","justify-content":"center",padding:"12px 8px","border-radius":"4px",border:"1.5px solid #4caf50",background:"linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)","min-height":"45px","box-shadow":"0 1px 3px rgba(76, 175, 80, 0.2)"}},$h={style:{"font-size":"1.1rem","font-weight":"800",color:"#2e7d32","text-align":"center",width:"100%",display:"block","letter-spacing":"0.3px"}},Bh={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},Hh=a("label",{style:{"font-size":"0.75rem","font-weight":"700",color:"#555","text-transform":"uppercase","letter-spacing":"0.5px",margin:"0",padding:"2px 4px","line-height":"1.2","text-align":"center",display:"block"}}," \u0627\u0644\u0645\u062A\u0628\u0642\u064A \u0644\u0644\u0639\u0645\u064A\u0644 ",-1),Gh={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},qh=a("label",{style:{"font-size":"0.75rem","font-weight":"700",color:"#555","text-transform":"uppercase","letter-spacing":"0.5px",margin:"0",padding:"2px 4px","line-height":"1.2","text-align":"center",display:"block"}}," \u0627\u0644\u0645\u062A\u0628\u0642\u064A \u0644\u0644\u062F\u0641\u0639 \u0644\u0627\u062D\u0642\u0627 ",-1),Wh={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},Kh=a("label",{style:{"font-size":"0.75rem","font-weight":"700",color:"#555","text-transform":"uppercase","letter-spacing":"0.5px",margin:"0",padding:"2px 4px","line-height":"1.2","text-align":"center",display:"block"}}," \u0631\u0635\u064A\u062F \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0645\u062A\u0623\u062E\u0631 ",-1),Yh=a("div",{style:{height:"1px",background:`linear-gradient(
							90deg,
							transparent 0%,
							#e0e0e0 50%,
							transparent 100%
						)`,margin:"4px 0"}},null,-1),Qh={key:1,style:{display:"flex","flex-direction":"column",gap:"3px",margin:"2px 0"}},Jh={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},Xh=a("label",{style:{"font-size":"0.6rem","font-weight":"600",color:"#666","text-transform":"uppercase","letter-spacing":"0.3px",margin:"0",padding:"0 2px","line-height":"1"}},[l(" Amount "),P(" \u0627\u0644\u0645\u0628\u0644\u063A ")],-1),Zh=["id","value","onChange","onFocus","onClick","readonly","disabled"],eg=["id","disabled","onClick"],tg=["disabled","onClick"],og={key:2,style:{margin:"3px 0"}},ig={style:{display:"flex",gap:"3px","align-items":"flex-start"}},ng={style:{flex:"1.4",display:"flex","flex-direction":"column",gap:"2px"}},sg=a("label",{style:{"font-size":"0.6rem","font-weight":"600",color:"#666","text-transform":"uppercase","letter-spacing":"0.3px",margin:"0",padding:"0 2px","line-height":"1"}},[l(" Pay from Customer Points "),P(" \u0627\u0644\u062F\u0641\u0639 \u0645\u0646 \u0646\u0642\u0627\u0637 \u0627\u0644\u0639\u0645\u064A\u0644 ")],-1),rg={style:{display:"flex","align-items":"center",background:"white",border:"1px solid #1976d2","border-radius":"3px",padding:"1px 4px","min-height":"22px"}},ag={style:{"font-size":"0.6rem","font-weight":"600",color:"#1976d2","margin-right":"3px","flex-shrink":"0"}},lg={style:{flex:"1",display:"flex","flex-direction":"column",gap:"2px"}},cg=a("label",{style:{"font-size":"0.6rem","font-weight":"600",color:"#666","text-transform":"uppercase","letter-spacing":"0.3px",margin:"0",padding:"0 2px","line-height":"1"}},[l(" Customer Points Balance "),P(" \u0631\u0635\u064A\u062F \u0646\u0642\u0627\u0637 \u0627\u0644\u0639\u0645\u064A\u0644 ")],-1),dg={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"3px 6px","border-radius":"3px",border:"1px solid #bdbdbd",background:"linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)","min-height":"22px",opacity:"0.8"}},pg={style:{"font-size":"0.6rem","font-weight":"600",color:"#666","margin-right":"3px"}},fg={style:{"font-size":"0.7rem","font-weight":"700",color:"#757575",flex:"1","text-align":"right"}},ug=a("div",{style:{height:"1px",background:`linear-gradient(
							90deg,
							transparent 0%,
							#e0e0e0 50%,
							transparent 100%
						)`,margin:"4px 0"}},null,-1),_g={style:{display:"flex",gap:"4px",margin:"3px 0",padding:"4px",background:"linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%)","border-radius":"4px","flex-wrap":"wrap"}},hg={key:0,style:{flex:"1 1 calc(50% - 2px)","min-width":"130px"}},gg={style:{display:"flex","align-items":"center",cursor:"pointer","user-select":"none",gap:"12px"}},mg={style:{position:"relative",display:"inline-block",width:"44px",height:"24px",background:"#ccc","border-radius":"24px","flex-shrink":"0"}},yg={key:0,style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",background:"#1976d2","border-radius":"24px","pointer-events":"none"}},bg=a("span",{style:{"font-size":"0.85rem",color:"#333","font-weight":"500"}},[l(" Is Credit Sale? "),P(" \u0647\u0644 \u0647\u0648 \u0628\u064A\u0639 \u0622\u062C\u0644\u061F ")],-1),vg={key:1,style:{flex:"1 1 calc(50% - 2px)","min-width":"130px"}},xg={style:{display:"flex","align-items":"center",cursor:"pointer","user-select":"none",gap:"12px"}},wg={style:{position:"relative",display:"inline-block",width:"44px",height:"24px",background:"#ccc","border-radius":"24px","flex-shrink":"0"}},Eg={key:0,style:{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",background:"#9c27b0","border-radius":"24px","pointer-events":"none"}},Og=a("span",{style:{"font-size":"0.85rem",color:"#333","font-weight":"500"}},[l(" Return from Customer Credit "),P(" \u0625\u0631\u062C\u0627\u0639 \u0645\u0646 \u062D\u0633\u0627\u0628 \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0622\u062C\u0644 ")],-1),Tg={key:2,style:{flex:"1 1 calc(50% - 2px)","min-width":"130px",display:"flex","flex-direction":"column",gap:"2px"}},Sg=a("label",{style:{"font-size":"0.6rem","font-weight":"600",color:"#666","text-transform":"uppercase","letter-spacing":"0.3px",margin:"0",padding:"0 2px","line-height":"1"}},[l(" Due Date "),P(" \u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0627\u0633\u062A\u062D\u0642\u0627\u0642 ")],-1),Cg={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},Ng=["min"],kg=a("div",{style:{height:"1px",background:`linear-gradient(
							90deg,
							transparent 0%,
							#e0e0e0 50%,
							transparent 100%
						)`,margin:"4px 0"}},null,-1),Dg={style:{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},Ig={style:{padding:"16px","border-bottom":"1px solid #e0e0e0",background:"#f5f5f5",position:"relative"}},Pg=a("span",{style:{"font-size":"1.5rem","font-weight":"700",color:"#1976d2"}},[l(" Confirm Phone Number "),P(" \u062A\u0623\u0643\u064A\u062F \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 ")],-1),Ag={style:{padding:"16px"}},Rg={style:{padding:"0"}},Mg={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},Vg=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" Phone Number "),P(" \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641 ")],-1),Lg={style:{display:"flex","align-items":"center","justify-content":"flex-end",gap:"8px",padding:"16px","border-top":"1px solid #e0e0e0"}},Ug=a("div",{style:{flex:"1"}},null,-1);function _a(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" COMPACT PAYMENTS COMPONENT "),l(" =========================================== "),a("div",kh,[l(" Fixed Back Button "),a("button",{style:{position:"absolute",bottom:"12px",right:"12px","z-index":"1001",display:"flex","align-items":"center",gap:"4px",height:"26px",padding:"0 10px",background:"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)",color:"white",border:"none","border-radius":"4px","font-size":"0.7rem","font-weight":"600",cursor:"pointer","box-shadow":"0 2px 6px rgba(25, 118, 210, 0.3)","text-transform":"uppercase","letter-spacing":"0.3px","white-space":"nowrap","line-height":"1"},onClick:t[0]||(t[0]=(...n)=>e.back_to_invoice&&e.back_to_invoice(...n)),title:"\u0631\u062C\u0648\u0639 \u0625\u0644\u0649 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629"},[Dh,l(" Back "),Ih]),a("div",Ph,[l(" Loading Progress "),e.loading?(g(),m("div",Ah,Mh)):l("v-if",!0),a("div",Vh,[l(" =========================================== "),l(" PAYMENT SUMMARY SECTION "),l(" =========================================== "),e.invoice_doc?(g(),m("div",Lh,[l(" Summary Row 1: Four Separate Fields "),a("div",Uh,[l(" paid_amount: \u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0645\u062F\u0641\u0648\u0639\u0627\u062A "),a("div",Fh,[zh,a("div",jh,[a("span",$h,x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):"")+x(e.formatCurrency(e.paid_amount)),1)])]),l(" change_amount: \u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062A\u0628\u0642\u064A \u0644\u0644\u0639\u0645\u064A\u0644 "),a("div",Bh,[Hh,a("div",{style:k({display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 8px",borderRadius:"4px",border:e.change_amount>0?"1.5px solid #4caf50":"1.5px solid #e0e0e0",background:e.change_amount>0?"linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%)":"linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)",minHeight:"45px",boxShadow:e.change_amount>0?"0 1px 3px rgba(76, 175, 80, 0.2)":"0 1px 3px rgba(0, 0, 0, 0.1)"})},[a("span",{style:k({fontSize:"1.1rem",fontWeight:"800",color:e.change_amount>0?"#2e7d32":"#9e9e9e",textAlign:"center",width:"100%",display:"block",letterSpacing:"0.3px"})},x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):"")+x(e.formatCurrency(e.change_amount)),5)],4)]),l(" outstanding_amount: \u0627\u0644\u0645\u0628\u0644\u063A \u0627\u0644\u0645\u062A\u0623\u062E\u0631 \u0639\u0644\u0649 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 "),a("div",Gh,[qh,a("div",{style:k({display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 8px",borderRadius:"4px",border:e.outstanding_amount>0?"1.5px solid #ff9800":"1.5px solid #e0e0e0",background:e.outstanding_amount>0?"linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%)":"linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)",minHeight:"45px",boxShadow:e.outstanding_amount>0?"0 1px 3px rgba(255, 152, 0, 0.3)":"0 1px 3px rgba(0, 0, 0, 0.1)"})},[a("span",{style:k({fontSize:"1.1rem",fontWeight:"800",color:e.outstanding_amount>0?"#e65100":"#9e9e9e",textAlign:"center",width:"100%",display:"block",letterSpacing:"0.3px"})},x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):"")+x(e.formatCurrency(e.outstanding_amount)),5)],4)]),l(" customer_outstanding_display: \u0631\u0635\u064A\u062F \u0627\u0644\u0639\u0645\u064A\u0644 \u0627\u0644\u0645\u062A\u0623\u062E\u0631 "),a("div",Wh,[Kh,a("div",{style:k({display:"flex",alignItems:"center",justifyContent:"center",padding:"12px 8px",borderRadius:"4px",border:e.customer_outstanding_display>0?"1.5px solid #d32f2f":"1.5px solid #e0e0e0",background:e.customer_outstanding_display>0?"linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%)":"linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)",minHeight:"45px",boxShadow:e.customer_outstanding_display>0?"0 1px 3px rgba(211, 47, 47, 0.3)":"0 1px 3px rgba(0, 0, 0, 0.1)"})},[a("span",{style:k({fontSize:"1.1rem",fontWeight:"800",color:e.customer_outstanding_display>0?"#c62828":"#9e9e9e",textAlign:"center",width:"100%",display:"block",letterSpacing:"0.3px"})},x(e.invoice_doc&&e.customer_outstanding_currency?e.currencySymbol(e.customer_outstanding_currency):e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):"")+x(e.formatCurrency(e.customer_outstanding_display)),5)],4)])])])):l("v-if",!0),l(" Section Divider "),Yh,l(" =========================================== "),l(" PAYMENT METHODS SECTION "),l(" =========================================== "),e.invoice_doc&&e.invoice_doc.payments&&Array.isArray(e.invoice_doc.payments)?(g(),m("div",Qh,[(g(!0),m(V,null,ae(e.invoice_doc.payments,n=>(g(),m("div",{key:n.name,style:{display:"flex",gap:"3px","align-items":"flex-end"}},[l(" Amount Input "),a("div",Jh,[Xh,a("div",{style:k(e.is_credit_sale?{display:"flex",alignItems:"center",background:"#f5f5f5",border:"1px solid #e0e0e0",borderRadius:"3px",padding:"1px 4px",minHeight:"22px",opacity:"0.6"}:{display:"flex",alignItems:"center",background:"white",border:"1px solid #1976d2",borderRadius:"3px",padding:"1px 4px",minHeight:"22px"})},[a("span",{style:k(e.is_credit_sale?{fontSize:"0.6rem",fontWeight:"600",color:"#9e9e9e",marginRight:"3px",flexShrink:"0"}:{fontSize:"0.6rem",fontWeight:"600",color:"#1976d2",marginRight:"3px",flexShrink:"0"})},x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):""),5),a("input",{id:`mode_of_payment_input_${n.idx||0}`,ref_for:!0,ref:`mode_of_payment_input_${n.idx||0}`,type:"text",value:n.amount||"",onChange:c=>{e.posa_use_customer_credit_switch||(e.handlePaymentAmountChange(n,c),e.validate_payment_amount(n))},onFocus:c=>{e.posa_use_customer_credit_switch||e.set_rest_amount(n.idx)},onClick:c=>{e.posa_use_customer_credit_switch||e.set_rest_amount(n.idx)},readonly:e.invoice_doc&&e.invoice_doc.is_return&&!e.quick_return||e.posa_use_customer_credit_switch,disabled:e.posa_use_customer_credit_switch,placeholder:"0.00",style:k(e.posa_use_customer_credit_switch?{flex:"1",border:"none",outline:"none",background:"transparent",fontSize:"0.7rem",fontWeight:"700",color:"#9e9e9e",textAlign:"right",padding:"1px",minWidth:"0",lineHeight:"1.2",cursor:"not-allowed"}:{flex:"1",border:"none",outline:"none",background:"transparent",fontSize:"0.7rem",fontWeight:"700",color:"#1976d2",textAlign:"right",padding:"1px",minWidth:"0",lineHeight:"1.2"})},null,44,Zh)],4)]),l(" Payment Method Button "),a("button",{id:`mode_of_payment_button_${n.idx||0}`,ref_for:!0,ref:`mode_of_payment_button_${n.idx||0}`,disabled:e.posa_use_customer_credit_switch,style:k(e.posa_use_customer_credit_switch?{flex:n.type=="Phone"&&n.amount>0&&e.request_payment_field?"0.7":"1",height:"22px",border:"none",borderRadius:"3px",background:"linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%)",color:"#9e9e9e",fontSize:"0.65rem",fontWeight:"600",cursor:"not-allowed",boxShadow:"none",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",padding:"0 4px",opacity:"0.6"}:{flex:n.type=="Phone"&&n.amount>0&&e.request_payment_field?"0.7":"1",height:"22px",border:"none",borderRadius:"3px",background:"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)",color:"white",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 1px 2px rgba(25, 118, 210, 0.25)",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",padding:"0 4px"}),onClick:we(c=>{e.posa_use_customer_credit_switch||e.set_full_amount(n.idx)},["stop"])},x(n.mode_of_payment),13,eg),l(" Request Button (for Phone) "),n.type=="Phone"&&n.amount>0&&e.request_payment_field?(g(),m("button",{key:0,disabled:n.amount==0||e.is_credit_sale,onClick:c=>{e.is_credit_sale||(e.phone_dialog=!0,n.amount=e.flt(n.amount,0))},style:k(e.is_credit_sale||n.amount==0?{flex:"0.4",height:"22px",border:"none",borderRadius:"3px",background:"linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%)",color:"#9e9e9e",fontSize:"0.65rem",fontWeight:"600",cursor:"not-allowed",boxShadow:"none",opacity:"0.6"}:{flex:"0.4",height:"22px",border:"none",borderRadius:"3px",background:"linear-gradient(135deg, #4caf50 0%, #388e3c 100%)",color:"white",fontSize:"0.65rem",fontWeight:"600",cursor:"pointer",boxShadow:"0 1px 2px rgba(76, 175, 80, 0.25)"})},[l(" Request "),P(" \u0637\u0644\u0628 ")],12,tg)):l("v-if",!0)]))),128))])):l("v-if",!0),l(" =========================================== "),l(" LOYALTY POINTS SECTION "),l(" =========================================== "),e.invoice_doc&&e.available_pioints_amount>0&&!e.invoice_doc.is_return?(g(),m("div",og,[a("div",ig,[l(" Pay from Customer Points "),a("div",ng,[sg,a("div",rg,[a("span",ag,x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):""),1),ee(a("input",{type:"number","onUpdate:modelValue":t[1]||(t[1]=n=>e.loyalty_amount=n),placeholder:"0.00",style:{flex:"1",border:"none",outline:"none",background:"transparent","font-size":"0.7rem","font-weight":"700",color:"#1976d2","text-align":"right",padding:"1px","min-width":"0","line-height":"1.2"}},null,512),[[ue,e.loyalty_amount]])])]),l(" Customer Points Balance "),a("div",lg,[cg,a("div",dg,[a("span",pg,x(e.invoice_doc?e.currencySymbol(e.invoice_doc.currency):""),1),a("span",fg,x(e.formatFloat(e.available_pioints_amount)),1)])])])])):l("v-if",!0),l(" Section Divider "),ug,l(" =========================================== "),l(" OPTIONS SECTION (SWITCHES) "),l(" =========================================== "),a("div",_g,[l(" Credit Sale Switch "),e.pos_profile&&e.pos_profile.posa_allow_credit_sale&&e.invoice_doc&&!e.invoice_doc.is_return?(g(),m("div",hg,[a("label",gg,[ee(a("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=n=>e.is_credit_sale=n),style:{position:"absolute",opacity:"0",width:"0",height:"0"}},null,512),[[Uo,e.is_credit_sale]]),a("span",mg,[a("span",{style:k([{content:"''",position:"absolute",height:"18px",width:"18px",left:"3px",bottom:"3px",background:"white","border-radius":"50%","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.2)"},e.is_credit_sale?"transform: translateX(20px); background: white":""])},null,4),e.is_credit_sale?(g(),m("span",yg)):l("v-if",!0)]),bg])])):l("v-if",!0),l(" Return from Customer Credit Switch "),e.invoice_doc&&e.invoice_doc.is_return&&e.pos_profile&&e.pos_profile.posa_use_customer_credit==1?(g(),m("div",vg,[a("label",xg,[ee(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=n=>e.posa_use_customer_credit_switch=n),style:{position:"absolute",opacity:"0",width:"0",height:"0"}},null,512),[[Uo,e.posa_use_customer_credit_switch]]),a("span",wg,[a("span",{style:k([{content:"''",position:"absolute",height:"18px",width:"18px",left:"3px",bottom:"3px",background:"white","border-radius":"50%","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.2)"},e.posa_use_customer_credit_switch?"transform: translateX(20px); background: white":""])},null,4),e.posa_use_customer_credit_switch?(g(),m("span",Eg)):l("v-if",!0)]),Og])])):l("v-if",!0),l(" Due Date Field "),e.is_credit_sale?(g(),m("div",Tg,[Sg,a("div",Cg,[ee(a("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=n=>e.invoice_doc.due_date=n),min:e.min_date,placeholder:"Select date",style:{width:"100%",padding:"8px 12px","font-size":"0.85rem",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none",cursor:"pointer"}},null,8,Ng),[[ue,e.invoice_doc.due_date]])])])):l("v-if",!0)]),l(" Section Divider "),kg])]),l(" =========================================== "),l(" PHONE DIALOG "),l(" =========================================== "),e.phone_dialog?(g(),m("div",{key:0,style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"},onClick:t[10]||(t[10]=n=>e.phone_dialog=!1)},[a("div",{style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"400px",width:"90%","max-height":"90vh",overflow:"hidden"},onClick:t[9]||(t[9]=we(()=>{},["stop"]))},[a("div",Dg,[l(" Card Header "),a("div",Ig,[Pg,a("button",{onClick:t[5]||(t[5]=n=>e.phone_dialog=!1),style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none","font-size":"1.5rem",color:"#999",cursor:"pointer",width:"32px",height:"32px",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}}," \xD7 ")]),l(" Card Body "),a("div",Ag,[a("div",Rg,[a("div",Mg,[Vg,ee(a("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=n=>e.invoice_doc.contact_mobile=n),placeholder:"\u0623\u062F\u062E\u0644 \u0631\u0642\u0645 \u0627\u0644\u0647\u0627\u062A\u0641",style:{width:"100%",padding:"8px 12px","font-size":"0.85rem",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.invoice_doc.contact_mobile]])])])]),l(" Card Footer "),a("div",Lg,[Ug,a("button",{onClick:t[7]||(t[7]=n=>e.phone_dialog=!1),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #d32f2f","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #f44336 0%, #e53935 100%)",color:"white"}},[l(" Close "),P(" \u0625\u063A\u0644\u0627\u0642 ")]),a("button",{onClick:t[8]||(t[8]=(...n)=>e.request_payment&&e.request_payment(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #1565c0","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #1976d2 0%, #1e88e5 100%)",color:"white"}},[l(" Request "),P(" \u0637\u0644\u0628 ")])])])])])):l("v-if",!0)])],2112)}Vi.render=_a;Vi.__file="../posawesome/posawesome/public/js/posapp/components/pos/Payments.vue";var ha=Vi;var Me={SHOW_OFFERS:"show_offers",SHOW_MESSAGE:"show_mesage",UPDATE_INVOICE_OFFERS:"update_invoice_offers",UPDATE_OFFERS_COUNTERS:"update_offers_counters",REGISTER_POS_PROFILE:"register_pos_profile",UPDATE_CUSTOMER:"update_customer",SET_OFFERS:"set_offers",UPDATE_POS_OFFERS:"update_pos_offers",UPDATE_DISCOUNT_PERCENTAGE_OFFER_NAME:"update_discount_percentage_offer_name",SET_ALL_ITEMS:"set_all_items"},Hn={GRAND_TOTAL:"Grand Total",GIVE_PRODUCT:"Give Product"},ga={ITEM_CODE:"Item Code",ITEM_GROUP:"Item Group"},Fg=[{title:"\u0627\u0644\u0627\u0633\u0645",key:"name",align:"start"},{title:"\u064A\u0637\u0628\u0642 \u0639\u0644\u0649",key:"apply_on",align:"start"},{title:"\u0627\u0644\u0639\u0631\u0636",key:"offer",align:"start"},{title:"\u0645\u0637\u0628\u0642",key:"offer_applied",align:"start"}],Li={mixins:[Re],data(){return{loading:!1,pos_profile:"",pos_offers:[],allItems:[],discount_percentage_offer_name:null,itemsPerPage:1e3,expanded:[],singleExpand:!0,items_headers:Fg}},computed:{offersEnabled(){var o;let e=(o=this.pos_profile)==null?void 0:o.posa_auto_fetch_offers;return e!==0&&e!=="0"&&e!==!1&&e!==null&&e!==void 0},offersCount(){return this.pos_offers.length},appliedOffersCount(){return this.pos_offers.filter(e=>e.offer_applied).length}},methods:{back_to_invoice(){d.emit(Me.SHOW_OFFERS,"false")},handleOfferToggle(){this.pos_offers=[...this.pos_offers],this.handleManualOfferChange()},toggleOffer(e){if(this.isOfferDisabled(e))return;this.handleOfferToggle();let t=Ce(ve({},e),{name:e.name||e.offer_name,offer_name:e.offer_name||e.name,offer_type:e.offer_type||this.inferOfferType(e)});e.offer_applied?this.$emit("offerApplied",t):this.$emit("offerRemoved",t)},inferOfferType(e){return e.item_code?"item_code":e.item_group?"item_group":e.brand?"brand":e.customer?"customer":e.customer_group?"customer_group":(e.offer==="Grand Total"||e.apply_on==="Grand Total","grand_total")},isOfferDisabled(e){return Boolean(e.offer_type==="Give Product"&&!e.give_item&&(!e.replace_cheapest_item||!e.replace_item)||e.offer_type==="Grand Total"&&this.discount_percentage_offer_name&&this.discount_percentage_offer_name!==e.name)},truncateName(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},handleImageError(e){e.target.src="/assets/posawesome/js/posapp/components/pos/placeholder-image.png"},handleManualOfferChange(){try{let e=this.pos_offers.filter(t=>t.offer===Hn.GRAND_TOTAL&&t.offer_applied);e.length>1?this.applyBestGrandTotalOffer():e.length===1?(this.discount_percentage_offer_name=e[0].name,this.pos_offers.forEach(t=>{t.offer===Hn.GRAND_TOTAL&&t.name!==e[0].name&&(t.offer_applied=!1)})):this.discount_percentage_offer_name=null}catch(e){console.log("[PosOffers.js] handleManualOfferChange error:",e),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u0645\u0639\u0627\u0644\u062C\u0629 \u062A\u063A\u064A\u064A\u0631 \u0627\u0644\u0639\u0631\u0636","error")}},makeid(e){let t="abcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},()=>t.charAt(Math.floor(Math.random()*t.length))).join("")},updatePosOffers(e){try{this.pos_offers.forEach(t=>{let o=t.offer_applied;t.offer_applied=e.some(i=>i.name===t.name||i.offer_name===t.name||i.name===t.title)})}catch(t){console.log("[PosOffers.js] updatePosOffers error:",t)}},applyBestGrandTotalOffer(){try{let e=this.pos_offers.filter(t=>t.offer===Hn.GRAND_TOTAL);if(e.length===0)return;e.length>1?(e.sort((t,o)=>{let i=parseFloat(t.discount_percentage||0);return parseFloat(o.discount_percentage||0)-i}),e.forEach(t=>t.offer_applied=!1),e[0].offer_applied=!0,this.discount_percentage_offer_name=e[0].name,this.showMessage("\u062A\u0645 \u062A\u0637\u0628\u064A\u0642 \u0623\u0641\u0636\u0644 \u0639\u0631\u0636: "+e[0].name,"success")):(e[0].offer_applied=!0,this.discount_percentage_offer_name=e[0].name)}catch(e){console.log("[PosOffers.js] applyBestOffer error:",e),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u062A\u0637\u0628\u064A\u0642 \u0623\u0641\u0636\u0644 \u0639\u0631\u0636","error")}},removeOffers(e){try{this.pos_offers=this.pos_offers.filter(t=>!e.includes(t.name||t.offer_name))}catch(t){console.log("[PosOffers.js] removeAllOffers error:",t),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u0625\u0632\u0627\u0644\u0629 \u0627\u0644\u0639\u0631\u0648\u0636","error")}},handelOffers(){try{let e=this.pos_offers.filter(t=>t.offer_applied);d.emit(Me.UPDATE_INVOICE_OFFERS,e)}catch(e){console.log("[PosOffers.js] processOffers error:",e),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u0639\u0631\u0648\u0636","error")}},handleNewLine(e){return e?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):""},get_give_items(e){try{if(e.apply_type===ga.ITEM_CODE)return[e.apply_item_code];if(e.apply_type===ga.ITEM_GROUP){let t=this.allItems.filter(o=>o.item_group===e.apply_item_group);return e.less_then>0&&(t=t.filter(o=>o.rate<e.less_then)),t}return[]}catch(t){return console.log("[PosOffers.js] getFreeItems error:",t),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u062C\u0644\u0628 \u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u0645\u062C\u0627\u0646\u064A\u0629","error"),[]}},updateCounters(){try{d.emit(Me.UPDATE_OFFERS_COUNTERS,{offersCount:this.offersCount,appliedOffersCount:this.appliedOffersCount})}catch(e){console.log("[PosOffers.js] updateCounters error:",e),this.showMessage("\u062E\u0637\u0623 \u0641\u064A \u062A\u062D\u062F\u064A\u062B \u0627\u0644\u0639\u062F\u0627\u062F\u0627\u062A","error")}},showMessage(e,t){d.emit(Me.SHOW_MESSAGE,{text:e,color:t})}},watch:{pos_offers:{deep:!0,handler(){this.handelOffers(),this.updateCounters()}}},created(){this.$nextTick(()=>{d.on(Me.REGISTER_POS_PROFILE,e=>{this.pos_profile=e.pos_profile}),d.on(Me.UPDATE_CUSTOMER,e=>{this.customer!==e&&(this.offers=[])}),d.on(Me.SET_OFFERS,e=>{this.pos_offers=e.map(t=>Ce(ve({},t),{offer_applied:!!t.auto}))}),d.on(Me.UPDATE_POS_OFFERS,e=>{this.updatePosOffers(e)}),d.on(Me.UPDATE_DISCOUNT_PERCENTAGE_OFFER_NAME,e=>{this.discount_percentage_offer_name=e.value}),d.on(Me.SET_ALL_ITEMS,e=>{this.allItems=e}),d.on("reset_manual_offers",()=>{this.pos_offers=this.pos_offers.map(e=>Ce(ve({},e),{offer_applied:!!e.auto}))})})},beforeDestroy(){d.$off(Me.REGISTER_POS_PROFILE),d.$off(Me.UPDATE_CUSTOMER),d.$off(Me.SET_OFFERS),d.$off(Me.UPDATE_POS_OFFERS),d.$off(Me.UPDATE_DISCOUNT_PERCENTAGE_OFFER_NAME),d.$off(Me.SET_ALL_ITEMS)}};var zg={key:0,style:{display:"flex","flex-direction":"column",height:"91vh",background:"#f8f9fa"}},jg={style:{background:"linear-gradient(135deg, #1976d2 0%, #1565c0 100%)",padding:"8px 12px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.15)","z-index":"10"}},$g={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Bg=a("div",{style:{display:"flex","align-items":"center",gap:"6px"}},[a("i",{class:"mdi mdi-tag-multiple",style:{color:"white","font-size":"22px"}}),a("h2",{style:{color:"white","font-size":"1rem","font-weight":"600",margin:"0","letter-spacing":"0.3px"}},[l(" Special Offers Total "),P(" \u0625\u062C\u0645\u0627\u0644\u064A \u0627\u0644\u0639\u0631\u0648\u0636 \u0627\u0644\u062E\u0627\u0635\u0629 ")])],-1),Hg={style:{display:"flex",gap:"6px"}},Gg={style:{background:"rgba(255, 255, 255, 0.2)","border-radius":"16px",padding:"3px 10px",display:"flex",gap:"6px","align-items":"center","min-width":"50px","backdrop-filter":"blur(10px)"}},qg=a("span",{style:{"font-size":"0.6rem",color:"rgba(255, 255, 255, 0.9)","text-transform":"uppercase","font-weight":"500","line-height":"1"}},[l(" Total "),P(" \u0627\u0644\u0625\u062C\u0645\u0627\u0644\u064A ")],-1),Wg={style:{"font-size":"0.6rem",color:"white","font-weight":"700","line-height":"1"}},Kg={style:{background:"rgba(76, 175, 80, 0.9)","border-radius":"16px",padding:"3px 10px",display:"flex",gap:"6px","align-items":"center","min-width":"50px"}},Yg=a("span",{style:{"font-size":"0.6rem",color:"rgba(255, 255, 255, 0.9)","text-transform":"uppercase","font-weight":"500","line-height":"1"}},[l(" Active "),P(" \u0645\u0641\u0639\u0644 ")],-1),Qg={style:{"font-size":"0.6rem",color:"white","font-weight":"700","line-height":"1"}},Jg={style:{flex:"1","overflow-y":"auto","overflow-x":"hidden",padding:"8px",display:"grid","grid-template-columns":"repeat(auto-fill, minmax(130px, 1fr))",gap:"8px","align-content":"start"}},Xg={style:{position:"relative",height:"70px",overflow:"hidden"}},Zg=["src"],em={style:{position:"absolute",bottom:"0",left:"0",right:"0",background:`linear-gradient(
                  to top,
                  rgba(0, 0, 0, 0.8),
                  transparent
                )`,padding:"4px 6px 3px"}},tm={style:{color:"white","font-size":"0.65rem","font-weight":"600","text-shadow":"0 1px 3px rgba(0, 0, 0, 0.5)","line-height":"1.2"}},om={key:0,style:{position:"absolute",top:"4px",right:"4px",background:"linear-gradient(135deg, #4caf50 0%, #45a049 100%)",color:"white",padding:"2px 6px","border-radius":"10px",display:"flex","align-items":"center",gap:"2px","font-size":"0.6rem","font-weight":"600","box-shadow":"0 2px 6px rgba(0, 0, 0, 0.3)"}},im=a("i",{class:"mdi mdi-check-circle",style:{color:"white","font-size":"14px"}},null,-1),nm=a("span",null,"\u0645\u0641\u0639\u0644",-1),sm={style:{padding:"6px",display:"flex","flex-direction":"column",gap:"5px",flex:"1"}},rm={style:{flex:"1"}},am={key:0,style:{display:"flex","align-items":"baseline",gap:"3px",padding:"3px 0"}},lm={style:{"font-size":"1.1rem","font-weight":"700",color:"#1976d2","line-height":"1"}},cm=a("span",{style:{"font-size":"0.6rem",color:"#666","text-transform":"uppercase","font-weight":"600","letter-spacing":"0.3px"}},[l(" OFF "),P(" \u062E\u0635\u0645 ")],-1),dm={key:1,style:{display:"flex","align-items":"baseline",gap:"3px",padding:"3px 0"}},pm={style:{"font-size":"1.1rem","font-weight":"700",color:"#1976d2","line-height":"1"}},fm=a("span",{style:{"font-size":"0.6rem",color:"#666","text-transform":"uppercase","font-weight":"600","letter-spacing":"0.3px"}},[l(" OFF "),P(" \u062E\u0635\u0645 ")],-1),um={key:2,style:{display:"flex","align-items":"center",gap:"4px",padding:"3px 0"}},_m=a("i",{class:"mdi mdi-gift",style:{color:"#4caf50","font-size":"18px"}},null,-1),hm=a("span",{style:{"font-size":"0.6rem",color:"#666","text-transform":"uppercase","font-weight":"600","letter-spacing":"0.3px"}},[l(" Special Offer "),P(" \u0639\u0631\u0636 \u062E\u0627\u0635 ")],-1),gm=[_m,hm],mm={key:0,style:{display:"flex","align-items":"center",gap:"3px",background:"rgba(255, 152, 0, 0.1)",padding:"3px 5px","border-radius":"4px","font-size":"0.6rem",color:"#f57c00","border-left":"2px solid #ff9800"}},ym=a("i",{class:"mdi mdi-alert-circle",style:{color:"#ff9800","font-size":"12px"}},null,-1),bm=a("span",null,"\u0639\u0631\u0636 \u0622\u062E\u0631 \u0646\u0634\u0637",-1),vm={style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"4px 0 0","border-top":"1px solid #f0f0f0"}},xm={style:{position:"relative",display:"inline-block",width:"32px",height:"16px","flex-shrink":"0"}},wm=["onUpdate:modelValue","onChange","disabled"],Em={style:{position:"absolute",cursor:"pointer",top:"0",left:"0",right:"0",bottom:"0","background-color":"#ccc","border-radius":"20px"}},Om={style:{"font-size":"0.65rem","font-weight":"600",color:"#666","margin-left":"8px"}},Tm={style:{padding:"8px 12px",background:"white","box-shadow":"0 -2px 8px rgba(0, 0, 0, 0.08)","z-index":"10"}},Sm=a("i",{class:"mdi mdi-arrow-left",style:{"font-size":"18px"}},null,-1),Cm=a("span",null,"\u0631\u062C\u0648\u0639 \u0625\u0644\u0649 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",-1),Nm={style:{display:"flex","flex-direction":"column",height:"91vh",background:"#f8f9fa","align-items":"center","justify-content":"center"}},km={style:{"text-align":"center",padding:"40px",background:"white","border-radius":"12px","box-shadow":"0 4px 20px rgba(0, 0, 0, 0.1)","max-width":"400px"}},Dm=a("i",{class:"mdi mdi-tag-off",style:{"font-size":"48px",color:"#ccc","margin-bottom":"16px"}},null,-1),Im=a("h3",{style:{color:"#666","margin-bottom":"8px","font-size":"1.2rem"}}," \u0627\u0644\u0639\u0631\u0648\u0636 \u063A\u064A\u0631 \u0645\u0641\u0639\u0644\u0629 ",-1),Pm=a("p",{style:{color:"#999","margin-bottom":"24px","font-size":"0.9rem"}}," \u062A\u0645 \u062A\u0639\u0637\u064A\u0644 \u0627\u0644\u0639\u0631\u0648\u0636 \u0641\u064A \u0625\u0639\u062F\u0627\u062F\u0627\u062A \u0645\u0644\u0641 \u0646\u0642\u0627\u0637 \u0627\u0644\u0628\u064A\u0639 ",-1),Am=a("i",{class:"mdi mdi-arrow-left",style:{"font-size":"18px"}},null,-1),Rm=a("span",null,"\u0631\u062C\u0648\u0639 \u0625\u0644\u0649 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",-1);function ma(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" POS OFFERS COMPONENT "),l(" =========================================== "),e.offersEnabled?(g(),m("div",zg,[l(" =========================================== "),l(" HEADER WITH STATS "),l(" =========================================== "),a("div",jg,[a("div",$g,[Bg,a("div",Hg,[l(" Total Badge "),a("div",Gg,[qg,a("span",Wg,x(e.offersCount),1)]),l(" Active Badge "),a("div",Kg,[Yg,a("span",Qg,x(e.appliedOffersCount),1)])])])]),l(" =========================================== "),l(" OFFERS GRID "),l(" =========================================== "),a("div",Jg,[(g(!0),m(V,null,ae(e.pos_offers,(n,c)=>(g(),m("div",{key:c,style:{display:"flex"}},[a("div",{style:k([{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.08)",cursor:"pointer",display:"flex","flex-direction":"column",width:"100%",border:"2px solid transparent"},n.offer_applied?"border-color: #4caf50; box-shadow: 0 4px 16px rgba(76, 175, 80, 0.3); background: linear-gradient(135deg, #ffffff 0%, #f1f8f4 100%)":""])},[l(" =========================================== "),l(" OFFER IMAGE WITH OVERLAY "),l(" =========================================== "),a("div",Xg,[a("img",{src:n.image||"/assets/posawesome/js/posapp/components/pos/placeholder-image.png",onError:t[0]||(t[0]=(...p)=>e.handleImageError&&e.handleImageError(...p)),style:{width:"100%",height:"100%","object-fit":"cover"}},null,40,Zg),l(" Image Overlay "),a("div",em,[a("div",tm,x(e.truncateName(n.name,15)),1)]),l(" Applied Badge "),n.offer_applied?(g(),m("div",om,[im,l(" Active "),nm])):l("v-if",!0)]),l(" =========================================== "),l(" OFFER CONTENT "),l(" =========================================== "),a("div",sm,[l(" Discount Info "),a("div",rm,[n.discount_percentage?(g(),m("div",am,[a("span",lm,x(n.discount_percentage)+"% ",1),cm])):n.discount_amount?(g(),m("div",dm,[a("span",pm,x(e.formatCurrency(n.discount_amount)),1),fm])):(g(),m("div",um,gm))]),l(" Warning Message "),n.offer_type==="Grand Total"&&!n.offer_applied&&e.discount_percentage_offer_name&&e.discount_percentage_offer_name!==n.name?(g(),m("div",mm,[ym,l(" Another offer active "),bm])):l("v-if",!0),l(" Apply Toggle "),a("div",vm,[a("label",xm,[ee(a("input",{type:"checkbox","onUpdate:modelValue":p=>n.offer_applied=p,onChange:p=>e.toggleOffer(n),disabled:e.isOfferDisabled(n),style:{opacity:"0",width:"0",height:"0"}},null,40,wm),[[Uo,n.offer_applied]]),a("span",Em,[a("span",{style:k([{position:"absolute",content:"''",height:"11px",width:"11px",left:"2.5px",bottom:"2.5px","background-color":"white","border-radius":"50%","box-shadow":"0 1px 3px rgba(0, 0, 0, 0.3)"},n.offer_applied?"transform: translateX(16px); background-color: white":""])},null,4)]),l(" Applied / Apply "),a("span",Om,x(n.offer_applied?"\u0645\u0637\u0628\u0642":"\u062A\u0637\u0628\u064A\u0642"),1)])])])],4)]))),128))]),l(" =========================================== "),l(" FOOTER "),l(" =========================================== "),a("div",Tm,[a("button",{onClick:t[1]||(t[1]=(...n)=>e.back_to_invoice&&e.back_to_invoice(...n)),style:{width:"100%",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white",border:"none","border-radius":"6px",padding:"6px","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"6px",cursor:"pointer","box-shadow":"0 2px 8px rgba(255, 152, 0, 0.3)"}},[Sm,l(" Back to Invoice "),Cm])])])):(g(),m(V,{key:1},[l(" =========================================== "),l(" OFFERS DISABLED MESSAGE "),l(" =========================================== "),a("div",Nm,[a("div",km,[Dm,l(" Offers Disabled "),Im,l(" Offers are disabled in POS Profile settings "),Pm,a("button",{onClick:t[2]||(t[2]=(...n)=>e.back_to_invoice&&e.back_to_invoice(...n)),style:{width:"100%",background:"linear-gradient(135deg, #ff9800 0%, #f57c00 100%)",color:"white",border:"none","border-radius":"6px",padding:"6px","font-size":"0.85rem","font-weight":"600",display:"flex","align-items":"center","justify-content":"center",gap:"6px",cursor:"pointer","box-shadow":"0 2px 8px rgba(255, 152, 0, 0.3)"}},[Am,l(" Back to Invoice "),Rm])])])],2112))],2112)}Li.render=ma;Li.__file="../posawesome/posawesome/public/js/posapp/components/pos/PosOffers.vue";var ya=Li;function Fo(e,t){if(e==null||e==="")return 0;let o=parseFloat(e);return isNaN(o)?0:t!==void 0?parseFloat(o.toFixed(t)):o}var _o={OPEN_CLOSING_DIALOG:"open_ClosingDialog",REGISTER_POS_PROFILE:"register_pos_profile",SUBMIT_CLOSING_POS:"submit_closing_pos",STOP_SHIFT_MONITORING:"stop_shift_monitoring"},ba={Cash:{icon:"mdi-cash",color:"#4CAF50"},Card:{icon:"mdi-credit-card",color:"#2196F3"},"Credit Card":{icon:"mdi-credit-card",color:"#2196F3"},"Debit Card":{icon:"mdi-credit-card-outline",color:"#FF9800"},"Bank Transfer":{icon:"mdi-bank-transfer",color:"#9C27B0"},"Mobile Payment":{icon:"mdi-cellphone",color:"#E91E63"},"Digital Wallet":{icon:"mdi-wallet",color:"#00BCD4"},Check:{icon:"mdi-checkbook",color:"#795548"},Voucher:{icon:"mdi-ticket",color:"#FF5722"}},Mm={icon:"mdi-currency-usd",color:"#607D8B"},zo={PAYMENT_METHOD:{title:"Payment Method",key:"mode_of_payment",align:"start",sortable:!0},SYSTEM_TOTAL:{title:"System Total",align:"end",sortable:!0,key:"opening_amount"},ACTUAL_COUNT:{title:"Actual Count",key:"closing_amount",align:"end",sortable:!0},EXPECTED_TOTAL:{title:"Expected Total",key:"expected_amount",align:"end",sortable:!1},DIFFERENCE:{title:"Difference",key:"difference",align:"end",sortable:!1}},Vm={MAX_CHARS:e=>e.length<=20||"Input too long!"},Ui={name:"ClosingDialog",mixins:[Re],setup(){let e=ge(!1),t=ge(20),o=ge({payment_reconciliation:[]}),i=ge(null),s=ge([zo.PAYMENT_METHOD,zo.SYSTEM_TOTAL,zo.ACTUAL_COUNT]),r=ge(!0),n=ge(""),c=Mn(()=>{if(!o.value.payment_reconciliation||!Array.isArray(o.value.payment_reconciliation))return!1;let N=o.value.payment_reconciliation.filter(Q=>Q.expected_amount&&Fo(Q.expected_amount)>0);return N.length===0?!1:N.every(Q=>{let E=Q.closing_amount;if(E==null||E===""||E===0)return!1;let U=parseFloat(E);return!isNaN(U)&&U>0})}),p=()=>{e.value=!1},f=async N=>{var W,M,le,ce,q,j;console.log("[ClosingDialog.js] ===== submit_dialog START ====="),console.log("[ClosingDialog.js] Event:",N),N&&(N.preventDefault(),N.stopPropagation(),console.log("[ClosingDialog.js] Prevented default event behavior"));let Q=o.value.pos_transactions?o.value.pos_transactions.length:0;console.log(`[ClosingDialog.js] Submitting shift: ${o.value.pos_opening_shift||"new"} transactions: ${Q}`);let E=((W=o.value)==null?void 0:W.pos_profile)||i.value;if(console.log("[ClosingDialog.js] currentPosProfile (initial):",E),console.log("[ClosingDialog.js] dialog_data.value?.pos_profile:",(M=o.value)==null?void 0:M.pos_profile),console.log("[ClosingDialog.js] pos_profile.value:",i.value),!E||typeof E=="string"||!E.posa_auto_print_closing_shift){let z=typeof E=="string"?E:(E==null?void 0:E.name)||((le=o.value)==null?void 0:le.pos_profile)||((ce=i.value)==null?void 0:ce.name);if(z){console.log("[ClosingDialog.js] Fetching full pos_profile from API:",z);try{E=(await frappe.call({method:"frappe.client.get",args:{doctype:"POS Profile",name:z}})).message,console.log("[ClosingDialog.js] Fetched pos_profile from API:",E),console.log("[ClosingDialog.js] posa_auto_print_closing_shift:",E==null?void 0:E.posa_auto_print_closing_shift)}catch(oe){console.error("[ClosingDialog.js] Error fetching pos_profile:",oe)}}}let U=(E==null?void 0:E.posa_auto_print_closing_shift)===1;console.log("[ClosingDialog.js] willAutoPrint:",U),console.log("[ClosingDialog.js] posa_auto_print_closing_shift:",E==null?void 0:E.posa_auto_print_closing_shift);try{console.log("[ClosingDialog.js] Calling API: SUBMIT_CLOSING_SHIFT");let z=await frappe.call({method:X.POS_CLOSING_SHIFT.SUBMIT_CLOSING_SHIFT,args:{closing_shift:o.value}});if(console.log("[ClosingDialog.js] API response received:",z),console.log("[ClosingDialog.js] response.message:",z.message),console.log("[ClosingDialog.js] response.message?.name:",(q=z.message)==null?void 0:q.name),(j=z.message)!=null&&j.name){console.log(`[ClosingDialog.js] submit_dialog success: ${z.message.name}`);let oe=E||i.value;if(console.log("[ClosingDialog.js] Using pos_profile for auto-print check:",oe),console.log("[ClosingDialog.js] currentPosProfile:",E),(oe==null?void 0:oe.posa_auto_print_closing_shift)===1&&z.message.name){console.log("[ClosingDialog.js] Auto-print condition met - preparing to print"),console.log("[ClosingDialog.js] Stopping Navbar.js shift monitoring..."),d.emit(_o.STOP_SHIFT_MONITORING),console.log("[ClosingDialog.js] STOP_SHIFT_MONITORING event emitted");let F=(oe==null?void 0:oe.posa_closing_shift_print_format)||"";console.log("[ClosingDialog.js] Print format:",F);let w=frappe.urllib.get_full_url(`/printview?doctype=POS%20Closing%20Shift&name=${z.message.name}&format=${F}&trigger_print=1&no_letterhead=0`);console.log("[ClosingDialog.js] Print URL:",w),console.log("[ClosingDialog.js] Opening print window...");let Ee=window.open(w);console.log("[ClosingDialog.js] printWindow object:",Ee),console.log("[ClosingDialog.js] Closing dialog..."),e.value=!1,console.log("[ClosingDialog.js] Dialog closed, closingDialog.value:",e.value),console.log("[ClosingDialog.js] ===== AFTER DIALOG CLOSED, BEFORE SETTIMEOUT ====="),console.log("[ClosingDialog.js] ===== BEFORE SETTIMEOUT ====="),console.log("[ClosingDialog.js] Setting timeout for page reload (3 seconds)...");let Ve=setTimeout(()=>{console.log("[ClosingDialog.js] ===== INSIDE SETTIMEOUT ====="),console.log("[ClosingDialog.js] Timeout fired - Reloading page after auto-print..."),window.clearCacheAndReload?(console.log("[ClosingDialog.js] Using clearCacheAndReload..."),window.clearCacheAndReload()):(console.log("[ClosingDialog.js] Using location.reload()..."),location.reload())},3e3);console.log("[ClosingDialog.js] ===== AFTER SETTIMEOUT ====="),console.log("[ClosingDialog.js] setTimeout ID:",Ve)}else console.log("[ClosingDialog.js] Auto-print NOT enabled - closing dialog and emitting event immediately"),e.value=!1,console.log("[ClosingDialog.js] Emitting SUBMIT_CLOSING_POS event (no auto-print)"),d.emit(_o.SUBMIT_CLOSING_POS,{success:!0,closing_shift_name:z.message.name}),console.log("[ClosingDialog.js] SUBMIT_CLOSING_POS event emitted");console.log("[ClosingDialog.js] ===== submit_dialog END (success) =====")}else frappe.show_alert({message:"\u0641\u0634\u0644 \u0625\u063A\u0644\u0627\u0642 \u0648\u0631\u062F\u064A\u0629 \u0627\u0644\u0635\u0631\u0627\u0641",indicator:"red"})}catch(z){console.error(`[ClosingDialog.js] submit_dialog error: ${z.message||z}`),console.error("[ClosingDialog.js] Error stack:",z.stack),console.log("[ClosingDialog.js] ===== submit_dialog END (error) ====="),frappe.show_alert({message:"\u0641\u0634\u0644 \u0625\u063A\u0644\u0627\u0642 \u0648\u0631\u062F\u064A\u0629 \u0627\u0644\u0635\u0631\u0627\u0641",indicator:"red"})}},_=N=>{let Q=Object.keys(ba).find(E=>N.toLowerCase().includes(E.toLowerCase()));return Q?ba[Q]:Mm},b=N=>N>0?"positive-diff":N<0?"negative-diff":"zero-diff",y=N=>{N&&(N.difference=Fo(N.closing_amount||0)-Fo(N.expected_amount||0))},A=()=>{var N;if(!((N=i.value)!=null&&N.name)){r.value=!0;return}frappe.call({method:X.POS_CLOSING_SHIFT.CHECK_CLOSING_TIME_ALLOWED,args:{pos_profile:i.value.name},callback:function(Q){Q.message?(r.value=Q.message.allowed,Q.message.allowed||(n.value=Q.message.message)):(r.value=!1,n.value="\u062E\u0637\u0623 \u0641\u064A \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0623\u0630\u0648\u0646\u0627\u062A \u0648\u0642\u062A \u0627\u0644\u0625\u063A\u0644\u0627\u0642")}})},G=N=>{let Q=N.pos_transactions?N.pos_transactions.length:0;console.log(`[ClosingDialog.js] Opening dialog shift: ${N.pos_opening_shift||"new"} transactions: ${Q}`),e.value=!0,N.payment_reconciliation&&Array.isArray(N.payment_reconciliation)&&N.payment_reconciliation.forEach(E=>{(!E.closing_amount||E.closing_amount===null||E.closing_amount===void 0)&&(E.closing_amount=0),E.editing===void 0&&(E.editing=!1),E.difference=Fo(E.closing_amount||0)-Fo(E.expected_amount||0)}),o.value=N,A()},C=N=>{i.value=N.pos_profile,i.value.posa_hide_expected_amount||(s.value.push(zo.EXPECTED_TOTAL),s.value.push(zo.DIFFERENCE))};return kt(()=>{d.on(_o.OPEN_CLOSING_DIALOG,G),d.on(_o.REGISTER_POS_PROFILE,C)}),Ao(()=>{d.off(_o.OPEN_CLOSING_DIALOG,G),d.off(_o.REGISTER_POS_PROFILE,C)}),{closingDialog:e,itemsPerPage:t,dialog_data:o,pos_profile:i,headers:s,isClosingAllowed:r,closingTimeMessage:n,max25chars:Vm.MAX_CHARS,isAllRequiredFieldsFilled:c,close_dialog:p,submit_dialog:f,getPaymentIcon:_,getDifferenceClass:b,updateDifference:y}}};var Lm={style:{display:"flex","justify-content":"center","align-items":"center"}},Um={style:{background:"linear-gradient(135deg, #ff6f00 0%, #ff9800 100%)",padding:"12px 16px",display:"flex","align-items":"center","justify-content":"space-between","box-shadow":"0 2px 8px rgba(255, 152, 0, 0.3)",position:"relative",overflow:"hidden"}},Fm=a("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[a("div",{style:{width:"28px",height:"28px",background:"rgba(255, 255, 255, 0.2)","border-radius":"6px",display:"flex","align-items":"center","justify-content":"center"}},[a("i",{class:"mdi mdi-cash-register",style:{color:"white","font-size":"20px"}})]),a("h3",{style:{margin:"0","font-size":"20px","font-weight":"700",color:"white","text-shadow":"0 1px 2px rgba(0, 0, 0, 0.1)",position:"relative","z-index":"2"}},[l(" Close POS "),P(" \u0625\u063A\u0644\u0627\u0642 \u0646\u0642\u0637\u0629 \u0627\u0644\u0628\u064A\u0639 ")])],-1),zm=a("i",{class:"mdi mdi-close",style:{color:"white","font-size":"14px"}},null,-1),jm=[zm],$m={key:0,style:{padding:"8px",background:"#fafbfc"}},Bm={style:{background:"white","border-radius":"8px",overflow:"hidden",border:"1px solid #e8eaed"}},Hm={style:{display:"grid","grid-template-columns":"2fr 1fr 1fr 1fr 1fr",background:"#f8fafc","border-bottom":"1px solid #e2e8f0"}},Gm=a("div",{style:{padding:"6px 8px","font-size":"12px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-start"}},[l(" Method "),P(" \u0637\u0631\u064A\u0642\u0629 \u0627\u0644\u062F\u0641\u0639 ")],-1),qm=a("div",{style:{padding:"6px 8px","font-size":"12px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-end"}},[l(" System "),P(" \u0627\u0644\u0627\u0641\u062A\u062A\u0627\u062D\u064A ")],-1),Wm=a("div",{style:{padding:"6px 8px","font-size":"12px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-end"}},[l(" Actual "),P(" \u0627\u0644\u0641\u0639\u0644\u064A ")],-1),Km={key:0,style:{padding:"6px 8px","font-size":"12px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-end"}},Ym={key:1,style:{padding:"6px 8px","font-size":"12px","font-weight":"600",color:"#475569","text-transform":"uppercase",display:"flex","align-items":"center","justify-content":"flex-end"}},Qm={style:{padding:"4px 8px",display:"flex","align-items":"center","justify-content":"flex-start","font-size":"14px","min-height":"32px"}},Jm={style:{display:"flex","align-items":"center",gap:"6px"}},Xm=a("i",{class:"mdi mdi-cash-multiple",style:{"font-size":"16px",color:"#ff6f00","flex-shrink":"0"}},null,-1),Zm={style:{"font-weight":"500",color:"#334155","font-size":"13px","white-space":"nowrap"}},e0={style:{padding:"4px 8px",display:"flex","align-items":"center","justify-content":"flex-end","font-size":"14px","min-height":"32px"}},t0={style:{"font-weight":"600",color:"#1e293b","font-size":"13px","font-family":"monospace"}},o0={style:{padding:"4px 8px",display:"flex","align-items":"center","justify-content":"flex-end","font-size":"14px","min-height":"32px"}},i0={key:0,style:{background:"#f0f9ff",border:"1px solid #6366f1","border-radius":"4px",padding:"4px 8px","font-size":"13px","font-weight":"600","font-family":"monospace",width:"100px","text-align":"right",outline:"none"}},n0=["onUpdate:modelValue","required","onInput","onBlur","onKeyup"],s0=["onClick"],r0=a("i",{class:"mdi mdi-pencil",style:{opacity:"0",color:"#6366f1","margin-left":"4px","font-size":"12px"}},null,-1),a0={key:0,style:{padding:"4px 8px",display:"flex","align-items":"center","justify-content":"flex-end","font-size":"14px","min-height":"32px"}},l0={style:{"font-weight":"600",color:"#1e293b","font-size":"13px","font-family":"monospace"}},c0={key:1,style:{padding:"4px 8px",display:"flex","align-items":"center","justify-content":"flex-end",gap:"4px","font-size":"14px","min-height":"32px"}},d0={key:0,style:{"font-weight":"600","font-size":"13px","font-family":"monospace",color:"#059669",display:"flex","align-items":"center",gap:"3px"}},p0=a("i",{class:"mdi mdi-arrow-up",style:{"font-size":"14px",color:"#059669"}},null,-1),f0={style:{"font-weight":"600","font-size":"13px","font-family":"monospace",color:"#dc2626",display:"flex","align-items":"center",gap:"3px"}},u0=a("i",{class:"mdi mdi-arrow-down",style:{"font-size":"14px",color:"#dc2626"}},null,-1),_0={style:{"font-weight":"600","font-size":"13px","font-family":"monospace",color:"#64748b"}},h0=a("span",{style:{"font-weight":"600","font-size":"13px","font-family":"monospace",color:"#dc2626"}}," --- ",-1),g0={style:{background:"#f8fafc",padding:"8px 12px","border-top":"1px solid #e2e8f0",display:"flex",gap:"8px","justify-content":"flex-end"}},m0=a("i",{class:"mdi mdi-close",style:{"font-size":"16px"}},null,-1),y0=a("i",{class:"mdi mdi-check",style:{"font-size":"16px"}},null,-1),b0={key:1,style:{display:"flex","align-items":"center",gap:"8px",color:"#f59e0b","font-size":"14px","font-weight":"500",padding:"8px 12px",background:"rgba(245, 158, 11, 0.1)","border-radius":"6px",border:"1px solid rgba(245, 158, 11, 0.2)"}},v0=a("i",{class:"mdi mdi-clock-alert-outline",style:{color:"#ff9800","font-size":"16px"}},null,-1);function va(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" CLOSING DIALOG "),l(" =========================================== "),a("div",Lm,[l(" Modal Overlay "),e.closingDialog?(g(),m("div",{key:0,onClick:t[4]||(t[4]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.7)",display:"flex","align-items":"flex-start","justify-content":"center","padding-top":"5vh","z-index":"1050 !important"}},[l(" Dialog "),a("div",{onClick:t[3]||(t[3]=we(()=>{},["stop"])),style:{background:"white","border-radius":"16px",overflow:"hidden","box-shadow":"0 20px 40px rgba(0, 0, 0, 0.15)","max-width":"95vw","min-width":"700px",width:"auto",border:"1px solid rgba(255, 152, 0, 0.1)"}},[l(" =========================================== "),l(" DIALOG HEADER "),l(" =========================================== "),a("div",Um,[Fm,a("button",{onClick:t[0]||(t[0]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{background:"rgba(255, 255, 255, 0.15)",border:"none","border-radius":"4px",width:"24px",height:"24px",display:"flex","align-items":"center","justify-content":"center",cursor:"pointer"}},jm)]),l(" =========================================== "),l(" DIALOG CONTENT "),l(" =========================================== "),e.pos_profile?(g(),m("div",$m,[l(" Payment Table "),a("div",Bm,[l(" Table Header "),a("div",Hm,[Gm,qm,Wm,e.pos_profile.posa_hide_expected_amount?l("v-if",!0):(g(),m("div",Km,[l(" Expected "),P(" \u0627\u0644\u0645\u062A\u0648\u0642\u0639 ")])),e.pos_profile.posa_hide_expected_amount?l("v-if",!0):(g(),m("div",Ym,[l(" Diff "),P(" \u0627\u0644\u0641\u0631\u0642 ")]))]),l(" Table Body "),a("div",null,[(g(!0),m(V,null,ae(e.dialog_data.payment_reconciliation,(n,c)=>(g(),m("div",{key:n.mode_of_payment,style:k([{display:"grid","grid-template-columns":"2fr 1fr 1fr 1fr 1fr","border-bottom":"1px solid #f1f5f9"},c%2===0?"":"background: #fafbfc"])},[l(" Method "),a("div",Qm,[a("div",Jm,[Xm,a("span",Zm,x(n.mode_of_payment),1)])]),l(" System Amount "),a("div",e0,[a("span",t0,x(e.formatCurrency(n.opening_amount)),1)]),l(" Actual Amount (Editable) "),a("div",o0,[n.editing?(g(),m("div",i0,[ee(a("input",{"onUpdate:modelValue":p=>n.closing_amount=p,type:"number",required:n.expected_amount&&n.expected_amount>0,onInput:p=>e.updateDifference(n),onBlur:p=>{n.editing=!1,e.updateDifference(n)},onKeyup:Fe(p=>{n.editing=!1,e.updateDifference(n)},["enter"]),style:{width:"100%",border:"none",outline:"none",background:"transparent","text-align":"right","font-size":"13px","font-weight":"600","font-family":"monospace"}},null,40,n0),[[ue,n.closing_amount,void 0,{number:!0}]])])):(g(),m("div",{key:1,onClick:p=>n.editing=!0,style:{cursor:"pointer",padding:"4px 8px","border-radius":"4px",background:"#f0f9ff",border:"1px solid #e0e7ff","min-width":"100px",display:"inline-flex","align-items":"center","justify-content":"flex-end"}},[a("span",{style:k([{"font-weight":"600","font-size":"13px","font-family":"monospace"},n.expected_amount&&n.expected_amount>0&&(!n.closing_amount||n.closing_amount===null||n.closing_amount===void 0||n.closing_amount===""||n.closing_amount===0)?"color: #dc2626":"color: #1e293b"])},x(n.closing_amount!==null&&n.closing_amount!==void 0&&n.closing_amount!==""&&n.closing_amount!==0?e.formatCurrency(n.closing_amount):"---"),5),r0],8,s0))]),l(" Expected Amount "),e.pos_profile.posa_hide_expected_amount?l("v-if",!0):(g(),m("div",a0,[a("span",l0,x(e.formatCurrency(n.expected_amount)),1)])),l(" Difference "),e.pos_profile.posa_hide_expected_amount?l("v-if",!0):(g(),m("div",c0,[n.closing_amount!==null&&n.closing_amount!==void 0&&n.closing_amount!==""&&n.closing_amount!==0?(g(),m(V,{key:0},[l(" \u0627\u0644\u0641\u0639\u0644\u064A > \u0627\u0644\u0645\u062A\u0648\u0642\u0639: \u0623\u062E\u0636\u0631 + \u0633\u0647\u0645 \u0644\u0623\u0639\u0644\u0649 "),n.closing_amount>n.expected_amount?(g(),m("span",d0,[p0,P(" "+x(e.formatCurrency(n.closing_amount-n.expected_amount)),1)])):n.closing_amount<n.expected_amount?(g(),m(V,{key:1},[l(" \u0627\u0644\u0641\u0639\u0644\u064A < \u0627\u0644\u0645\u062A\u0648\u0642\u0639: \u0623\u062D\u0645\u0631 + \u0633\u0647\u0645 \u0644\u0623\u0633\u0641\u0644 "),a("span",f0,[u0,P(" "+x(e.formatCurrency(n.expected_amount-n.closing_amount)),1)])],2112)):(g(),m(V,{key:2},[l(" \u0627\u0644\u0641\u0639\u0644\u064A = \u0627\u0644\u0645\u062A\u0648\u0642\u0639: \u0631\u0645\u0627\u062F\u064A "),a("span",_0,x(e.formatCurrency(0)),1)],2112))],64)):(g(),m(V,{key:1},[l(" \u0627\u0644\u062D\u0642\u0644 \u0641\u0627\u0631\u063A "),h0],2112))]))],4))),128))])])])):l("v-if",!0),l(" =========================================== "),l(" DIALOG FOOTER "),l(" =========================================== "),a("div",g0,[l(" Cancel Button "),a("button",{onClick:t[1]||(t[1]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{display:"flex","align-items":"center",gap:"4px",padding:"6px 12px","border-radius":"6px","font-size":"14px","font-weight":"500",cursor:"pointer",border:"1px solid #cbd5e1",background:"#f1f5f9",color:"#475569"}},[l(" Cancel "),m0,P(" \u0625\u0644\u063A\u0627\u0621 ")]),l(" Submit Button "),e.isClosingAllowed&&e.isAllRequiredFieldsFilled?(g(),m("button",{key:0,onClick:t[2]||(t[2]=we((...n)=>e.submit_dialog&&e.submit_dialog(...n),["prevent"])),type:"button",style:{display:"flex","align-items":"center",gap:"4px",padding:"6px 12px","border-radius":"6px","font-size":"14px","font-weight":"500",cursor:"pointer",border:"none",background:"#10b981",color:"white"}},[l(" Submit "),y0,P(" \u062A\u0623\u0643\u064A\u062F ")])):l("v-if",!0),l(" Time Restriction Message "),!e.isClosingAllowed&&e.closingTimeMessage?(g(),m("div",b0,[v0,P(" "+x(e.closingTimeMessage),1)])):l("v-if",!0)])])])):l("v-if",!0)])],2112)}Ui.render=va;Ui.__file="../posawesome/posawesome/public/js/posapp/components/pos/ClosingDialog.vue";var xa=Ui;var Fi={data:()=>({addressDialog:!1,address:{},customer:""}),methods:{close_dialog(){this.addressDialog=!1},submit_dialog(){let e=this;this.address.customer=this.customer,this.address.doctype="Customer",frappe.call({method:X.CUSTOMER.CREATE_CUSTOMER_ADDRESS,args:{args:this.address},callback:t=>{t.exc||(d.emit("add_the_new_address",t.message),e.addressDialog=!1,e.customer="",e.address={})}})}},created:function(){d.on("open_new_address",e=>{this.addressDialog=!0,this.customer=e})},beforeDestroy(){d&&typeof d.off=="function"&&d.off("open_new_address")}};var x0={style:{display:"flex","justify-content":"center","align-items":"center"}},w0={style:{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},E0={style:{padding:"12px 16px","border-bottom":"1px solid #e0e0e0",background:"#f5f5f5",position:"relative"}},O0=a("span",{style:{"font-size":"1.25rem","font-weight":"700",color:"#1976d2"}},[l(" Add New Address "),P(" \u0625\u0636\u0627\u0641\u0629 \u0639\u0646\u0648\u0627\u0646 \u062C\u062F\u064A\u062F ")],-1),T0={style:{padding:"8px"}},S0={style:{padding:"8px"}},C0={style:{padding:"4px","margin-bottom":"4px"}},N0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},k0=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" Address Title "),P(" \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 ")],-1),D0={style:{padding:"4px","margin-bottom":"4px"}},I0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},P0=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" Address Line 1 "),P(" \u0627\u0644\u0633\u0637\u0631 \u0627\u0644\u0623\u0648\u0644 \u0645\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 ")],-1),A0={style:{padding:"4px","margin-bottom":"4px"}},R0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},M0=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" Address Line 2 "),P(" \u0627\u0644\u0633\u0637\u0631 \u0627\u0644\u062B\u0627\u0646\u064A \u0645\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646 ")],-1),V0={style:{display:"flex",gap:"8px","margin-bottom":"4px"}},L0={style:{flex:"0 0 calc(50% - 4px)","max-width":"calc(50% - 4px)",padding:"4px"}},U0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},F0=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" City "),P(" \u0627\u0644\u0645\u062F\u064A\u0646\u0629 ")],-1),z0={style:{flex:"0 0 calc(50% - 4px)","max-width":"calc(50% - 4px)",padding:"4px"}},j0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%"}},$0=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" State "),P(" \u0627\u0644\u0648\u0644\u0627\u064A\u0629 ")],-1),B0={style:{display:"flex","align-items":"center","justify-content":"flex-end",gap:"8px",padding:"12px 16px 0","border-top":"1px solid #e0e0e0"}},H0=a("div",{style:{flex:"1"}},null,-1);function wa(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" NEW ADDRESS DIALOG "),l(" =========================================== "),a("div",x0,[l(" Modal Overlay "),e.addressDialog?(g(),m("div",{key:0,onClick:t[9]||(t[9]=n=>e.addressDialog=!1),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"}},[l(" Modal "),a("div",{onClick:t[8]||(t[8]=we(()=>{},["stop"])),style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"480px",width:"90%","max-height":"90vh",overflow:"hidden"}},[l(" Card "),a("div",w0,[l(" =========================================== "),l(" CARD HEADER "),l(" =========================================== "),a("div",E0,[O0,a("button",{onClick:t[0]||(t[0]=n=>e.addressDialog=!1),style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none","font-size":"1.5rem",color:"#999",cursor:"pointer",width:"32px",height:"32px",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}}," \xD7 ")]),l(" =========================================== "),l(" CARD BODY "),l(" =========================================== "),a("div",T0,[a("div",S0,[l(" Address Title "),a("div",C0,[a("div",N0,[k0,ee(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.address.name=n),placeholder:"\u0623\u062F\u062E\u0644 \u0639\u0646\u0648\u0627\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646",style:{width:"100%",padding:"6px 10px","font-size":"0.8rem","min-height":"36px",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.address.name]])])]),l(" Address Line 1 "),a("div",D0,[a("div",I0,[P0,ee(a("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=n=>e.address.address_line1=n),placeholder:"\u0623\u062F\u062E\u0644 \u0627\u0644\u0633\u0637\u0631 \u0627\u0644\u0623\u0648\u0644 \u0645\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646",style:{width:"100%",padding:"6px 10px","font-size":"0.8rem","min-height":"36px",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.address.address_line1]])])]),l(" Address Line 2 "),a("div",A0,[a("div",R0,[M0,ee(a("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>e.address.address_line2=n),placeholder:"\u0623\u062F\u062E\u0644 \u0627\u0644\u0633\u0637\u0631 \u0627\u0644\u062B\u0627\u0646\u064A \u0645\u0646 \u0627\u0644\u0639\u0646\u0648\u0627\u0646",style:{width:"100%",padding:"6px 10px","font-size":"0.8rem","min-height":"36px",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.address.address_line2]])])]),l(" City & State "),a("div",V0,[l(" City "),a("div",L0,[a("div",U0,[F0,ee(a("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=n=>e.address.city=n),placeholder:"\u0623\u062F\u062E\u0644 \u0627\u0644\u0645\u062F\u064A\u0646\u0629",style:{width:"100%",padding:"6px 10px","font-size":"0.8rem","min-height":"36px",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.address.city]])])]),l(" State "),a("div",z0,[a("div",j0,[$0,ee(a("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=n=>e.address.state=n),placeholder:"\u0623\u062F\u062E\u0644 \u0627\u0644\u0648\u0644\u0627\u064A\u0629",style:{width:"100%",padding:"6px 10px","font-size":"0.8rem","min-height":"36px",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,512),[[ue,e.address.state]])])])])])]),l(" =========================================== "),l(" CARD FOOTER "),l(" =========================================== "),a("div",B0,[H0,l(" Cancel Button "),a("button",{onClick:t[6]||(t[6]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"4px 12px",height:"26px","font-size":"11px","font-weight":"500",cursor:"pointer",border:"1px solid #9e9e9e","line-height":"1.5","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",background:"white",color:"#616161","border-radius":"6px","margin-right":"8px"}},[l(" Cancel "),P(" \u0625\u0644\u063A\u0627\u0621 ")]),l(" Confirm Button "),a("button",{onClick:t[7]||(t[7]=(...n)=>e.submit_dialog&&e.submit_dialog(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"4px 12px",height:"26px","font-size":"11px","font-weight":"500",cursor:"pointer",border:"1px solid #1565c0","line-height":"1.5","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #1976d2 0%, #1e88e5 100%)",color:"white","border-radius":"6px"}},[l(" Confirm "),P(" \u062A\u0623\u0643\u064A\u062F ")])])])])])):l("v-if",!0)])],2112)}Fi.render=wa;Fi.__file="../posawesome/posawesome/public/js/posapp/components/pos/NewAddress.vue";var Ea=Fi;var jo={OPEN_RETURNS:"open_returns",LOAD_RETURN_INVOICE:"load_return_invoice",SHOW_MESSAGE:"show_mesage"},G0=[{title:"\u0627\u0644\u0639\u0645\u064A\u0644",key:"customer",align:"start",sortable:!0},{title:"\u0627\u0644\u062A\u0627\u0631\u064A\u062E",key:"posting_date",align:"start",sortable:!0},{title:"\u0627\u0644\u0648\u0642\u062A",key:"posting_time",align:"center",sortable:!1},{title:"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",key:"name",align:"start",sortable:!0},{title:"\u0627\u0644\u062D\u0627\u0644\u0629",key:"invoice_status",align:"center",sortable:!1},{title:"\u0627\u0644\u0645\u0628\u0644\u063A",key:"grand_total",align:"end",sortable:!1}],q0="Khaleej Women",zi={mixins:[Re],data(){return{invoicesDialog:!1,selected:null,dialog_data:[],isLoading:!1,company:"",invoice_name:"",pos_profile:null,pos_opening_shift:null,headers:G0}},beforeUnmount(){d.off(jo.OPEN_RETURNS)},created(){d.on(jo.OPEN_RETURNS,e=>{this.invoicesDialog=!0,this.pos_profile=e.pos_profile||null,this.pos_opening_shift=e.pos_opening_shift||null,this.company=this.getCompany(),this.dialog_data=[],this.selected=null,this.search_invoices()})},methods:{getInvoiceUrl(e){return`/app/sales-invoice/${encodeURIComponent(e)}`},showMessage(e,t){d.emit(jo.SHOW_MESSAGE,{text:e,color:t})},getCompany(){var e,t;return((e=this.pos_profile)==null?void 0:e.company)||((t=this.pos_opening_shift)==null?void 0:t.company)||this.company||q0},close_dialog(){this.$nextTick(()=>{this.invoicesDialog=!1,this.selected=null,this.dialog_data=[],this.invoice_name=""})},search_invoices(){var e;this.company=this.getCompany(),this.isLoading=!0,frappe.call({method:X.SALES_INVOICE.GET_INVOICES_FOR_RETURN,args:{invoice_name:this.invoice_name||"",company:this.company,pos_profile:((e=this.pos_profile)==null?void 0:e.name)||null},callback:t=>{var o;this.isLoading=!1,this.dialog_data=((o=t.message)==null?void 0:o.length)>0?t.message.map(i=>({name:i.name,customer:i.customer,posting_date:i.posting_date,posting_time:i.posting_time||null,grand_total:i.grand_total,outstanding_amount:i.outstanding_amount||0,paid_amount:i.paid_amount||0,currency:i.currency,items:i.items||[],invoice_status:i.invoice_status||i.status||"-",status:i.status||"-"})):[],this.displaySearchResultsMessage()},error:()=>{this.isLoading=!1,this.showMessage("\u0641\u0634\u0644 \u0627\u0644\u0628\u062D\u062B \u0639\u0646 \u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631","error")}})},displaySearchResultsMessage(){if(this.dialog_data.length===0){let e=this.invoice_name?"\u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0641\u0648\u0627\u062A\u064A\u0631 \u0645\u0637\u0627\u0628\u0642\u0629 \u0644\u0644\u0628\u062D\u062B":`\u0644\u0627 \u062A\u0648\u062C\u062F \u0641\u0648\u0627\u062A\u064A\u0631 \u0645\u062A\u0627\u062D\u0629 \u0644\u0644\u0625\u0631\u062C\u0627\u0639 \u0641\u064A \u0627\u0644\u0634\u0631\u0643\u0629: ${this.company}`}},async fetchOriginalInvoice(e){try{return(await frappe.call({method:X.FRAPPE.CLIENT_GET,args:{doctype:"Sales Invoice",name:e}})).message}catch(t){return console.log("[Returns.js] fetchOriginalInvoice error:",t),this.showMessage("\u0641\u0634\u0644 \u062C\u0644\u0628 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629","error"),null}},validateReturnItems(e,t){let o=t.items.map(s=>s.item_code),i=e.filter(s=>!o.includes(s.item_code));return i.length>0?(this.showMessage(`\u0627\u0644\u0623\u0635\u0646\u0627\u0641 \u0627\u0644\u062A\u0627\u0644\u064A\u0629 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F\u0629 \u0641\u064A \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629: ${i.map(s=>s.item_code).join(", ")}`,"error"),!1):!0},createReturnInvoiceDoc(e){var t;return{items:e.items.map(o=>Ce(ve({},o),{qty:Math.abs(o.qty)*-1,stock_qty:Math.abs(o.stock_qty||o.qty)*-1,amount:Math.abs(o.amount)*-1,posa_row_id:Date.now().toString(36)+Math.random().toString(36).substr(2,5),posa_offers:"[]",posa_offer_applied:0,posa_is_offer:0,posa_is_replace:0,is_free_item:0,sales_invoice_item:o.name,name:null})),is_return:1,return_against:e.name,company:this.getCompany(),customer:e.customer,posa_pos_opening_shift:(t=this.pos_opening_shift)==null?void 0:t.name,pos_opening_shift:this.pos_opening_shift||null,pos_profile:this.pos_profile||null}},selectInvoice(e){this.selected=e},async submit_dialog(){if(!this.selected||!this.dialog_data.length){this.showMessage("\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0641\u0627\u062A\u0648\u0631\u0629 \u0635\u062D\u064A\u062D\u0629","error");return}let e=this.selected;if(!e){this.showMessage("\u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0645\u062D\u062F\u062F\u0629 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F\u0629","error");return}let t=e,o=await this.fetchOriginalInvoice(t.name);if(!o){this.showMessage("\u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 \u0627\u0644\u0623\u0635\u0644\u064A\u0629 \u063A\u064A\u0631 \u0645\u0648\u062C\u0648\u062F\u0629","error");return}if(!this.validateReturnItems(t.items,o))return;let i=this.createReturnInvoiceDoc(t);this.invoicesDialog=!1,this.selected=null,this.dialog_data=[],this.invoice_name="",d.emit(jo.LOAD_RETURN_INVOICE,{invoice_doc:i,return_doc:t,original_invoice_payment_info:{grand_total:this.flt(o.grand_total||0),paid_amount:this.flt(o.paid_amount||0),outstanding_amount:this.flt(o.outstanding_amount||0)}})}},beforeDestroy(){d.$off(jo.OPEN_RETURNS)}};var W0={style:{display:"flex","justify-content":"center","align-items":"center"}},K0={style:{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},Y0={style:{background:"#607d8b",color:"white",padding:"12px 16px","border-bottom":"1px solid #e0e0e0",position:"relative"}},Q0=a("span",{style:{color:"white",display:"flex","align-items":"center",gap:"8px","font-size":"1.25rem","font-weight":"700"}},[a("i",{class:"mdi mdi-keyboard-return",style:{"font-size":"18px"}}),l(" Return Invoice "),P(" \u062C\u062F\u0648\u0644 \u0625\u0631\u062C\u0627\u0639 \u0641\u0627\u062A\u0648\u0631\u0629 ")],-1),J0={style:{"max-height":"60vh","overflow-y":"auto",display:"flex","flex-direction":"column",padding:"16px"}},X0={style:{display:"flex",gap:"8px","margin-bottom":"12px"}},Z0={style:{display:"flex","flex-direction":"column",gap:"4px",width:"100%",flex:"1"}},ey=a("label",{style:{"font-size":"0.75rem","font-weight":"600",color:"#555","margin-bottom":"2px"}},[l(" Invoice Number "),P(" \u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 ")],-1),ty={style:{flex:"1","min-height":"0"}},oy={style:{"max-height":"60vh","overflow-y":"auto"}},iy={key:0,style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"40px",gap:"12px"}},ny=a("div",{style:{width:"40px",height:"40px",border:"4px solid #f3f3f3","border-top":"4px solid #1976d2","border-radius":"50%"}},null,-1),sy=a("span",{style:{"font-size":"14px",color:"#666"}},[l(" Loading invoices... "),P(" \u062C\u0627\u0631\u064A \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0641\u0648\u0627\u062A\u064A\u0631... ")],-1),ry=[ny,sy],ay=a("div",{style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",padding:"40px",color:"#999","font-size":"14px"}},[l(" No invoices found "),P(" \u0644\u0645 \u064A\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 \u0641\u0648\u0627\u062A\u064A\u0631 ")],-1),ly={style:{width:"100%","border-collapse":"collapse","font-size":"0.875rem",background:"white","table-layout":"auto"}},cy={style:{"border-bottom":"2px solid #e0e0e0",background:"#607d8b",color:"white"}},dy=["onClick"],py={style:{padding:"10px","text-align":"left","white-space":"nowrap"}},fy={style:{padding:"10px","text-align":"left","white-space":"nowrap"}},uy={style:{padding:"10px","text-align":"center","white-space":"nowrap"}},_y={style:{padding:"10px","text-align":"left","white-space":"nowrap"}},hy=["href"],gy=a("i",{class:"mdi mdi-open-in-new",style:{"font-size":"10px","margin-left":"4px"}},null,-1),my={style:{padding:"10px","text-align":"center","white-space":"nowrap"}},yy={style:{padding:"10px","text-align":"right","font-weight":"600",color:"#1976d2","white-space":"nowrap"}},by={style:{display:"flex","align-items":"center","justify-content":"flex-end",gap:"8px",padding:"12px 16px","border-top":"1px solid #e0e0e0","flex-shrink":"0","margin-top":"auto"}},vy=a("div",{style:{flex:"1"}},null,-1);function Oa(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" RETURNS DIALOG "),l(" =========================================== "),a("div",W0,[l(" Modal Overlay "),e.invoicesDialog?(g(),m("div",{key:0,onClick:t[8]||(t[8]=n=>e.invoicesDialog=!1),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"}},[l(" Modal "),a("div",{onClick:t[7]||(t[7]=we(()=>{},["stop"])),style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"90vw","min-width":"600px",width:"auto","max-height":"90vh",overflow:"hidden"}},[l(" Card "),a("div",K0,[l(" =========================================== "),l(" CARD HEADER "),l(" =========================================== "),a("div",Y0,[Q0,a("button",{onClick:t[0]||(t[0]=n=>e.invoicesDialog=!1),style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none","font-size":"1.5rem",color:"white",cursor:"pointer",width:"32px",height:"32px",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}}," \xD7 ")]),l(" =========================================== "),l(" CARD BODY "),l(" =========================================== "),a("div",J0,[l(" Search Row "),a("div",X0,[l(" Invoice Number Input "),a("div",Z0,[ey,ee(a("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=n=>e.invoice_name=n),placeholder:"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629",onKeydown:t[2]||(t[2]=Fe((...n)=>e.search_invoices&&e.search_invoices(...n),["enter"])),style:{width:"100%",padding:"8px 12px","font-size":"0.85rem",color:"#333",background:"white",border:"1px solid #d0d0d0","border-radius":"6px",outline:"none"}},null,544),[[ue,e.invoice_name]])]),l(" Search Button "),a("button",{onClick:t[3]||(t[3]=(...n)=>e.search_invoices&&e.search_invoices(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px",height:"40px","font-size":"12px","font-weight":"500",cursor:"pointer",border:"1px solid #1565c0","line-height":"1.5","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #1976d2 0%, #1e88e5 100%)",color:"white","border-radius":"6px","margin-top":"20px"}},[l(" Search "),P(" \u0628\u062D\u062B ")])]),l(" Table Container "),a("div",ty,[a("div",oy,[l(" Loading State "),e.isLoading?(g(),m("div",iy,ry)):e.dialog_data.length===0?(g(),m(V,{key:1},[l(" No Data "),ay],2112)):(g(),m(V,{key:2},[l(" Table "),a("table",ly,[l(" Table Headers "),a("thead",null,[a("tr",cy,[(g(!0),m(V,null,ae(e.headers,n=>(g(),m("th",{key:n.key,style:k({padding:"10px",textAlign:n.align||"left",fontWeight:"600",color:"white",fontSize:"0.75rem",textTransform:"uppercase",whiteSpace:"nowrap"})},x(n.title),5))),128))])]),l(" Table Body "),a("tbody",null,[(g(!0),m(V,null,ae(e.dialog_data,n=>(g(),m("tr",{key:n.name,onClick:c=>e.selectInvoice(n),style:k([e.selected&&e.selected.name===n.name?"background: #e3f2fd; cursor: pointer;":"cursor: pointer;",{"border-bottom":"1px solid #e0e0e0"}])},[l(" Customer "),a("td",py,x(n.customer),1),l(" Posting Date "),a("td",fy,x(n.posting_date),1),l(" Posting Time "),a("td",uy,x(n.posting_time?n.posting_time.split(".")[0]:"-"),1),l(" Invoice Name "),a("td",_y,[a("a",{href:e.getInvoiceUrl(n.name),target:"_blank",onClick:t[4]||(t[4]=we(()=>{},["stop"])),style:{color:"#3b82f6","font-weight":"600","font-size":"12px","font-family":"'Courier New', monospace","text-decoration":"none"}},[P(x(n.name)+" ",1),gy],8,hy)]),l(" Invoice Status "),a("td",my,[a("span",{style:k({display:"inline-block",padding:"4px 12px",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",whiteSpace:"nowrap",backgroundColor:(n.invoice_status||n.status)==="Paid"?"#e8f5e9":(n.invoice_status||n.status)==="Unpaid"?"#ffebee":(n.invoice_status||n.status)==="Partly Paid"?"#fff3e0":(n.invoice_status||n.status)==="Return"?"#f3e5f5":(n.invoice_status||n.status)==="Credit Note Issued"?"#e1bee7":"#f5f5f5",color:(n.invoice_status||n.status)==="Paid"?"#2e7d32":(n.invoice_status||n.status)==="Unpaid"?"#c62828":(n.invoice_status||n.status)==="Partly Paid"?"#e65100":(n.invoice_status||n.status)==="Return"?"#6a1b9a":(n.invoice_status||n.status)==="Credit Note Issued"?"#7b1fa2":"#616161",border:(n.invoice_status||n.status)==="Paid"?"1px solid #4caf50":(n.invoice_status||n.status)==="Unpaid"?"1px solid #ef5350":(n.invoice_status||n.status)==="Partly Paid"?"1px solid #ff9800":(n.invoice_status||n.status)==="Return"?"1px solid #9c27b0":(n.invoice_status||n.status)==="Credit Note Issued"?"1px solid #ab47bc":"1px solid #9e9e9e"})},x(n.invoice_status||n.status||"-"),5)]),l(" Grand Total "),a("td",yy,x(e.currencySymbol(n.currency))+" "+x(e.formatCurrency(n.grand_total)),1)],12,dy))),128))])])],2112))])])]),l(" =========================================== "),l(" CARD FOOTER "),l(" =========================================== "),a("div",by,[vy,l(" Close Button "),a("button",{onClick:t[5]||(t[5]=(...n)=>e.close_dialog&&e.close_dialog(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"6px 16px","border-radius":"6px","font-size":"12px","font-weight":"500",cursor:"pointer",border:"1px solid #d32f2f","line-height":"1.5","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",background:"white",color:"#d32f2f"}},[l(" Close "),P(" \u0625\u063A\u0644\u0627\u0642 ")]),l(" Select Button "),a("button",{onClick:t[6]||(t[6]=(...n)=>e.submit_dialog&&e.submit_dialog(...n)),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"6px 16px","border-radius":"6px","font-size":"12px","font-weight":"500",cursor:"pointer",border:"1px solid #2e7d32","line-height":"1.5","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.1)",background:"linear-gradient(135deg, #4caf50 0%, #388e3c 100%)",color:"white"}},[l(" Select "),P(" \u0627\u062E\u062A\u0631 ")])])])])])):l("v-if",!0)])],2112)}zi.render=Oa;zi.__file="../posawesome/posawesome/public/js/posapp/components/pos/Returns.vue";var Ta=zi;var ji={OPEN_DRAFTS_DIALOG:"open_drafts_dialog",LOAD_DRAFT_INVOICE:"load_draft_invoice",SHOW_MESSAGE:"show_mesage"},$i={mixins:[Re],data(){return{draftsDialog:!1,selected:null,dialog_data:[],isLoading:!1}},beforeUnmount(){d.off(ji.OPEN_DRAFTS_DIALOG)},created(){d.on(ji.OPEN_DRAFTS_DIALOG,e=>{console.log("[Drafts.js] Opening drafts dialog with",(e==null?void 0:e.length)||0,"invoices"),this.draftsDialog=!0,this.dialog_data=e||[],this.selected=null,this.isLoading=!1})},methods:{selectInvoice(e){this.selected=e},submit_dialog(){if(!this.selected){d.emit(ji.SHOW_MESSAGE,{text:"\u064A\u0631\u062C\u0649 \u0627\u062E\u062A\u064A\u0627\u0631 \u0641\u0627\u062A\u0648\u0631\u0629",color:"error"});return}if(this.draftsDialog===!1)return;let e=this.selected;this.draftsDialog=!1,this.selected=null,this.$nextTick(()=>{d.emit(ji.LOAD_DRAFT_INVOICE,e)})}}};var xy={style:{display:"flex","justify-content":"center","align-items":"center"}},wy={style:{background:"white","border-radius":"12px",overflow:"hidden","box-shadow":"0 4px 12px rgba(0, 0, 0, 0.1)"}},Ey={style:{background:"linear-gradient(135deg, #2196f3 0%, #1976d2 100%)",color:"white",padding:"12px 16px","border-bottom":"1px solid #e0e0e0",position:"relative"}},Oy=a("span",{style:{color:"white",display:"flex","align-items":"center",gap:"8px","font-size":"1.25rem","font-weight":"700"}},[a("i",{class:"mdi mdi-file-document-edit",style:{"font-size":"18px"}}),l(" Load Draft Invoice "),P(" \u062C\u062F\u0648\u0644 \u062A\u0643\u0645\u0644\u0629 \u0641\u0627\u062A\u0648\u0631\u0629 ")],-1),Ty={style:{padding:"16px","max-height":"60vh","overflow-y":"auto"}},Sy={key:0,style:{"text-align":"center",padding:"40px"}},Cy=a("div",{style:{"font-size":"1rem",color:"#666"}},"\u062C\u0627\u0631\u064A \u0627\u0644\u062A\u062D\u0645\u064A\u0644...",-1),Ny=[Cy],ky=a("div",{style:{"text-align":"center",padding:"40px"}},[a("div",{style:{"font-size":"1rem",color:"#666"}},"\u0644\u0627 \u062A\u0648\u062C\u062F \u0641\u0648\u0627\u062A\u064A\u0631 \u0645\u0633\u0648\u062F\u0629")],-1),Dy={style:{width:"100%","border-collapse":"collapse","font-size":"0.9rem"}},Iy=a("thead",null,[a("tr",{style:{background:`linear-gradient(
											135deg,
											#2196f3 0%,
											#1976d2 100%
										)`,"border-bottom":"2px solid #e0e0e0",color:"white"}},[a("th",{style:{padding:"12px","text-align":"right","font-weight":"600",color:"white"}}," \u0627\u0644\u0639\u0645\u064A\u0644 "),a("th",{style:{padding:"12px","text-align":"center","font-weight":"600",color:"white"}}," \u0627\u0644\u062A\u0627\u0631\u064A\u062E "),a("th",{style:{padding:"12px","text-align":"center","font-weight":"600",color:"white"}}," \u0627\u0644\u0648\u0642\u062A "),a("th",{style:{padding:"12px","text-align":"right","font-weight":"600",color:"white"}}," \u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062A\u0648\u0631\u0629 "),a("th",{style:{padding:"12px","text-align":"left","font-weight":"600",color:"white"}}," \u0627\u0644\u0645\u0628\u0644\u063A ")])],-1),Py=["onClick"],Ay={style:{padding:"12px","text-align":"right"}},Ry={style:{padding:"12px","text-align":"center"}},My={style:{padding:"12px","text-align":"center"}},Vy={style:{padding:"12px","text-align":"right","font-weight":"600"}},Ly={style:{padding:"12px","text-align":"left","font-weight":"600"}},Uy={style:{display:"flex","align-items":"center","justify-content":"flex-end",gap:"8px",padding:"16px","border-top":"1px solid #e0e0e0"}},Fy=a("div",{style:{flex:"1"}},null,-1),zy=["disabled"];function Sa(e,t,o,i,s,r){return g(),m(V,null,[l(" =========================================== "),l(" DRAFTS DIALOG "),l(" =========================================== "),a("div",xy,[l(" Modal Overlay "),e.draftsDialog?(g(),m("div",{key:0,onClick:t[4]||(t[4]=n=>e.draftsDialog=!1),style:{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",background:"rgba(0, 0, 0, 0.5)",display:"flex","align-items":"center","justify-content":"center","z-index":"1000"}},[l(" Modal "),a("div",{onClick:t[3]||(t[3]=we(()=>{},["stop"])),style:{background:"white","border-radius":"8px","box-shadow":"0 10px 30px rgba(0, 0, 0, 0.3)","max-width":"90vw","min-width":"600px",width:"auto","max-height":"90vh",overflow:"hidden"}},[l(" Card "),a("div",wy,[l(" =========================================== "),l(" CARD HEADER "),l(" =========================================== "),a("div",Ey,[Oy,a("button",{onClick:t[0]||(t[0]=n=>e.draftsDialog=!1),style:{position:"absolute",top:"8px",right:"8px",background:"none",border:"none","font-size":"1.5rem",color:"white",cursor:"pointer",width:"32px",height:"32px",display:"flex","align-items":"center","justify-content":"center","border-radius":"50%"}}," \xD7 ")]),l(" =========================================== "),l(" CARD BODY "),l(" =========================================== "),a("div",Ty,[l(" Loading State "),e.isLoading?(g(),m("div",Sy,Ny)):!e.dialog_data||e.dialog_data.length===0?(g(),m(V,{key:1},[l(" Empty State "),ky],2112)):(g(),m(V,{key:2},[l(" Table "),a("table",Dy,[Iy,a("tbody",null,[(g(!0),m(V,null,ae(e.dialog_data,n=>(g(),m("tr",{key:n.name,onClick:c=>e.selectInvoice(n),style:k([e.selected&&e.selected.name===n.name?"background: #e3f2fd; cursor: pointer;":"cursor: pointer;",{"border-bottom":"1px solid #e0e0e0"}])},[a("td",Ay,x(n.customer_name||n.customer||"-"),1),a("td",Ry,x(n.posting_date||"-"),1),a("td",My,x(n.posting_time?n.posting_time.split(".")[0]:"-"),1),a("td",Vy,x(n.name),1),a("td",Ly,x(e.currencySymbol(n.currency||"SAR"))+x(e.formatCurrency(n.grand_total||0)),1)],12,Py))),128))])])],2112))]),l(" =========================================== "),l(" CARD FOOTER "),l(" =========================================== "),a("div",Uy,[Fy,a("button",{onClick:t[1]||(t[1]=n=>e.draftsDialog=!1),style:{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #d32f2f","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #f44336 0%, #e53935 100%)",color:"white"}},[l(" Close "),P(" \u0625\u063A\u0644\u0627\u0642 ")]),a("button",{onClick:t[2]||(t[2]=(...n)=>e.submit_dialog&&e.submit_dialog(...n)),disabled:!e.selected,style:k([{display:"inline-flex","align-items":"center","justify-content":"center",padding:"8px 16px","border-radius":"4px","font-size":"13px","font-weight":"500",cursor:"pointer",border:"1px solid #1565c0","line-height":"1.5",margin:"0 4px",background:"linear-gradient(135deg, #1976d2 0%, #1e88e5 100%)",color:"white"},e.selected?"":"background: #e0e0e0; color: #9e9e9e; cursor: not-allowed; border-color: #e0e0e0"])},[l(" Load "),P(" \u062A\u062D\u0645\u064A\u0644 ")],12,zy)])])])])):l("v-if",!0)])],2112)}$i.render=Sa;$i.__file="../posawesome/posawesome/public/js/posapp/components/pos/Drafts.vue";var Ca=$i;var xe={CLOSE_OPENING_DIALOG:"close_opening_dialog",REGISTER_POS_DATA:"register_pos_data",REGISTER_POS_PROFILE:"register_pos_profile",SET_COMPANY:"set_company",SET_POS_OPENING_SHIFT:"set_pos_opening_shift",SET_OFFERS:"set_offers",SET_POS_SETTINGS:"set_pos_settings",SHOW_PAYMENT:"show_payment",SHOW_OFFERS:"show_offers",SHOW_MESSAGE:"show_mesage",OPEN_CLOSING_DIALOG:"open_closing_dialog",OPEN_CLOSING_DIALOG_EMIT:"open_ClosingDialog",SUBMIT_CLOSING_POS:"submit_closing_pos",REQUEST_INVOICE_PRINT:"request_invoice_print",LOAD_POS_PROFILE:"LoadPosProfile"},Bi={name:"PosMain",components:{ItemsSelector:Xr,Invoice:la,OpeningDialog:pa,OpenShiftsWarning:ua,Payments:ha,ClosingDialog:xa,Returns:Ta,Drafts:Ca,PosOffers:ya,NewAddress:Ea},data(){return{dialog:!1,showOpenShiftsWarning:!1,openShifts:[],pos_profile:null,pos_opening_shift:null,payment:!1,offers:!1,offerApplied:null,offerRemoved:!1}},methods:{handleOfferApplied(e){this.offerApplied=null,this.offerRemoved=!1,this.$nextTick(()=>{this.offerApplied=Ce(ve({},e),{_timestamp:Date.now()})})},handleOfferRemoved(e){this.offerApplied=null,this.offerRemoved=e||!0,this.$nextTick(()=>{setTimeout(()=>{this.offerRemoved=!1},100)})},async check_opening_entry(){try{let e=await frappe.call({method:X.POS_OPENING_SHIFT.GET_ALL_OPEN_SHIFTS});if(e.message.success&&e.message.count>1){this.openShifts=e.message.shifts,this.showOpenShiftsWarning=!0;return}let t=await frappe.call({method:X.POS_OPENING_SHIFT.GET_CURRENT_SHIFT_NAME});if(t.message.success&&t.message.data){let o=t.message.data,i=o.pos_profile_data;if(!i){this.show_message("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0645\u0644\u0641 \u0627\u0644\u0634\u062E\u0635\u064A","error");return}this.pos_profile=i,this.pos_opening_shift={name:o.name,company:o.company,period_start_date:o.period_start_date,pos_profile:o.pos_profile,user:o.user},console.log("[Pos.js] POS Profile loaded:",i.name);let s={pos_profile:i,pos_opening_shift:this.pos_opening_shift,company:{name:i.company}};await this.get_offers(i.name),d.emit(xe.REGISTER_POS_PROFILE,s),d.emit(xe.SET_COMPANY,{name:i.company}),d.emit(xe.SET_POS_OPENING_SHIFT,this.pos_opening_shift)}else this.create_opening_voucher()}catch(e){console.log("[Pos.js] check_opening_entry error:",e),this.show_message("\u0641\u0634\u0644 \u0627\u0644\u062A\u062D\u0642\u0642 \u0645\u0646 \u0625\u062F\u062E\u0627\u0644 \u0627\u0644\u0627\u0641\u062A\u062A\u0627\u062D","error")}},create_opening_voucher(){this.dialog=!0},async get_pos_setting(){try{let e=await frappe.db.get_doc("POS Settings",void 0);d.emit(xe.SET_POS_SETTINGS,e)}catch(e){console.log("[Pos.js] get_pos_setting error:",e)}},async get_offers(e){var t,o,i,s,r;try{if(!(((t=this.pos_profile)==null?void 0:t.posa_auto_fetch_offers)!==0&&((o=this.pos_profile)==null?void 0:o.posa_auto_fetch_offers)!=="0"&&((i=this.pos_profile)==null?void 0:i.posa_auto_fetch_offers)!==!1&&((s=this.pos_profile)==null?void 0:s.posa_auto_fetch_offers)!==null&&((r=this.pos_profile)==null?void 0:r.posa_auto_fetch_offers)!==void 0)){d.emit(xe.SET_OFFERS,[]);return}let c=await frappe.call({method:X.POS_OFFER.GET_OFFERS_FOR_PROFILE,args:{profile:e}});c.message?d.emit(xe.SET_OFFERS,c.message):this.show_message("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0639\u0631\u0648\u0636","error")}catch(n){console.log("[Pos.js] get_offers error:",n),this.show_message("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0639\u0631\u0648\u0636","error")}},async get_closing_data(){var e;try{let t=((e=this.pos_opening_shift)==null?void 0:e.name)||this.pos_opening_shift;if(!t){this.show_message("\u0644\u0627 \u064A\u0648\u062C\u062F \u0634\u0641\u062A \u0645\u0641\u062A\u0648\u062D","error");return}console.log(`[Pos.js] get_closing_data shift: ${t}`);let o=await frappe.call({method:X.POS_CLOSING_SHIFT.MAKE_CLOSING_SHIFT,args:{opening_shift:t}});if(o.message){let i=o.message,s=i.pos_transactions?i.pos_transactions.length:0;console.log(`[Pos.js] get_closing_data success: ${s} transactions found`),d.emit(xe.OPEN_CLOSING_DIALOG_EMIT,i)}else this.show_message("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0625\u063A\u0644\u0627\u0642","error")}catch(t){console.log(`[Pos.js] get_closing_data error: ${t.message||t}`),this.show_message("\u0641\u0634\u0644 \u062A\u062D\u0645\u064A\u0644 \u0628\u064A\u0627\u0646\u0627\u062A \u0627\u0644\u0625\u063A\u0644\u0627\u0642","error")}},async handleSubmitClosingPos(e){if(console.log("[Pos.js] ===== handleSubmitClosingPos START ====="),console.log("[Pos.js] Received data:",e),console.log("[Pos.js] data?.success:",e==null?void 0:e.success),console.log("[Pos.js] data?.has_auto_print:",e==null?void 0:e.has_auto_print),e!=null&&e.success){if(console.log(`[Pos.js] handleSubmitClosingPos: Closing shift ${e.closing_shift_name} submitted successfully`),this.show_message("\u062A\u0645 \u0625\u063A\u0644\u0627\u0642 \u0648\u0631\u062F\u064A\u0629 \u0627\u0644\u0635\u0631\u0627\u0641 \u0628\u0646\u062C\u0627\u062D","success"),e.has_auto_print){console.log("[Pos.js] Auto-print was triggered - page reload will happen in ClosingDialog.js"),console.log("[Pos.js] ===== handleSubmitClosingPos END (auto-print case) =====");return}console.log("[Pos.js] No auto-print - will call check_opening_entry() after 1 second"),setTimeout(async()=>{console.log("[Pos.js] Timeout fired - calling check_opening_entry()"),await this.check_opening_entry(),console.log("[Pos.js] check_opening_entry() completed")},1e3),console.log("[Pos.js] ===== handleSubmitClosingPos END (normal case) =====")}else console.log("[Pos.js] data.success is false or undefined - not processing"),console.log("[Pos.js] ===== handleSubmitClosingPos END (no success) =====")},switchPanel(e,t){let o=t==="true";this.payment=e==="payment"&&o,this.offers=e==="offers"&&o},show_message(e,t){d.emit(xe.SHOW_MESSAGE,{text:e,color:t})},onPrintRequest(){d.emit(xe.REQUEST_INVOICE_PRINT)},registerEventListeners(){d.on(xe.CLOSE_OPENING_DIALOG,this.handleCloseOpeningDialog),d.on(xe.REGISTER_POS_DATA,this.handleRegisterPosData),d.on(xe.SHOW_PAYMENT,this.handleShowPayment),d.on(xe.SHOW_OFFERS,this.handleShowOffers),d.on(xe.OPEN_CLOSING_DIALOG,this.handleOpenClosingDialog),d.on(xe.SUBMIT_CLOSING_POS,this.handleSubmitClosingPos)},unregisterEventListeners(){d.$off(xe.CLOSE_OPENING_DIALOG,this.handleCloseOpeningDialog),d.$off(xe.REGISTER_POS_DATA,this.handleRegisterPosData),d.$off(xe.SHOW_PAYMENT,this.handleShowPayment),d.$off(xe.SHOW_OFFERS,this.handleShowOffers),d.$off(xe.OPEN_CLOSING_DIALOG,this.handleOpenClosingDialog),d.$off(xe.SUBMIT_CLOSING_POS,this.handleSubmitClosingPos),d.$off(xe.LOAD_POS_PROFILE)},handleCloseOpeningDialog(){this.dialog=!1},handleRegisterPosData(e){this.pos_profile=e.pos_profile,this.pos_opening_shift=e.pos_opening_shift,this.get_offers(this.pos_profile.name),d.emit(xe.REGISTER_POS_PROFILE,e),d.emit(xe.SET_POS_OPENING_SHIFT,this.pos_opening_shift)},handleShowPayment(e){this.switchPanel("payment",e)},handleShowOffers(e){this.switchPanel("offers",e)},handleOpenClosingDialog(){this.get_closing_data()}},mounted(){this.$nextTick(()=>{this.check_opening_entry(),this.get_pos_setting(),this.registerEventListeners()})},beforeUnmount(){this.unregisterEventListeners()}};var jy={style:{padding:"0 3px 3px 3px",background:"#c4763d85","min-height":"100vh",overflow:"visible"}},$y={style:{display:"flex",gap:"5px","min-height":"calc(100vh - 130px)",width:"100%","margin-top":"3px"}},By={style:{flex:"1",display:"flex","flex-direction":"column","min-width":"0",position:"relative"}},Hy={style:{flex:"1",display:"flex","flex-direction":"column",background:"white","border-radius":"8px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden",border:"1px solid rgba(0, 0, 0, 0.05)",position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},Gy={style:{flex:"1",display:"flex","flex-direction":"column",background:"white","border-radius":"8px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden",border:"1px solid rgba(0, 0, 0, 0.05)",position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},qy={style:{flex:"1",display:"flex","flex-direction":"column",background:"white","border-radius":"8px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden",border:"1px solid rgba(0, 0, 0, 0.05)",position:"absolute",top:"0",left:"0",right:"0",bottom:"0"}},Wy={style:{flex:"1",display:"flex","flex-direction":"column","min-width":"0"}},Ky={style:{flex:"1",display:"flex","flex-direction":"column",background:"white","border-radius":"8px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden",border:"1px solid rgba(0, 0, 0, 0.05)"}};function Na(e,t,o,i,s,r){let n=Ie("ClosingDialog"),c=Ie("Returns"),p=Ie("Drafts"),f=Ie("NewAddress"),_=Ie("OpeningDialog"),b=Ie("OpenShiftsWarning"),y=Ie("ItemsSelector"),A=Ie("PosOffers"),G=Ie("Payments"),C=Ie("Invoice");return g(),m(V,null,[l(" =========================================== "),l(" POS CONTAINER "),l(" =========================================== "),a("div",jy,[l(" =========================================== "),l(" DIALOGS & OVERLAYS "),l(" =========================================== "),de(n),de(c),de(p),de(f),e.dialog?(g(),lo(_,{key:0,dialog:e.dialog},null,8,["dialog"])):l("v-if",!0),de(b,{isOpen:e.showOpenShiftsWarning,shifts:e.openShifts},null,8,["isOpen","shifts"]),l(" =========================================== "),l(" MAIN POS INTERFACE "),l(" =========================================== "),ee(a("div",$y,[l(" =========================================== "),l(" LEFT PANEL (Items/Offers/Payments) "),l(" =========================================== "),a("div",By,[l(" Items Selector Panel "),ee(a("div",Hy,[de(y)],512),[[Lo,!e.payment&&!e.offers]]),l(" Offers Panel "),ee(a("div",Gy,[de(A,{onOfferApplied:e.handleOfferApplied,onOfferRemoved:e.handleOfferRemoved},null,8,["onOfferApplied","onOfferRemoved"])],512),[[Lo,e.offers]]),l(" Payments Panel "),ee(a("div",qy,[de(G,{ref:"payments",onRequestPrint:e.onPrintRequest},null,8,["onRequestPrint"])],512),[[Lo,e.payment]])]),l(" =========================================== "),l(" RIGHT PANEL (Invoice) "),l(" =========================================== "),a("div",Wy,[a("div",Ky,[de(C,{is_payment:e.payment,"offer-applied":e.offerApplied,"offer-removed":e.offerRemoved},null,8,["is_payment","offer-applied","offer-removed"])])])],512),[[Lo,!e.dialog]])])],2112)}Bi.render=Na;Bi.__file="../posawesome/posawesome/public/js/posapp/components/pos/Pos.vue";var ka=Bi;var Hi={data:function(){return{page:"POS"}},components:{Navbar:Yr,POS:ka},methods:{setPage(e){this.page=e}}};var Yy={style:{"font-size":"0.8rem"}};function Da(e,t,o,i,s,r){let n=Ie("Navbar");return g(),m("div",Yy,[a("main",null,[de(n,{onChangePage:e.setPage},null,8,["onChangePage"]),(g(),lo(sr,null,[(g(),lo(Xs(e.page),{style:{margin:"0 auto","max-width":"100%",width:"100%","min-height":"calc(100vh - 32px)"}}))],1024))])])}Hi.render=Da;Hi.__file="../posawesome/posawesome/public/js/posapp/Home.vue";var Ia=Hi;typeof window!="undefined"&&(window.__VUE_OPTIONS_API__=!0,window.__VUE_PROD_DEVTOOLS__=!1,window.__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1);function Qy(e){e.config.globalProperties.$frappe=frappe,typeof frappe!="undefined"&&(e.config.globalProperties.$call=frappe.call,e.config.globalProperties.$format=frappe.format,e.config.globalProperties.$db=frappe.db)}frappe.provide("frappe.PosApp");frappe.PosApp.posapp=class{constructor({parent:e}){this.$parent=$(document),this.page=e.page,this.make_body()}make_body(){this.$el=this.$parent.find(".main-section");let e=Wr(Ia);Qy(e),window.posApp=e,e.mount(this.$el[0])}setup_header(){}};})();
/*! #__NO_SIDE_EFFECTS__ */
//# sourceMappingURL=posawesome.bundle.WWEDSHHE.js.map
